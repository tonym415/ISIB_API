<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/home/tony/public_html/assets/js/lib/jquery.jqgrid.src.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/app/appLib.contentMode.html">app/appLib.contentMode</a></li>
                                <li><a href="../classes/app/appLib.defaults.html">app/appLib.defaults</a></li>
                                <li><a href="../classes/app/appLib.steps.html">app/appLib.steps</a></li>
                                <li><a href="../classes/app/appLib.stepsOrientation.html">app/appLib.stepsOrientation</a></li>
                                <li><a href="../classes/app/appLib.transitionEffect.html">app/appLib.transitionEffect</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/app.html">app</a></li>
                                <li><a href="../modules/feedback.html">feedback</a></li>
                                <li><a href="../modules/game.html">game</a></li>
                                <li><a href="../modules/signup.html">signup</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: /home/tony/public_html/assets/js/lib/jquery.jqgrid.src.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
// ==ClosureCompiler==
// @compilation_level SIMPLE_OPTIMIZATIONS

/**
 * @license jqGrid  4.6.0 - jQuery Grid
 * Copyright (c) 2008, Tony Tomov, tony@trirand.com
 * Dual licensed under the MIT and GPL licenses
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
 * Date: 2014-02-20
 */
//jsHint options
/*jshint evil:true, eqeqeq:false, eqnull:true, devel:true */
/*global jQuery */

(function ($) {
&quot;use strict&quot;;
$.jgrid = $.jgrid || {};
$.extend($.jgrid,{
	version : &quot;4.6.0&quot;,
	htmlDecode : function(value){
		if(value &amp;&amp; (value===&#x27;&amp;nbsp;&#x27; || value===&#x27;&amp;#160;&#x27; || (value.length===1 &amp;&amp; value.charCodeAt(0)===160))) { return &quot;&quot;;}
		return !value ? value : String(value).replace(/&amp;gt;/g, &quot;&gt;&quot;).replace(/&amp;lt;/g, &quot;&lt;&quot;).replace(/&amp;quot;/g, &#x27;&quot;&#x27;).replace(/&amp;amp;/g, &quot;&amp;&quot;);
	},
	htmlEncode : function (value){
		return !value ? value : String(value).replace(/&amp;/g, &quot;&amp;amp;&quot;).replace(/\&quot;/g, &quot;&amp;quot;&quot;).replace(/&lt;/g, &quot;&amp;lt;&quot;).replace(/&gt;/g, &quot;&amp;gt;&quot;);
	},
	format : function(format){ //jqgformat
		var args = $.makeArray(arguments).slice(1);
		if(format==null) { format = &quot;&quot;; }
		return format.replace(/\{(\d+)\}/g, function(m, i){
			return args[i];
		});
	},
	msie : navigator.appName === &#x27;Microsoft Internet Explorer&#x27;,
	msiever : function () {
		var rv = -1;
		var ua = navigator.userAgent;
		var re  = new RegExp(&quot;MSIE ([0-9]{1,}[\.0-9]{0,})&quot;);
		if (re.exec(ua) != null) {
			rv = parseFloat( RegExp.$1 );
		}
		return rv;
	},
	getCellIndex : function (cell) {
		var c = $(cell);
		if (c.is(&#x27;tr&#x27;)) { return -1; }
		c = (!c.is(&#x27;td&#x27;) &amp;&amp; !c.is(&#x27;th&#x27;) ? c.closest(&quot;td,th&quot;) : c)[0];
		if ($.jgrid.msie) { return $.inArray(c, c.parentNode.cells); }
		return c.cellIndex;
	},
	stripHtml : function(v) {
		v = String(v);
		var regexp = /&lt;(&quot;[^&quot;]*&quot;|&#x27;[^&#x27;]*&#x27;|[^&#x27;&quot;&gt;])*&gt;/gi;
		if (v) {
			v = v.replace(regexp,&quot;&quot;);
			return (v &amp;&amp; v !== &#x27;&amp;nbsp;&#x27; &amp;&amp; v !== &#x27;&amp;#160;&#x27;) ? v.replace(/\&quot;/g,&quot;&#x27;&quot;) : &quot;&quot;;
		}
			return v;
	},
	stripPref : function (pref, id) {
		var obj = $.type( pref );
		if( obj === &quot;string&quot; || obj === &quot;number&quot;) {
			pref =  String(pref);
			id = pref !== &quot;&quot; ? String(id).replace(String(pref), &quot;&quot;) : id;
		}
		return id;
	},
	parse : function(jsonString) {
		var js = jsonString;
		if (js.substr(0,9) === &quot;while(1);&quot;) { js = js.substr(9); }
		if (js.substr(0,2) === &quot;/*&quot;) { js = js.substr(2,js.length-4); }
		if(!js) { js = &quot;{}&quot;; }
		return ($.jgrid.useJSON===true &amp;&amp; typeof JSON === &#x27;object&#x27; &amp;&amp; typeof JSON.parse === &#x27;function&#x27;) ?
			JSON.parse(js) :
			eval(&#x27;(&#x27; + js + &#x27;)&#x27;);
	},
	parseDate : function(format, date, newformat, opts) {
		var	token = /\\.|[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g,
		timezone = /\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,
		timezoneClip = /[^-+\dA-Z]/g,
		msDateRegExp = new RegExp(&quot;^\/Date\\((([-+])?[0-9]+)(([-+])([0-9]{2})([0-9]{2}))?\\)\/$&quot;),
		msMatch = ((typeof date === &#x27;string&#x27;) ? date.match(msDateRegExp): null),
		pad = function (value, length) {
			value = String(value);
			length = parseInt(length,10) || 2;
			while (value.length &lt; length)  { value = &#x27;0&#x27; + value; }
			return value;
		},
		ts = {m : 1, d : 1, y : 1970, h : 0, i : 0, s : 0, u:0},
		timestamp=0, dM, k,hl,
		h12to24 = function(ampm, h){
			if (ampm === 0){ if (h === 12) { h = 0;} }
			else { if (h !== 12) { h += 12; } }
			return h;
		};
		if(opts === undefined) {
			opts = $.jgrid.formatter.date;
		}
		// old lang files
		if(opts.parseRe === undefined ) {
			opts.parseRe = /[#%\\\/:_;.,\t\s-]/;
		}
		if( opts.masks.hasOwnProperty(format) ) { format = opts.masks[format]; }
		if(date &amp;&amp; date != null) {
			if( !isNaN( date - 0 ) &amp;&amp; String(format).toLowerCase() === &quot;u&quot;) {
				//Unix timestamp
				timestamp = new Date( parseFloat(date)*1000 );
			} else if(date.constructor === Date) {
				timestamp = date;
				// Microsoft date format support
			} else if( msMatch !== null ) {
				timestamp = new Date(parseInt(msMatch[1], 10));
				if (msMatch[3]) {
					var offset = Number(msMatch[5]) * 60 + Number(msMatch[6]);
					offset *= ((msMatch[4] === &#x27;-&#x27;) ? 1 : -1);
					offset -= timestamp.getTimezoneOffset();
					timestamp.setTime(Number(Number(timestamp) + (offset * 60 * 1000)));
				}
			} else {
				var offset = 0;
				//Support ISO8601Long that have Z at the end to indicate UTC timezone
				if(opts.srcformat === &#x27;ISO8601Long&#x27; &amp;&amp; date.charAt(date.length - 1) === &#x27;Z&#x27;) {
					offset -= (new Date()).getTimezoneOffset();
				}
				date = String(date).replace(/\T/g,&quot;#&quot;).replace(/\t/,&quot;%&quot;).split(opts.parseRe);
				format = format.replace(/\T/g,&quot;#&quot;).replace(/\t/,&quot;%&quot;).split(opts.parseRe);
				// parsing for month names
				for(k=0,hl=format.length;k&lt;hl;k++){
					if(format[k] === &#x27;M&#x27;) {
						dM = $.inArray(date[k],opts.monthNames);
						if(dM !== -1 &amp;&amp; dM &lt; 12){date[k] = dM+1; ts.m = date[k];}
					}
					if(format[k] === &#x27;F&#x27;) {
						dM = $.inArray(date[k],opts.monthNames,12);
						if(dM !== -1 &amp;&amp; dM &gt; 11){date[k] = dM+1-12; ts.m = date[k];}
					}
					if(format[k] === &#x27;a&#x27;) {
						dM = $.inArray(date[k],opts.AmPm);
						if(dM !== -1 &amp;&amp; dM &lt; 2 &amp;&amp; date[k] === opts.AmPm[dM]){
							date[k] = dM;
							ts.h = h12to24(date[k], ts.h);
						}
					}
					if(format[k] === &#x27;A&#x27;) {
						dM = $.inArray(date[k],opts.AmPm);
						if(dM !== -1 &amp;&amp; dM &gt; 1 &amp;&amp; date[k] === opts.AmPm[dM]){
							date[k] = dM-2;
							ts.h = h12to24(date[k], ts.h);
						}
					}
					if (format[k] === &#x27;g&#x27;) {
						ts.h = parseInt(date[k], 10);
					}
					if(date[k] !== undefined) {
						ts[format[k].toLowerCase()] = parseInt(date[k],10);
					}
				}
				if(ts.f) {ts.m = ts.f;}
				if( ts.m === 0 &amp;&amp; ts.y === 0 &amp;&amp; ts.d === 0) {
					return &quot;&amp;#160;&quot; ;
				}
				ts.m = parseInt(ts.m,10)-1;
				var ty = ts.y;
				if (ty &gt;= 70 &amp;&amp; ty &lt;= 99) {ts.y = 1900+ts.y;}
				else if (ty &gt;=0 &amp;&amp; ty &lt;=69) {ts.y= 2000+ts.y;}
				timestamp = new Date(ts.y, ts.m, ts.d, ts.h, ts.i, ts.s, ts.u);
				//Apply offset to show date as local time.
				if(offset &gt; 0) {
					timestamp.setTime(Number(Number(timestamp) + (offset * 60 * 1000)));
				}
			}
		} else {
			timestamp = new Date(ts.y, ts.m, ts.d, ts.h, ts.i, ts.s, ts.u);
		}
		if( newformat === undefined ) {
			return timestamp;
		}
		if( opts.masks.hasOwnProperty(newformat) )  {
			newformat = opts.masks[newformat];
		} else if ( !newformat ) {
			newformat = &#x27;Y-m-d&#x27;;
		}
		var
			G = timestamp.getHours(),
			i = timestamp.getMinutes(),
			j = timestamp.getDate(),
			n = timestamp.getMonth() + 1,
			o = timestamp.getTimezoneOffset(),
			s = timestamp.getSeconds(),
			u = timestamp.getMilliseconds(),
			w = timestamp.getDay(),
			Y = timestamp.getFullYear(),
			N = (w + 6) % 7 + 1,
			z = (new Date(Y, n - 1, j) - new Date(Y, 0, 1)) / 86400000,
			flags = {
				// Day
				d: pad(j),
				D: opts.dayNames[w],
				j: j,
				l: opts.dayNames[w + 7],
				N: N,
				S: opts.S(j),
				//j &lt; 11 || j &gt; 13 ? [&#x27;st&#x27;, &#x27;nd&#x27;, &#x27;rd&#x27;, &#x27;th&#x27;][Math.min((j - 1) % 10, 3)] : &#x27;th&#x27;,
				w: w,
				z: z,
				// Week
				W: N &lt; 5 ? Math.floor((z + N - 1) / 7) + 1 : Math.floor((z + N - 1) / 7) || ((new Date(Y - 1, 0, 1).getDay() + 6) % 7 &lt; 4 ? 53 : 52),
				// Month
				F: opts.monthNames[n - 1 + 12],
				m: pad(n),
				M: opts.monthNames[n - 1],
				n: n,
				t: &#x27;?&#x27;,
				// Year
				L: &#x27;?&#x27;,
				o: &#x27;?&#x27;,
				Y: Y,
				y: String(Y).substring(2),
				// Time
				a: G &lt; 12 ? opts.AmPm[0] : opts.AmPm[1],
				A: G &lt; 12 ? opts.AmPm[2] : opts.AmPm[3],
				B: &#x27;?&#x27;,
				g: G % 12 || 12,
				G: G,
				h: pad(G % 12 || 12),
				H: pad(G),
				i: pad(i),
				s: pad(s),
				u: u,
				// Timezone
				e: &#x27;?&#x27;,
				I: &#x27;?&#x27;,
				O: (o &gt; 0 ? &quot;-&quot; : &quot;+&quot;) + pad(Math.floor(Math.abs(o) / 60) * 100 + Math.abs(o) % 60, 4),
				P: &#x27;?&#x27;,
				T: (String(timestamp).match(timezone) || [&quot;&quot;]).pop().replace(timezoneClip, &quot;&quot;),
				Z: &#x27;?&#x27;,
				// Full Date/Time
				c: &#x27;?&#x27;,
				r: &#x27;?&#x27;,
				U: Math.floor(timestamp / 1000)
			};
		return newformat.replace(token, function ($0) {
			return flags.hasOwnProperty($0) ? flags[$0] : $0.substring(1);
		});
	},
	jqID : function(sid){
		return String(sid).replace(/[!&quot;#$%&amp;&#x27;()*+,.\/:; &lt;=&gt;?@\[\\\]\^&#x60;{|}~]/g,&quot;\\$&amp;&quot;);
	},
	guid : 1,
	uidPref: &#x27;jqg&#x27;,
	randId : function( prefix )	{
		return (prefix || $.jgrid.uidPref) + ($.jgrid.guid++);
	},
	getAccessor : function(obj, expr) {
		var ret,p,prm = [], i;
		if( typeof expr === &#x27;function&#x27;) { return expr(obj); }
		ret = obj[expr];
		if(ret===undefined) {
			try {
				if ( typeof expr === &#x27;string&#x27; ) {
					prm = expr.split(&#x27;.&#x27;);
				}
				i = prm.length;
				if( i ) {
					ret = obj;
					while (ret &amp;&amp; i--) {
						p = prm.shift();
						ret = ret[p];
					}
				}
			} catch (e) {}
		}
		return ret;
	},
	getXmlData: function (obj, expr, returnObj) {
		var ret, m = typeof expr === &#x27;string&#x27; ? expr.match(/^(.*)\[(\w+)\]$/) : null;
		if (typeof expr === &#x27;function&#x27;) { return expr(obj); }
		if (m &amp;&amp; m[2]) {
			// m[2] is the attribute selector
			// m[1] is an optional element selector
			// examples: &quot;[id]&quot;, &quot;rows[page]&quot;
			return m[1] ? $(m[1], obj).attr(m[2]) : $(obj).attr(m[2]);
		}
			ret = $(expr, obj);
			if (returnObj) { return ret; }
			//$(expr, obj).filter(&#x27;:last&#x27;); // we use &#x27;:last&#x27; to be more compatible with old version of jqGrid
			return ret.length &gt; 0 ? $(ret).text() : undefined;
	},
	cellWidth : function () {
		var $testDiv = $(&quot;&lt;div class=&#x27;ui-jqgrid&#x27; style=&#x27;left:10000px&#x27;&gt;&lt;table class=&#x27;ui-jqgrid-btable&#x27; style=&#x27;width:5px;&#x27;&gt;&lt;tr class=&#x27;jqgrow&#x27;&gt;&lt;td style=&#x27;width:5px;display:block;&#x27;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&quot;),
		testCell = $testDiv.appendTo(&quot;body&quot;)
			.find(&quot;td&quot;)
			.width();
		$testDiv.remove();
		return Math.abs(testCell-5) &gt; 0.1;
	},
	cell_width : true,
	ajaxOptions: {},
	from : function(source){
		// Original Author Hugo Bonacci
		// License MIT http://jlinq.codeplex.com/license
		var QueryObject=function(d,q){
		if(typeof d===&quot;string&quot;){
			d=$.data(d);
		}
		var self=this,
		_data=d,
		_usecase=true,
		_trim=false,
		_query=q,
		_stripNum = /[\$,%]/g,
		_lastCommand=null,
		_lastField=null,
		_orDepth=0,
		_negate=false,
		_queuedOperator=&quot;&quot;,
		_sorting=[],
		_useProperties=true;
		if(typeof d===&quot;object&quot;&amp;&amp;d.push) {
			if(d.length&gt;0){
				if(typeof d[0]!==&quot;object&quot;){
					_useProperties=false;
				}else{
					_useProperties=true;
				}
			}
		}else{
			throw &quot;data provides is not an array&quot;;
		}
		this._hasData=function(){
			return _data===null?false:_data.length===0?false:true;
		};
		this._getStr=function(s){
			var phrase=[];
			if(_trim){
				phrase.push(&quot;jQuery.trim(&quot;);
			}
			phrase.push(&quot;String(&quot;+s+&quot;)&quot;);
			if(_trim){
				phrase.push(&quot;)&quot;);
			}
			if(!_usecase){
				phrase.push(&quot;.toLowerCase()&quot;);
			}
			return phrase.join(&quot;&quot;);
		};
		this._strComp=function(val){
			if(typeof val===&quot;string&quot;){
				return&quot;.toString()&quot;;
			}
			return&quot;&quot;;
		};
		this._group=function(f,u){
			return({field:f.toString(),unique:u,items:[]});
		};
		this._toStr=function(phrase){
			if(_trim){
				phrase=$.trim(phrase);
			}
			phrase=phrase.toString().replace(/\\/g,&#x27;\\\\&#x27;).replace(/\&quot;/g,&#x27;\\&quot;&#x27;);
			return _usecase ? phrase : phrase.toLowerCase();
		};
		this._funcLoop=function(func){
			var results=[];
			$.each(_data,function(i,v){
				results.push(func(v));
			});
			return results;
		};
		this._append=function(s){
			var i;
			if(_query===null){
				_query=&quot;&quot;;
			} else {
				_query+=_queuedOperator === &quot;&quot; ? &quot; &amp;&amp; &quot; :_queuedOperator;
			}
			for (i=0;i&lt;_orDepth;i++){
				_query+=&quot;(&quot;;
			}
			if(_negate){
				_query+=&quot;!&quot;;
			}
			_query+=&quot;(&quot;+s+&quot;)&quot;;
			_negate=false;
			_queuedOperator=&quot;&quot;;
			_orDepth=0;
		};
		this._setCommand=function(f,c){
			_lastCommand=f;
			_lastField=c;
		};
		this._resetNegate=function(){
			_negate=false;
		};
		this._repeatCommand=function(f,v){
			if(_lastCommand===null){
				return self;
			}
			if(f!==null&amp;&amp;v!==null){
				return _lastCommand(f,v);
			}
			if(_lastField===null){
				return _lastCommand(f);
			}
			if(!_useProperties){
				return _lastCommand(f);
			}
			return _lastCommand(_lastField,f);
		};
		this._equals=function(a,b){
			return(self._compare(a,b,1)===0);
		};
		this._compare=function(a,b,d){
			var toString = Object.prototype.toString;
			if( d === undefined) { d = 1; }
			if(a===undefined) { a = null; }
			if(b===undefined) { b = null; }
			if(a===null &amp;&amp; b===null){
				return 0;
			}
			if(a===null&amp;&amp;b!==null){
				return 1;
			}
			if(a!==null&amp;&amp;b===null){
				return -1;
			}
			if (toString.call(a) === &#x27;[object Date]&#x27; &amp;&amp; toString.call(b) === &#x27;[object Date]&#x27;) {
				if (a &lt; b) { return -d; }
				if (a &gt; b) { return d; }
				return 0;
			}
			if(!_usecase &amp;&amp; typeof a !== &quot;number&quot; &amp;&amp; typeof b !== &quot;number&quot; ) {
				a=String(a);
				b=String(b);
			}
			if(a&lt;b){return -d;}
			if(a&gt;b){return d;}
			return 0;
		};
		this._performSort=function(){
			if(_sorting.length===0){return;}
			_data=self._doSort(_data,0);
		};
		this._doSort=function(d,q){
			var by=_sorting[q].by,
			dir=_sorting[q].dir,
			type = _sorting[q].type,
			dfmt = _sorting[q].datefmt,
			sfunc = _sorting[q].sfunc;
			if(q===_sorting.length-1){
				return self._getOrder(d, by, dir, type, dfmt, sfunc);
			}
			q++;
			var values=self._getGroup(d,by,dir,type,dfmt), results=[], i, j, sorted;
			for(i=0;i&lt;values.length;i++){
				sorted=self._doSort(values[i].items,q);
				for(j=0;j&lt;sorted.length;j++){
					results.push(sorted[j]);
				}
			}
			return results;
		};
		this._getOrder=function(data,by,dir,type, dfmt, sfunc){
			var sortData=[],_sortData=[], newDir = dir===&quot;a&quot; ? 1 : -1, i,ab,j,
			findSortKey;

			if(type === undefined ) { type = &quot;text&quot;; }
			if (type === &#x27;float&#x27; || type=== &#x27;number&#x27; || type=== &#x27;currency&#x27; || type=== &#x27;numeric&#x27;) {
				findSortKey = function($cell) {
					var key = parseFloat( String($cell).replace(_stripNum, &#x27;&#x27;));
					return isNaN(key) ? 0.00 : key;
				};
			} else if (type===&#x27;int&#x27; || type===&#x27;integer&#x27;) {
				findSortKey = function($cell) {
					return $cell ? parseFloat(String($cell).replace(_stripNum, &#x27;&#x27;)) : 0;
				};
			} else if(type === &#x27;date&#x27; || type === &#x27;datetime&#x27;) {
				findSortKey = function($cell) {
					return $.jgrid.parseDate(dfmt,$cell).getTime();
				};
			} else if($.isFunction(type)) {
				findSortKey = type;
			} else {
				findSortKey = function($cell) {
					$cell = $cell ? $.trim(String($cell)) : &quot;&quot;;
					return _usecase ? $cell : $cell.toLowerCase();
				};
			}
			$.each(data,function(i,v){
				ab = by!==&quot;&quot; ? $.jgrid.getAccessor(v,by) : v;
				if(ab === undefined) { ab = &quot;&quot;; }
				ab = findSortKey(ab, v);
				_sortData.push({ &#x27;vSort&#x27;: ab,&#x27;index&#x27;:i});
			});
			if($.isFunction(sfunc)) {
				_sortData.sort(function(a,b){
					a = a.vSort;
					b = b.vSort;
					return sfunc.call(this,a,b,newDir);
				});
			} else {
				_sortData.sort(function(a,b){
					a = a.vSort;
					b = b.vSort;
					return self._compare(a,b,newDir);
				});
			}
			j=0;
			var nrec= data.length;
			// overhead, but we do not change the original data.
			while(j&lt;nrec) {
				i = _sortData[j].index;
				sortData.push(data[i]);
				j++;
			}
			return sortData;
		};
		this._getGroup=function(data,by,dir,type, dfmt){
			var results=[],
			group=null,
			last=null, val;
			$.each(self._getOrder(data,by,dir,type, dfmt),function(i,v){
				val = $.jgrid.getAccessor(v, by);
				if(val == null) { val = &quot;&quot;; }
				if(!self._equals(last,val)){
					last=val;
					if(group !== null){
						results.push(group);
					}
					group=self._group(by,val);
				}
				group.items.push(v);
			});
			if(group !== null){
				results.push(group);
			}
			return results;
		};
		this.ignoreCase=function(){
			_usecase=false;
			return self;
		};
		this.useCase=function(){
			_usecase=true;
			return self;
		};
		this.trim=function(){
			_trim=true;
			return self;
		};
		this.noTrim=function(){
			_trim=false;
			return self;
		};
		this.execute=function(){
			var match=_query, results=[];
			if(match === null){
				return self;
			}
			$.each(_data,function(){
				if(eval(match)){results.push(this);}
			});
			_data=results;
			return self;
		};
		this.data=function(){
			return _data;
		};
		this.select=function(f){
			self._performSort();
			if(!self._hasData()){ return[]; }
			self.execute();
			if($.isFunction(f)){
				var results=[];
				$.each(_data,function(i,v){
					results.push(f(v));
				});
				return results;
			}
			return _data;
		};
		this.hasMatch=function(){
			if(!self._hasData()) { return false; }
			self.execute();
			return _data.length&gt;0;
		};
		this.andNot=function(f,v,x){
			_negate=!_negate;
			return self.and(f,v,x);
		};
		this.orNot=function(f,v,x){
			_negate=!_negate;
			return self.or(f,v,x);
		};
		this.not=function(f,v,x){
			return self.andNot(f,v,x);
		};
		this.and=function(f,v,x){
			_queuedOperator=&quot; &amp;&amp; &quot;;
			if(f===undefined){
				return self;
			}
			return self._repeatCommand(f,v,x);
		};
		this.or=function(f,v,x){
			_queuedOperator=&quot; || &quot;;
			if(f===undefined) { return self; }
			return self._repeatCommand(f,v,x);
		};
		this.orBegin=function(){
			_orDepth++;
			return self;
		};
		this.orEnd=function(){
			if (_query !== null){
				_query+=&quot;)&quot;;
			}
			return self;
		};
		this.isNot=function(f){
			_negate=!_negate;
			return self.is(f);
		};
		this.is=function(f){
			self._append(&#x27;this.&#x27;+f);
			self._resetNegate();
			return self;
		};
		this._compareValues=function(func,f,v,how,t){
			var fld;
			if(_useProperties){
				fld=&#x27;jQuery.jgrid.getAccessor(this,\&#x27;&#x27;+f+&#x27;\&#x27;)&#x27;;
			}else{
				fld=&#x27;this&#x27;;
			}
			if(v===undefined) { v = null; }
			//var val=v===null?f:v,
			var val =v,
			swst = t.stype === undefined ? &quot;text&quot; : t.stype;
			if(v !== null) {
			switch(swst) {
				case &#x27;int&#x27;:
				case &#x27;integer&#x27;:
					val = (isNaN(Number(val)) || val===&quot;&quot;) ? &#x27;0&#x27; : val; // To be fixed with more inteligent code
					fld = &#x27;parseInt(&#x27;+fld+&#x27;,10)&#x27;;
					val = &#x27;parseInt(&#x27;+val+&#x27;,10)&#x27;;
					break;
				case &#x27;float&#x27;:
				case &#x27;number&#x27;:
				case &#x27;numeric&#x27;:
					val = String(val).replace(_stripNum, &#x27;&#x27;);
					val = (isNaN(Number(val)) || val===&quot;&quot;) ? &#x27;0&#x27; : val; // To be fixed with more inteligent code
					fld = &#x27;parseFloat(&#x27;+fld+&#x27;)&#x27;;
					val = &#x27;parseFloat(&#x27;+val+&#x27;)&#x27;;
					break;
				case &#x27;date&#x27;:
				case &#x27;datetime&#x27;:
					val = String($.jgrid.parseDate(t.newfmt || &#x27;Y-m-d&#x27;,val).getTime());
					fld = &#x27;jQuery.jgrid.parseDate(&quot;&#x27;+t.srcfmt+&#x27;&quot;,&#x27;+fld+&#x27;).getTime()&#x27;;
					break;
				default :
					fld=self._getStr(fld);
					val=self._getStr(&#x27;&quot;&#x27;+self._toStr(val)+&#x27;&quot;&#x27;);
			}
			}
			self._append(fld+&#x27; &#x27;+how+&#x27; &#x27;+val);
			self._setCommand(func,f);
			self._resetNegate();
			return self;
		};
		this.equals=function(f,v,t){
			return self._compareValues(self.equals,f,v,&quot;==&quot;,t);
		};
		this.notEquals=function(f,v,t){
			return self._compareValues(self.equals,f,v,&quot;!==&quot;,t);
		};
		this.isNull = function(f,v,t){
			return self._compareValues(self.equals,f,null,&quot;===&quot;,t);
		};
		this.greater=function(f,v,t){
			return self._compareValues(self.greater,f,v,&quot;&gt;&quot;,t);
		};
		this.less=function(f,v,t){
			return self._compareValues(self.less,f,v,&quot;&lt;&quot;,t);
		};
		this.greaterOrEquals=function(f,v,t){
			return self._compareValues(self.greaterOrEquals,f,v,&quot;&gt;=&quot;,t);
		};
		this.lessOrEquals=function(f,v,t){
			return self._compareValues(self.lessOrEquals,f,v,&quot;&lt;=&quot;,t);
		};
		this.startsWith=function(f,v){
			var val = (v==null) ? f: v,
			length=_trim ? $.trim(val.toString()).length : val.toString().length;
			if(_useProperties){
				self._append(self._getStr(&#x27;jQuery.jgrid.getAccessor(this,\&#x27;&#x27;+f+&#x27;\&#x27;)&#x27;)+&#x27;.substr(0,&#x27;+length+&#x27;) == &#x27;+self._getStr(&#x27;&quot;&#x27;+self._toStr(v)+&#x27;&quot;&#x27;));
			}else{
				if (v!=null) { length=_trim?$.trim(v.toString()).length:v.toString().length; }
				self._append(self._getStr(&#x27;this&#x27;)+&#x27;.substr(0,&#x27;+length+&#x27;) == &#x27;+self._getStr(&#x27;&quot;&#x27;+self._toStr(f)+&#x27;&quot;&#x27;));
			}
			self._setCommand(self.startsWith,f);
			self._resetNegate();
			return self;
		};
		this.endsWith=function(f,v){
			var val = (v==null) ? f: v,
			length=_trim ? $.trim(val.toString()).length:val.toString().length;
			if(_useProperties){
				self._append(self._getStr(&#x27;jQuery.jgrid.getAccessor(this,\&#x27;&#x27;+f+&#x27;\&#x27;)&#x27;)+&#x27;.substr(&#x27;+self._getStr(&#x27;jQuery.jgrid.getAccessor(this,\&#x27;&#x27;+f+&#x27;\&#x27;)&#x27;)+&#x27;.length-&#x27;+length+&#x27;,&#x27;+length+&#x27;) == &quot;&#x27;+self._toStr(v)+&#x27;&quot;&#x27;);
			} else {
				self._append(self._getStr(&#x27;this&#x27;)+&#x27;.substr(&#x27;+self._getStr(&#x27;this&#x27;)+&#x27;.length-&quot;&#x27;+self._toStr(f)+&#x27;&quot;.length,&quot;&#x27;+self._toStr(f)+&#x27;&quot;.length) == &quot;&#x27;+self._toStr(f)+&#x27;&quot;&#x27;);
			}
			self._setCommand(self.endsWith,f);self._resetNegate();
			return self;
		};
		this.contains=function(f,v){
			if(_useProperties){
				self._append(self._getStr(&#x27;jQuery.jgrid.getAccessor(this,\&#x27;&#x27;+f+&#x27;\&#x27;)&#x27;)+&#x27;.indexOf(&quot;&#x27;+self._toStr(v)+&#x27;&quot;,0) &gt; -1&#x27;);
			}else{
				self._append(self._getStr(&#x27;this&#x27;)+&#x27;.indexOf(&quot;&#x27;+self._toStr(f)+&#x27;&quot;,0) &gt; -1&#x27;);
			}
			self._setCommand(self.contains,f);
			self._resetNegate();
			return self;
		};
		this.groupBy=function(by,dir,type, datefmt){
			if(!self._hasData()){
				return null;
			}
			return self._getGroup(_data,by,dir,type, datefmt);
		};
		this.orderBy=function(by,dir,stype, dfmt, sfunc){
			dir = dir == null ? &quot;a&quot; :$.trim(dir.toString().toLowerCase());
			if(stype == null) { stype = &quot;text&quot;; }
			if(dfmt == null) { dfmt = &quot;Y-m-d&quot;; }
			if(sfunc == null) { sfunc = false; }
			if(dir===&quot;desc&quot;||dir===&quot;descending&quot;){dir=&quot;d&quot;;}
			if(dir===&quot;asc&quot;||dir===&quot;ascending&quot;){dir=&quot;a&quot;;}
			_sorting.push({by:by,dir:dir,type:stype, datefmt: dfmt, sfunc: sfunc});
			return self;
		};
		return self;
		};
	return new QueryObject(source,null);
	},
	getMethod: function (name) {
        return this.getAccessor($.fn.jqGrid, name);
	},
	extend : function(methods) {
		$.extend($.fn.jqGrid,methods);
		if (!this.no_legacy_api) {
			$.fn.extend(methods);
		}
	}
});

$.fn.jqGrid = function( pin ) {
	if (typeof pin === &#x27;string&#x27;) {
		var fn = $.jgrid.getMethod(pin);
		if (!fn) {
			throw (&quot;jqGrid - No such method: &quot; + pin);
		}
		var args = $.makeArray(arguments).slice(1);
		return fn.apply(this,args);
	}
	return this.each( function() {
		if(this.grid) {return;}

		var p = $.extend(true,{
			url: &quot;&quot;,
			height: 150,
			page: 1,
			rowNum: 20,
			rowTotal : null,
			records: 0,
			pager: &quot;&quot;,
			pgbuttons: true,
			pginput: true,
			colModel: [],
			rowList: [],
			colNames: [],
			sortorder: &quot;asc&quot;,
			sortname: &quot;&quot;,
			datatype: &quot;xml&quot;,
			mtype: &quot;GET&quot;,
			altRows: false,
			selarrrow: [],
			savedRow: [],
			shrinkToFit: true,
			xmlReader: {},
			jsonReader: {},
			subGrid: false,
			subGridModel :[],
			reccount: 0,
			lastpage: 0,
			lastsort: 0,
			selrow: null,
			beforeSelectRow: null,
			onSelectRow: null,
			onSortCol: null,
			ondblClickRow: null,
			onRightClickRow: null,
			onPaging: null,
			onSelectAll: null,
			onInitGrid : null,
			loadComplete: null,
			gridComplete: null,
			loadError: null,
			loadBeforeSend: null,
			afterInsertRow: null,
			beforeRequest: null,
			beforeProcessing : null,
			onHeaderClick: null,
			viewrecords: false,
			loadonce: false,
			multiselect: false,
			multikey: false,
			editurl: null,
			search: false,
			caption: &quot;&quot;,
			hidegrid: true,
			hiddengrid: false,
			postData: {},
			userData: {},
			treeGrid : false,
			treeGridModel : &#x27;nested&#x27;,
			treeReader : {},
			treeANode : -1,
			ExpandColumn: null,
			tree_root_level : 0,
			prmNames: {page:&quot;page&quot;,rows:&quot;rows&quot;, sort: &quot;sidx&quot;,order: &quot;sord&quot;, search:&quot;_search&quot;, nd:&quot;nd&quot;, id:&quot;id&quot;,oper:&quot;oper&quot;,editoper:&quot;edit&quot;,addoper:&quot;add&quot;,deloper:&quot;del&quot;, subgridid:&quot;id&quot;, npage: null, totalrows:&quot;totalrows&quot;},
			forceFit : false,
			gridstate : &quot;visible&quot;,
			cellEdit: false,
			cellsubmit: &quot;remote&quot;,
			nv:0,
			loadui: &quot;enable&quot;,
			toolbar: [false,&quot;&quot;],
			scroll: false,
			multiboxonly : false,
			deselectAfterSort : true,
			scrollrows : false,
			autowidth: false,
			scrollOffset :18,
			cellLayout: 5,
			subGridWidth: 20,
			multiselectWidth: 20,
			gridview: false,
			rownumWidth: 25,
			rownumbers : false,
			pagerpos: &#x27;center&#x27;,
			recordpos: &#x27;right&#x27;,
			footerrow : false,
			userDataOnFooter : false,
			hoverrows : true,
			altclass : &#x27;ui-priority-secondary&#x27;,
			viewsortcols : [false,&#x27;vertical&#x27;,true],
			resizeclass : &#x27;&#x27;,
			autoencode : false,
			remapColumns : [],
			ajaxGridOptions :{},
			direction : &quot;ltr&quot;,
			toppager: false,
			headertitles: false,
			scrollTimeout: 40,
			data : [],
			_index : {},
			grouping : false,
			groupingView : {groupField:[],groupOrder:[], groupText:[],groupColumnShow:[],groupSummary:[], showSummaryOnHide: false, sortitems:[], sortnames:[], summary:[],summaryval:[], plusicon: &#x27;ui-icon-circlesmall-plus&#x27;, minusicon: &#x27;ui-icon-circlesmall-minus&#x27;, displayField: [], groupSummaryPos:[], formatDisplayField : [], _locgr : false},
			ignoreCase : false,
			cmTemplate : {},
			idPrefix : &quot;&quot;,
			multiSort :  false
		}, $.jgrid.defaults, pin || {});
		var ts= this, grid={
			headers:[],
			cols:[],
			footers: [],
			dragStart: function(i,x,y) {
				var gridLeftPos = $(this.bDiv).offset().left;
				this.resizing = { idx: i, startX: x.clientX, sOL : x.clientX - gridLeftPos };
				this.hDiv.style.cursor = &quot;col-resize&quot;;
				this.curGbox = $(&quot;#rs_m&quot;+$.jgrid.jqID(p.id),&quot;#gbox_&quot;+$.jgrid.jqID(p.id));
				this.curGbox.css({display:&quot;block&quot;,left:x.clientX-gridLeftPos,top:y[1],height:y[2]});
				$(ts).triggerHandler(&quot;jqGridResizeStart&quot;, [x, i]);
				if($.isFunction(p.resizeStart)) { p.resizeStart.call(ts,x,i); }
				document.onselectstart=function(){return false;};
			},
			dragMove: function(x) {
				if(this.resizing) {
					var diff = x.clientX-this.resizing.startX,
					h = this.headers[this.resizing.idx],
					newWidth = p.direction === &quot;ltr&quot; ? h.width + diff : h.width - diff, hn, nWn;
					if(newWidth &gt; 33) {
						this.curGbox.css({left:this.resizing.sOL+diff});
						if(p.forceFit===true ){
							hn = this.headers[this.resizing.idx+p.nv];
							nWn = p.direction === &quot;ltr&quot; ? hn.width - diff : hn.width + diff;
							if(nWn &gt;33) {
								h.newWidth = newWidth;
								hn.newWidth = nWn;
							}
						} else {
							this.newWidth = p.direction === &quot;ltr&quot; ? p.tblwidth+diff : p.tblwidth-diff;
							h.newWidth = newWidth;
						}
					}
				}
			},
			dragEnd: function() {
				this.hDiv.style.cursor = &quot;default&quot;;
				if(this.resizing) {
					var idx = this.resizing.idx,
					nw = this.headers[idx].newWidth || this.headers[idx].width;
					nw = parseInt(nw,10);
					this.resizing = false;
					$(&quot;#rs_m&quot;+$.jgrid.jqID(p.id)).css(&quot;display&quot;,&quot;none&quot;);
					p.colModel[idx].width = nw;
					this.headers[idx].width = nw;
					this.headers[idx].el.style.width = nw + &quot;px&quot;;
					this.cols[idx].style.width = nw+&quot;px&quot;;
					if(this.footers.length&gt;0) {this.footers[idx].style.width = nw+&quot;px&quot;;}
					if(p.forceFit===true){
						nw = this.headers[idx+p.nv].newWidth || this.headers[idx+p.nv].width;
						this.headers[idx+p.nv].width = nw;
						this.headers[idx+p.nv].el.style.width = nw + &quot;px&quot;;
						this.cols[idx+p.nv].style.width = nw+&quot;px&quot;;
						if(this.footers.length&gt;0) {this.footers[idx+p.nv].style.width = nw+&quot;px&quot;;}
						p.colModel[idx+p.nv].width = nw;
					} else {
						p.tblwidth = this.newWidth || p.tblwidth;
						$(&#x27;table:first&#x27;,this.bDiv).css(&quot;width&quot;,p.tblwidth+&quot;px&quot;);
						$(&#x27;table:first&#x27;,this.hDiv).css(&quot;width&quot;,p.tblwidth+&quot;px&quot;);
						this.hDiv.scrollLeft = this.bDiv.scrollLeft;
						if(p.footerrow) {
							$(&#x27;table:first&#x27;,this.sDiv).css(&quot;width&quot;,p.tblwidth+&quot;px&quot;);
							this.sDiv.scrollLeft = this.bDiv.scrollLeft;
						}
					}
					$(ts).triggerHandler(&quot;jqGridResizeStop&quot;, [nw, idx]);
					if($.isFunction(p.resizeStop)) { p.resizeStop.call(ts,nw,idx); }
				}
				this.curGbox = null;
				document.onselectstart=function(){return true;};
			},
			populateVisible: function() {
				if (grid.timer) { clearTimeout(grid.timer); }
				grid.timer = null;
				var dh = $(grid.bDiv).height();
				if (!dh) { return; }
				var table = $(&quot;table:first&quot;, grid.bDiv);
				var rows, rh;
				if(table[0].rows.length) {
					try {
						rows = table[0].rows[1];
						rh = rows ? $(rows).outerHeight() || grid.prevRowHeight : grid.prevRowHeight;
					} catch (pv) {
						rh = grid.prevRowHeight;
					}
				}
				if (!rh) { return; }
				grid.prevRowHeight = rh;
				var rn = p.rowNum;
				var scrollTop = grid.scrollTop = grid.bDiv.scrollTop;
				var ttop = Math.round(table.position().top) - scrollTop;
				var tbot = ttop + table.height();
				var div = rh * rn;
				var page, npage, empty;
				if ( tbot &lt; dh &amp;&amp; ttop &lt;= 0 &amp;&amp;
					(p.lastpage===undefined||parseInt((tbot + scrollTop + div - 1) / div,10) &lt;= p.lastpage))
				{
					npage = parseInt((dh - tbot + div - 1) / div,10);
					if (tbot &gt;= 0 || npage &lt; 2 || p.scroll === true) {
						page = Math.round((tbot + scrollTop) / div) + 1;
						ttop = -1;
					} else {
						ttop = 1;
					}
				}
				if (ttop &gt; 0) {
					page = parseInt(scrollTop / div,10) + 1;
					npage = parseInt((scrollTop + dh) / div,10) + 2 - page;
					empty = true;
				}
				if (npage) {
					if (p.lastpage &amp;&amp; (page &gt; p.lastpage || p.lastpage===1 || (page === p.page &amp;&amp; page===p.lastpage)) ) {
						return;
					}
					if (grid.hDiv.loading) {
						grid.timer = setTimeout(grid.populateVisible, p.scrollTimeout);
					} else {
						p.page = page;
						if (empty) {
							grid.selectionPreserver(table[0]);
							grid.emptyRows.call(table[0], false, false);
						}
						grid.populate(npage);
					}
				}
			},
			scrollGrid: function( e ) {
				if(p.scroll) {
					var scrollTop = grid.bDiv.scrollTop;
					if(grid.scrollTop === undefined) { grid.scrollTop = 0; }
					if (scrollTop !== grid.scrollTop) {
						grid.scrollTop = scrollTop;
						if (grid.timer) { clearTimeout(grid.timer); }
						grid.timer = setTimeout(grid.populateVisible, p.scrollTimeout);
					}
				}
				grid.hDiv.scrollLeft = grid.bDiv.scrollLeft;
				if(p.footerrow) {
					grid.sDiv.scrollLeft = grid.bDiv.scrollLeft;
				}
				if( e ) { e.stopPropagation(); }
			},
			selectionPreserver : function(ts) {
				var p = ts.p,
				sr = p.selrow, sra = p.selarrrow ? $.makeArray(p.selarrrow) : null,
				left = ts.grid.bDiv.scrollLeft,
				restoreSelection = function() {
					var i;
					p.selrow = null;
					p.selarrrow = [];
					if(p.multiselect &amp;&amp; sra &amp;&amp; sra.length&gt;0) {
						for(i=0;i&lt;sra.length;i++){
							if (sra[i] !== sr) {
								$(ts).jqGrid(&quot;setSelection&quot;,sra[i],false, null);
							}
						}
					}
					if (sr) {
						$(ts).jqGrid(&quot;setSelection&quot;,sr,false,null);
					}
					ts.grid.bDiv.scrollLeft = left;
					$(ts).unbind(&#x27;.selectionPreserver&#x27;, restoreSelection);
				};
				$(ts).bind(&#x27;jqGridGridComplete.selectionPreserver&#x27;, restoreSelection);
			}
		};
		if(this.tagName.toUpperCase() !== &#x27;TABLE&#x27;) {
			alert(&quot;Element is not a table&quot;);
			return;
		}
		if(document.documentMode !== undefined ) { // IE only
			if(document.documentMode &lt;= 5) {
				alert(&quot;Grid can not be used in this (&#x27;quirks&#x27;) mode!&quot;);
				return;
			}
		}
		$(this).empty().attr(&quot;tabindex&quot;,&quot;0&quot;);
		this.p = p ;
		this.p.useProp = !!$.fn.prop;
		var i, dir;
		if(this.p.colNames.length === 0) {
			for (i=0;i&lt;this.p.colModel.length;i++){
				this.p.colNames[i] = this.p.colModel[i].label || this.p.colModel[i].name;
			}
		}
		if( this.p.colNames.length !== this.p.colModel.length ) {
			alert($.jgrid.errors.model);
			return;
		}
		var gv = $(&quot;&lt;div class=&#x27;ui-jqgrid-view&#x27;&gt;&lt;/div&gt;&quot;),
		isMSIE = $.jgrid.msie;
		ts.p.direction = $.trim(ts.p.direction.toLowerCase());
		if($.inArray(ts.p.direction,[&quot;ltr&quot;,&quot;rtl&quot;]) === -1) { ts.p.direction = &quot;ltr&quot;; }
		dir = ts.p.direction;

		$(gv).insertBefore(this);
		$(this).removeClass(&quot;scroll&quot;).appendTo(gv);
		var eg = $(&quot;&lt;div class=&#x27;ui-jqgrid ui-widget ui-widget-content ui-corner-all&#x27;&gt;&lt;/div&gt;&quot;);
		$(eg).attr({&quot;id&quot; : &quot;gbox_&quot;+this.id,&quot;dir&quot;:dir}).insertBefore(gv);
		$(gv).attr(&quot;id&quot;,&quot;gview_&quot;+this.id).appendTo(eg);
		$(&quot;&lt;div class=&#x27;ui-widget-overlay jqgrid-overlay&#x27; id=&#x27;lui_&quot;+this.id+&quot;&#x27;&gt;&lt;/div&gt;&quot;).insertBefore(gv);
		$(&quot;&lt;div class=&#x27;loading ui-state-default ui-state-active&#x27; id=&#x27;load_&quot;+this.id+&quot;&#x27;&gt;&quot;+this.p.loadtext+&quot;&lt;/div&gt;&quot;).insertBefore(gv);
		$(this).attr({cellspacing:&quot;0&quot;,cellpadding:&quot;0&quot;,border:&quot;0&quot;,&quot;role&quot;:&quot;grid&quot;,&quot;aria-multiselectable&quot;:!!this.p.multiselect,&quot;aria-labelledby&quot;:&quot;gbox_&quot;+this.id});
		var sortkeys = [&quot;shiftKey&quot;,&quot;altKey&quot;,&quot;ctrlKey&quot;],
		intNum = function(val,defval) {
			val = parseInt(val,10);
			if (isNaN(val)) { return defval || 0;}
			return val;
		},
		formatCol = function (pos, rowInd, tv, rawObject, rowId, rdata){
			var cm = ts.p.colModel[pos],
			ral = cm.align, result=&quot;style=\&quot;&quot;, clas = cm.classes, nm = cm.name, celp, acp=[];
			if(ral) { result += &quot;text-align:&quot;+ral+&quot;;&quot;; }
			if(cm.hidden===true) { result += &quot;display:none;&quot;; }
			if(rowInd===0) {
				result += &quot;width: &quot;+grid.headers[pos].width+&quot;px;&quot;;
			} else if (cm.cellattr &amp;&amp; $.isFunction(cm.cellattr))
			{
				celp = cm.cellattr.call(ts, rowId, tv, rawObject, cm, rdata);
				if(celp &amp;&amp; typeof celp === &quot;string&quot;) {
					celp = celp.replace(/style/i,&#x27;style&#x27;).replace(/title/i,&#x27;title&#x27;);
					if(celp.indexOf(&#x27;title&#x27;) &gt; -1) { cm.title=false;}
					if(celp.indexOf(&#x27;class&#x27;) &gt; -1) { clas = undefined;}
					acp = celp.replace(&#x27;-style&#x27;,&#x27;-sti&#x27;).split(/style/);
					if(acp.length === 2 ) {
						acp[1] =  $.trim(acp[1].replace(&#x27;-sti&#x27;,&#x27;-style&#x27;).replace(&quot;=&quot;,&quot;&quot;));
						if(acp[1].indexOf(&quot;&#x27;&quot;) === 0 || acp[1].indexOf(&#x27;&quot;&#x27;) === 0) {
							acp[1] = acp[1].substring(1);
						}
						result += acp[1].replace(/&#x27;/gi,&#x27;&quot;&#x27;);
					} else {
						result += &quot;\&quot;&quot;;
					}
				}
			}
			if(!acp.length) { acp[0] = &quot;&quot;; result += &quot;\&quot;&quot;;}
			result += (clas !== undefined ? (&quot; class=\&quot;&quot;+clas+&quot;\&quot;&quot;) :&quot;&quot;) + ((cm.title &amp;&amp; tv) ? (&quot; title=\&quot;&quot;+$.jgrid.stripHtml(tv)+&quot;\&quot;&quot;) :&quot;&quot;);
			result += &quot; aria-describedby=\&quot;&quot;+ts.p.id+&quot;_&quot;+nm+&quot;\&quot;&quot;;
			return result + acp[0];
		},
		cellVal =  function (val) {
			return val == null || val === &quot;&quot; ? &quot;&amp;#160;&quot; : (ts.p.autoencode ? $.jgrid.htmlEncode(val) : String(val));
		},
		formatter = function (rowId, cellval , colpos, rwdat, _act){
			var cm = ts.p.colModel[colpos],v;
			if(cm.formatter !== undefined) {
				rowId = String(ts.p.idPrefix) !== &quot;&quot; ? $.jgrid.stripPref(ts.p.idPrefix, rowId) : rowId;
				var opts= {rowId: rowId, colModel:cm, gid:ts.p.id, pos:colpos };
				if($.isFunction( cm.formatter ) ) {
					v = cm.formatter.call(ts,cellval,opts,rwdat,_act);
				} else if($.fmatter){
					v = $.fn.fmatter.call(ts,cm.formatter,cellval,opts,rwdat,_act);
				} else {
					v = cellVal(cellval);
				}
			} else {
				v = cellVal(cellval);
			}
			return v;
		},
		addCell = function(rowId,cell,pos,irow, srvr, rdata) {
			var v,prp;
			v = formatter(rowId,cell,pos,srvr,&#x27;add&#x27;);
			prp = formatCol( pos,irow, v, srvr, rowId, rdata);
			return &quot;&lt;td role=\&quot;gridcell\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;;
		},
		addMulti = function(rowid,pos,irow,checked){
			var	v = &quot;&lt;input role=\&quot;checkbox\&quot; type=\&quot;checkbox\&quot;&quot;+&quot; id=\&quot;jqg_&quot;+ts.p.id+&quot;_&quot;+rowid+&quot;\&quot; class=\&quot;cbox\&quot; name=\&quot;jqg_&quot;+ts.p.id+&quot;_&quot;+rowid+&quot;\&quot;&quot; + (checked ? &quot;checked=\&quot;checked\&quot;&quot; : &quot;&quot;)+&quot;/&gt;&quot;,
			prp = formatCol( pos,irow,&#x27;&#x27;,null, rowid, true);
			return &quot;&lt;td role=\&quot;gridcell\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;;
		},
		addRowNum = function (pos,irow,pG,rN) {
			var v =  (parseInt(pG,10)-1)*parseInt(rN,10)+1+irow,
			prp = formatCol( pos,irow,v, null, irow, true);
			return &quot;&lt;td role=\&quot;gridcell\&quot; class=\&quot;ui-state-default jqgrid-rownum\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;;
		},
		reader = function (datatype) {
			var field, f=[], j=0, i;
			for(i =0; i&lt;ts.p.colModel.length; i++){
				field = ts.p.colModel[i];
				if (field.name !== &#x27;cb&#x27; &amp;&amp; field.name !==&#x27;subgrid&#x27; &amp;&amp; field.name !==&#x27;rn&#x27;) {
					f[j]= datatype === &quot;local&quot; ?
					field.name :
					( (datatype===&quot;xml&quot; || datatype === &quot;xmlstring&quot;) ? field.xmlmap || field.name : field.jsonmap || field.name );
					if(ts.p.keyIndex !== false &amp;&amp; field.key===true ) {
						ts.p.keyName = f[j];
					}
					j++;
				}
			}
			return f;
		},
		orderedCols = function (offset) {
			var order = ts.p.remapColumns;
			if (!order || !order.length) {
				order = $.map(ts.p.colModel, function(v,i) { return i; });
			}
			if (offset) {
				order = $.map(order, function(v) { return v&lt;offset?null:v-offset; });
			}
			return order;
		},
		emptyRows = function (scroll, locdata) {
			var firstrow;
			if (this.p.deepempty) {
				$(this.rows).slice(1).remove();
			} else {
				firstrow = this.rows.length &gt; 0 ? this.rows[0] : null;
				$(this.firstChild).empty().append(firstrow);
			}
			if (scroll &amp;&amp; this.p.scroll) {
				$(this.grid.bDiv.firstChild).css({height: &quot;auto&quot;});
				$(this.grid.bDiv.firstChild.firstChild).css({height: 0, display: &quot;none&quot;});
				if (this.grid.bDiv.scrollTop !== 0) {
					this.grid.bDiv.scrollTop = 0;
				}
			}
			if(locdata === true &amp;&amp; this.p.treeGrid) {
				this.p.data = []; this.p._index = {};
			}
		},
		refreshIndex = function() {
			var datalen = ts.p.data.length, idname, i, val,
			ni = ts.p.rownumbers===true ? 1 :0,
			gi = ts.p.multiselect ===true ? 1 :0,
			si = ts.p.subGrid===true ? 1 :0;

			if(ts.p.keyIndex === false || ts.p.loadonce === true) {
				idname = ts.p.localReader.id;
			} else {
				idname = ts.p.colModel[ts.p.keyIndex+gi+si+ni].name;
			}
			for(i =0;i &lt; datalen; i++) {
				val = $.jgrid.getAccessor(ts.p.data[i],idname);
				if (val === undefined) { val=String(i+1); }
				ts.p._index[val] = i;
			}
		},
		constructTr = function(id, hide, altClass, rd, cur, selected) {
			var tabindex = &#x27;-1&#x27;, restAttr = &#x27;&#x27;, attrName, style = hide ? &#x27;display:none;&#x27; : &#x27;&#x27;,
				classes = &#x27;ui-widget-content jqgrow ui-row-&#x27; + ts.p.direction + (altClass ? &#x27; &#x27; + altClass : &#x27;&#x27;) + (selected ? &#x27; ui-state-highlight&#x27; : &#x27;&#x27;),
				rowAttrObj = $(ts).triggerHandler(&quot;jqGridRowAttr&quot;, [rd, cur, id]);
				if( typeof rowAttrObj !== &quot;object&quot; ) {
					rowAttrObj =   $.isFunction(ts.p.rowattr) ? ts.p.rowattr.call(ts, rd, cur, id) :{};
				}
			if(!$.isEmptyObject( rowAttrObj )) {
				if (rowAttrObj.hasOwnProperty(&quot;id&quot;)) {
					id = rowAttrObj.id;
					delete rowAttrObj.id;
				}
				if (rowAttrObj.hasOwnProperty(&quot;tabindex&quot;)) {
					tabindex = rowAttrObj.tabindex;
					delete rowAttrObj.tabindex;
				}
				if (rowAttrObj.hasOwnProperty(&quot;style&quot;)) {
					style += rowAttrObj.style;
					delete rowAttrObj.style;
				}
				if (rowAttrObj.hasOwnProperty(&quot;class&quot;)) {
					classes += &#x27; &#x27; + rowAttrObj[&#x27;class&#x27;];
					delete rowAttrObj[&#x27;class&#x27;];
				}
				// dot&#x27;t allow to change role attribute
				try { delete rowAttrObj.role; } catch(ra){}
				for (attrName in rowAttrObj) {
					if (rowAttrObj.hasOwnProperty(attrName)) {
						restAttr += &#x27; &#x27; + attrName + &#x27;=&#x27; + rowAttrObj[attrName];
					}
				}
			}
			return &#x27;&lt;tr role=&quot;row&quot; id=&quot;&#x27; + id + &#x27;&quot; tabindex=&quot;&#x27; + tabindex + &#x27;&quot; class=&quot;&#x27; + classes + &#x27;&quot;&#x27; +
				(style === &#x27;&#x27; ? &#x27;&#x27; : &#x27; style=&quot;&#x27; + style + &#x27;&quot;&#x27;) + restAttr + &#x27;&gt;&#x27;;
		},
		addXmlData = function (xml,t, rcnt, more, adjust) {
			var startReq = new Date(),
			locdata = (ts.p.datatype !== &quot;local&quot; &amp;&amp; ts.p.loadonce) || ts.p.datatype === &quot;xmlstring&quot;,
			xmlid = &quot;_id_&quot;, xmlRd = ts.p.xmlReader,
			frd = ts.p.datatype === &quot;local&quot; ? &quot;local&quot; : &quot;xml&quot;;
			if(locdata) {
				ts.p.data = [];
				ts.p._index = {};
				ts.p.localReader.id = xmlid;
			}
			ts.p.reccount = 0;
			if($.isXMLDoc(xml)) {
				if(ts.p.treeANode===-1 &amp;&amp; !ts.p.scroll) {
					emptyRows.call(ts, false, true);
					rcnt=1;
				} else { rcnt = rcnt &gt; 1 ? rcnt :1; }
			} else { return; }
			var self= $(ts), i,fpos,ir=0,v,gi=ts.p.multiselect===true?1:0,si=0,addSubGridCell,ni=ts.p.rownumbers===true?1:0,idn, getId,f=[],F,rd ={}, xmlr,rid, rowData=[], cn=(ts.p.altRows === true) ? ts.p.altclass:&quot;&quot;,cn1;
			if(ts.p.subGrid===true) {
				si = 1;
				addSubGridCell = $.jgrid.getMethod(&quot;addSubGridCell&quot;);
			}
			if(!xmlRd.repeatitems) {f = reader(frd);}
			if( ts.p.keyIndex===false) {
				idn = $.isFunction( xmlRd.id ) ?  xmlRd.id.call(ts, xml) : xmlRd.id;
			} else {
				idn = ts.p.keyIndex;
			}
			if(f.length&gt;0 &amp;&amp; !isNaN(idn)) {
				idn=ts.p.keyName;
			}
			if( String(idn).indexOf(&quot;[&quot;) === -1 ) {
				if (f.length) {
					getId = function( trow, k) {return $(idn,trow).text() || k;};
				} else {
					getId = function( trow, k) {return $(xmlRd.cell,trow).eq(idn).text() || k;};
				}
			}
			else {
				getId = function( trow, k) {return trow.getAttribute(idn.replace(/[\[\]]/g,&quot;&quot;)) || k;};
			}
			ts.p.userData = {};
			ts.p.page = intNum($.jgrid.getXmlData(xml, xmlRd.page), ts.p.page);
			ts.p.lastpage = intNum($.jgrid.getXmlData(xml, xmlRd.total), 1);
			ts.p.records = intNum($.jgrid.getXmlData(xml, xmlRd.records));
			if($.isFunction(xmlRd.userdata)) {
				ts.p.userData = xmlRd.userdata.call(ts, xml) || {};
			} else {
				$.jgrid.getXmlData(xml, xmlRd.userdata, true).each(function() {ts.p.userData[this.getAttribute(&quot;name&quot;)]= $(this).text();});
			}
			var gxml = $.jgrid.getXmlData( xml, xmlRd.root, true);
			gxml = $.jgrid.getXmlData( gxml, xmlRd.row, true);
			if (!gxml) { gxml = []; }
			var gl = gxml.length, j=0, grpdata=[], rn = parseInt(ts.p.rowNum,10), br=ts.p.scroll?$.jgrid.randId():1, altr;
			if (gl &gt; 0 &amp;&amp;  ts.p.page &lt;= 0) { ts.p.page = 1; }
			if(gxml &amp;&amp; gl){
			if (adjust) { rn *= adjust+1; }
			var afterInsRow = $.isFunction(ts.p.afterInsertRow), hiderow=false, groupingPrepare;
			if(ts.p.grouping)  {
				hiderow = ts.p.groupingView.groupCollapse === true;
				groupingPrepare = $.jgrid.getMethod(&quot;groupingPrepare&quot;);
			}
			while (j&lt;gl) {
				xmlr = gxml[j];
				rid = getId(xmlr,br+j);
				rid  = ts.p.idPrefix + rid;
				altr = rcnt === 0 ? 0 : rcnt+1;
				cn1 = (altr+j)%2 === 1 ? cn : &#x27;&#x27;;
				var iStartTrTag = rowData.length;
				rowData.push(&quot;&quot;);
				if( ni ) {
					rowData.push( addRowNum(0,j,ts.p.page,ts.p.rowNum) );
				}
				if( gi ) {
					rowData.push( addMulti(rid,ni,j, false) );
				}
				if( si ) {
					rowData.push( addSubGridCell.call(self,gi+ni,j+rcnt) );
				}
				if(xmlRd.repeatitems){
					if (!F) { F=orderedCols(gi+si+ni); }
					var cells = $.jgrid.getXmlData( xmlr, xmlRd.cell, true);
					$.each(F, function (k) {
						var cell = cells[this];
						if (!cell) { return false; }
						v = cell.textContent || cell.text;
						rd[ts.p.colModel[k+gi+si+ni].name] = v;
						rowData.push( addCell(rid,v,k+gi+si+ni,j+rcnt,xmlr, rd) );
					});
				} else {
					for(i = 0; i &lt; f.length;i++) {
						v = $.jgrid.getXmlData( xmlr, f[i]);
						rd[ts.p.colModel[i+gi+si+ni].name] = v;
						rowData.push( addCell(rid, v, i+gi+si+ni, j+rcnt, xmlr, rd) );
					}
				}
				rowData[iStartTrTag] = constructTr(rid, hiderow, cn1, rd, xmlr, false);
				rowData.push(&quot;&lt;/tr&gt;&quot;);
				if(ts.p.grouping) {
					grpdata.push( rowData );
					if(!ts.p.groupingView._locgr) {
						groupingPrepare.call(self, rd, j );
					}
					rowData = [];
				}
				if(locdata || ts.p.treeGrid === true) {
					rd[xmlid] = $.jgrid.stripPref(ts.p.idPrefix, rid);
					ts.p.data.push(rd);
					ts.p._index[rd[xmlid]] = ts.p.data.length-1;
				}
				if(ts.p.gridview === false ) {
					$(&quot;tbody:first&quot;,t).append(rowData.join(&#x27;&#x27;));
					self.triggerHandler(&quot;jqGridAfterInsertRow&quot;, [rid, rd, xmlr]);
					if(afterInsRow) {ts.p.afterInsertRow.call(ts,rid,rd,xmlr);}
					rowData=[];
				}
				rd={};
				ir++;
				j++;
				if(ir===rn) {break;}
			}
			}
			if(ts.p.gridview === true) {
				fpos = ts.p.treeANode &gt; -1 ? ts.p.treeANode: 0;
				if(ts.p.grouping) {
					if(!locdata) {
						self.jqGrid(&#x27;groupingRender&#x27;,grpdata,ts.p.colModel.length, ts.p.page, rn);
					}
					grpdata = null;
				} else if(ts.p.treeGrid === true &amp;&amp; fpos &gt; 0) {
					$(ts.rows[fpos]).after(rowData.join(&#x27;&#x27;));
				} else {
					$(&quot;tbody:first&quot;,t).append(rowData.join(&#x27;&#x27;));
				}
			}
			if(ts.p.subGrid === true ) {
				try {self.jqGrid(&quot;addSubGrid&quot;,gi+ni);} catch (_){}
			}
			ts.p.totaltime = new Date() - startReq;
			if(ir&gt;0) { if(ts.p.records===0) { ts.p.records=gl;} }
			rowData =null;
			if( ts.p.treeGrid === true) {
				try {self.jqGrid(&quot;setTreeNode&quot;, fpos+1, ir+fpos+1);} catch (e) {}
			}
			if(!ts.p.treeGrid &amp;&amp; !ts.p.scroll) {ts.grid.bDiv.scrollTop = 0;}
			ts.p.reccount=ir;
			ts.p.treeANode = -1;
			if(ts.p.userDataOnFooter) { self.jqGrid(&quot;footerData&quot;,&quot;set&quot;,ts.p.userData,true); }
			if(locdata) {
				ts.p.records = gl;
				ts.p.lastpage = Math.ceil(gl/ rn);
			}
			if (!more) { ts.updatepager(false,true); }
			if(locdata) {
				while (ir&lt;gl) {
					xmlr = gxml[ir];
					rid = getId(xmlr,ir+br);
					rid  = ts.p.idPrefix + rid;
					if(xmlRd.repeatitems){
						if (!F) { F=orderedCols(gi+si+ni); }
						var cells2 = $.jgrid.getXmlData( xmlr, xmlRd.cell, true);
						$.each(F, function (k) {
							var cell = cells2[this];
							if (!cell) { return false; }
							v = cell.textContent || cell.text;
							rd[ts.p.colModel[k+gi+si+ni].name] = v;
						});
					} else {
						for(i = 0; i &lt; f.length;i++) {
							v = $.jgrid.getXmlData( xmlr, f[i]);
							rd[ts.p.colModel[i+gi+si+ni].name] = v;
						}
					}
					rd[xmlid] = $.jgrid.stripPref(ts.p.idPrefix, rid);
					if(ts.p.grouping) {
						groupingPrepare.call(self, rd, ir );
					}
					ts.p.data.push(rd);
					ts.p._index[rd[xmlid]] = ts.p.data.length-1;
					rd = {};
					ir++;
				}
				if(ts.p.grouping) {
					ts.p.groupingView._locgr = true;
					self.jqGrid(&#x27;groupingRender&#x27;, grpdata, ts.p.colModel.length, ts.p.page, rn);
					grpdata = null;
				}
			}
		},
		addJSONData = function(data,t, rcnt, more, adjust) {
			var startReq = new Date();
			if(data) {
				if(ts.p.treeANode === -1 &amp;&amp; !ts.p.scroll) {
					emptyRows.call(ts, false, true);
					rcnt=1;
				} else { rcnt = rcnt &gt; 1 ? rcnt :1; }
			} else { return; }

			var dReader, locid = &quot;_id_&quot;, frd,
			locdata = (ts.p.datatype !== &quot;local&quot; &amp;&amp; ts.p.loadonce) || ts.p.datatype === &quot;jsonstring&quot;;
			if(locdata) { ts.p.data = []; ts.p._index = {}; ts.p.localReader.id = locid;}
			ts.p.reccount = 0;
			if(ts.p.datatype === &quot;local&quot;) {
				dReader =  ts.p.localReader;
				frd= &#x27;local&#x27;;
			} else {
				dReader =  ts.p.jsonReader;
				frd=&#x27;json&#x27;;
			}
			var self = $(ts), ir=0,v,i,j,f=[],cur,gi=ts.p.multiselect?1:0,si=ts.p.subGrid===true?1:0,addSubGridCell,ni=ts.p.rownumbers===true?1:0,arrayReader=orderedCols(gi+si+ni),objectReader=reader(frd),rowReader,len,drows,idn,rd={}, fpos, idr,rowData=[],cn=(ts.p.altRows === true) ? ts.p.altclass:&quot;&quot;,cn1;
			ts.p.page = intNum($.jgrid.getAccessor(data,dReader.page), ts.p.page);
			ts.p.lastpage = intNum($.jgrid.getAccessor(data,dReader.total), 1);
			ts.p.records = intNum($.jgrid.getAccessor(data,dReader.records));
			ts.p.userData = $.jgrid.getAccessor(data,dReader.userdata) || {};
			if(si) {
				addSubGridCell = $.jgrid.getMethod(&quot;addSubGridCell&quot;);
			}
			if( ts.p.keyIndex===false ) {
				idn = $.isFunction(dReader.id) ? dReader.id.call(ts, data) : dReader.id;
			} else {
				idn = ts.p.keyIndex;
			}
			if(!dReader.repeatitems) {
				f = objectReader;
				if(f.length&gt;0 &amp;&amp; !isNaN(idn)) {
					idn=ts.p.keyName;
				}
			}
			drows = $.jgrid.getAccessor(data,dReader.root);
			if (drows == null &amp;&amp; $.isArray(data)) { drows = data; }
			if (!drows) { drows = []; }
			len = drows.length; i=0;
			if (len &gt; 0 &amp;&amp; ts.p.page &lt;= 0) { ts.p.page = 1; }
			var rn = parseInt(ts.p.rowNum,10),br=ts.p.scroll?$.jgrid.randId():1, altr, selected=false, selr;
			if (adjust) { rn *= adjust+1; }
			if(ts.p.datatype === &quot;local&quot; &amp;&amp; !ts.p.deselectAfterSort) {
				selected = true;
			}
			var afterInsRow = $.isFunction(ts.p.afterInsertRow), grpdata=[],hiderow=false, groupingPrepare;
			if(ts.p.grouping)  {
				hiderow = ts.p.groupingView.groupCollapse === true;
				groupingPrepare = $.jgrid.getMethod(&quot;groupingPrepare&quot;);
			}
			while (i&lt;len) {
				cur = drows[i];
				idr = $.jgrid.getAccessor(cur,idn);
				if(idr === undefined) {
					if (typeof idn === &quot;number&quot; &amp;&amp; ts.p.colModel[idn+gi+si+ni] != null) {
						// reread id by name
						idr = $.jgrid.getAccessor(cur,ts.p.colModel[idn+gi+si+ni].name);
					}
					if(idr === undefined) {
						idr = br+i;
						if(f.length===0){
							if(dReader.cell){
								var ccur = $.jgrid.getAccessor(cur,dReader.cell) || cur;
								idr = ccur != null &amp;&amp; ccur[idn] !== undefined ? ccur[idn] : idr;
								ccur=null;
							}
						}
					}
				}
				idr  = ts.p.idPrefix + idr;
				altr = rcnt === 1 ? 0 : rcnt;
				cn1 = (altr+i)%2 === 1 ? cn : &#x27;&#x27;;
				if( selected) {
					if( ts.p.multiselect) {
						selr = ($.inArray(idr, ts.p.selarrrow) !== -1);
					} else {
						selr = (idr === ts.p.selrow);
					}
				}
				var iStartTrTag = rowData.length;
				rowData.push(&quot;&quot;);
				if( ni ) {
					rowData.push( addRowNum(0,i,ts.p.page,ts.p.rowNum) );
				}
				if( gi ){
					rowData.push( addMulti(idr,ni,i,selr) );
				}
				if( si ) {
					rowData.push( addSubGridCell.call(self,gi+ni,i+rcnt) );
				}
				rowReader=objectReader;
				if (dReader.repeatitems) {
					if(dReader.cell) {cur = $.jgrid.getAccessor(cur,dReader.cell) || cur;}
					if ($.isArray(cur)) { rowReader=arrayReader; }
				}
				for (j=0;j&lt;rowReader.length;j++) {
					v = $.jgrid.getAccessor(cur,rowReader[j]);
					rd[ts.p.colModel[j+gi+si+ni].name] = v;
					rowData.push( addCell(idr,v,j+gi+si+ni,i+rcnt,cur, rd) );
				}
				rowData[iStartTrTag] = constructTr(idr, hiderow, cn1, rd, cur, selr);
				rowData.push( &quot;&lt;/tr&gt;&quot; );
				if(ts.p.grouping) {
					grpdata.push( rowData );
					if(!ts.p.groupingView._locgr) {
						groupingPrepare.call(self, rd, i);
					}
					rowData = [];
				}
				if(locdata || ts.p.treeGrid===true) {
					rd[locid] = $.jgrid.stripPref(ts.p.idPrefix, idr);
					ts.p.data.push(rd);
					ts.p._index[rd[locid]] = ts.p.data.length-1;
				}
				if(ts.p.gridview === false ) {
					$(&quot;#&quot;+$.jgrid.jqID(ts.p.id)+&quot; tbody:first&quot;).append(rowData.join(&#x27;&#x27;));
					self.triggerHandler(&quot;jqGridAfterInsertRow&quot;, [idr, rd, cur]);
					if(afterInsRow) {ts.p.afterInsertRow.call(ts,idr,rd,cur);}
					rowData=[];//ari=0;
				}
				rd={};
				ir++;
				i++;
				if(ir===rn) { break; }
			}
			if(ts.p.gridview === true ) {
				fpos = ts.p.treeANode &gt; -1 ? ts.p.treeANode: 0;
				if(ts.p.grouping) {
					if(!locdata) {
						self.jqGrid(&#x27;groupingRender&#x27;, grpdata, ts.p.colModel.length, ts.p.page, rn);
						grpdata = null;
					}
				} else if(ts.p.treeGrid === true &amp;&amp; fpos &gt; 0) {
					$(ts.rows[fpos]).after(rowData.join(&#x27;&#x27;));
				} else {
					$(&quot;#&quot;+$.jgrid.jqID(ts.p.id)+&quot; tbody:first&quot;).append(rowData.join(&#x27;&#x27;));
				}
			}
			if(ts.p.subGrid === true ) {
				try { self.jqGrid(&quot;addSubGrid&quot;,gi+ni);} catch (_){}
			}
			ts.p.totaltime = new Date() - startReq;
			if(ir&gt;0) {
				if(ts.p.records===0) { ts.p.records=len; }
			}
			rowData = null;
			if( ts.p.treeGrid === true) {
				try {self.jqGrid(&quot;setTreeNode&quot;, fpos+1, ir+fpos+1);} catch (e) {}
			}
			if(!ts.p.treeGrid &amp;&amp; !ts.p.scroll) {ts.grid.bDiv.scrollTop = 0;}
			ts.p.reccount=ir;
			ts.p.treeANode = -1;
			if(ts.p.userDataOnFooter) { self.jqGrid(&quot;footerData&quot;,&quot;set&quot;,ts.p.userData,true); }
			if(locdata) {
				ts.p.records = len;
				ts.p.lastpage = Math.ceil(len/ rn);
			}
			if (!more) { ts.updatepager(false,true); }
			if(locdata) {
				while (ir&lt;len &amp;&amp; drows[ir]) {
					cur = drows[ir];
					idr = $.jgrid.getAccessor(cur,idn);
					if(idr === undefined) {
						if (typeof idn === &quot;number&quot; &amp;&amp; ts.p.colModel[idn+gi+si+ni] != null) {
							// reread id by name
							idr = $.jgrid.getAccessor(cur,ts.p.colModel[idn+gi+si+ni].name);
						}
						if(idr === undefined) {
							idr = br+ir;
							if(f.length===0){
								if(dReader.cell){
									var ccur2 = $.jgrid.getAccessor(cur,dReader.cell) || cur;
									idr = ccur2 != null &amp;&amp; ccur2[idn] !== undefined ? ccur2[idn] : idr;
									ccur2=null;
								}
							}
						}
					}
					if(cur) {
						idr  = ts.p.idPrefix + idr;
						rowReader=objectReader;
						if (dReader.repeatitems) {
							if(dReader.cell) {cur = $.jgrid.getAccessor(cur,dReader.cell) || cur;}
							if ($.isArray(cur)) { rowReader=arrayReader; }
						}

						for (j=0;j&lt;rowReader.length;j++) {
							rd[ts.p.colModel[j+gi+si+ni].name] = $.jgrid.getAccessor(cur,rowReader[j]);
						}
						rd[locid] = $.jgrid.stripPref(ts.p.idPrefix, idr);
						if(ts.p.grouping) {
							groupingPrepare.call(self, rd, ir );
						}
						ts.p.data.push(rd);
						ts.p._index[rd[locid]] = ts.p.data.length-1;
						rd = {};
					}
					ir++;
				}
				if(ts.p.grouping) {
					ts.p.groupingView._locgr = true;
					self.jqGrid(&#x27;groupingRender&#x27;, grpdata, ts.p.colModel.length, ts.p.page, rn);
					grpdata = null;
				}
			}
		},
		addLocalData = function() {
			var st = ts.p.multiSort ? [] : &quot;&quot;, sto=[], fndsort=false, cmtypes={}, grtypes=[], grindexes=[], srcformat, sorttype, newformat;
			if(!$.isArray(ts.p.data)) {
				return;
			}
			var grpview = ts.p.grouping ? ts.p.groupingView : false, lengrp, gin;
			$.each(ts.p.colModel,function(){
				sorttype = this.sorttype || &quot;text&quot;;
				if(sorttype === &quot;date&quot; || sorttype === &quot;datetime&quot;) {
					if(this.formatter &amp;&amp; typeof this.formatter === &#x27;string&#x27; &amp;&amp; this.formatter === &#x27;date&#x27;) {
						if(this.formatoptions &amp;&amp; this.formatoptions.srcformat) {
							srcformat = this.formatoptions.srcformat;
						} else {
							srcformat = $.jgrid.formatter.date.srcformat;
						}
						if(this.formatoptions &amp;&amp; this.formatoptions.newformat) {
							newformat = this.formatoptions.newformat;
						} else {
							newformat = $.jgrid.formatter.date.newformat;
						}
					} else {
						srcformat = newformat = this.datefmt || &quot;Y-m-d&quot;;
					}
					cmtypes[this.name] = {&quot;stype&quot;: sorttype, &quot;srcfmt&quot;: srcformat,&quot;newfmt&quot;:newformat, &quot;sfunc&quot;: this.sortfunc || null};
				} else {
					cmtypes[this.name] = {&quot;stype&quot;: sorttype, &quot;srcfmt&quot;:&#x27;&#x27;,&quot;newfmt&quot;:&#x27;&#x27;, &quot;sfunc&quot;: this.sortfunc || null};
				}
				if(ts.p.grouping ) {
					for(gin =0, lengrp = grpview.groupField.length; gin&lt; lengrp; gin++) {
						if( this.name === grpview.groupField[gin]) {
							var grindex = this.name;
							if (this.index) {
								grindex = this.index;
							}
							grtypes[gin] = cmtypes[grindex];
							grindexes[gin]= grindex;
						}
					}
				}
				if(ts.p.multiSort) {
					if(this.lso) {
						st.push(this.name);
						var tmplso= this.lso.split(&quot;-&quot;);
						sto.push( tmplso[tmplso.length-1] );
					}
				} else {
					if(!fndsort &amp;&amp; (this.index === ts.p.sortname || this.name === ts.p.sortname)){
						st = this.name; // ???
						fndsort = true;
					}
				}
			});
			if(ts.p.treeGrid) {
				$(ts).jqGrid(&quot;SortTree&quot;, st, ts.p.sortorder, cmtypes[st].stype || &#x27;text&#x27;, cmtypes[st].srcfmt || &#x27;&#x27;);
				return;
			}
			var compareFnMap = {
				&#x27;eq&#x27;:function(queryObj) {return queryObj.equals;},
				&#x27;ne&#x27;:function(queryObj) {return queryObj.notEquals;},
				&#x27;lt&#x27;:function(queryObj) {return queryObj.less;},
				&#x27;le&#x27;:function(queryObj) {return queryObj.lessOrEquals;},
				&#x27;gt&#x27;:function(queryObj) {return queryObj.greater;},
				&#x27;ge&#x27;:function(queryObj) {return queryObj.greaterOrEquals;},
				&#x27;cn&#x27;:function(queryObj) {return queryObj.contains;},
				&#x27;nc&#x27;:function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().contains : queryObj.andNot().contains;},
				&#x27;bw&#x27;:function(queryObj) {return queryObj.startsWith;},
				&#x27;bn&#x27;:function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().startsWith : queryObj.andNot().startsWith;},
				&#x27;en&#x27;:function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().endsWith : queryObj.andNot().endsWith;},
				&#x27;ew&#x27;:function(queryObj) {return queryObj.endsWith;},
				&#x27;ni&#x27;:function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().equals : queryObj.andNot().equals;},
				&#x27;in&#x27;:function(queryObj) {return queryObj.equals;},
				&#x27;nu&#x27;:function(queryObj) {return queryObj.isNull;},
				&#x27;nn&#x27;:function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().isNull : queryObj.andNot().isNull;}

			},
			query = $.jgrid.from(ts.p.data);
			if (ts.p.ignoreCase) { query = query.ignoreCase(); }
			function tojLinq ( group ) {
				var s = 0, index, gor, ror, opr, rule;
				if (group.groups != null) {
					gor = group.groups.length &amp;&amp; group.groupOp.toString().toUpperCase() === &quot;OR&quot;;
					if (gor) {
						query.orBegin();
					}
					for (index = 0; index &lt; group.groups.length; index++) {
						if (s &gt; 0 &amp;&amp; gor) {
							query.or();
						}
						try {
							tojLinq(group.groups[index]);
						} catch (e) {alert(e);}
						s++;
					}
					if (gor) {
						query.orEnd();
					}
				}
				if (group.rules != null) {
					//if(s&gt;0) {
					//	var result = query.select();
					//	query = $.jgrid.from( result);
					//	if (ts.p.ignoreCase) { query = query.ignoreCase(); }
					//}
					try{
						ror = group.rules.length &amp;&amp; group.groupOp.toString().toUpperCase() === &quot;OR&quot;;
						if (ror) {
							query.orBegin();
						}
						for (index = 0; index &lt; group.rules.length; index++) {
							rule = group.rules[index];
							opr = group.groupOp.toString().toUpperCase();
							if (compareFnMap[rule.op] &amp;&amp; rule.field ) {
								if(s &gt; 0 &amp;&amp; opr &amp;&amp; opr === &quot;OR&quot;) {
									query = query.or();
								}
								query = compareFnMap[rule.op](query, opr)(rule.field, rule.data, cmtypes[rule.field]);
							}
							s++;
						}
						if (ror) {
							query.orEnd();
						}
					} catch (g) {alert(g);}
				}
			}

			if (ts.p.search === true) {
				var srules = ts.p.postData.filters;
				if(srules) {
					if(typeof srules === &quot;string&quot;) { srules = $.jgrid.parse(srules);}
					tojLinq( srules );
				} else {
					try {
						query = compareFnMap[ts.p.postData.searchOper](query)(ts.p.postData.searchField, ts.p.postData.searchString,cmtypes[ts.p.postData.searchField]);
					} catch (se){}
				}
			}
			if(ts.p.grouping) {
				for(gin=0; gin&lt;lengrp;gin++) {
					query.orderBy(grindexes[gin],grpview.groupOrder[gin],grtypes[gin].stype, grtypes[gin].srcfmt);
				}
			}
			if(ts.p.multiSort) {
				$.each(st,function(i){
					query.orderBy(this, sto[i], cmtypes[this].stype, cmtypes[this].srcfmt, cmtypes[this].sfunc);
				});
			} else {
				if (st &amp;&amp; ts.p.sortorder &amp;&amp; fndsort) {
					if(ts.p.sortorder.toUpperCase() === &quot;DESC&quot;) {
						query.orderBy(ts.p.sortname, &quot;d&quot;, cmtypes[st].stype, cmtypes[st].srcfmt, cmtypes[st].sfunc);
					} else {
						query.orderBy(ts.p.sortname, &quot;a&quot;, cmtypes[st].stype, cmtypes[st].srcfmt, cmtypes[st].sfunc);
					}
				}
			}
			var queryResults = query.select(),
			recordsperpage = parseInt(ts.p.rowNum,10),
			total = queryResults.length,
			page = parseInt(ts.p.page,10),
			totalpages = Math.ceil(total / recordsperpage),
			retresult = {};
			if((ts.p.search || ts.p.resetsearch) &amp;&amp; ts.p.grouping &amp;&amp; ts.p.groupingView._locgr) {
				ts.p.groupingView.groups =[];
				var j, grPrepare = $.jgrid.getMethod(&quot;groupingPrepare&quot;), key, udc;
				if(ts.p.footerrow &amp;&amp; ts.p.userDataOnFooter) {
					for (key in ts.p.userData) {
						if(ts.p.userData.hasOwnProperty(key)) {
							ts.p.userData[key] = 0;
						}
					}
					udc = true;
				}
				for(j=0; j&lt;total; j++) {
					if(udc) {
						for(key in ts.p.userData){
							ts.p.userData[key] += parseFloat(queryResults[j][key] || 0);
						}
					}
					grPrepare.call($(ts),queryResults[j],j, recordsperpage );
				}
			}
			queryResults = queryResults.slice( (page-1)*recordsperpage , page*recordsperpage );
			query = null;
			cmtypes = null;
			retresult[ts.p.localReader.total] = totalpages;
			retresult[ts.p.localReader.page] = page;
			retresult[ts.p.localReader.records] = total;
			retresult[ts.p.localReader.root] = queryResults;
			retresult[ts.p.localReader.userdata] = ts.p.userData;
			queryResults = null;
			return  retresult;
		},
		updatepager = function(rn, dnd) {
			var cp, last, base, from,to,tot,fmt, pgboxes = &quot;&quot;, sppg,
			tspg = ts.p.pager ? &quot;_&quot;+$.jgrid.jqID(ts.p.pager.substr(1)) : &quot;&quot;,
			tspg_t = ts.p.toppager ? &quot;_&quot;+ts.p.toppager.substr(1) : &quot;&quot;;
			base = parseInt(ts.p.page,10)-1;
			if(base &lt; 0) { base = 0; }
			base = base*parseInt(ts.p.rowNum,10);
			to = base + ts.p.reccount;
			if (ts.p.scroll) {
				var rows = $(&quot;tbody:first &gt; tr:gt(0)&quot;, ts.grid.bDiv);
				base = to - rows.length;
				ts.p.reccount = rows.length;
				var rh = rows.outerHeight() || ts.grid.prevRowHeight;
				if (rh) {
					var top = base * rh;
					var height = parseInt(ts.p.records,10) * rh;
					$(&quot;&gt;div:first&quot;,ts.grid.bDiv).css({height : height}).children(&quot;div:first&quot;).css({height:top,display:top?&quot;&quot;:&quot;none&quot;});
					if (ts.grid.bDiv.scrollTop == 0 &amp;&amp; ts.p.page &gt; 1) {
						ts.grid.bDiv.scrollTop = ts.p.rowNum * (ts.p.page - 1) * rh;
					}
				}
				ts.grid.bDiv.scrollLeft = ts.grid.hDiv.scrollLeft;
			}
			pgboxes = ts.p.pager || &quot;&quot;;
			pgboxes += ts.p.toppager ?  (pgboxes ? &quot;,&quot; + ts.p.toppager : ts.p.toppager) : &quot;&quot;;
			if(pgboxes) {
				fmt = $.jgrid.formatter.integer || {};
				cp = intNum(ts.p.page);
				last = intNum(ts.p.lastpage);
				$(&quot;.selbox&quot;,pgboxes)[ this.p.useProp ? &#x27;prop&#x27; : &#x27;attr&#x27; ](&quot;disabled&quot;,false);
				if(ts.p.pginput===true) {
					$(&#x27;.ui-pg-input&#x27;,pgboxes).val(ts.p.page);
					sppg = ts.p.toppager ? &#x27;#sp_1&#x27;+tspg+&quot;,#sp_1&quot;+tspg_t : &#x27;#sp_1&#x27;+tspg;
					$(sppg).html($.fmatter ? $.fmatter.util.NumberFormat(ts.p.lastpage,fmt):ts.p.lastpage);

				}
				if (ts.p.viewrecords){
					if(ts.p.reccount === 0) {
						$(&quot;.ui-paging-info&quot;,pgboxes).html(ts.p.emptyrecords);
					} else {
						from = base+1;
						tot=ts.p.records;
						if($.fmatter) {
							from = $.fmatter.util.NumberFormat(from,fmt);
							to = $.fmatter.util.NumberFormat(to,fmt);
							tot = $.fmatter.util.NumberFormat(tot,fmt);
						}
						$(&quot;.ui-paging-info&quot;,pgboxes).html($.jgrid.format(ts.p.recordtext,from,to,tot));
					}
				}
				if(ts.p.pgbuttons===true) {
					if(cp&lt;=0) {cp = last = 0;}
					if(cp===1 || cp === 0) {
						$(&quot;#first&quot;+tspg+&quot;, #prev&quot;+tspg).addClass(&#x27;ui-state-disabled&#x27;).removeClass(&#x27;ui-state-hover&#x27;);
						if(ts.p.toppager) { $(&quot;#first_t&quot;+tspg_t+&quot;, #prev_t&quot;+tspg_t).addClass(&#x27;ui-state-disabled&#x27;).removeClass(&#x27;ui-state-hover&#x27;); }
					} else {
						$(&quot;#first&quot;+tspg+&quot;, #prev&quot;+tspg).removeClass(&#x27;ui-state-disabled&#x27;);
						if(ts.p.toppager) { $(&quot;#first_t&quot;+tspg_t+&quot;, #prev_t&quot;+tspg_t).removeClass(&#x27;ui-state-disabled&#x27;); }
					}
					if(cp===last || cp === 0) {
						$(&quot;#next&quot;+tspg+&quot;, #last&quot;+tspg).addClass(&#x27;ui-state-disabled&#x27;).removeClass(&#x27;ui-state-hover&#x27;);
						if(ts.p.toppager) { $(&quot;#next_t&quot;+tspg_t+&quot;, #last_t&quot;+tspg_t).addClass(&#x27;ui-state-disabled&#x27;).removeClass(&#x27;ui-state-hover&#x27;); }
					} else {
						$(&quot;#next&quot;+tspg+&quot;, #last&quot;+tspg).removeClass(&#x27;ui-state-disabled&#x27;);
						if(ts.p.toppager) { $(&quot;#next_t&quot;+tspg_t+&quot;, #last_t&quot;+tspg_t).removeClass(&#x27;ui-state-disabled&#x27;); }
					}
				}
			}
			if(rn===true &amp;&amp; ts.p.rownumbers === true) {
				$(&quot;&gt;td.jqgrid-rownum&quot;,ts.rows).each(function(i){
					$(this).html(base+1+i);
				});
			}
			if(dnd &amp;&amp; ts.p.jqgdnd) { $(ts).jqGrid(&#x27;gridDnD&#x27;,&#x27;updateDnD&#x27;);}
			$(ts).triggerHandler(&quot;jqGridGridComplete&quot;);
			if($.isFunction(ts.p.gridComplete)) {ts.p.gridComplete.call(ts);}
			$(ts).triggerHandler(&quot;jqGridAfterGridComplete&quot;);
		},
		beginReq = function() {
			ts.grid.hDiv.loading = true;
			if(ts.p.hiddengrid) { return;}
			switch(ts.p.loadui) {
				case &quot;disable&quot;:
					break;
				case &quot;enable&quot;:
					$(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).show();
					break;
				case &quot;block&quot;:
					$(&quot;#lui_&quot;+$.jgrid.jqID(ts.p.id)).show();
					$(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).show();
					break;
			}
		},
		endReq = function() {
			ts.grid.hDiv.loading = false;
			switch(ts.p.loadui) {
				case &quot;disable&quot;:
					break;
				case &quot;enable&quot;:
					$(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).hide();
					break;
				case &quot;block&quot;:
					$(&quot;#lui_&quot;+$.jgrid.jqID(ts.p.id)).hide();
					$(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).hide();
					break;
			}
		},
		populate = function (npage) {
			if(!ts.grid.hDiv.loading) {
				var pvis = ts.p.scroll &amp;&amp; npage === false,
				prm = {}, dt, dstr, pN=ts.p.prmNames;
				if(ts.p.page &lt;=0) { ts.p.page = Math.min(1,ts.p.lastpage); }
				if(pN.search !== null) {prm[pN.search] = ts.p.search;} if(pN.nd !== null) {prm[pN.nd] = new Date().getTime();}
				if(pN.rows !== null) {prm[pN.rows]= ts.p.rowNum;} if(pN.page !== null) {prm[pN.page]= ts.p.page;}
				if(pN.sort !== null) {prm[pN.sort]= ts.p.sortname;} if(pN.order !== null) {prm[pN.order]= ts.p.sortorder;}
				if(ts.p.rowTotal !== null &amp;&amp; pN.totalrows !== null) { prm[pN.totalrows]= ts.p.rowTotal; }
				var lcf = $.isFunction(ts.p.loadComplete), lc = lcf ? ts.p.loadComplete : null;
				var adjust = 0;
				npage = npage || 1;
				if (npage &gt; 1) {
					if(pN.npage !== null) {
						prm[pN.npage] = npage;
						adjust = npage - 1;
						npage = 1;
					} else {
						lc = function(req) {
							ts.p.page++;
							ts.grid.hDiv.loading = false;
							if (lcf) {
								ts.p.loadComplete.call(ts,req);
							}
							populate(npage-1);
						};
					}
				} else if (pN.npage !== null) {
					delete ts.p.postData[pN.npage];
				}
				if(ts.p.grouping) {
					$(ts).jqGrid(&#x27;groupingSetup&#x27;);
					var grp = ts.p.groupingView, gi, gs=&quot;&quot;;
					for(gi=0;gi&lt;grp.groupField.length;gi++) {
						var index = grp.groupField[gi];
						$.each(ts.p.colModel, function(cmIndex, cmValue) {
							if (cmValue.name === index &amp;&amp; cmValue.index){
								index = cmValue.index;
							}
						} );
						gs += index +&quot; &quot;+grp.groupOrder[gi]+&quot;, &quot;;
					}
					prm[pN.sort] = gs + prm[pN.sort];
				}
				$.extend(ts.p.postData,prm);
				var rcnt = !ts.p.scroll ? 1 : ts.rows.length-1;
				var bfr = $(ts).triggerHandler(&quot;jqGridBeforeRequest&quot;);
				if (bfr === false || bfr === &#x27;stop&#x27;) { return; }
				if ($.isFunction(ts.p.datatype)) { ts.p.datatype.call(ts,ts.p.postData,&quot;load_&quot;+ts.p.id, rcnt, npage, adjust); return;}
				if ($.isFunction(ts.p.beforeRequest)) {
					bfr = ts.p.beforeRequest.call(ts);
					if(bfr === undefined) { bfr = true; }
					if ( bfr === false ) { return; }
				}
				dt = ts.p.datatype.toLowerCase();
				switch(dt)
				{
				case &quot;json&quot;:
				case &quot;jsonp&quot;:
				case &quot;xml&quot;:
				case &quot;script&quot;:
					$.ajax($.extend({
						url:ts.p.url,
						type:ts.p.mtype,
						dataType: dt ,
						data: $.isFunction(ts.p.serializeGridData)? ts.p.serializeGridData.call(ts,ts.p.postData) : ts.p.postData,
						success:function(data,st, xhr) {
							if ($.isFunction(ts.p.beforeProcessing)) {
								if (ts.p.beforeProcessing.call(ts, data, st, xhr) === false) {
									endReq();
									return;
								}
							}
							if(dt === &quot;xml&quot;) { addXmlData(data,ts.grid.bDiv,rcnt,npage&gt;1,adjust); }
							else { addJSONData(data,ts.grid.bDiv,rcnt,npage&gt;1,adjust); }
							$(ts).triggerHandler(&quot;jqGridLoadComplete&quot;, [data]);
							if(lc) { lc.call(ts,data); }
							$(ts).triggerHandler(&quot;jqGridAfterLoadComplete&quot;, [data]);
							if (pvis) { ts.grid.populateVisible(); }
							if( ts.p.loadonce || ts.p.treeGrid) {ts.p.datatype = &quot;local&quot;;}
							data=null;
							if (npage === 1) { endReq(); }
						},
						error:function(xhr,st,err){
							if($.isFunction(ts.p.loadError)) { ts.p.loadError.call(ts,xhr,st,err); }
							if (npage === 1) { endReq(); }
							xhr=null;
						},
						beforeSend: function(xhr, settings ){
							var gotoreq = true;
							if($.isFunction(ts.p.loadBeforeSend)) {
								gotoreq = ts.p.loadBeforeSend.call(ts,xhr, settings);
							}
							if(gotoreq === undefined) { gotoreq = true; }
							if(gotoreq === false) {
								return false;
							}
								beginReq();
							}
					},$.jgrid.ajaxOptions, ts.p.ajaxGridOptions));
				break;
				case &quot;xmlstring&quot;:
					beginReq();
					dstr = typeof ts.p.datastr !== &#x27;string&#x27; ? ts.p.datastr : $.parseXML(ts.p.datastr);
					addXmlData(dstr,ts.grid.bDiv);
					$(ts).triggerHandler(&quot;jqGridLoadComplete&quot;, [dstr]);
					if(lcf) {ts.p.loadComplete.call(ts,dstr);}
					$(ts).triggerHandler(&quot;jqGridAfterLoadComplete&quot;, [dstr]);
					ts.p.datatype = &quot;local&quot;;
					ts.p.datastr = null;
					endReq();
				break;
				case &quot;jsonstring&quot;:
					beginReq();
					if(typeof ts.p.datastr === &#x27;string&#x27;) { dstr = $.jgrid.parse(ts.p.datastr); }
					else { dstr = ts.p.datastr; }
					addJSONData(dstr,ts.grid.bDiv);
					$(ts).triggerHandler(&quot;jqGridLoadComplete&quot;, [dstr]);
					if(lcf) {ts.p.loadComplete.call(ts,dstr);}
					$(ts).triggerHandler(&quot;jqGridAfterLoadComplete&quot;, [dstr]);
					ts.p.datatype = &quot;local&quot;;
					ts.p.datastr = null;
					endReq();
				break;
				case &quot;local&quot;:
				case &quot;clientside&quot;:
					beginReq();
					ts.p.datatype = &quot;local&quot;;
					var req = addLocalData();
					addJSONData(req,ts.grid.bDiv,rcnt,npage&gt;1,adjust);
					$(ts).triggerHandler(&quot;jqGridLoadComplete&quot;, [req]);
					if(lc) { lc.call(ts,req); }
					$(ts).triggerHandler(&quot;jqGridAfterLoadComplete&quot;, [req]);
					if (pvis) { ts.grid.populateVisible(); }
					endReq();
				break;
				}
			}
		},
		setHeadCheckBox = function ( checked ) {
			$(&#x27;#cb_&#x27;+$.jgrid.jqID(ts.p.id),ts.grid.hDiv)[ts.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;, checked);
			var fid = ts.p.frozenColumns ? ts.p.id+&quot;_frozen&quot; : &quot;&quot;;
			if(fid) {
				$(&#x27;#cb_&#x27;+$.jgrid.jqID(ts.p.id),ts.grid.fhDiv)[ts.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;, checked);
			}
		},
		setPager = function (pgid, tp){
			// TBD - consider escaping pgid with pgid = $.jgrid.jqID(pgid);
			var sep = &quot;&lt;td class=&#x27;ui-pg-button ui-state-disabled&#x27; style=&#x27;width:4px;&#x27;&gt;&lt;span class=&#x27;ui-separator&#x27;&gt;&lt;/span&gt;&lt;/td&gt;&quot;,
			pginp = &quot;&quot;,
			pgl=&quot;&lt;table cellspacing=&#x27;0&#x27; cellpadding=&#x27;0&#x27; border=&#x27;0&#x27; style=&#x27;table-layout:auto;&#x27; class=&#x27;ui-pg-table&#x27;&gt;&lt;tbody&gt;&lt;tr&gt;&quot;,
			str=&quot;&quot;, pgcnt, lft, cent, rgt, twd, tdw, i,
			clearVals = function(onpaging){
				var ret;
				if ($.isFunction(ts.p.onPaging) ) { ret = ts.p.onPaging.call(ts,onpaging); }
				if(ret===&#x27;stop&#x27;) {return false;}
				ts.p.selrow = null;
				if(ts.p.multiselect) {ts.p.selarrrow =[]; setHeadCheckBox( false );}
				ts.p.savedRow = [];
				return true;
			};
			pgid = pgid.substr(1);
			tp += &quot;_&quot; + pgid;
			pgcnt = &quot;pg_&quot;+pgid;
			lft = pgid+&quot;_left&quot;; cent = pgid+&quot;_center&quot;; rgt = pgid+&quot;_right&quot;;
			$(&quot;#&quot;+$.jgrid.jqID(pgid) )
			.append(&quot;&lt;div id=&#x27;&quot;+pgcnt+&quot;&#x27; class=&#x27;ui-pager-control&#x27; role=&#x27;group&#x27;&gt;&lt;table cellspacing=&#x27;0&#x27; cellpadding=&#x27;0&#x27; border=&#x27;0&#x27; class=&#x27;ui-pg-table&#x27; style=&#x27;width:100%;table-layout:fixed;height:100%;&#x27; role=&#x27;row&#x27;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td id=&#x27;&quot;+lft+&quot;&#x27; align=&#x27;left&#x27;&gt;&lt;/td&gt;&lt;td id=&#x27;&quot;+cent+&quot;&#x27; align=&#x27;center&#x27; style=&#x27;white-space:pre;&#x27;&gt;&lt;/td&gt;&lt;td id=&#x27;&quot;+rgt+&quot;&#x27; align=&#x27;right&#x27;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&quot;)
			.attr(&quot;dir&quot;,&quot;ltr&quot;); //explicit setting
			if(ts.p.rowList.length &gt;0){
				str = &quot;&lt;td dir=&#x27;&quot;+dir+&quot;&#x27;&gt;&quot;;
				str +=&quot;&lt;select class=&#x27;ui-pg-selbox&#x27; role=&#x27;listbox&#x27;&gt;&quot;;
				for(i=0;i&lt;ts.p.rowList.length;i++){
					str +=&quot;&lt;option role=\&quot;option\&quot; value=\&quot;&quot;+ts.p.rowList[i]+&quot;\&quot;&quot;+((ts.p.rowNum === ts.p.rowList[i])?&quot; selected=\&quot;selected\&quot;&quot;:&quot;&quot;)+&quot;&gt;&quot;+ts.p.rowList[i]+&quot;&lt;/option&gt;&quot;;
				}
				str +=&quot;&lt;/select&gt;&lt;/td&gt;&quot;;
			}
			if(dir===&quot;rtl&quot;) { pgl += str; }
			if(ts.p.pginput===true) { pginp= &quot;&lt;td dir=&#x27;&quot;+dir+&quot;&#x27;&gt;&quot;+$.jgrid.format(ts.p.pgtext || &quot;&quot;,&quot;&lt;input class=&#x27;ui-pg-input&#x27; type=&#x27;text&#x27; size=&#x27;2&#x27; maxlength=&#x27;7&#x27; value=&#x27;0&#x27; role=&#x27;textbox&#x27;/&gt;&quot;,&quot;&lt;span id=&#x27;sp_1_&quot;+$.jgrid.jqID(pgid)+&quot;&#x27;&gt;&lt;/span&gt;&quot;)+&quot;&lt;/td&gt;&quot;;}
			if(ts.p.pgbuttons===true) {
				var po=[&quot;first&quot;+tp,&quot;prev&quot;+tp, &quot;next&quot;+tp,&quot;last&quot;+tp]; if(dir===&quot;rtl&quot;) { po.reverse(); }
				pgl += &quot;&lt;td id=&#x27;&quot;+po[0]+&quot;&#x27; class=&#x27;ui-pg-button ui-corner-all&#x27;&gt;&lt;span class=&#x27;ui-icon ui-icon-seek-first&#x27;&gt;&lt;/span&gt;&lt;/td&gt;&quot;;
				pgl += &quot;&lt;td id=&#x27;&quot;+po[1]+&quot;&#x27; class=&#x27;ui-pg-button ui-corner-all&#x27;&gt;&lt;span class=&#x27;ui-icon ui-icon-seek-prev&#x27;&gt;&lt;/span&gt;&lt;/td&gt;&quot;;
				pgl += pginp !== &quot;&quot; ? sep+pginp+sep:&quot;&quot;;
				pgl += &quot;&lt;td id=&#x27;&quot;+po[2]+&quot;&#x27; class=&#x27;ui-pg-button ui-corner-all&#x27;&gt;&lt;span class=&#x27;ui-icon ui-icon-seek-next&#x27;&gt;&lt;/span&gt;&lt;/td&gt;&quot;;
				pgl += &quot;&lt;td id=&#x27;&quot;+po[3]+&quot;&#x27; class=&#x27;ui-pg-button ui-corner-all&#x27;&gt;&lt;span class=&#x27;ui-icon ui-icon-seek-end&#x27;&gt;&lt;/span&gt;&lt;/td&gt;&quot;;
			} else if (pginp !== &quot;&quot;) { pgl += pginp; }
			if(dir===&quot;ltr&quot;) { pgl += str; }
			pgl += &quot;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;;
			if(ts.p.viewrecords===true) {$(&quot;td#&quot;+pgid+&quot;_&quot;+ts.p.recordpos,&quot;#&quot;+pgcnt).append(&quot;&lt;div dir=&#x27;&quot;+dir+&quot;&#x27; style=&#x27;text-align:&quot;+ts.p.recordpos+&quot;&#x27; class=&#x27;ui-paging-info&#x27;&gt;&lt;/div&gt;&quot;);}
			$(&quot;td#&quot;+pgid+&quot;_&quot;+ts.p.pagerpos,&quot;#&quot;+pgcnt).append(pgl);
			tdw = $(&quot;.ui-jqgrid&quot;).css(&quot;font-size&quot;) || &quot;11px&quot;;
			$(document.body).append(&quot;&lt;div id=&#x27;testpg&#x27; class=&#x27;ui-jqgrid ui-widget ui-widget-content&#x27; style=&#x27;font-size:&quot;+tdw+&quot;;visibility:hidden;&#x27; &gt;&lt;/div&gt;&quot;);
			twd = $(pgl).clone().appendTo(&quot;#testpg&quot;).width();
			$(&quot;#testpg&quot;).remove();
			if(twd &gt; 0) {
				if(pginp !== &quot;&quot;) { twd += 50; } //should be param
				$(&quot;td#&quot;+pgid+&quot;_&quot;+ts.p.pagerpos,&quot;#&quot;+pgcnt).width(twd);
			}
			ts.p._nvtd = [];
			ts.p._nvtd[0] = twd ? Math.floor((ts.p.width - twd)/2) : Math.floor(ts.p.width/3);
			ts.p._nvtd[1] = 0;
			pgl=null;
			$(&#x27;.ui-pg-selbox&#x27;,&quot;#&quot;+pgcnt).bind(&#x27;change&#x27;,function() {
				if(!clearVals(&#x27;records&#x27;)) { return false; }
				ts.p.page = Math.round(ts.p.rowNum*(ts.p.page-1)/this.value-0.5)+1;
				ts.p.rowNum = this.value;
				if(ts.p.pager) { $(&#x27;.ui-pg-selbox&#x27;,ts.p.pager).val(this.value); }
				if(ts.p.toppager) { $(&#x27;.ui-pg-selbox&#x27;,ts.p.toppager).val(this.value); }
				populate();
				return false;
			});
			if(ts.p.pgbuttons===true) {
			$(&quot;.ui-pg-button&quot;,&quot;#&quot;+pgcnt).hover(function(){
				if($(this).hasClass(&#x27;ui-state-disabled&#x27;)) {
					this.style.cursor=&#x27;default&#x27;;
				} else {
					$(this).addClass(&#x27;ui-state-hover&#x27;);
					this.style.cursor=&#x27;pointer&#x27;;
				}
			},function() {
				if(!$(this).hasClass(&#x27;ui-state-disabled&#x27;)) {
					$(this).removeClass(&#x27;ui-state-hover&#x27;);
					this.style.cursor= &quot;default&quot;;
				}
			});
			$(&quot;#first&quot;+$.jgrid.jqID(tp)+&quot;, #prev&quot;+$.jgrid.jqID(tp)+&quot;, #next&quot;+$.jgrid.jqID(tp)+&quot;, #last&quot;+$.jgrid.jqID(tp)).click( function() {
				if ($(this).hasClass(&quot;ui-state-disabled&quot;)) {
					return false;
				}
				var cp = intNum(ts.p.page,1),
				last = intNum(ts.p.lastpage,1), selclick = false,
				fp=true, pp=true, np=true,lp=true;
				if(last ===0 || last===1) {fp=false;pp=false;np=false;lp=false; }
				else if( last&gt;1 &amp;&amp; cp &gt;=1) {
					if( cp === 1) { fp=false; pp=false; }
					//else if( cp&gt;1 &amp;&amp; cp &lt;last){ }
					else if( cp===last){ np=false;lp=false; }
				} else if( last&gt;1 &amp;&amp; cp===0 ) { np=false;lp=false; cp=last-1;}
				if(!clearVals(this.id)) { return false; }
				if( this.id === &#x27;first&#x27;+tp &amp;&amp; fp ) { ts.p.page=1; selclick=true;}
				if( this.id === &#x27;prev&#x27;+tp &amp;&amp; pp) { ts.p.page=(cp-1); selclick=true;}
				if( this.id === &#x27;next&#x27;+tp &amp;&amp; np) { ts.p.page=(cp+1); selclick=true;}
				if( this.id === &#x27;last&#x27;+tp &amp;&amp; lp) { ts.p.page=last; selclick=true;}
				if(selclick) {
					populate();
				}
				return false;
			});
			}
			if(ts.p.pginput===true) {
			$(&#x27;input.ui-pg-input&#x27;,&quot;#&quot;+pgcnt).keypress( function(e) {
				var key = e.charCode || e.keyCode || 0;
				if(key === 13) {
					if(!clearVals(&#x27;user&#x27;)) { return false; }
					$(this).val( intNum( $(this).val(), 1));
					ts.p.page = ($(this).val()&gt;0) ? $(this).val():ts.p.page;
					populate();
					return false;
				}
				return this;
			});
			}
		},
		multiSort = function(iCol, obj ) {
			var splas, sort=&quot;&quot;, cm = ts.p.colModel, fs=false, ls,
					selTh = ts.p.frozenColumns ?  obj : ts.grid.headers[iCol].el, so=&quot;&quot;;
			$(&quot;span.ui-grid-ico-sort&quot;,selTh).addClass(&#x27;ui-state-disabled&#x27;);
			$(selTh).attr(&quot;aria-selected&quot;,&quot;false&quot;);

			if(cm[iCol].lso) {
				if(cm[iCol].lso===&quot;asc&quot;) {
					cm[iCol].lso += &quot;-desc&quot;;
					so = &quot;desc&quot;;
				} else if(cm[iCol].lso===&quot;desc&quot;) {
					cm[iCol].lso += &quot;-asc&quot;;
					so = &quot;asc&quot;;
				} else if(cm[iCol].lso===&quot;asc-desc&quot; || cm[iCol].lso===&quot;desc-asc&quot;) {
					cm[iCol].lso=&quot;&quot;;
				}
			} else {
				cm[iCol].lso = so = cm[iCol].firstsortorder || &#x27;asc&#x27;;
			}
			if( so ) {
				$(&quot;span.s-ico&quot;,selTh).show();
				$(&quot;span.ui-icon-&quot;+so,selTh).removeClass(&#x27;ui-state-disabled&#x27;);
				$(selTh).attr(&quot;aria-selected&quot;,&quot;true&quot;);
			} else {
				if(!ts.p.viewsortcols[0]) {
					$(&quot;span.s-ico&quot;,selTh).hide();
				}
			}
			ts.p.sortorder = &quot;&quot;;
			$.each(cm, function(i){
				if(this.lso) {
					if(i&gt;0 &amp;&amp; fs) {
						sort += &quot;, &quot;;
					}
					splas = this.lso.split(&quot;-&quot;);
					sort += cm[i].index || cm[i].name;
					sort += &quot; &quot;+splas[splas.length-1];
					fs = true;
					ts.p.sortorder = splas[splas.length-1];
				}
			});
			ls = sort.lastIndexOf(ts.p.sortorder);
			sort = sort.substring(0, ls);
			ts.p.sortname = sort;
		},
		sortData = function (index, idxcol,reload,sor, obj){
			if(!ts.p.colModel[idxcol].sortable) { return; }
			if(ts.p.savedRow.length &gt; 0) {return;}
			if(!reload) {
				if( ts.p.lastsort === idxcol ) {
					if( ts.p.sortorder === &#x27;asc&#x27;) {
						ts.p.sortorder = &#x27;desc&#x27;;
					} else if(ts.p.sortorder === &#x27;desc&#x27;) { ts.p.sortorder = &#x27;asc&#x27;;}
				} else { ts.p.sortorder = ts.p.colModel[idxcol].firstsortorder || &#x27;asc&#x27;; }
				ts.p.page = 1;
			}
			if(ts.p.multiSort) {
				multiSort( idxcol, obj);
			} else {
				if(sor) {
					if(ts.p.lastsort === idxcol &amp;&amp; ts.p.sortorder === sor &amp;&amp; !reload) { return; }
					ts.p.sortorder = sor;
				}
				var previousSelectedTh = ts.grid.headers[ts.p.lastsort].el, newSelectedTh = ts.p.frozenColumns ?  obj : ts.grid.headers[idxcol].el;

				$(&quot;span.ui-grid-ico-sort&quot;,previousSelectedTh).addClass(&#x27;ui-state-disabled&#x27;);
				$(previousSelectedTh).attr(&quot;aria-selected&quot;,&quot;false&quot;);
				if(ts.p.frozenColumns) {
					ts.grid.fhDiv.find(&quot;span.ui-grid-ico-sort&quot;).addClass(&#x27;ui-state-disabled&#x27;);
					ts.grid.fhDiv.find(&quot;th&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;);
				}
				$(&quot;span.ui-icon-&quot;+ts.p.sortorder,newSelectedTh).removeClass(&#x27;ui-state-disabled&#x27;);
				$(newSelectedTh).attr(&quot;aria-selected&quot;,&quot;true&quot;);
				if(!ts.p.viewsortcols[0]) {
					if(ts.p.lastsort !== idxcol) {
						if(ts.p.frozenColumns){
							ts.grid.fhDiv.find(&quot;span.s-ico&quot;).hide();
						}
						$(&quot;span.s-ico&quot;,previousSelectedTh).hide();
						$(&quot;span.s-ico&quot;,newSelectedTh).show();
					}
				}
				index = index.substring(5 + ts.p.id.length + 1); // bad to be changed!?!
				ts.p.sortname = ts.p.colModel[idxcol].index || index;
			}
			if ($(ts).triggerHandler(&quot;jqGridSortCol&quot;, [ts.p.sortname, idxcol, ts.p.sortorder]) === &#x27;stop&#x27;) {
				ts.p.lastsort = idxcol;
				return;
			}
			if($.isFunction(ts.p.onSortCol)) {if (ts.p.onSortCol.call(ts, ts.p.sortname, idxcol, ts.p.sortorder)===&#x27;stop&#x27;) {ts.p.lastsort = idxcol; return;}}
			if(ts.p.datatype === &quot;local&quot;) {
				if(ts.p.deselectAfterSort) {$(ts).jqGrid(&quot;resetSelection&quot;);}
			} else {
				ts.p.selrow = null;
				if(ts.p.multiselect){setHeadCheckBox( false );}
				ts.p.selarrrow =[];
				ts.p.savedRow =[];
			}
			if(ts.p.scroll) {
				var sscroll = ts.grid.bDiv.scrollLeft;
				emptyRows.call(ts, true, false);
				ts.grid.hDiv.scrollLeft = sscroll;
			}
			if(ts.p.subGrid &amp;&amp; ts.p.datatype === &#x27;local&#x27;) {
				$(&quot;td.sgexpanded&quot;,&quot;#&quot;+$.jgrid.jqID(ts.p.id)).each(function(){
					$(this).trigger(&quot;click&quot;);
				});
			}
			populate();
			ts.p.lastsort = idxcol;
			if(ts.p.sortname !== index &amp;&amp; idxcol) {ts.p.lastsort = idxcol;}
		},
		setColWidth = function () {
			var initwidth = 0, brd=$.jgrid.cell_width? 0: intNum(ts.p.cellLayout,0), vc=0, lvc, scw=intNum(ts.p.scrollOffset,0),cw,hs=false,aw,gw=0,cr;
			$.each(ts.p.colModel, function() {
				if(this.hidden === undefined) {this.hidden=false;}
				if(ts.p.grouping &amp;&amp; ts.p.autowidth) {
					var ind = $.inArray(this.name, ts.p.groupingView.groupField);
					if(ind &gt;= 0 &amp;&amp; ts.p.groupingView.groupColumnShow.length &gt; ind) {
						this.hidden = !ts.p.groupingView.groupColumnShow[ind];
					}
				}
				this.widthOrg = cw = intNum(this.width,0);
				if(this.hidden===false){
					initwidth += cw+brd;
					if(this.fixed) {
						gw += cw+brd;
					} else {
						vc++;
					}
				}
			});
			if(isNaN(ts.p.width)) {
				ts.p.width  = initwidth + ((ts.p.shrinkToFit ===false &amp;&amp; !isNaN(ts.p.height)) ? scw : 0);
			}
			grid.width = ts.p.width;
			ts.p.tblwidth = initwidth;
			if(ts.p.shrinkToFit ===false &amp;&amp; ts.p.forceFit === true) {ts.p.forceFit=false;}
			if(ts.p.shrinkToFit===true &amp;&amp; vc &gt; 0) {
				aw = grid.width-brd*vc-gw;
				if(!isNaN(ts.p.height)) {
					aw -= scw;
					hs = true;
				}
				initwidth =0;
				$.each(ts.p.colModel, function(i) {
					if(this.hidden === false &amp;&amp; !this.fixed){
						cw = Math.round(aw*this.width/(ts.p.tblwidth-brd*vc-gw));
						this.width =cw;
						initwidth += cw;
						lvc = i;
					}
				});
				cr =0;
				if (hs) {
					if(grid.width-gw-(initwidth+brd*vc) !== scw){
						cr = grid.width-gw-(initwidth+brd*vc)-scw;
					}
				} else if(!hs &amp;&amp; Math.abs(grid.width-gw-(initwidth+brd*vc)) !== 1) {
					cr = grid.width-gw-(initwidth+brd*vc);
				}
				ts.p.colModel[lvc].width += cr;
				ts.p.tblwidth = initwidth+cr+brd*vc+gw;
				if(ts.p.tblwidth &gt; ts.p.width) {
					ts.p.colModel[lvc].width -= (ts.p.tblwidth - parseInt(ts.p.width,10));
					ts.p.tblwidth = ts.p.width;
				}
			}
		},
		nextVisible= function(iCol) {
			var ret = iCol, j=iCol, i;
			for (i = iCol+1;i&lt;ts.p.colModel.length;i++){
				if(ts.p.colModel[i].hidden !== true ) {
					j=i; break;
				}
			}
			return j-ret;
		},
		getOffset = function (iCol) {
			var $th = $(ts.grid.headers[iCol].el), ret = [$th.position().left + $th.outerWidth()];
			if(ts.p.direction===&quot;rtl&quot;) { ret[0] = ts.p.width - ret[0]; }
			ret[0] -= ts.grid.bDiv.scrollLeft;
			ret.push($(ts.grid.hDiv).position().top);
			ret.push($(ts.grid.bDiv).offset().top - $(ts.grid.hDiv).offset().top + $(ts.grid.bDiv).height());
			return ret;
		},
		getColumnHeaderIndex = function (th) {
			var i, headers = ts.grid.headers, ci = $.jgrid.getCellIndex(th);
			for (i = 0; i &lt; headers.length; i++) {
				if (th === headers[i].el) {
					ci = i;
					break;
				}
			}
			return ci;
		};
		this.p.id = this.id;
		if ($.inArray(ts.p.multikey,sortkeys) === -1 ) {ts.p.multikey = false;}
		ts.p.keyIndex=false;
		ts.p.keyName=false;
		for (i=0; i&lt;ts.p.colModel.length;i++) {
			ts.p.colModel[i] = $.extend(true, {}, ts.p.cmTemplate, ts.p.colModel[i].template || {}, ts.p.colModel[i]);
			if (ts.p.keyIndex === false &amp;&amp; ts.p.colModel[i].key===true) {
				ts.p.keyIndex = i;
			}
		}
		ts.p.sortorder = ts.p.sortorder.toLowerCase();
		$.jgrid.cell_width = $.jgrid.cellWidth();
		if(ts.p.grouping===true) {
			ts.p.scroll = false;
			ts.p.rownumbers = false;
			//ts.p.subGrid = false; expiremental
			ts.p.treeGrid = false;
			ts.p.gridview = true;
		}
		if(this.p.treeGrid === true) {
			try { $(this).jqGrid(&quot;setTreeGrid&quot;);} catch (_) {}
			if(ts.p.datatype !== &quot;local&quot;) { ts.p.localReader = {id: &quot;_id_&quot;};	}
		}
		if(this.p.subGrid) {
			try { $(ts).jqGrid(&quot;setSubGrid&quot;);} catch (s){}
		}
		if(this.p.multiselect) {
			this.p.colNames.unshift(&quot;&lt;input role=&#x27;checkbox&#x27; id=&#x27;cb_&quot;+this.p.id+&quot;&#x27; class=&#x27;cbox&#x27; type=&#x27;checkbox&#x27;/&gt;&quot;);
			this.p.colModel.unshift({name:&#x27;cb&#x27;,width:$.jgrid.cell_width ? ts.p.multiselectWidth+ts.p.cellLayout : ts.p.multiselectWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:&#x27;center&#x27;,fixed:true});
		}
		if(this.p.rownumbers) {
			this.p.colNames.unshift(&quot;&quot;);
			this.p.colModel.unshift({name:&#x27;rn&#x27;,width:ts.p.rownumWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:&#x27;center&#x27;,fixed:true});
		}
		ts.p.xmlReader = $.extend(true,{
			root: &quot;rows&quot;,
			row: &quot;row&quot;,
			page: &quot;rows&gt;page&quot;,
			total: &quot;rows&gt;total&quot;,
			records : &quot;rows&gt;records&quot;,
			repeatitems: true,
			cell: &quot;cell&quot;,
			id: &quot;[id]&quot;,
			userdata: &quot;userdata&quot;,
			subgrid: {root:&quot;rows&quot;, row: &quot;row&quot;, repeatitems: true, cell:&quot;cell&quot;}
		}, ts.p.xmlReader);
		ts.p.jsonReader = $.extend(true,{
			root: &quot;rows&quot;,
			page: &quot;page&quot;,
			total: &quot;total&quot;,
			records: &quot;records&quot;,
			repeatitems: true,
			cell: &quot;cell&quot;,
			id: &quot;id&quot;,
			userdata: &quot;userdata&quot;,
			subgrid: {root:&quot;rows&quot;, repeatitems: true, cell:&quot;cell&quot;}
		},ts.p.jsonReader);
		ts.p.localReader = $.extend(true,{
			root: &quot;rows&quot;,
			page: &quot;page&quot;,
			total: &quot;total&quot;,
			records: &quot;records&quot;,
			repeatitems: false,
			cell: &quot;cell&quot;,
			id: &quot;id&quot;,
			userdata: &quot;userdata&quot;,
			subgrid: {root:&quot;rows&quot;, repeatitems: true, cell:&quot;cell&quot;}
		},ts.p.localReader);
		if(ts.p.scroll){
			ts.p.pgbuttons = false; ts.p.pginput=false; ts.p.rowList=[];
		}
		if(ts.p.data.length) { refreshIndex(); }
		var thead = &quot;&lt;thead&gt;&lt;tr class=&#x27;ui-jqgrid-labels&#x27; role=&#x27;rowheader&#x27;&gt;&quot;,
		tdc, idn, w, res, sort,
		td, ptr, tbody, imgs,iac=&quot;&quot;,idc=&quot;&quot;,sortarr=[], sortord=[], sotmp=[];
		if(ts.p.shrinkToFit===true &amp;&amp; ts.p.forceFit===true) {
			for (i=ts.p.colModel.length-1;i&gt;=0;i--){
				if(!ts.p.colModel[i].hidden) {
					ts.p.colModel[i].resizable=false;
					break;
				}
			}
		}
		if(ts.p.viewsortcols[1] === &#x27;horizontal&#x27;) {iac=&quot; ui-i-asc&quot;;idc=&quot; ui-i-desc&quot;;}
		tdc = isMSIE ?  &quot;class=&#x27;ui-th-div-ie&#x27;&quot; :&quot;&quot;;
		imgs = &quot;&lt;span class=&#x27;s-ico&#x27; style=&#x27;display:none&#x27;&gt;&lt;span sort=&#x27;asc&#x27; class=&#x27;ui-grid-ico-sort ui-icon-asc&quot;+iac+&quot; ui-state-disabled ui-icon ui-icon-triangle-1-n ui-sort-&quot;+dir+&quot;&#x27;&gt;&lt;/span&gt;&quot;;
		imgs += &quot;&lt;span sort=&#x27;desc&#x27; class=&#x27;ui-grid-ico-sort ui-icon-desc&quot;+idc+&quot; ui-state-disabled ui-icon ui-icon-triangle-1-s ui-sort-&quot;+dir+&quot;&#x27;&gt;&lt;/span&gt;&lt;/span&gt;&quot;;
		if(ts.p.multiSort) {
			sortarr = ts.p.sortname.split(&quot;,&quot;);
			for (i=0; i&lt;sortarr.length; i++) {
				sotmp = $.trim(sortarr[i]).split(&quot; &quot;);
				sortarr[i] = $.trim(sotmp[0]);
				sortord[i] = sotmp[1] ? $.trim(sotmp[1]) : ts.p.sortorder || &quot;asc&quot;;
			}
		}
		for(i=0;i&lt;this.p.colNames.length;i++){
			var tooltip = ts.p.headertitles ? (&quot; title=\&quot;&quot;+$.jgrid.stripHtml(ts.p.colNames[i])+&quot;\&quot;&quot;) :&quot;&quot;;
			thead += &quot;&lt;th id=&#x27;&quot;+ts.p.id+&quot;_&quot;+ts.p.colModel[i].name+&quot;&#x27; role=&#x27;columnheader&#x27; class=&#x27;ui-state-default ui-th-column ui-th-&quot;+dir+&quot;&#x27;&quot;+ tooltip+&quot;&gt;&quot;;
			idn = ts.p.colModel[i].index || ts.p.colModel[i].name;
			thead += &quot;&lt;div id=&#x27;jqgh_&quot;+ts.p.id+&quot;_&quot;+ts.p.colModel[i].name+&quot;&#x27; &quot;+tdc+&quot;&gt;&quot;+ts.p.colNames[i];
			if(!ts.p.colModel[i].width)  { ts.p.colModel[i].width = 150; }
			else { ts.p.colModel[i].width = parseInt(ts.p.colModel[i].width,10); }
			if(typeof ts.p.colModel[i].title !== &quot;boolean&quot;) { ts.p.colModel[i].title = true; }
			ts.p.colModel[i].lso = &quot;&quot;;
			if (idn === ts.p.sortname) {
				ts.p.lastsort = i;
			}
			if(ts.p.multiSort) {
				sotmp = $.inArray(idn,sortarr);
				if( sotmp !== -1 ) {
					ts.p.colModel[i].lso = sortord[sotmp];
				}
			}
			thead += imgs+&quot;&lt;/div&gt;&lt;/th&gt;&quot;;
		}
		thead += &quot;&lt;/tr&gt;&lt;/thead&gt;&quot;;
		imgs = null;
		$(this).append(thead);
		$(&quot;thead tr:first th&quot;,this).hover(function(){$(this).addClass(&#x27;ui-state-hover&#x27;);},function(){$(this).removeClass(&#x27;ui-state-hover&#x27;);});
		if(this.p.multiselect) {
			var emp=[], chk;
			$(&#x27;#cb_&#x27;+$.jgrid.jqID(ts.p.id),this).bind(&#x27;click&#x27;,function(){
				ts.p.selarrrow = [];
				var froz = ts.p.frozenColumns === true ? ts.p.id + &quot;_frozen&quot; : &quot;&quot;;
				if (this.checked) {
					$(ts.rows).each(function(i) {
						if (i&gt;0) {
							if(!$(this).hasClass(&quot;ui-subgrid&quot;) &amp;&amp; !$(this).hasClass(&quot;jqgroup&quot;) &amp;&amp; !$(this).hasClass(&#x27;ui-state-disabled&#x27;)){
								$(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(this.id) )[ts.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;,true);
								$(this).addClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;true&quot;);
								ts.p.selarrrow.push(this.id);
								ts.p.selrow = this.id;
								if(froz) {
									$(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(this.id), ts.grid.fbDiv )[ts.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;,true);
									$(&quot;#&quot;+$.jgrid.jqID(this.id), ts.grid.fbDiv).addClass(&quot;ui-state-highlight&quot;);
								}
							}
						}
					});
					chk=true;
					emp=[];
				}
				else {
					$(ts.rows).each(function(i) {
						if(i&gt;0) {
							if(!$(this).hasClass(&quot;ui-subgrid&quot;) &amp;&amp; !$(this).hasClass(&#x27;ui-state-disabled&#x27;)){
								$(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(this.id) )[ts.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;, false);
								$(this).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;);
								emp.push(this.id);
								if(froz) {
									$(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(this.id), ts.grid.fbDiv )[ts.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;,false);
									$(&quot;#&quot;+$.jgrid.jqID(this.id), ts.grid.fbDiv).removeClass(&quot;ui-state-highlight&quot;);
								}
							}
						}
					});
					ts.p.selrow = null;
					chk=false;
				}
				$(ts).triggerHandler(&quot;jqGridSelectAll&quot;, [chk ? ts.p.selarrrow : emp, chk]);
				if($.isFunction(ts.p.onSelectAll)) {ts.p.onSelectAll.call(ts, chk ? ts.p.selarrrow : emp,chk);}
			});
		}

		if(ts.p.autowidth===true) {
			var pw = $(eg).innerWidth();
			ts.p.width = pw &gt; 0?  pw: &#x27;nw&#x27;;
		}
		setColWidth();
		$(eg).css(&quot;width&quot;,grid.width+&quot;px&quot;).append(&quot;&lt;div class=&#x27;ui-jqgrid-resize-mark&#x27; id=&#x27;rs_m&quot;+ts.p.id+&quot;&#x27;&gt;&amp;#160;&lt;/div&gt;&quot;);
		$(gv).css(&quot;width&quot;,grid.width+&quot;px&quot;);
		thead = $(&quot;thead:first&quot;,ts).get(0);
		var	tfoot = &quot;&quot;;
		if(ts.p.footerrow) { tfoot += &quot;&lt;table role=&#x27;grid&#x27; style=&#x27;width:&quot;+ts.p.tblwidth+&quot;px&#x27; class=&#x27;ui-jqgrid-ftable&#x27; cellspacing=&#x27;0&#x27; cellpadding=&#x27;0&#x27; border=&#x27;0&#x27;&gt;&lt;tbody&gt;&lt;tr role=&#x27;row&#x27; class=&#x27;ui-widget-content footrow footrow-&quot;+dir+&quot;&#x27;&gt;&quot;; }
		var thr = $(&quot;tr:first&quot;,thead),
		firstr = &quot;&lt;tr class=&#x27;jqgfirstrow&#x27; role=&#x27;row&#x27; style=&#x27;height:auto&#x27;&gt;&quot;;
		ts.p.disableClick=false;
		$(&quot;th&quot;,thr).each(function ( j ) {
			w = ts.p.colModel[j].width;
			if(ts.p.colModel[j].resizable === undefined) {ts.p.colModel[j].resizable = true;}
			if(ts.p.colModel[j].resizable){
				res = document.createElement(&quot;span&quot;);
				$(res).html(&quot;&amp;#160;&quot;).addClass(&#x27;ui-jqgrid-resize ui-jqgrid-resize-&#x27;+dir)
				.css(&quot;cursor&quot;,&quot;col-resize&quot;);
				$(this).addClass(ts.p.resizeclass);
			} else {
				res = &quot;&quot;;
			}
			$(this).css(&quot;width&quot;,w+&quot;px&quot;).prepend(res);
			res = null;
			var hdcol = &quot;&quot;;
			if( ts.p.colModel[j].hidden ) {
				$(this).css(&quot;display&quot;,&quot;none&quot;);
				hdcol = &quot;display:none;&quot;;
			}
			firstr += &quot;&lt;td role=&#x27;gridcell&#x27; style=&#x27;height:0px;width:&quot;+w+&quot;px;&quot;+hdcol+&quot;&#x27;&gt;&lt;/td&gt;&quot;;
			grid.headers[j] = { width: w, el: this };
			sort = ts.p.colModel[j].sortable;
			if( typeof sort !== &#x27;boolean&#x27;) {ts.p.colModel[j].sortable =  true; sort=true;}
			var nm = ts.p.colModel[j].name;
			if( !(nm === &#x27;cb&#x27; || nm===&#x27;subgrid&#x27; || nm===&#x27;rn&#x27;) ) {
				if(ts.p.viewsortcols[2]){
					$(&quot;&gt;div&quot;,this).addClass(&#x27;ui-jqgrid-sortable&#x27;);
				}
			}
			if(sort) {
				if(ts.p.multiSort) {
					if(ts.p.viewsortcols[0]) {
						$(&quot;div span.s-ico&quot;,this).show();
						if(ts.p.colModel[j].lso){
							$(&quot;div span.ui-icon-&quot;+ts.p.colModel[j].lso,this).removeClass(&quot;ui-state-disabled&quot;);
						}
					} else if( ts.p.colModel[j].lso) {
						$(&quot;div span.s-ico&quot;,this).show();
						$(&quot;div span.ui-icon-&quot;+ts.p.colModel[j].lso,this).removeClass(&quot;ui-state-disabled&quot;);
					}
				} else {
					if(ts.p.viewsortcols[0]) {$(&quot;div span.s-ico&quot;,this).show(); if(j===ts.p.lastsort){ $(&quot;div span.ui-icon-&quot;+ts.p.sortorder,this).removeClass(&quot;ui-state-disabled&quot;);}}
					else if( j === ts.p.lastsort) {$(&quot;div span.s-ico&quot;,this).show();$(&quot;div span.ui-icon-&quot;+ts.p.sortorder,this).removeClass(&quot;ui-state-disabled&quot;);}
				}
			}
			if(ts.p.footerrow) { tfoot += &quot;&lt;td role=&#x27;gridcell&#x27; &quot;+formatCol(j,0,&#x27;&#x27;, null, &#x27;&#x27;, false)+&quot;&gt;&amp;#160;&lt;/td&gt;&quot;; }
		}).mousedown(function(e) {
			if ($(e.target).closest(&quot;th&gt;span.ui-jqgrid-resize&quot;).length !== 1) { return; }
			var ci = getColumnHeaderIndex(this);
			if(ts.p.forceFit===true) {ts.p.nv= nextVisible(ci);}
			grid.dragStart(ci, e, getOffset(ci));
			return false;
		}).click(function(e) {
			if (ts.p.disableClick) {
				ts.p.disableClick = false;
				return false;
			}
			var s = &quot;th&gt;div.ui-jqgrid-sortable&quot;,r,d;
			if (!ts.p.viewsortcols[2]) { s = &quot;th&gt;div&gt;span&gt;span.ui-grid-ico-sort&quot;; }
			var t = $(e.target).closest(s);
			if (t.length !== 1) { return; }
			var ci;
			if(ts.p.frozenColumns) {
				var tid =  $(this)[0].id.substring( ts.p.id.length + 1 );
				$(ts.p.colModel).each(function(i){
					if (this.name === tid) {
						ci = i;return false;
					}
				});
			} else {
				ci = getColumnHeaderIndex(this);
			}
			if (!ts.p.viewsortcols[2]) { r=true;d=t.attr(&quot;sort&quot;); }
			if(ci != null){
				sortData( $(&#x27;div&#x27;,this)[0].id, ci, r, d, this);
			}
			return false;
		});
		if (ts.p.sortable &amp;&amp; $.fn.sortable) {
			try {
				$(ts).jqGrid(&quot;sortableColumns&quot;, thr);
			} catch (e){}
		}
		if(ts.p.footerrow) { tfoot += &quot;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;; }
		firstr += &quot;&lt;/tr&gt;&quot;;
		tbody = document.createElement(&quot;tbody&quot;);
		this.appendChild(tbody);
		$(this).addClass(&#x27;ui-jqgrid-btable&#x27;).append(firstr);
		firstr = null;
		var hTable = $(&quot;&lt;table class=&#x27;ui-jqgrid-htable&#x27; style=&#x27;width:&quot;+ts.p.tblwidth+&quot;px&#x27; role=&#x27;grid&#x27; aria-labelledby=&#x27;gbox_&quot;+this.id+&quot;&#x27; cellspacing=&#x27;0&#x27; cellpadding=&#x27;0&#x27; border=&#x27;0&#x27;&gt;&lt;/table&gt;&quot;).append(thead),
		hg = (ts.p.caption &amp;&amp; ts.p.hiddengrid===true) ? true : false,
		hb = $(&quot;&lt;div class=&#x27;ui-jqgrid-hbox&quot; + (dir===&quot;rtl&quot; ? &quot;-rtl&quot; : &quot;&quot; )+&quot;&#x27;&gt;&lt;/div&gt;&quot;);
		thead = null;
		grid.hDiv = document.createElement(&quot;div&quot;);
		$(grid.hDiv)
			.css({ width: grid.width+&quot;px&quot;})
			.addClass(&quot;ui-state-default ui-jqgrid-hdiv&quot;)
			.append(hb);
		$(hb).append(hTable);
		hTable = null;
		if(hg) { $(grid.hDiv).hide(); }
		if(ts.p.pager){
			// TBD -- escape ts.p.pager here?
			if(typeof ts.p.pager === &quot;string&quot;) {if(ts.p.pager.substr(0,1) !== &quot;#&quot;) { ts.p.pager = &quot;#&quot;+ts.p.pager;} }
			else { ts.p.pager = &quot;#&quot;+ $(ts.p.pager).attr(&quot;id&quot;);}
			$(ts.p.pager).css({width: grid.width+&quot;px&quot;}).addClass(&#x27;ui-state-default ui-jqgrid-pager ui-corner-bottom&#x27;).appendTo(eg);
			if(hg) {$(ts.p.pager).hide();}
			setPager(ts.p.pager,&#x27;&#x27;);
		}
		if( ts.p.cellEdit === false &amp;&amp; ts.p.hoverrows === true) {
		$(ts).bind(&#x27;mouseover&#x27;,function(e) {
			ptr = $(e.target).closest(&quot;tr.jqgrow&quot;);
			if($(ptr).attr(&quot;class&quot;) !== &quot;ui-subgrid&quot;) {
				$(ptr).addClass(&quot;ui-state-hover&quot;);
			}
		}).bind(&#x27;mouseout&#x27;,function(e) {
			ptr = $(e.target).closest(&quot;tr.jqgrow&quot;);
			$(ptr).removeClass(&quot;ui-state-hover&quot;);
		});
		}
		var ri,ci, tdHtml;
		$(ts).before(grid.hDiv).click(function(e) {
			td = e.target;
			ptr = $(td,ts.rows).closest(&quot;tr.jqgrow&quot;);
			if($(ptr).length === 0 || ptr[0].className.indexOf( &#x27;ui-state-disabled&#x27; ) &gt; -1 || ($(td,ts).closest(&quot;table.ui-jqgrid-btable&quot;).attr(&#x27;id&#x27;) || &#x27;&#x27;).replace(&quot;_frozen&quot;,&quot;&quot;) !== ts.id ) {
				return this;
			}
			var scb = $(td).hasClass(&quot;cbox&quot;),
			cSel = $(ts).triggerHandler(&quot;jqGridBeforeSelectRow&quot;, [ptr[0].id, e]);
			cSel = (cSel === false || cSel === &#x27;stop&#x27;) ? false : true;
			if(cSel &amp;&amp; $.isFunction(ts.p.beforeSelectRow)) { cSel = ts.p.beforeSelectRow.call(ts,ptr[0].id, e); }
			if (td.tagName === &#x27;A&#x27; || ((td.tagName === &#x27;INPUT&#x27; || td.tagName === &#x27;TEXTAREA&#x27; || td.tagName === &#x27;OPTION&#x27; || td.tagName === &#x27;SELECT&#x27; ) &amp;&amp; !scb) ) { return; }
			if(cSel === true) {
				ri = ptr[0].id;
				ci = $.jgrid.getCellIndex(td);
				tdHtml = $(td).closest(&quot;td,th&quot;).html();
				$(ts).triggerHandler(&quot;jqGridCellSelect&quot;, [ri,ci,tdHtml,e]);
				if($.isFunction(ts.p.onCellSelect)) {
					ts.p.onCellSelect.call(ts,ri,ci,tdHtml,e);
				}
				if(ts.p.cellEdit === true) {
					if(ts.p.multiselect &amp;&amp; scb){
						$(ts).jqGrid(&quot;setSelection&quot;, ri ,true,e);
					} else {
						ri = ptr[0].rowIndex;
						try {$(ts).jqGrid(&quot;editCell&quot;,ri,ci,true);} catch (_) {}
					}
				} else if ( !ts.p.multikey ) {
					if(ts.p.multiselect &amp;&amp; ts.p.multiboxonly) {
						if(scb){$(ts).jqGrid(&quot;setSelection&quot;,ri,true,e);}
						else {
							var frz = ts.p.frozenColumns ? ts.p.id+&quot;_frozen&quot; : &quot;&quot;;
							$(ts.p.selarrrow).each(function(i,n){
								var trid = $(ts).jqGrid(&#x27;getGridRowById&#x27;,n);
								$( trid ).removeClass(&quot;ui-state-highlight&quot;);
								$(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(n))[ts.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;, false);
								if(frz) {
									$(&quot;#&quot;+$.jgrid.jqID(n), &quot;#&quot;+$.jgrid.jqID(frz)).removeClass(&quot;ui-state-highlight&quot;);
									$(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(n), &quot;#&quot;+$.jgrid.jqID(frz))[ts.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;, false);
								}
							});
							ts.p.selarrrow = [];
							$(ts).jqGrid(&quot;setSelection&quot;,ri,true,e);
						}
					} else {
						$(ts).jqGrid(&quot;setSelection&quot;,ri,true,e);
					}
				} else {
					if(e[ts.p.multikey]) {
						$(ts).jqGrid(&quot;setSelection&quot;,ri,true,e);
					} else if(ts.p.multiselect &amp;&amp; scb) {
						scb = $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+ri).is(&quot;:checked&quot;);
						$(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+ri)[ts.p.useProp ? &#x27;prop&#x27; : &#x27;attr&#x27;](&quot;checked&quot;, scb);
					}
				}
			}
		}).bind(&#x27;reloadGrid&#x27;, function(e,opts) {
			if(ts.p.treeGrid ===true) {	ts.p.datatype = ts.p.treedatatype;}
			if (opts &amp;&amp; opts.current) {
				ts.grid.selectionPreserver(ts);
			}
			if(ts.p.datatype===&quot;local&quot;){ $(ts).jqGrid(&quot;resetSelection&quot;);  if(ts.p.data.length) { refreshIndex();} }
			else if(!ts.p.treeGrid) {
				ts.p.selrow=null;
				if(ts.p.multiselect) {ts.p.selarrrow =[];setHeadCheckBox(false);}
				ts.p.savedRow = [];
			}
			if(ts.p.scroll) {emptyRows.call(ts, true, false);}
			if (opts &amp;&amp; opts.page) {
				var page = opts.page;
				if (page &gt; ts.p.lastpage) { page = ts.p.lastpage; }
				if (page &lt; 1) { page = 1; }
				ts.p.page = page;
				if (ts.grid.prevRowHeight) {
					ts.grid.bDiv.scrollTop = (page - 1) * ts.grid.prevRowHeight * ts.p.rowNum;
				} else {
					ts.grid.bDiv.scrollTop = 0;
				}
			}
			if (ts.grid.prevRowHeight &amp;&amp; ts.p.scroll) {
				delete ts.p.lastpage;
				ts.grid.populateVisible();
			} else {
				ts.grid.populate();
			}
			if(ts.p._inlinenav===true) {$(ts).jqGrid(&#x27;showAddEditButtons&#x27;);}
			return false;
		})
		.dblclick(function(e) {
			td = e.target;
			ptr = $(td,ts.rows).closest(&quot;tr.jqgrow&quot;);
			if($(ptr).length === 0 ){return;}
			ri = ptr[0].rowIndex;
			ci = $.jgrid.getCellIndex(td);
			$(ts).triggerHandler(&quot;jqGridDblClickRow&quot;, [$(ptr).attr(&quot;id&quot;),ri,ci,e]);
			if ($.isFunction(ts.p.ondblClickRow)) { ts.p.ondblClickRow.call(ts,$(ptr).attr(&quot;id&quot;),ri,ci, e); }
		})
		.bind(&#x27;contextmenu&#x27;, function(e) {
			td = e.target;
			ptr = $(td,ts.rows).closest(&quot;tr.jqgrow&quot;);
			if($(ptr).length === 0 ){return;}
			if(!ts.p.multiselect) {	$(ts).jqGrid(&quot;setSelection&quot;,ptr[0].id,true,e);	}
			ri = ptr[0].rowIndex;
			ci = $.jgrid.getCellIndex(td);
			$(ts).triggerHandler(&quot;jqGridRightClickRow&quot;, [$(ptr).attr(&quot;id&quot;),ri,ci,e]);
			if ($.isFunction(ts.p.onRightClickRow)) { ts.p.onRightClickRow.call(ts,$(ptr).attr(&quot;id&quot;),ri,ci, e); }
		});
		grid.bDiv = document.createElement(&quot;div&quot;);
		if(isMSIE) { if(String(ts.p.height).toLowerCase() === &quot;auto&quot;) { ts.p.height = &quot;100%&quot;; } }
		$(grid.bDiv)
			.append($(&#x27;&lt;div style=&quot;position:relative;&#x27;+(isMSIE &amp;&amp; $.jgrid.msiever() &lt; 8 ? &quot;height:0.01%;&quot; : &quot;&quot;)+&#x27;&quot;&gt;&lt;/div&gt;&#x27;).append(&#x27;&lt;div&gt;&lt;/div&gt;&#x27;).append(this))
			.addClass(&quot;ui-jqgrid-bdiv&quot;)
			.css({ height: ts.p.height+(isNaN(ts.p.height)?&quot;&quot;:&quot;px&quot;), width: (grid.width)+&quot;px&quot;})
			.scroll(grid.scrollGrid);
		$(&quot;table:first&quot;,grid.bDiv).css({width:ts.p.tblwidth+&quot;px&quot;});
		if( !$.support.tbody ) { //IE
			if( $(&quot;tbody&quot;,this).length === 2 ) { $(&quot;tbody:gt(0)&quot;,this).remove();}
		}
		if(ts.p.multikey){
			if( $.jgrid.msie) {
				$(grid.bDiv).bind(&quot;selectstart&quot;,function(){return false;});
			} else {
				$(grid.bDiv).bind(&quot;mousedown&quot;,function(){return false;});
			}
		}
		if(hg) {$(grid.bDiv).hide();}
		grid.cDiv = document.createElement(&quot;div&quot;);
		var arf = ts.p.hidegrid===true ? $(&quot;&lt;a role=&#x27;link&#x27; class=&#x27;ui-jqgrid-titlebar-close ui-corner-all HeaderButton&#x27; /&gt;&quot;).hover(
			function(){ arf.addClass(&#x27;ui-state-hover&#x27;);},
			function() {arf.removeClass(&#x27;ui-state-hover&#x27;);})
		.append(&quot;&lt;span class=&#x27;ui-icon ui-icon-circle-triangle-n&#x27;&gt;&lt;/span&gt;&quot;).css((dir===&quot;rtl&quot;?&quot;left&quot;:&quot;right&quot;),&quot;0px&quot;) : &quot;&quot;;
		$(grid.cDiv).append(arf).append(&quot;&lt;span class=&#x27;ui-jqgrid-title&#x27;&gt;&quot;+ts.p.caption+&quot;&lt;/span&gt;&quot;)
		.addClass(&quot;ui-jqgrid-titlebar ui-jqgrid-caption&quot;+(dir===&quot;rtl&quot; ? &quot;-rtl&quot; :&quot;&quot; )+&quot; ui-widget-header ui-corner-top ui-helper-clearfix&quot;);
		$(grid.cDiv).insertBefore(grid.hDiv);
		if( ts.p.toolbar[0] ) {
			grid.uDiv = document.createElement(&quot;div&quot;);
			if(ts.p.toolbar[1] === &quot;top&quot;) {$(grid.uDiv).insertBefore(grid.hDiv);}
			else if (ts.p.toolbar[1]===&quot;bottom&quot; ) {$(grid.uDiv).insertAfter(grid.hDiv);}
			if(ts.p.toolbar[1]===&quot;both&quot;) {
				grid.ubDiv = document.createElement(&quot;div&quot;);
				$(grid.uDiv).addClass(&quot;ui-userdata ui-state-default&quot;).attr(&quot;id&quot;,&quot;t_&quot;+this.id).insertBefore(grid.hDiv);
				$(grid.ubDiv).addClass(&quot;ui-userdata ui-state-default&quot;).attr(&quot;id&quot;,&quot;tb_&quot;+this.id).insertAfter(grid.hDiv);
				if(hg)  {$(grid.ubDiv).hide();}
			} else {
				$(grid.uDiv).width(grid.width).addClass(&quot;ui-userdata ui-state-default&quot;).attr(&quot;id&quot;,&quot;t_&quot;+this.id);
			}
			if(hg) {$(grid.uDiv).hide();}
		}
		if(ts.p.toppager) {
			ts.p.toppager = $.jgrid.jqID(ts.p.id)+&quot;_toppager&quot;;
			grid.topDiv = $(&quot;&lt;div id=&#x27;&quot;+ts.p.toppager+&quot;&#x27;&gt;&lt;/div&gt;&quot;)[0];
			ts.p.toppager = &quot;#&quot;+ts.p.toppager;
			$(grid.topDiv).addClass(&#x27;ui-state-default ui-jqgrid-toppager&#x27;).width(grid.width).insertBefore(grid.hDiv);
			setPager(ts.p.toppager,&#x27;_t&#x27;);
		}
		if(ts.p.footerrow) {
			grid.sDiv = $(&quot;&lt;div class=&#x27;ui-jqgrid-sdiv&#x27;&gt;&lt;/div&gt;&quot;)[0];
			hb = $(&quot;&lt;div class=&#x27;ui-jqgrid-hbox&quot;+(dir===&quot;rtl&quot;?&quot;-rtl&quot;:&quot;&quot;)+&quot;&#x27;&gt;&lt;/div&gt;&quot;);
			$(grid.sDiv).append(hb).width(grid.width).insertAfter(grid.hDiv);
			$(hb).append(tfoot);
			grid.footers = $(&quot;.ui-jqgrid-ftable&quot;,grid.sDiv)[0].rows[0].cells;
			if(ts.p.rownumbers) { grid.footers[0].className = &#x27;ui-state-default jqgrid-rownum&#x27;; }
			if(hg) {$(grid.sDiv).hide();}
		}
		hb = null;
		if(ts.p.caption) {
			var tdt = ts.p.datatype;
			if(ts.p.hidegrid===true) {
				$(&quot;.ui-jqgrid-titlebar-close&quot;,grid.cDiv).click( function(e){
					var onHdCl = $.isFunction(ts.p.onHeaderClick),
					elems = &quot;.ui-jqgrid-bdiv, .ui-jqgrid-hdiv, .ui-jqgrid-pager, .ui-jqgrid-sdiv&quot;,
					counter, self = this;
					if(ts.p.toolbar[0]===true) {
						if( ts.p.toolbar[1]===&#x27;both&#x27;) {
							elems += &#x27;, #&#x27; + $(grid.ubDiv).attr(&#x27;id&#x27;);
						}
						elems += &#x27;, #&#x27; + $(grid.uDiv).attr(&#x27;id&#x27;);
					}
					counter = $(elems,&quot;#gview_&quot;+$.jgrid.jqID(ts.p.id)).length;

					if(ts.p.gridstate === &#x27;visible&#x27;) {
						$(elems,&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).slideUp(&quot;fast&quot;, function() {
							counter--;
							if (counter === 0) {
								$(&quot;span&quot;,self).removeClass(&quot;ui-icon-circle-triangle-n&quot;).addClass(&quot;ui-icon-circle-triangle-s&quot;);
								ts.p.gridstate = &#x27;hidden&#x27;;
								if($(&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).hasClass(&quot;ui-resizable&quot;)) { $(&quot;.ui-resizable-handle&quot;,&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).hide(); }
								$(ts).triggerHandler(&quot;jqGridHeaderClick&quot;, [ts.p.gridstate,e]);
								if(onHdCl) {if(!hg) {ts.p.onHeaderClick.call(ts,ts.p.gridstate,e);}}
							}
						});
					} else if(ts.p.gridstate === &#x27;hidden&#x27;){
						$(elems,&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).slideDown(&quot;fast&quot;, function() {
							counter--;
							if (counter === 0) {
								$(&quot;span&quot;,self).removeClass(&quot;ui-icon-circle-triangle-s&quot;).addClass(&quot;ui-icon-circle-triangle-n&quot;);
								if(hg) {ts.p.datatype = tdt;populate();hg=false;}
								ts.p.gridstate = &#x27;visible&#x27;;
								if($(&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).hasClass(&quot;ui-resizable&quot;)) { $(&quot;.ui-resizable-handle&quot;,&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).show(); }
								$(ts).triggerHandler(&quot;jqGridHeaderClick&quot;, [ts.p.gridstate,e]);
								if(onHdCl) {if(!hg) {ts.p.onHeaderClick.call(ts,ts.p.gridstate,e);}}
							}
						});
					}
					return false;
				});
				if(hg) {ts.p.datatype=&quot;local&quot;; $(&quot;.ui-jqgrid-titlebar-close&quot;,grid.cDiv).trigger(&quot;click&quot;);}
			}
		} else {$(grid.cDiv).hide();}
		$(grid.hDiv).after(grid.bDiv)
		.mousemove(function (e) {
			if(grid.resizing){grid.dragMove(e);return false;}
		});
		$(&quot;.ui-jqgrid-labels&quot;,grid.hDiv).bind(&quot;selectstart&quot;, function () { return false; });
		$(document).bind( &quot;mouseup.jqGrid&quot; + ts.p.id, function () {
			if(grid.resizing) {	grid.dragEnd(); return false;}
			return true;
		});
		ts.formatCol = formatCol;
		ts.sortData = sortData;
		ts.updatepager = updatepager;
		ts.refreshIndex = refreshIndex;
		ts.setHeadCheckBox = setHeadCheckBox;
		ts.constructTr = constructTr;
		ts.formatter = function ( rowId, cellval , colpos, rwdat, act){return formatter(rowId, cellval , colpos, rwdat, act);};
		$.extend(grid,{populate : populate, emptyRows: emptyRows, beginReq: beginReq, endReq: endReq});
		this.grid = grid;
		ts.addXmlData = function(d) {addXmlData(d,ts.grid.bDiv);};
		ts.addJSONData = function(d) {addJSONData(d,ts.grid.bDiv);};
		this.grid.cols = this.rows[0].cells;
		$(ts).triggerHandler(&quot;jqGridInitGrid&quot;);
		if ($.isFunction( ts.p.onInitGrid )) { ts.p.onInitGrid.call(ts); }

		populate();ts.p.hiddengrid=false;
	});
};
$.jgrid.extend({
	getGridParam : function(pName) {
		var $t = this[0];
		if (!$t || !$t.grid) {return;}
		if (!pName) { return $t.p; }
		return $t.p[pName] !== undefined ? $t.p[pName] : null;
	},
	setGridParam : function (newParams){
		return this.each(function(){
			if (this.grid &amp;&amp; typeof newParams === &#x27;object&#x27;) {$.extend(true,this.p,newParams);}
		});
	},
	getGridRowById: function ( rowid ) {
		var row;
		this.each( function(){
			try {
				//row = this.rows.namedItem( rowid );
				var i = this.rows.length;
				while(i--) {
					if( rowid.toString() === this.rows[i].id) {
						row = this.rows[i];
						break;
					}
				}
			} catch ( e ) {
				row = $(this.grid.bDiv).find( &quot;#&quot; + $.jgrid.jqID( rowid ));
			}
		});
		return row;
	},
	getDataIDs : function () {
		var ids=[], i=0, len, j=0;
		this.each(function(){
			len = this.rows.length;
			if(len &amp;&amp; len&gt;0){
				while(i&lt;len) {
					if($(this.rows[i]).hasClass(&#x27;jqgrow&#x27;)) {
						ids[j] = this.rows[i].id;
						j++;
					}
					i++;
				}
			}
		});
		return ids;
	},
	setSelection : function(selection,onsr, e) {
		return this.each(function(){
			var $t = this, stat,pt, ner, ia, tpsr, fid;
			if(selection === undefined) { return; }
			onsr = onsr === false ? false : true;
			pt=$($t).jqGrid(&#x27;getGridRowById&#x27;, selection);
			if(!pt || !pt.className || pt.className.indexOf( &#x27;ui-state-disabled&#x27; ) &gt; -1 ) { return; }
			function scrGrid(iR){
				var ch = $($t.grid.bDiv)[0].clientHeight,
				st = $($t.grid.bDiv)[0].scrollTop,
				rpos = $($t.rows[iR]).position().top,
				rh = $t.rows[iR].clientHeight;
				if(rpos+rh &gt;= ch+st) { $($t.grid.bDiv)[0].scrollTop = rpos-(ch+st)+rh+st; }
				else if(rpos &lt; ch+st) {
					if(rpos &lt; st) {
						$($t.grid.bDiv)[0].scrollTop = rpos;
					}
				}
			}
			if($t.p.scrollrows===true) {
				ner = $($t).jqGrid(&#x27;getGridRowById&#x27;,selection).rowIndex;
				if(ner &gt;=0 ){
					scrGrid(ner);
				}
			}
			if($t.p.frozenColumns === true ) {
				fid = $t.p.id+&quot;_frozen&quot;;
			}
			if(!$t.p.multiselect) {
				if(pt.className !== &quot;ui-subgrid&quot;) {
					if( $t.p.selrow !== pt.id) {
						$( $($t).jqGrid(&#x27;getGridRowById&#x27;, $t.p.selrow) ).removeClass(&quot;ui-state-highlight&quot;).attr({&quot;aria-selected&quot;:&quot;false&quot;, &quot;tabindex&quot; : &quot;-1&quot;});
						$(pt).addClass(&quot;ui-state-highlight&quot;).attr({&quot;aria-selected&quot;:&quot;true&quot;, &quot;tabindex&quot; : &quot;0&quot;});//.focus();
						if(fid) {
							$(&quot;#&quot;+$.jgrid.jqID($t.p.selrow), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;);
							$(&quot;#&quot;+$.jgrid.jqID(selection), &quot;#&quot;+$.jgrid.jqID(fid)).addClass(&quot;ui-state-highlight&quot;);
						}
						stat = true;
					} else {
						stat = false;
					}
					$t.p.selrow = pt.id;
					if( onsr ) {
						$($t).triggerHandler(&quot;jqGridSelectRow&quot;, [pt.id, stat, e]);
						if( $t.p.onSelectRow) { $t.p.onSelectRow.call($t, pt.id, stat, e); }
					}
				}
			} else {
				//unselect selectall checkbox when deselecting a specific row
				$t.setHeadCheckBox( false );
				$t.p.selrow = pt.id;
				ia = $.inArray($t.p.selrow,$t.p.selarrrow);
				if (  ia === -1 ){
					if(pt.className !== &quot;ui-subgrid&quot;) { $(pt).addClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;true&quot;);}
					stat = true;
					$t.p.selarrrow.push($t.p.selrow);
				} else {
					if(pt.className !== &quot;ui-subgrid&quot;) { $(pt).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;);}
					stat = false;
					$t.p.selarrrow.splice(ia,1);
					tpsr = $t.p.selarrrow[0];
					$t.p.selrow = (tpsr === undefined) ? null : tpsr;
				}
				$(&quot;#jqg_&quot;+$.jgrid.jqID($t.p.id)+&quot;_&quot;+$.jgrid.jqID(pt.id))[$t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;,stat);
				if(fid) {
					if(ia === -1) {
						$(&quot;#&quot;+$.jgrid.jqID(selection), &quot;#&quot;+$.jgrid.jqID(fid)).addClass(&quot;ui-state-highlight&quot;);
					} else {
						$(&quot;#&quot;+$.jgrid.jqID(selection), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;);
					}
					$(&quot;#jqg_&quot;+$.jgrid.jqID($t.p.id)+&quot;_&quot;+$.jgrid.jqID(selection), &quot;#&quot;+$.jgrid.jqID(fid))[$t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;,stat);
				}
				if( onsr ) {
					$($t).triggerHandler(&quot;jqGridSelectRow&quot;, [pt.id, stat, e]);
					if( $t.p.onSelectRow) { $t.p.onSelectRow.call($t, pt.id , stat, e); }
				}
			}
		});
	},
	resetSelection : function( rowid ){
		return this.each(function(){
			var t = this, sr, fid;
			if( t.p.frozenColumns === true ) {
				fid = t.p.id+&quot;_frozen&quot;;
			}
			if(rowid !== undefined ) {
				sr = rowid === t.p.selrow ? t.p.selrow : rowid;
				$(&quot;#&quot;+$.jgrid.jqID(t.p.id)+&quot; tbody:first tr#&quot;+$.jgrid.jqID(sr)).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;);
				if (fid) { $(&quot;#&quot;+$.jgrid.jqID(sr), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;); }
				if(t.p.multiselect) {
					$(&quot;#jqg_&quot;+$.jgrid.jqID(t.p.id)+&quot;_&quot;+$.jgrid.jqID(sr), &quot;#&quot;+$.jgrid.jqID(t.p.id))[t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;,false);
					if(fid) { $(&quot;#jqg_&quot;+$.jgrid.jqID(t.p.id)+&quot;_&quot;+$.jgrid.jqID(sr), &quot;#&quot;+$.jgrid.jqID(fid))[t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;,false); }
					t.setHeadCheckBox( false);
				}
				sr = null;
			} else if(!t.p.multiselect) {
				if(t.p.selrow) {
					$(&quot;#&quot;+$.jgrid.jqID(t.p.id)+&quot; tbody:first tr#&quot;+$.jgrid.jqID(t.p.selrow)).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;);
					if(fid) { $(&quot;#&quot;+$.jgrid.jqID(t.p.selrow), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;); }
					t.p.selrow = null;
				}
			} else {
				$(t.p.selarrrow).each(function(i,n){
					$( $(t).jqGrid(&#x27;getGridRowById&#x27;,n) ).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;);
					$(&quot;#jqg_&quot;+$.jgrid.jqID(t.p.id)+&quot;_&quot;+$.jgrid.jqID(n))[t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;,false);
					if(fid) {
						$(&quot;#&quot;+$.jgrid.jqID(n), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;);
						$(&quot;#jqg_&quot;+$.jgrid.jqID(t.p.id)+&quot;_&quot;+$.jgrid.jqID(n), &quot;#&quot;+$.jgrid.jqID(fid))[t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;,false);
					}
				});
				t.setHeadCheckBox( false );
				t.p.selarrrow = [];
				t.p.selrow = null;
			}
			if(t.p.cellEdit === true) {
				if(parseInt(t.p.iCol,10)&gt;=0  &amp;&amp; parseInt(t.p.iRow,10)&gt;=0) {
					$(&quot;td:eq(&quot;+t.p.iCol+&quot;)&quot;,t.rows[t.p.iRow]).removeClass(&quot;edit-cell ui-state-highlight&quot;);
					$(t.rows[t.p.iRow]).removeClass(&quot;selected-row ui-state-hover&quot;);
				}
			}
			t.p.savedRow = [];
		});
	},
	getRowData : function( rowid ) {
		var res = {}, resall, getall=false, len, j=0;
		this.each(function(){
			var $t = this,nm,ind;
			if(rowid === undefined) {
				getall = true;
				resall = [];
				len = $t.rows.length;
			} else {
				ind = $($t).jqGrid(&#x27;getGridRowById&#x27;, rowid);
				if(!ind) { return res; }
				len = 2;
			}
			while(j&lt;len){
				if(getall) { ind = $t.rows[j]; }
				if( $(ind).hasClass(&#x27;jqgrow&#x27;) ) {
					$(&#x27;td[role=&quot;gridcell&quot;]&#x27;,ind).each( function(i) {
						nm = $t.p.colModel[i].name;
						if ( nm !== &#x27;cb&#x27; &amp;&amp; nm !== &#x27;subgrid&#x27; &amp;&amp; nm !== &#x27;rn&#x27;) {
							if($t.p.treeGrid===true &amp;&amp; nm === $t.p.ExpandColumn) {
								res[nm] = $.jgrid.htmlDecode($(&quot;span:first&quot;,this).html());
							} else {
								try {
									res[nm] = $.unformat.call($t,this,{rowId:ind.id, colModel:$t.p.colModel[i]},i);
								} catch (e){
									res[nm] = $.jgrid.htmlDecode($(this).html());
								}
							}
						}
					});
					if(getall) { resall.push(res); res={}; }
				}
				j++;
			}
		});
		return resall || res;
	},
	delRowData : function(rowid) {
		var success = false, rowInd, ia;
		this.each(function() {
			var $t = this;
			rowInd = $($t).jqGrid(&#x27;getGridRowById&#x27;, rowid);
			if(!rowInd) {return false;}
				$(rowInd).remove();
				$t.p.records--;
				$t.p.reccount--;
				$t.updatepager(true,false);
				success=true;
				if($t.p.multiselect) {
					ia = $.inArray(rowid,$t.p.selarrrow);
					if(ia !== -1) { $t.p.selarrrow.splice(ia,1);}
				}
				if ($t.p.multiselect &amp;&amp; $t.p.selarrrow.length &gt; 0) {
					$t.p.selrow = $t.p.selarrrow[$t.p.selarrrow.length-1];
				} else {
					$t.p.selrow = null;
				}
			if($t.p.datatype === &#x27;local&#x27;) {
				var id = $.jgrid.stripPref($t.p.idPrefix, rowid),
				pos = $t.p._index[id];
				if(pos !== undefined) {
					$t.p.data.splice(pos,1);
					$t.refreshIndex();
				}
			}
			if( $t.p.altRows === true &amp;&amp; success ) {
				var cn = $t.p.altclass;
				$($t.rows).each(function(i){
					if(i % 2 === 1) { $(this).addClass(cn); }
					else { $(this).removeClass(cn); }
				});
			}
		});
		return success;
	},
	setRowData : function(rowid, data, cssp) {
		var nm, success=true, title;
		this.each(function(){
			if(!this.grid) {return false;}
			var t = this, vl, ind, cp = typeof cssp, lcdata={};
			ind = $(this).jqGrid(&#x27;getGridRowById&#x27;, rowid);
			if(!ind) { return false; }
			if( data ) {
				try {
					$(this.p.colModel).each(function(i){
						nm = this.name;
						var dval =$.jgrid.getAccessor(data,nm);
						if( dval !== undefined) {
							lcdata[nm] = this.formatter &amp;&amp; typeof this.formatter === &#x27;string&#x27; &amp;&amp; this.formatter === &#x27;date&#x27; ? $.unformat.date.call(t,dval,this) : dval;
							vl = t.formatter( rowid, dval, i, data, &#x27;edit&#x27;);
							title = this.title ? {&quot;title&quot;:$.jgrid.stripHtml(vl)} : {};
							if(t.p.treeGrid===true &amp;&amp; nm === t.p.ExpandColumn) {
								$(&quot;td[role=&#x27;gridcell&#x27;]:eq(&quot;+i+&quot;) &gt; span:first&quot;,ind).html(vl).attr(title);
							} else {
								$(&quot;td[role=&#x27;gridcell&#x27;]:eq(&quot;+i+&quot;)&quot;,ind).html(vl).attr(title);
							}
						}
					});
					if(t.p.datatype === &#x27;local&#x27;) {
						var id = $.jgrid.stripPref(t.p.idPrefix, rowid),
						pos = t.p._index[id], key;
						if(t.p.treeGrid) {
							for(key in t.p.treeReader){
								if(t.p.treeReader.hasOwnProperty(key)) {
									delete lcdata[t.p.treeReader[key]];
								}
							}
						}
						if(pos !== undefined) {
							t.p.data[pos] = $.extend(true, t.p.data[pos], lcdata);
						}
						lcdata = null;
					}
				} catch (e) {
					success = false;
				}
			}
			if(success) {
				if(cp === &#x27;string&#x27;) {$(ind).addClass(cssp);} else if(cssp !== null &amp;&amp; cp === &#x27;object&#x27;) {$(ind).css(cssp);}
				$(t).triggerHandler(&quot;jqGridAfterGridComplete&quot;);
			}
		});
		return success;
	},
	addRowData : function(rowid,rdata,pos,src) {
		if(!pos) {pos = &quot;last&quot;;}
		var success = false, nm, row, gi, si, ni,sind, i, v, prp=&quot;&quot;, aradd, cnm, cn, data, cm, id;
		if(rdata) {
			if($.isArray(rdata)) {
				aradd=true;
				pos = &quot;last&quot;;
				cnm = rowid;
			} else {
				rdata = [rdata];
				aradd = false;
			}
			this.each(function() {
				var t = this, datalen = rdata.length;
				ni = t.p.rownumbers===true ? 1 :0;
				gi = t.p.multiselect ===true ? 1 :0;
				si = t.p.subGrid===true ? 1 :0;
				if(!aradd) {
					if(rowid !== undefined) { rowid = String(rowid);}
					else {
						rowid = $.jgrid.randId();
						if(t.p.keyIndex !== false) {
							cnm = t.p.colModel[t.p.keyIndex+gi+si+ni].name;
							if(rdata[0][cnm] !== undefined) { rowid = rdata[0][cnm]; }
						}
					}
				}
				cn = t.p.altclass;
				var k = 0, cna =&quot;&quot;, lcdata = {},
				air = $.isFunction(t.p.afterInsertRow) ? true : false;
				while(k &lt; datalen) {
					data = rdata[k];
					row=[];
					if(aradd) {
						try {
							rowid = data[cnm];
							if(rowid===undefined) {
								rowid = $.jgrid.randId();
							}
						}
						catch (e) {rowid = $.jgrid.randId();}
						cna = t.p.altRows === true ?  (t.rows.length-1)%2 === 0 ? cn : &quot;&quot; : &quot;&quot;;
					}
					id = rowid;
					rowid  = t.p.idPrefix + rowid;
					if(ni){
						prp = t.formatCol(0,1,&#x27;&#x27;,null,rowid, true);
						row[row.length] = &quot;&lt;td role=\&quot;gridcell\&quot; class=\&quot;ui-state-default jqgrid-rownum\&quot; &quot;+prp+&quot;&gt;0&lt;/td&gt;&quot;;
					}
					if(gi) {
						v = &quot;&lt;input role=\&quot;checkbox\&quot; type=\&quot;checkbox\&quot;&quot;+&quot; id=\&quot;jqg_&quot;+t.p.id+&quot;_&quot;+rowid+&quot;\&quot; class=\&quot;cbox\&quot;/&gt;&quot;;
						prp = t.formatCol(ni,1,&#x27;&#x27;, null, rowid, true);
						row[row.length] = &quot;&lt;td role=\&quot;gridcell\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;;
					}
					if(si) {
						row[row.length] = $(t).jqGrid(&quot;addSubGridCell&quot;,gi+ni,1);
					}
					for(i = gi+si+ni; i &lt; t.p.colModel.length;i++){
						cm = t.p.colModel[i];
						nm = cm.name;
						lcdata[nm] = data[nm];
						v = t.formatter( rowid, $.jgrid.getAccessor(data,nm), i, data );
						prp = t.formatCol(i,1,v, data, rowid, lcdata);
						row[row.length] = &quot;&lt;td role=\&quot;gridcell\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;;
					}
					row.unshift( t.constructTr(rowid, false, cna, lcdata, data, false ) );
					row[row.length] = &quot;&lt;/tr&gt;&quot;;
					if(t.rows.length === 0){
						$(&quot;table:first&quot;,t.grid.bDiv).append(row.join(&#x27;&#x27;));
					} else {
						switch (pos) {
							case &#x27;last&#x27;:
								$(t.rows[t.rows.length-1]).after(row.join(&#x27;&#x27;));
								sind = t.rows.length-1;
								break;
							case &#x27;first&#x27;:
								$(t.rows[0]).after(row.join(&#x27;&#x27;));
								sind = 1;
								break;
							case &#x27;after&#x27;:
								sind = $(t).jqGrid(&#x27;getGridRowById&#x27;, src);
								if (sind) {
									if($(t.rows[sind.rowIndex+1]).hasClass(&quot;ui-subgrid&quot;)) { $(t.rows[sind.rowIndex+1]).after(row); }
									else { $(sind).after(row.join(&#x27;&#x27;)); }
									sind=sind.rowIndex + 1;
								}
								break;
							case &#x27;before&#x27;:
								sind = $(t).jqGrid(&#x27;getGridRowById&#x27;, src);
								if(sind) {
									$(sind).before(row.join(&#x27;&#x27;));
									sind=sind.rowIndex - 1;
								}
								break;
						}
					}
					if(t.p.subGrid===true) {
						$(t).jqGrid(&quot;addSubGrid&quot;,gi+ni, sind);
					}
					t.p.records++;
					t.p.reccount++;
					$(t).triggerHandler(&quot;jqGridAfterInsertRow&quot;, [rowid,data,data]);
					if(air) { t.p.afterInsertRow.call(t,rowid,data,data); }
					k++;
					if(t.p.datatype === &#x27;local&#x27;) {
						lcdata[t.p.localReader.id] = id;
						t.p._index[id] = t.p.data.length;
						t.p.data.push(lcdata);
						lcdata = {};
					}
				}
				if( t.p.altRows === true &amp;&amp; !aradd) {
					if (pos === &quot;last&quot;) {
						if ((t.rows.length-1)%2 === 1)  {$(t.rows[t.rows.length-1]).addClass(cn);}
					} else {
						$(t.rows).each(function(i){
							if(i % 2 ===1) { $(this).addClass(cn); }
							else { $(this).removeClass(cn); }
						});
					}
				}
				t.updatepager(true,true);
				success = true;
			});
		}
		return success;
	},
	footerData : function(action,data, format) {
		var nm, success=false, res={}, title;
		function isEmpty(obj) {
			var i;
			for(i in obj) {
				if (obj.hasOwnProperty(i)) { return false; }
			}
			return true;
		}
		if(action == undefined) { action = &quot;get&quot;; }
		if(typeof format !== &quot;boolean&quot;) { format  = true; }
		action = action.toLowerCase();
		this.each(function(){
			var t = this, vl;
			if(!t.grid || !t.p.footerrow) {return false;}
			if(action === &quot;set&quot;) { if(isEmpty(data)) { return false; } }
			success=true;
			$(this.p.colModel).each(function(i){
				nm = this.name;
				if(action === &quot;set&quot;) {
					if( data[nm] !== undefined) {
						vl = format ? t.formatter( &quot;&quot;, data[nm], i, data, &#x27;edit&#x27;) : data[nm];
						title = this.title ? {&quot;title&quot;:$.jgrid.stripHtml(vl)} : {};
						$(&quot;tr.footrow td:eq(&quot;+i+&quot;)&quot;,t.grid.sDiv).html(vl).attr(title);
						success = true;
					}
				} else if(action === &quot;get&quot;) {
					res[nm] = $(&quot;tr.footrow td:eq(&quot;+i+&quot;)&quot;,t.grid.sDiv).html();
				}
			});
		});
		return action === &quot;get&quot; ? res : success;
	},
	showHideCol : function(colname,show) {
		return this.each(function() {
			var $t = this, fndh=false, brd=$.jgrid.cell_width ? 0: $t.p.cellLayout, cw;
			if (!$t.grid ) {return;}
			if( typeof colname === &#x27;string&#x27;) {colname=[colname];}
			show = show !== &quot;none&quot; ? &quot;&quot; : &quot;none&quot;;
			var sw = show === &quot;&quot; ? true :false,
			gh = $t.p.groupHeader &amp;&amp; (typeof $t.p.groupHeader === &#x27;object&#x27; || $.isFunction($t.p.groupHeader) );
			if(gh) { $($t).jqGrid(&#x27;destroyGroupHeader&#x27;, false); }
			$(this.p.colModel).each(function(i) {
				if ($.inArray(this.name,colname) !== -1 &amp;&amp; this.hidden === sw) {
					if($t.p.frozenColumns === true &amp;&amp; this.frozen === true) {
						return true;
					}
					$(&quot;tr[role=rowheader]&quot;,$t.grid.hDiv).each(function(){
						$(this.cells[i]).css(&quot;display&quot;, show);
					});
					$($t.rows).each(function(){
						if (!$(this).hasClass(&quot;jqgroup&quot;)) {
							$(this.cells[i]).css(&quot;display&quot;, show);
						}
					});
					if($t.p.footerrow) { $(&quot;tr.footrow td:eq(&quot;+i+&quot;)&quot;, $t.grid.sDiv).css(&quot;display&quot;, show); }
					cw =  parseInt(this.width,10);
					if(show === &quot;none&quot;) {
						$t.p.tblwidth -= cw+brd;
					} else {
						$t.p.tblwidth += cw+brd;
					}
					this.hidden = !sw;
					fndh=true;
					$($t).triggerHandler(&quot;jqGridShowHideCol&quot;, [sw,this.name,i]);
				}
			});
			if(fndh===true) {
				if($t.p.shrinkToFit === true &amp;&amp; !isNaN($t.p.height)) { $t.p.tblwidth += parseInt($t.p.scrollOffset,10);}
				$($t).jqGrid(&quot;setGridWidth&quot;,$t.p.shrinkToFit === true ? $t.p.tblwidth : $t.p.width );
			}
			if( gh )  {
				$($t).jqGrid(&#x27;setGroupHeaders&#x27;,$t.p.groupHeader);
			}
		});
	},
	hideCol : function (colname) {
		return this.each(function(){$(this).jqGrid(&quot;showHideCol&quot;,colname,&quot;none&quot;);});
	},
	showCol : function(colname) {
		return this.each(function(){$(this).jqGrid(&quot;showHideCol&quot;,colname,&quot;&quot;);});
	},
	remapColumns : function(permutation, updateCells, keepHeader)
	{
		function resortArray(a) {
			var ac;
			if (a.length) {
				ac = $.makeArray(a);
			} else {
				ac = $.extend({}, a);
			}
			$.each(permutation, function(i) {
				a[i] = ac[this];
			});
		}
		var ts = this.get(0);
		function resortRows(parent, clobj) {
			$(&quot;&gt;tr&quot;+(clobj||&quot;&quot;), parent).each(function() {
				var row = this;
				var elems = $.makeArray(row.cells);
				$.each(permutation, function() {
					var e = elems[this];
					if (e) {
						row.appendChild(e);
					}
				});
			});
		}
		resortArray(ts.p.colModel);
		resortArray(ts.p.colNames);
		resortArray(ts.grid.headers);
		resortRows($(&quot;thead:first&quot;, ts.grid.hDiv), keepHeader &amp;&amp; &quot;:not(.ui-jqgrid-labels)&quot;);
		if (updateCells) {
			resortRows($(&quot;#&quot;+$.jgrid.jqID(ts.p.id)+&quot; tbody:first&quot;), &quot;.jqgfirstrow, tr.jqgrow, tr.jqfoot&quot;);
		}
		if (ts.p.footerrow) {
			resortRows($(&quot;tbody:first&quot;, ts.grid.sDiv));
		}
		if (ts.p.remapColumns) {
			if (!ts.p.remapColumns.length){
				ts.p.remapColumns = $.makeArray(permutation);
			} else {
				resortArray(ts.p.remapColumns);
			}
		}
		ts.p.lastsort = $.inArray(ts.p.lastsort, permutation);
		if(ts.p.treeGrid) { ts.p.expColInd = $.inArray(ts.p.expColInd, permutation); }
		$(ts).triggerHandler(&quot;jqGridRemapColumns&quot;, [permutation, updateCells, keepHeader]);
	},
	setGridWidth : function(nwidth, shrink) {
		return this.each(function(){
			if (!this.grid ) {return;}
			var $t = this, cw,
			initwidth = 0, brd=$.jgrid.cell_width ? 0: $t.p.cellLayout, lvc, vc=0, hs=false, scw=$t.p.scrollOffset, aw, gw=0, cr;
			if(typeof shrink !== &#x27;boolean&#x27;) {
				shrink=$t.p.shrinkToFit;
			}
			if(isNaN(nwidth)) {return;}
			nwidth = parseInt(nwidth,10);
			$t.grid.width = $t.p.width = nwidth;
			$(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id)).css(&quot;width&quot;,nwidth+&quot;px&quot;);
			$(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).css(&quot;width&quot;,nwidth+&quot;px&quot;);
			$($t.grid.bDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;);
			$($t.grid.hDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;);
			if($t.p.pager ) {$($t.p.pager).css(&quot;width&quot;,nwidth+&quot;px&quot;);}
			if($t.p.toppager ) {$($t.p.toppager).css(&quot;width&quot;,nwidth+&quot;px&quot;);}
			if($t.p.toolbar[0] === true){
				$($t.grid.uDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;);
				if($t.p.toolbar[1]===&quot;both&quot;) {$($t.grid.ubDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;);}
			}
			if($t.p.footerrow) { $($t.grid.sDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;); }
			if(shrink ===false &amp;&amp; $t.p.forceFit === true) {$t.p.forceFit=false;}
			if(shrink===true) {
				$.each($t.p.colModel, function() {
					if(this.hidden===false){
						cw = this.widthOrg;
						initwidth += cw+brd;
						if(this.fixed) {
							gw += cw+brd;
						} else {
							vc++;
						}
					}
				});
				if(vc  === 0) { return; }
				$t.p.tblwidth = initwidth;
				aw = nwidth-brd*vc-gw;
				if(!isNaN($t.p.height)) {
					if($($t.grid.bDiv)[0].clientHeight &lt; $($t.grid.bDiv)[0].scrollHeight || $t.rows.length === 1){
						hs = true;
						aw -= scw;
					}
				}
				initwidth =0;
				var cle = $t.grid.cols.length &gt;0;
				$.each($t.p.colModel, function(i) {
					if(this.hidden === false &amp;&amp; !this.fixed){
						cw = this.widthOrg;
						cw = Math.round(aw*cw/($t.p.tblwidth-brd*vc-gw));
						if (cw &lt; 0) { return; }
						this.width =cw;
						initwidth += cw;
						$t.grid.headers[i].width=cw;
						$t.grid.headers[i].el.style.width=cw+&quot;px&quot;;
						if($t.p.footerrow) { $t.grid.footers[i].style.width = cw+&quot;px&quot;; }
						if(cle) { $t.grid.cols[i].style.width = cw+&quot;px&quot;; }
						lvc = i;
					}
				});

				if (!lvc) { return; }

				cr =0;
				if (hs) {
					if(nwidth-gw-(initwidth+brd*vc) !== scw){
						cr = nwidth-gw-(initwidth+brd*vc)-scw;
					}
				} else if( Math.abs(nwidth-gw-(initwidth+brd*vc)) !== 1) {
					cr = nwidth-gw-(initwidth+brd*vc);
				}
				$t.p.colModel[lvc].width += cr;
				$t.p.tblwidth = initwidth+cr+brd*vc+gw;
				if($t.p.tblwidth &gt; nwidth) {
					var delta = $t.p.tblwidth - parseInt(nwidth,10);
					$t.p.tblwidth = nwidth;
					cw = $t.p.colModel[lvc].width = $t.p.colModel[lvc].width-delta;
				} else {
					cw= $t.p.colModel[lvc].width;
				}
				$t.grid.headers[lvc].width = cw;
				$t.grid.headers[lvc].el.style.width=cw+&quot;px&quot;;
				if(cle) { $t.grid.cols[lvc].style.width = cw+&quot;px&quot;; }
				if($t.p.footerrow) {
					$t.grid.footers[lvc].style.width = cw+&quot;px&quot;;
				}
			}
			if($t.p.tblwidth) {
				$(&#x27;table:first&#x27;,$t.grid.bDiv).css(&quot;width&quot;,$t.p.tblwidth+&quot;px&quot;);
				$(&#x27;table:first&#x27;,$t.grid.hDiv).css(&quot;width&quot;,$t.p.tblwidth+&quot;px&quot;);
				$t.grid.hDiv.scrollLeft = $t.grid.bDiv.scrollLeft;
				if($t.p.footerrow) {
					$(&#x27;table:first&#x27;,$t.grid.sDiv).css(&quot;width&quot;,$t.p.tblwidth+&quot;px&quot;);
				}
			}
		});
	},
	setGridHeight : function (nh) {
		return this.each(function (){
			var $t = this;
			if(!$t.grid) {return;}
			var bDiv = $($t.grid.bDiv);
			bDiv.css({height: nh+(isNaN(nh)?&quot;&quot;:&quot;px&quot;)});
			if($t.p.frozenColumns === true){
				//follow the original set height to use 16, better scrollbar width detection
				$(&#x27;#&#x27;+$.jgrid.jqID($t.p.id)+&quot;_frozen&quot;).parent().height(bDiv.height() - 16);
			}
			$t.p.height = nh;
			if ($t.p.scroll) { $t.grid.populateVisible(); }
		});
	},
	setCaption : function (newcap){
		return this.each(function(){
			this.p.caption=newcap;
			$(&quot;span.ui-jqgrid-title, span.ui-jqgrid-title-rtl&quot;,this.grid.cDiv).html(newcap);
			$(this.grid.cDiv).show();
		});
	},
	setLabel : function(colname, nData, prop, attrp ){
		return this.each(function(){
			var $t = this, pos=-1;
			if(!$t.grid) {return;}
			if(colname !== undefined) {
				$($t.p.colModel).each(function(i){
					if (this.name === colname) {
						pos = i;return false;
					}
				});
			} else { return; }
			if(pos&gt;=0) {
				var thecol = $(&quot;tr.ui-jqgrid-labels th:eq(&quot;+pos+&quot;)&quot;,$t.grid.hDiv);
				if (nData){
					var ico = $(&quot;.s-ico&quot;,thecol);
					$(&quot;[id^=jqgh_]&quot;,thecol).empty().html(nData).append(ico);
					$t.p.colNames[pos] = nData;
				}
				if (prop) {
					if(typeof prop === &#x27;string&#x27;) {$(thecol).addClass(prop);} else {$(thecol).css(prop);}
				}
				if(typeof attrp === &#x27;object&#x27;) {$(thecol).attr(attrp);}
			}
		});
	},
	setCell : function(rowid,colname,nData,cssp,attrp, forceupd) {
		return this.each(function(){
			var $t = this, pos =-1,v, title;
			if(!$t.grid) {return;}
			if(isNaN(colname)) {
				$($t.p.colModel).each(function(i){
					if (this.name === colname) {
						pos = i;return false;
					}
				});
			} else {pos = parseInt(colname,10);}
			if(pos&gt;=0) {
				var ind = $($t).jqGrid(&#x27;getGridRowById&#x27;, rowid);
				if (ind){
					var tcell = $(&quot;td:eq(&quot;+pos+&quot;)&quot;,ind);
					if(nData !== &quot;&quot; || forceupd === true) {
						v = $t.formatter(rowid, nData, pos,ind,&#x27;edit&#x27;);
						title = $t.p.colModel[pos].title ? {&quot;title&quot;:$.jgrid.stripHtml(v)} : {};
						if($t.p.treeGrid &amp;&amp; $(&quot;.tree-wrap&quot;,$(tcell)).length&gt;0) {
							$(&quot;span&quot;,$(tcell)).html(v).attr(title);
						} else {
							$(tcell).html(v).attr(title);
						}
						if($t.p.datatype === &quot;local&quot;) {
							var cm = $t.p.colModel[pos], index;
							nData = cm.formatter &amp;&amp; typeof cm.formatter === &#x27;string&#x27; &amp;&amp; cm.formatter === &#x27;date&#x27; ? $.unformat.date.call($t,nData,cm) : nData;
							index = $t.p._index[$.jgrid.stripPref($t.p.idPrefix, rowid)];
							if(index !== undefined) {
								$t.p.data[index][cm.name] = nData;
							}
						}
					}
					if(typeof cssp === &#x27;string&#x27;){
						$(tcell).addClass(cssp);
					} else if(cssp) {
						$(tcell).css(cssp);
					}
					if(typeof attrp === &#x27;object&#x27;) {$(tcell).attr(attrp);}
				}
			}
		});
	},
	getCell : function(rowid,col) {
		var ret = false;
		this.each(function(){
			var $t=this, pos=-1;
			if(!$t.grid) {return;}
			if(isNaN(col)) {
				$($t.p.colModel).each(function(i){
					if (this.name === col) {
						pos = i;return false;
					}
				});
			} else {pos = parseInt(col,10);}
			if(pos&gt;=0) {
				var ind = $($t).jqGrid(&#x27;getGridRowById&#x27;, rowid);
				if(ind) {
					try {
						ret = $.unformat.call($t,$(&quot;td:eq(&quot;+pos+&quot;)&quot;,ind),{rowId:ind.id, colModel:$t.p.colModel[pos]},pos);
					} catch (e){
						ret = $.jgrid.htmlDecode($(&quot;td:eq(&quot;+pos+&quot;)&quot;,ind).html());
					}
				}
			}
		});
		return ret;
	},
	getCol : function (col, obj, mathopr) {
		var ret = [], val, sum=0, min, max, v;
		obj = typeof obj !== &#x27;boolean&#x27; ? false : obj;
		if(mathopr === undefined) { mathopr = false; }
		this.each(function(){
			var $t=this, pos=-1;
			if(!$t.grid) {return;}
			if(isNaN(col)) {
				$($t.p.colModel).each(function(i){
					if (this.name === col) {
						pos = i;return false;
					}
				});
			} else {pos = parseInt(col,10);}
			if(pos&gt;=0) {
				var ln = $t.rows.length, i =0, dlen=0;
				if (ln &amp;&amp; ln&gt;0){
					while(i&lt;ln){
						if($($t.rows[i]).hasClass(&#x27;jqgrow&#x27;)) {
							try {
								val = $.unformat.call($t,$($t.rows[i].cells[pos]),{rowId:$t.rows[i].id, colModel:$t.p.colModel[pos]},pos);
							} catch (e) {
								val = $.jgrid.htmlDecode($t.rows[i].cells[pos].innerHTML);
							}
							if(mathopr) {
								v = parseFloat(val);
								if(!isNaN(v)) {
									sum += v;
									if (max === undefined) {max = min = v;}
									min = Math.min(min, v);
									max = Math.max(max, v);
									dlen++;
								}
							}
							else if(obj) { ret.push( {id:$t.rows[i].id,value:val} ); }
							else { ret.push( val ); }
						}
						i++;
					}
					if(mathopr) {
						switch(mathopr.toLowerCase()){
							case &#x27;sum&#x27;: ret =sum; break;
							case &#x27;avg&#x27;: ret = sum/dlen; break;
							case &#x27;count&#x27;: ret = (ln-1); break;
							case &#x27;min&#x27;: ret = min; break;
							case &#x27;max&#x27;: ret = max; break;
						}
					}
				}
			}
		});
		return ret;
	},
	clearGridData : function(clearfooter) {
		return this.each(function(){
			var $t = this;
			if(!$t.grid) {return;}
			if(typeof clearfooter !== &#x27;boolean&#x27;) { clearfooter = false; }
			if($t.p.deepempty) {$(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first tr:gt(0)&quot;).remove();}
			else {
				var trf = $(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first tr:first&quot;)[0];
				$(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first&quot;).empty().append(trf);
			}
			if($t.p.footerrow &amp;&amp; clearfooter) { $(&quot;.ui-jqgrid-ftable td&quot;,$t.grid.sDiv).html(&quot;&amp;#160;&quot;); }
			$t.p.selrow = null; $t.p.selarrrow= []; $t.p.savedRow = [];
			$t.p.records = 0;$t.p.page=1;$t.p.lastpage=0;$t.p.reccount=0;
			$t.p.data = []; $t.p._index = {};
			$t.updatepager(true,false);
		});
	},
	getInd : function(rowid,rc){
		var ret =false,rw;
		this.each(function(){
			rw = $(this).jqGrid(&#x27;getGridRowById&#x27;, rowid);
			if(rw) {
				ret = rc===true ? rw: rw.rowIndex;
			}
		});
		return ret;
	},
	bindKeys : function( settings ){
		var o = $.extend({
			onEnter: null,
			onSpace: null,
			onLeftKey: null,
			onRightKey: null,
			scrollingRows : true
		},settings || {});
		return this.each(function(){
			var $t = this;
			if( !$(&#x27;body&#x27;).is(&#x27;[role]&#x27;) ){$(&#x27;body&#x27;).attr(&#x27;role&#x27;,&#x27;application&#x27;);}
			$t.p.scrollrows = o.scrollingRows;
			$($t).keydown(function(event){
				var target = $($t).find(&#x27;tr[tabindex=0]&#x27;)[0], id, r, mind,
				expanded = $t.p.treeReader.expanded_field;
				//check for arrow keys
				if(target) {
					mind = $t.p._index[$.jgrid.stripPref($t.p.idPrefix, target.id)];
					if(event.keyCode === 37 || event.keyCode === 38 || event.keyCode === 39 || event.keyCode === 40){
						// up key
						if(event.keyCode === 38 ){
							r = target.previousSibling;
							id = &quot;&quot;;
							if(r) {
								if($(r).is(&quot;:hidden&quot;)) {
									while(r) {
										r = r.previousSibling;
										if(!$(r).is(&quot;:hidden&quot;) &amp;&amp; $(r).hasClass(&#x27;jqgrow&#x27;)) {id = r.id;break;}
									}
								} else {
									id = r.id;
								}
							}
							$($t).jqGrid(&#x27;setSelection&#x27;, id, true, event);
							event.preventDefault();
						}
						//if key is down arrow
						if(event.keyCode === 40){
							r = target.nextSibling;
							id =&quot;&quot;;
							if(r) {
								if($(r).is(&quot;:hidden&quot;)) {
									while(r) {
										r = r.nextSibling;
										if(!$(r).is(&quot;:hidden&quot;) &amp;&amp; $(r).hasClass(&#x27;jqgrow&#x27;) ) {id = r.id;break;}
									}
								} else {
									id = r.id;
								}
							}
							$($t).jqGrid(&#x27;setSelection&#x27;, id, true, event);
							event.preventDefault();
						}
						// left
						if(event.keyCode === 37 ){
							if($t.p.treeGrid &amp;&amp; $t.p.data[mind][expanded]) {
								$(target).find(&quot;div.treeclick&quot;).trigger(&#x27;click&#x27;);
							}
							$($t).triggerHandler(&quot;jqGridKeyLeft&quot;, [$t.p.selrow]);
							if($.isFunction(o.onLeftKey)) {
								o.onLeftKey.call($t, $t.p.selrow);
							}
						}
						// right
						if(event.keyCode === 39 ){
							if($t.p.treeGrid &amp;&amp; !$t.p.data[mind][expanded]) {
								$(target).find(&quot;div.treeclick&quot;).trigger(&#x27;click&#x27;);
							}
							$($t).triggerHandler(&quot;jqGridKeyRight&quot;, [$t.p.selrow]);
							if($.isFunction(o.onRightKey)) {
								o.onRightKey.call($t, $t.p.selrow);
							}
						}
					}
					//check if enter was pressed on a grid or treegrid node
					else if( event.keyCode === 13 ){
						$($t).triggerHandler(&quot;jqGridKeyEnter&quot;, [$t.p.selrow]);
						if($.isFunction(o.onEnter)) {
							o.onEnter.call($t, $t.p.selrow);
						}
					} else if(event.keyCode === 32) {
						$($t).triggerHandler(&quot;jqGridKeySpace&quot;, [$t.p.selrow]);
						if($.isFunction(o.onSpace)) {
							o.onSpace.call($t, $t.p.selrow);
						}
					}
				}
			});
		});
	},
	unbindKeys : function(){
		return this.each(function(){
			$(this).unbind(&#x27;keydown&#x27;);
		});
	},
	getLocalRow : function (rowid) {
		var ret = false, ind;
		this.each(function(){
			if(rowid !== undefined) {
				ind = this.p._index[$.jgrid.stripPref(this.p.idPrefix, rowid)];
				if(ind &gt;= 0 ) {
					ret = this.p.data[ind];
				}
			}
		});
		return ret;
	}
});
})(jQuery);
/*jshint eqeqeq:false */
/*global jQuery */
(function($){
/**
 * jqGrid extension for custom methods
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 *
 * Wildraid wildraid@mail.ru
 * Oleg Kiriljuk oleg.kiriljuk@ok-soft-gmbh.com
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/
&quot;use strict&quot;;
$.jgrid.extend({
	getColProp : function(colname){
		var ret ={}, $t = this[0];
		if ( !$t.grid ) { return false; }
		var cM = $t.p.colModel, i;
		for ( i=0;i&lt;cM.length;i++ ) {
			if ( cM[i].name === colname ) {
				ret = cM[i];
				break;
			}
		}
		return ret;
	},
	setColProp : function(colname, obj){
		//do not set width will not work
		return this.each(function(){
			if ( this.grid ) {
				if ( obj ) {
					var cM = this.p.colModel, i;
					for ( i=0;i&lt;cM.length;i++ ) {
						if ( cM[i].name === colname ) {
							$.extend(true, this.p.colModel[i],obj);
							break;
						}
					}
				}
			}
		});
	},
	sortGrid : function(colname,reload, sor){
		return this.each(function(){
			var $t=this,idx=-1,i, sobj=false;
			if ( !$t.grid ) { return;}
			if ( !colname ) { colname = $t.p.sortname; }
			for ( i=0;i&lt;$t.p.colModel.length;i++ ) {
				if ( $t.p.colModel[i].index === colname || $t.p.colModel[i].name === colname ) {
					idx = i;
					if($t.p.frozenColumns === true &amp;&amp; $t.p.colModel[i].frozen === true) {
						sobj = $t.grid.fhDiv.find(&quot;#&quot; + $t.p.id + &quot;_&quot; + colname);
					}
					break;
				}
			}
			if ( idx !== -1 ){
				var sort = $t.p.colModel[idx].sortable;
				if(!sobj) {
					sobj = $t.grid.headers[idx].el;
				}
				if ( typeof sort !== &#x27;boolean&#x27; ) { sort =  true; }
				if ( typeof reload !==&#x27;boolean&#x27; ) { reload = false; }
				if ( sort ) { $t.sortData(&quot;jqgh_&quot;+$t.p.id+&quot;_&quot; + colname, idx, reload, sor, sobj); }
			}
		});
	},
	clearBeforeUnload : function () {
		return this.each(function(){
			var grid = this.grid;
			if ($.isFunction(grid.emptyRows)) {
				grid.emptyRows.call(this, true, true); // this work quick enough and reduce the size of memory leaks if we have someone
			}

			$(document).unbind(&quot;mouseup.jqGrid&quot; + this.p.id );
			$(grid.hDiv).unbind(&quot;mousemove&quot;); // TODO add namespace
			$(this).unbind();

			grid.dragEnd = null;
			grid.dragMove = null;
			grid.dragStart = null;
			grid.emptyRows = null;
			grid.populate = null;
			grid.populateVisible = null;
			grid.scrollGrid = null;
			grid.selectionPreserver = null;

			grid.bDiv = null;
			grid.cDiv = null;
			grid.hDiv = null;
			grid.cols = null;
			var i, l = grid.headers.length;
			for (i = 0; i &lt; l; i++) {
				grid.headers[i].el = null;
			}

			this.formatCol = null;
			this.sortData = null;
			this.updatepager = null;
			this.refreshIndex = null;
			this.setHeadCheckBox = null;
			this.constructTr = null;
			this.formatter = null;
			this.addXmlData = null;
			this.addJSONData = null;
			this.grid = null;
		});
	},
	GridDestroy : function () {
		return this.each(function(){
			if ( this.grid ) {
				if ( this.p.pager ) { // if not part of grid
					$(this.p.pager).remove();
				}
				try {
					$(this).jqGrid(&#x27;clearBeforeUnload&#x27;);
					$(&quot;#gbox_&quot;+$.jgrid.jqID(this.id)).remove();
				} catch (_) {}
			}
		});
	},
	GridUnload : function(){
		return this.each(function(){
			if ( !this.grid ) {return;}
			var defgrid = {id: $(this).attr(&#x27;id&#x27;),cl: $(this).attr(&#x27;class&#x27;)};
			if (this.p.pager) {
				$(this.p.pager).empty().removeClass(&quot;ui-state-default ui-jqgrid-pager ui-corner-bottom&quot;);
			}
			var newtable = document.createElement(&#x27;table&#x27;);
			$(newtable).attr({id:defgrid.id});
			newtable.className = defgrid.cl;
			var gid = $.jgrid.jqID(this.id);
			$(newtable).removeClass(&quot;ui-jqgrid-btable&quot;);
			if( $(this.p.pager).parents(&quot;#gbox_&quot;+gid).length === 1 ) {
				$(newtable).insertBefore(&quot;#gbox_&quot;+gid).show();
				$(this.p.pager).insertBefore(&quot;#gbox_&quot;+gid);
			} else {
				$(newtable).insertBefore(&quot;#gbox_&quot;+gid).show();
			}
			$(this).jqGrid(&#x27;clearBeforeUnload&#x27;);
			$(&quot;#gbox_&quot;+gid).remove();
		});
	},
	setGridState : function(state) {
		return this.each(function(){
			if ( !this.grid ) {return;}
			var $t = this;
			if(state === &#x27;hidden&#x27;){
				$(&quot;.ui-jqgrid-bdiv, .ui-jqgrid-hdiv&quot;,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).slideUp(&quot;fast&quot;);
				if($t.p.pager) {$($t.p.pager).slideUp(&quot;fast&quot;);}
				if($t.p.toppager) {$($t.p.toppager).slideUp(&quot;fast&quot;);}
				if($t.p.toolbar[0]===true) {
					if( $t.p.toolbar[1] === &#x27;both&#x27;) {
						$($t.grid.ubDiv).slideUp(&quot;fast&quot;);
					}
					$($t.grid.uDiv).slideUp(&quot;fast&quot;);
				}
				if($t.p.footerrow) { $(&quot;.ui-jqgrid-sdiv&quot;,&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id)).slideUp(&quot;fast&quot;); }
				$(&quot;.ui-jqgrid-titlebar-close span&quot;,$t.grid.cDiv).removeClass(&quot;ui-icon-circle-triangle-n&quot;).addClass(&quot;ui-icon-circle-triangle-s&quot;);
				$t.p.gridstate = &#x27;hidden&#x27;;
			} else if(state === &#x27;visible&#x27;) {
				$(&quot;.ui-jqgrid-hdiv, .ui-jqgrid-bdiv&quot;,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).slideDown(&quot;fast&quot;);
				if($t.p.pager) {$($t.p.pager).slideDown(&quot;fast&quot;);}
				if($t.p.toppager) {$($t.p.toppager).slideDown(&quot;fast&quot;);}
				if($t.p.toolbar[0]===true) {
					if( $t.p.toolbar[1] === &#x27;both&#x27;) {
						$($t.grid.ubDiv).slideDown(&quot;fast&quot;);
					}
					$($t.grid.uDiv).slideDown(&quot;fast&quot;);
				}
				if($t.p.footerrow) { $(&quot;.ui-jqgrid-sdiv&quot;,&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id)).slideDown(&quot;fast&quot;); }
				$(&quot;.ui-jqgrid-titlebar-close span&quot;,$t.grid.cDiv).removeClass(&quot;ui-icon-circle-triangle-s&quot;).addClass(&quot;ui-icon-circle-triangle-n&quot;);
				$t.p.gridstate = &#x27;visible&#x27;;
			}

		});
	},
	filterToolbar : function(p){
		p = $.extend({
			autosearch: true,
			searchOnEnter : true,
			beforeSearch: null,
			afterSearch: null,
			beforeClear: null,
			afterClear: null,
			searchurl : &#x27;&#x27;,
			stringResult: false,
			groupOp: &#x27;AND&#x27;,
			defaultSearch : &quot;bw&quot;,
			searchOperators : false,
			resetIcon : &quot;x&quot;,
			operands : { &quot;eq&quot; :&quot;==&quot;, &quot;ne&quot;:&quot;!&quot;,&quot;lt&quot;:&quot;&lt;&quot;,&quot;le&quot;:&quot;&lt;=&quot;,&quot;gt&quot;:&quot;&gt;&quot;,&quot;ge&quot;:&quot;&gt;=&quot;,&quot;bw&quot;:&quot;^&quot;,&quot;bn&quot;:&quot;!^&quot;,&quot;in&quot;:&quot;=&quot;,&quot;ni&quot;:&quot;!=&quot;,&quot;ew&quot;:&quot;|&quot;,&quot;en&quot;:&quot;!@&quot;,&quot;cn&quot;:&quot;~&quot;,&quot;nc&quot;:&quot;!~&quot;,&quot;nu&quot;:&quot;#&quot;,&quot;nn&quot;:&quot;!#&quot;}
		}, $.jgrid.search , p  || {});
		return this.each(function(){
			var $t = this;
			if(this.ftoolbar) { return; }
			var triggerToolbar = function() {
				var sdata={}, j=0, v, nm, sopt={},so;
				$.each($t.p.colModel,function(){
					var $elem = $(&quot;#gs_&quot;+$.jgrid.jqID(this.name), (this.frozen===true &amp;&amp; $t.p.frozenColumns === true) ?  $t.grid.fhDiv : $t.grid.hDiv);
					nm = this.index || this.name;
					if(p.searchOperators ) {
						so = $elem.parent().prev().children(&quot;a&quot;).attr(&quot;soper&quot;) || p.defaultSearch;
					} else {
						so  = (this.searchoptions &amp;&amp; this.searchoptions.sopt) ? this.searchoptions.sopt[0] : this.stype===&#x27;select&#x27;?  &#x27;eq&#x27; : p.defaultSearch;
					}
					v = this.stype === &quot;custom&quot; &amp;&amp; $.isFunction(this.searchoptions.custom_value) &amp;&amp; $elem.length &gt; 0 &amp;&amp; $elem[0].nodeName.toUpperCase() === &quot;SPAN&quot; ?
						this.searchoptions.custom_value.call($t, $elem.children(&quot;.customelement:first&quot;), &quot;get&quot;) :
						$elem.val();
					if(v || so===&quot;nu&quot; || so===&quot;nn&quot;) {
						sdata[nm] = v;
						sopt[nm] = so;
						j++;
					} else {
						try {
							delete $t.p.postData[nm];
						} catch (z) {}
					}
				});
				var sd =  j&gt;0 ? true : false;
				if(p.stringResult === true || $t.p.datatype === &quot;local&quot;) {
					var ruleGroup = &quot;{\&quot;groupOp\&quot;:\&quot;&quot; + p.groupOp + &quot;\&quot;,\&quot;rules\&quot;:[&quot;;
					var gi=0;
					$.each(sdata,function(i,n){
						if (gi &gt; 0) {ruleGroup += &quot;,&quot;;}
						ruleGroup += &quot;{\&quot;field\&quot;:\&quot;&quot; + i + &quot;\&quot;,&quot;;
						ruleGroup += &quot;\&quot;op\&quot;:\&quot;&quot; + sopt[i] + &quot;\&quot;,&quot;;
						n+=&quot;&quot;;
						ruleGroup += &quot;\&quot;data\&quot;:\&quot;&quot; + n.replace(/\\/g,&#x27;\\\\&#x27;).replace(/\&quot;/g,&#x27;\\&quot;&#x27;) + &quot;\&quot;}&quot;;
						gi++;
					});
					ruleGroup += &quot;]}&quot;;
					$.extend($t.p.postData,{filters:ruleGroup});
					$.each([&#x27;searchField&#x27;, &#x27;searchString&#x27;, &#x27;searchOper&#x27;], function(i, n){
						if($t.p.postData.hasOwnProperty(n)) { delete $t.p.postData[n];}
					});
				} else {
					$.extend($t.p.postData,sdata);
				}
				var saveurl;
				if($t.p.searchurl) {
					saveurl = $t.p.url;
					$($t).jqGrid(&quot;setGridParam&quot;,{url:$t.p.searchurl});
				}
				var bsr = $($t).triggerHandler(&quot;jqGridToolbarBeforeSearch&quot;) === &#x27;stop&#x27; ? true : false;
				if(!bsr &amp;&amp; $.isFunction(p.beforeSearch)){bsr = p.beforeSearch.call($t);}
				if(!bsr) { $($t).jqGrid(&quot;setGridParam&quot;,{search:sd}).trigger(&quot;reloadGrid&quot;,[{page:1}]); }
				if(saveurl) {$($t).jqGrid(&quot;setGridParam&quot;,{url:saveurl});}
				$($t).triggerHandler(&quot;jqGridToolbarAfterSearch&quot;);
				if($.isFunction(p.afterSearch)){p.afterSearch.call($t);}
			},
			clearToolbar = function(trigger){
				var sdata={}, j=0, nm;
				trigger = (typeof trigger !== &#x27;boolean&#x27;) ? true : trigger;
				$.each($t.p.colModel,function(){
					var v, $elem = $(&quot;#gs_&quot;+$.jgrid.jqID(this.name),(this.frozen===true &amp;&amp; $t.p.frozenColumns === true) ?  $t.grid.fhDiv : $t.grid.hDiv);
					if(this.searchoptions &amp;&amp; this.searchoptions.defaultValue !== undefined) { v = this.searchoptions.defaultValue; }
					nm = this.index || this.name;
					switch (this.stype) {
						case &#x27;select&#x27; :
							$elem.find(&quot;option&quot;).each(function (i){
								if(i===0) { this.selected = true; }
								if ($(this).val() === v) {
									this.selected = true;
									return false;
								}
							});
							if ( v !== undefined ) {
								// post the key and not the text
								sdata[nm] = v;
								j++;
							} else {
								try {
									delete $t.p.postData[nm];
								} catch(e) {}
							}
							break;
						case &#x27;text&#x27;:
							$elem.val(v || &quot;&quot;);
							if(v !== undefined) {
								sdata[nm] = v;
								j++;
							} else {
								try {
									delete $t.p.postData[nm];
								} catch (y){}
							}
							break;
						case &#x27;custom&#x27;:
							if ($.isFunction(this.searchoptions.custom_value) &amp;&amp; $elem.length &gt; 0 &amp;&amp; $elem[0].nodeName.toUpperCase() === &quot;SPAN&quot;) {
								this.searchoptions.custom_value.call($t, $elem.children(&quot;.customelement:first&quot;), &quot;set&quot;, v || &quot;&quot;);
							}
							break;
					}
				});
				var sd =  j&gt;0 ? true : false;
				$t.p.resetsearch =  true;
				if(p.stringResult === true || $t.p.datatype === &quot;local&quot;) {
					var ruleGroup = &quot;{\&quot;groupOp\&quot;:\&quot;&quot; + p.groupOp + &quot;\&quot;,\&quot;rules\&quot;:[&quot;;
					var gi=0;
					$.each(sdata,function(i,n){
						if (gi &gt; 0) {ruleGroup += &quot;,&quot;;}
						ruleGroup += &quot;{\&quot;field\&quot;:\&quot;&quot; + i + &quot;\&quot;,&quot;;
						ruleGroup += &quot;\&quot;op\&quot;:\&quot;&quot; + &quot;eq&quot; + &quot;\&quot;,&quot;;
						n+=&quot;&quot;;
						ruleGroup += &quot;\&quot;data\&quot;:\&quot;&quot; + n.replace(/\\/g,&#x27;\\\\&#x27;).replace(/\&quot;/g,&#x27;\\&quot;&#x27;) + &quot;\&quot;}&quot;;
						gi++;
					});
					ruleGroup += &quot;]}&quot;;
					$.extend($t.p.postData,{filters:ruleGroup});
					$.each([&#x27;searchField&#x27;, &#x27;searchString&#x27;, &#x27;searchOper&#x27;], function(i, n){
						if($t.p.postData.hasOwnProperty(n)) { delete $t.p.postData[n];}
					});
				} else {
					$.extend($t.p.postData,sdata);
				}
				var saveurl;
				if($t.p.searchurl) {
					saveurl = $t.p.url;
					$($t).jqGrid(&quot;setGridParam&quot;,{url:$t.p.searchurl});
				}
				var bcv = $($t).triggerHandler(&quot;jqGridToolbarBeforeClear&quot;) === &#x27;stop&#x27; ? true : false;
				if(!bcv &amp;&amp; $.isFunction(p.beforeClear)){bcv = p.beforeClear.call($t);}
				if(!bcv) {
					if(trigger) {
						$($t).jqGrid(&quot;setGridParam&quot;,{search:sd}).trigger(&quot;reloadGrid&quot;,[{page:1}]);
					}
				}
				if(saveurl) {$($t).jqGrid(&quot;setGridParam&quot;,{url:saveurl});}
				$($t).triggerHandler(&quot;jqGridToolbarAfterClear&quot;);
				if($.isFunction(p.afterClear)){p.afterClear();}
			},
			toggleToolbar = function(){
				var trow = $(&quot;tr.ui-search-toolbar&quot;,$t.grid.hDiv),
				trow2 = $t.p.frozenColumns === true ?  $(&quot;tr.ui-search-toolbar&quot;,$t.grid.fhDiv) : false;
				if(trow.css(&quot;display&quot;) === &#x27;none&#x27;) {
					trow.show();
					if(trow2) {
						trow2.show();
					}
				} else {
					trow.hide();
					if(trow2) {
						trow2.hide();
					}
				}
			},
			buildRuleMenu = function( elem, left, top ){
				$(&quot;#sopt_menu&quot;).remove();

				left=parseInt(left,10);
				top=parseInt(top,10) + 18;

				var fs =  $(&#x27;.ui-jqgrid-view&#x27;).css(&#x27;font-size&#x27;) || &#x27;11px&#x27;;
				var str = &#x27;&lt;ul id=&quot;sopt_menu&quot; class=&quot;ui-search-menu&quot; role=&quot;menu&quot; tabindex=&quot;0&quot; style=&quot;font-size:&#x27;+fs+&#x27;;left:&#x27;+left+&#x27;px;top:&#x27;+top+&#x27;px;&quot;&gt;&#x27;,
				selected = $(elem).attr(&quot;soper&quot;), selclass,
				aoprs = [], ina;
				var i=0, nm =$(elem).attr(&quot;colname&quot;),len = $t.p.colModel.length;
				while(i&lt;len) {
					if($t.p.colModel[i].name === nm) {
						break;
					}
					i++;
				}
				var cm = $t.p.colModel[i], options = $.extend({}, cm.searchoptions);
				if(!options.sopt) {
					options.sopt = [];
					options.sopt[0]= cm.stype===&#x27;select&#x27; ?  &#x27;eq&#x27; : p.defaultSearch;
				}
				$.each(p.odata, function() { aoprs.push(this.oper); });
				for ( i = 0 ; i &lt; options.sopt.length; i++) {
					ina = $.inArray(options.sopt[i],aoprs);
					if(ina !== -1) {
						selclass = selected === p.odata[ina].oper ? &quot;ui-state-highlight&quot; : &quot;&quot;;
						str += &#x27;&lt;li class=&quot;ui-menu-item &#x27;+selclass+&#x27;&quot; role=&quot;presentation&quot;&gt;&lt;a class=&quot;ui-corner-all g-menu-item&quot; tabindex=&quot;0&quot; role=&quot;menuitem&quot; value=&quot;&#x27;+p.odata[ina].oper+&#x27;&quot; oper=&quot;&#x27;+p.operands[p.odata[ina].oper]+&#x27;&quot;&gt;&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot;&gt;&lt;tr&gt;&lt;td width=&quot;25px&quot;&gt;&#x27;+p.operands[p.odata[ina].oper]+&#x27;&lt;/td&gt;&lt;td&gt;&#x27;+ p.odata[ina].text+&#x27;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/a&gt;&lt;/li&gt;&#x27;;
					}
				}
				str += &quot;&lt;/ul&gt;&quot;;
				$(&#x27;body&#x27;).append(str);
				$(&quot;#sopt_menu&quot;).addClass(&quot;ui-menu ui-widget ui-widget-content ui-corner-all&quot;);
				$(&quot;#sopt_menu &gt; li &gt; a&quot;).hover(
					function(){ $(this).addClass(&quot;ui-state-hover&quot;); },
					function(){ $(this).removeClass(&quot;ui-state-hover&quot;); }
				).click(function( e ){
					var v = $(this).attr(&quot;value&quot;),
					oper = $(this).attr(&quot;oper&quot;);
					$($t).triggerHandler(&quot;jqGridToolbarSelectOper&quot;, [v, oper, elem]);
					$(&quot;#sopt_menu&quot;).hide();
					$(elem).text(oper).attr(&quot;soper&quot;,v);
					if(p.autosearch===true){
						var inpelm = $(elem).parent().next().children()[0];
						if( $(inpelm).val() || v===&quot;nu&quot; || v ===&quot;nn&quot;) {
							triggerToolbar();
						}
					}
				});
			};
			// create the row
			var tr = $(&quot;&lt;tr class=&#x27;ui-search-toolbar&#x27; role=&#x27;rowheader&#x27;&gt;&lt;/tr&gt;&quot;);
			var timeoutHnd;
			$.each($t.p.colModel,function(ci){
				var cm=this, soptions, surl, self, select = &quot;&quot;, sot=&quot;=&quot;, so, i,
				th = $(&quot;&lt;th role=&#x27;columnheader&#x27; class=&#x27;ui-state-default ui-th-column ui-th-&quot;+$t.p.direction+&quot;&#x27;&gt;&lt;/th&gt;&quot;),
				thd = $(&quot;&lt;div style=&#x27;position:relative;height:100%;padding-right:0.3em;padding-left:0.3em;&#x27;&gt;&lt;/div&gt;&quot;),
				stbl = $(&quot;&lt;table class=&#x27;ui-search-table&#x27; cellspacing=&#x27;0&#x27;&gt;&lt;tr&gt;&lt;td class=&#x27;ui-search-oper&#x27;&gt;&lt;/td&gt;&lt;td class=&#x27;ui-search-input&#x27;&gt;&lt;/td&gt;&lt;td class=&#x27;ui-search-clear&#x27;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;);
				if(this.hidden===true) { $(th).css(&quot;display&quot;,&quot;none&quot;);}
				this.search = this.search === false ? false : true;
				if(this.stype === undefined) {this.stype=&#x27;text&#x27;;}
				soptions = $.extend({},this.searchoptions || {});
				if(this.search){
					if(p.searchOperators) {
						so  = (soptions.sopt) ? soptions.sopt[0] : cm.stype===&#x27;select&#x27; ?  &#x27;eq&#x27; : p.defaultSearch;
						for(i = 0;i&lt;p.odata.length;i++) {
							if(p.odata[i].oper === so) {
								sot = p.operands[so] || &quot;&quot;;
								break;
							}
						}
						var st = soptions.searchtitle != null ? soptions.searchtitle : p.operandTitle;
						select = &quot;&lt;a title=&#x27;&quot;+st+&quot;&#x27; style=&#x27;padding-right: 0.5em;&#x27; soper=&#x27;&quot;+so+&quot;&#x27; class=&#x27;soptclass&#x27; colname=&#x27;&quot;+this.name+&quot;&#x27;&gt;&quot;+sot+&quot;&lt;/a&gt;&quot;;
					}
					$(&quot;td:eq(0)&quot;,stbl).attr(&quot;colindex&quot;,ci).append(select);
					if(soptions.clearSearch === undefined) {
						soptions.clearSearch = true;
					}
					if(soptions.clearSearch) {
						var csv = p.resetTitle || &#x27;Clear Search Value&#x27;;
						$(&quot;td:eq(2)&quot;,stbl).append(&quot;&lt;a title=&#x27;&quot;+csv+&quot;&#x27; style=&#x27;padding-right: 0.3em;padding-left: 0.3em;&#x27; class=&#x27;clearsearchclass&#x27;&gt;&quot;+p.resetIcon+&quot;&lt;/a&gt;&quot;);
					} else {
						$(&quot;td:eq(2)&quot;, stbl).hide();
					}
					switch (this.stype)
					{
					case &quot;select&quot;:
						surl = this.surl || soptions.dataUrl;
						if(surl) {
							// data returned should have already constructed html select
							// primitive jQuery load
							self = thd;
							$(self).append(stbl);
							$.ajax($.extend({
								url: surl,
								dataType: &quot;html&quot;,
								success: function(res) {
									if(soptions.buildSelect !== undefined) {
										var d = soptions.buildSelect(res);
										if (d) {
											$(&quot;td:eq(1)&quot;,stbl).append(d);
										}
									} else {
										$(&quot;td:eq(1)&quot;,stbl).append(res);
									}
									if(soptions.defaultValue !== undefined) { $(&quot;select&quot;,self).val(soptions.defaultValue); }
									$(&quot;select&quot;,self).attr({name:cm.index || cm.name, id: &quot;gs_&quot;+cm.name});
									if(soptions.attr) {$(&quot;select&quot;,self).attr(soptions.attr);}
									$(&quot;select&quot;,self).css({width: &quot;100%&quot;});
									// preserve autoserch
									$.jgrid.bindEv.call($t, $(&quot;select&quot;,self)[0], soptions);
									if(p.autosearch===true){
										$(&quot;select&quot;,self).change(function(){
											triggerToolbar();
											return false;
										});
									}
									res=null;
								}
							}, $.jgrid.ajaxOptions, $t.p.ajaxSelectOptions || {} ));
						} else {
							var oSv, sep, delim;
							if(cm.searchoptions) {
								oSv = cm.searchoptions.value === undefined ? &quot;&quot; : cm.searchoptions.value;
								sep = cm.searchoptions.separator === undefined ? &quot;:&quot; : cm.searchoptions.separator;
								delim = cm.searchoptions.delimiter === undefined ? &quot;;&quot; : cm.searchoptions.delimiter;
							} else if(cm.editoptions) {
								oSv = cm.editoptions.value === undefined ? &quot;&quot; : cm.editoptions.value;
								sep = cm.editoptions.separator === undefined ? &quot;:&quot; : cm.editoptions.separator;
								delim = cm.editoptions.delimiter === undefined ? &quot;;&quot; : cm.editoptions.delimiter;
							}
							if (oSv) {
								var elem = document.createElement(&quot;select&quot;);
								elem.style.width = &quot;100%&quot;;
								$(elem).attr({name:cm.index || cm.name, id: &quot;gs_&quot;+cm.name});
								var sv, ov, key, k;
								if(typeof oSv === &quot;string&quot;) {
									so = oSv.split(delim);
									for(k=0; k&lt;so.length;k++){
										sv = so[k].split(sep);
										ov = document.createElement(&quot;option&quot;);
										ov.value = sv[0]; ov.innerHTML = sv[1];
										elem.appendChild(ov);
									}
								} else if(typeof oSv === &quot;object&quot; ) {
									for (key in oSv) {
										if(oSv.hasOwnProperty(key)) {
											ov = document.createElement(&quot;option&quot;);
											ov.value = key; ov.innerHTML = oSv[key];
											elem.appendChild(ov);
										}
									}
								}
								if(soptions.defaultValue !== undefined) { $(elem).val(soptions.defaultValue); }
								if(soptions.attr) {$(elem).attr(soptions.attr);}
								$(thd).append(stbl);
								$.jgrid.bindEv.call($t, elem , soptions);
								$(&quot;td:eq(1)&quot;,stbl).append( elem );
								if(p.autosearch===true){
									$(elem).change(function(){
										triggerToolbar();
										return false;
									});
								}
							}
						}
						break;
					case &quot;text&quot;:
						var df = soptions.defaultValue !== undefined ? soptions.defaultValue: &quot;&quot;;

						$(&quot;td:eq(1)&quot;,stbl).append(&quot;&lt;input type=&#x27;text&#x27; style=&#x27;width:100%;padding:0px;&#x27; name=&#x27;&quot;+(cm.index || cm.name)+&quot;&#x27; id=&#x27;gs_&quot;+cm.name+&quot;&#x27; value=&#x27;&quot;+df+&quot;&#x27;/&gt;&quot;);
						$(thd).append(stbl);

						if(soptions.attr) {$(&quot;input&quot;,thd).attr(soptions.attr);}
						$.jgrid.bindEv.call($t, $(&quot;input&quot;,thd)[0], soptions);
						if(p.autosearch===true){
							if(p.searchOnEnter) {
								$(&quot;input&quot;,thd).keypress(function(e){
									var key = e.charCode || e.keyCode || 0;
									if(key === 13){
										triggerToolbar();
										return false;
									}
									return this;
								});
							} else {
								$(&quot;input&quot;,thd).keydown(function(e){
									var key = e.which;
									switch (key) {
										case 13:
											return false;
										case 9 :
										case 16:
										case 37:
										case 38:
										case 39:
										case 40:
										case 27:
											break;
										default :
											if(timeoutHnd) { clearTimeout(timeoutHnd); }
											timeoutHnd = setTimeout(function(){triggerToolbar();},500);
									}
								});
							}
						}
						break;
					case &quot;custom&quot;:
						$(&quot;td:eq(1)&quot;,stbl).append(&quot;&lt;span style=&#x27;width:95%;padding:0px;&#x27; name=&#x27;&quot;+(cm.index || cm.name)+&quot;&#x27; id=&#x27;gs_&quot;+cm.name+&quot;&#x27;/&gt;&quot;);
						$(thd).append(stbl);
						try {
							if($.isFunction(soptions.custom_element)) {
								var celm = soptions.custom_element.call($t,soptions.defaultValue !== undefined ? soptions.defaultValue: &quot;&quot;,soptions);
								if(celm) {
									celm = $(celm).addClass(&quot;customelement&quot;);
									$(thd).find(&quot;&gt;span&quot;).append(celm);
								} else {
									throw &quot;e2&quot;;
								}
							} else {
								throw &quot;e1&quot;;
							}
						} catch (e) {
							if (e === &quot;e1&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function &#x27;custom_element&#x27; &quot;+$.jgrid.edit.msg.nodefined,$.jgrid.edit.bClose);}
							if (e === &quot;e2&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function &#x27;custom_element&#x27; &quot;+$.jgrid.edit.msg.novalue,$.jgrid.edit.bClose);}
							else { $.jgrid.info_dialog($.jgrid.errors.errcap,typeof e===&quot;string&quot;?e:e.message,$.jgrid.edit.bClose); }
						}
						break;
					}
				}
				$(th).append(thd);
				$(tr).append(th);
				if(!p.searchOperators) {
					$(&quot;td:eq(0)&quot;,stbl).hide();
				}
			});
			$(&quot;table thead&quot;,$t.grid.hDiv).append(tr);
			if(p.searchOperators) {
				$(&quot;.soptclass&quot;,tr).click(function(e){
					var offset = $(this).offset(),
					left = ( offset.left ),
					top = ( offset.top);
					buildRuleMenu(this, left, top );
					e.stopPropagation();
				});
				$(&quot;body&quot;).on(&#x27;click&#x27;, function(e){
					if(e.target.className !== &quot;soptclass&quot;) {
						$(&quot;#sopt_menu&quot;).hide();
					}
				});
			}
			$(&quot;.clearsearchclass&quot;,tr).click(function(e){
				var ptr = $(this).parents(&quot;tr:first&quot;),
				coli = parseInt($(&quot;td.ui-search-oper&quot;, ptr).attr(&#x27;colindex&#x27;),10),
				sval  = $.extend({},$t.p.colModel[coli].searchoptions || {}),
				dval = sval.defaultValue ? sval.defaultValue : &quot;&quot;;
				if($t.p.colModel[coli].stype === &quot;select&quot;) {
					if(dval) {
						$(&quot;td.ui-search-input select&quot;, ptr).val( dval );
					} else {
						$(&quot;td.ui-search-input select&quot;, ptr)[0].selectedIndex = 0;
					}
				} else {
					$(&quot;td.ui-search-input input&quot;, ptr).val( dval );
				}
				// ToDo custom search type
				if(p.autosearch===true){
					triggerToolbar();
				}

			});
			this.ftoolbar = true;
			this.triggerToolbar = triggerToolbar;
			this.clearToolbar = clearToolbar;
			this.toggleToolbar = toggleToolbar;
		});
	},
	destroyFilterToolbar: function () {
		return this.each(function () {
			if (!this.ftoolbar) {
				return;
			}
			this.triggerToolbar = null;
			this.clearToolbar = null;
			this.toggleToolbar = null;
			this.ftoolbar = false;
			$(this.grid.hDiv).find(&quot;table thead tr.ui-search-toolbar&quot;).remove();
		});
	},
	destroyGroupHeader : function(nullHeader)
	{
		if(nullHeader === undefined) {
			nullHeader = true;
		}
		return this.each(function()
		{
			var $t = this, $tr, i, l, headers, $th, $resizing, grid = $t.grid,
			thead = $(&quot;table.ui-jqgrid-htable thead&quot;, grid.hDiv), cm = $t.p.colModel, hc;
			if(!grid) { return; }

			$(this).unbind(&#x27;.setGroupHeaders&#x27;);
			$tr = $(&quot;&lt;tr&gt;&quot;, {role: &quot;rowheader&quot;}).addClass(&quot;ui-jqgrid-labels&quot;);
			headers = grid.headers;
			for (i = 0, l = headers.length; i &lt; l; i++) {
				hc = cm[i].hidden ? &quot;none&quot; : &quot;&quot;;
				$th = $(headers[i].el)
					.width(headers[i].width)
					.css(&#x27;display&#x27;,hc);
				try {
					$th.removeAttr(&quot;rowSpan&quot;);
				} catch (rs) {
					//IE 6/7
					$th.attr(&quot;rowSpan&quot;,1);
				}
				$tr.append($th);
				$resizing = $th.children(&quot;span.ui-jqgrid-resize&quot;);
				if ($resizing.length&gt;0) {// resizable column
					$resizing[0].style.height = &quot;&quot;;
				}
				$th.children(&quot;div&quot;)[0].style.top = &quot;&quot;;
			}
			$(thead).children(&#x27;tr.ui-jqgrid-labels&#x27;).remove();
			$(thead).prepend($tr);

			if(nullHeader === true) {
				$($t).jqGrid(&#x27;setGridParam&#x27;,{ &#x27;groupHeader&#x27;: null});
			}
		});
	},
	setGroupHeaders : function ( o ) {
		o = $.extend({
			useColSpanStyle :  false,
			groupHeaders: []
		},o  || {});
		return this.each(function(){
			this.p.groupHeader = o;
			var ts = this,
			i, cmi, skip = 0, $tr, $colHeader, th, $th, thStyle,
			iCol,
			cghi,
			//startColumnName,
			numberOfColumns,
			titleText,
			cVisibleColumns,
			colModel = ts.p.colModel,
			cml = colModel.length,
			ths = ts.grid.headers,
			$htable = $(&quot;table.ui-jqgrid-htable&quot;, ts.grid.hDiv),
			$trLabels = $htable.children(&quot;thead&quot;).children(&quot;tr.ui-jqgrid-labels:last&quot;).addClass(&quot;jqg-second-row-header&quot;),
			$thead = $htable.children(&quot;thead&quot;),
			$theadInTable,
			$firstHeaderRow = $htable.find(&quot;.jqg-first-row-header&quot;);
			if($firstHeaderRow[0] === undefined) {
				$firstHeaderRow = $(&#x27;&lt;tr&gt;&#x27;, {role: &quot;row&quot;, &quot;aria-hidden&quot;: &quot;true&quot;}).addClass(&quot;jqg-first-row-header&quot;).css(&quot;height&quot;, &quot;auto&quot;);
			} else {
				$firstHeaderRow.empty();
			}
			var $firstRow,
			inColumnHeader = function (text, columnHeaders) {
				var length = columnHeaders.length, i;
				for (i = 0; i &lt; length; i++) {
					if (columnHeaders[i].startColumnName === text) {
						return i;
					}
				}
				return -1;
			};

			$(ts).prepend($thead);
			$tr = $(&#x27;&lt;tr&gt;&#x27;, {role: &quot;rowheader&quot;}).addClass(&quot;ui-jqgrid-labels jqg-third-row-header&quot;);
			for (i = 0; i &lt; cml; i++) {
				th = ths[i].el;
				$th = $(th);
				cmi = colModel[i];
				// build the next cell for the first header row
				thStyle = { height: &#x27;0px&#x27;, width: ths[i].width + &#x27;px&#x27;, display: (cmi.hidden ? &#x27;none&#x27; : &#x27;&#x27;)};
				$(&quot;&lt;th&gt;&quot;, {role: &#x27;gridcell&#x27;}).css(thStyle).addClass(&quot;ui-first-th-&quot;+ts.p.direction).appendTo($firstHeaderRow);

				th.style.width = &quot;&quot;; // remove unneeded style
				iCol = inColumnHeader(cmi.name, o.groupHeaders);
				if (iCol &gt;= 0) {
					cghi = o.groupHeaders[iCol];
					numberOfColumns = cghi.numberOfColumns;
					titleText = cghi.titleText;

					// caclulate the number of visible columns from the next numberOfColumns columns
					for (cVisibleColumns = 0, iCol = 0; iCol &lt; numberOfColumns &amp;&amp; (i + iCol &lt; cml); iCol++) {
						if (!colModel[i + iCol].hidden) {
							cVisibleColumns++;
						}
					}

					// The next numberOfColumns headers will be moved in the next row
					// in the current row will be placed the new column header with the titleText.
					// The text will be over the cVisibleColumns columns
					$colHeader = $(&#x27;&lt;th&gt;&#x27;).attr({role: &quot;columnheader&quot;})
						.addClass(&quot;ui-state-default ui-th-column-header ui-th-&quot;+ts.p.direction)
						.css({&#x27;height&#x27;:&#x27;22px&#x27;, &#x27;border-top&#x27;: &#x27;0 none&#x27;})
						.html(titleText);
					if(cVisibleColumns &gt; 0) {
						$colHeader.attr(&quot;colspan&quot;, String(cVisibleColumns));
					}
					if (ts.p.headertitles) {
						$colHeader.attr(&quot;title&quot;, $colHeader.text());
					}
					// hide if not a visible cols
					if( cVisibleColumns === 0) {
						$colHeader.hide();
					}

					$th.before($colHeader); // insert new column header before the current
					$tr.append(th);         // move the current header in the next row

					// set the coumter of headers which will be moved in the next row
					skip = numberOfColumns - 1;
				} else {
					if (skip === 0) {
						if (o.useColSpanStyle) {
							// expand the header height to two rows
							$th.attr(&quot;rowspan&quot;, &quot;2&quot;);
						} else {
							$(&#x27;&lt;th&gt;&#x27;, {role: &quot;columnheader&quot;})
								.addClass(&quot;ui-state-default ui-th-column-header ui-th-&quot;+ts.p.direction)
								.css({&quot;display&quot;: cmi.hidden ? &#x27;none&#x27; : &#x27;&#x27;, &#x27;border-top&#x27;: &#x27;0 none&#x27;})
								.insertBefore($th);
							$tr.append(th);
						}
					} else {
						// move the header to the next row
						//$th.css({&quot;padding-top&quot;: &quot;2px&quot;, height: &quot;19px&quot;});
						$tr.append(th);
						skip--;
					}
				}
			}
			$theadInTable = $(ts).children(&quot;thead&quot;);
			$theadInTable.prepend($firstHeaderRow);
			$tr.insertAfter($trLabels);
			$htable.append($theadInTable);

			if (o.useColSpanStyle) {
				// Increase the height of resizing span of visible headers
				$htable.find(&quot;span.ui-jqgrid-resize&quot;).each(function () {
					var $parent = $(this).parent();
					if ($parent.is(&quot;:visible&quot;)) {
						this.style.cssText = &#x27;height: &#x27; + $parent.height() + &#x27;px !important; cursor: col-resize;&#x27;;
					}
				});

				// Set position of the sortable div (the main lable)
				// with the column header text to the middle of the cell.
				// One should not do this for hidden headers.
				$htable.find(&quot;div.ui-jqgrid-sortable&quot;).each(function () {
					var $ts = $(this), $parent = $ts.parent();
					if ($parent.is(&quot;:visible&quot;) &amp;&amp; $parent.is(&quot;:has(span.ui-jqgrid-resize)&quot;)) {
						$ts.css(&#x27;top&#x27;, ($parent.height() - $ts.outerHeight()) / 2 + &#x27;px&#x27;);
					}
				});
			}

			$firstRow = $theadInTable.find(&quot;tr.jqg-first-row-header&quot;);
			$(ts).bind(&#x27;jqGridResizeStop.setGroupHeaders&#x27;, function (e, nw, idx) {
				$firstRow.find(&#x27;th&#x27;).eq(idx).width(nw);
			});
		});
	},
	setFrozenColumns : function () {
		return this.each(function() {
			if ( !this.grid ) {return;}
			var $t = this, cm = $t.p.colModel,i=0, len = cm.length, maxfrozen = -1, frozen= false;
			// TODO treeGrid and grouping  Support
			if($t.p.subGrid === true || $t.p.treeGrid === true || $t.p.cellEdit === true || $t.p.sortable || $t.p.scroll )
			{
				return;
			}
			if($t.p.rownumbers) { i++; }
			if($t.p.multiselect) { i++; }

			// get the max index of frozen col
			while(i&lt;len)
			{
				// from left, no breaking frozen
				if(cm[i].frozen === true)
				{
					frozen = true;
					maxfrozen = i;
				} else {
					break;
				}
				i++;
			}
			if( maxfrozen&gt;=0 &amp;&amp; frozen) {
				var top = $t.p.caption ? $($t.grid.cDiv).outerHeight() : 0,
				hth = $(&quot;.ui-jqgrid-htable&quot;,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).height();
				//headers
				if($t.p.toppager) {
					top = top + $($t.grid.topDiv).outerHeight();
				}
				if($t.p.toolbar[0] === true) {
					if($t.p.toolbar[1] !== &quot;bottom&quot;) {
						top = top + $($t.grid.uDiv).outerHeight();
					}
				}
				$t.grid.fhDiv = $(&#x27;&lt;div style=&quot;position:absolute;left:0px;top:&#x27;+top+&#x27;px;height:&#x27;+hth+&#x27;px;&quot; class=&quot;frozen-div ui-state-default ui-jqgrid-hdiv&quot;&gt;&lt;/div&gt;&#x27;);
				$t.grid.fbDiv = $(&#x27;&lt;div style=&quot;position:absolute;left:0px;top:&#x27;+(parseInt(top,10)+parseInt(hth,10) + 1)+&#x27;px;overflow-y:hidden&quot; class=&quot;frozen-bdiv ui-jqgrid-bdiv&quot;&gt;&lt;/div&gt;&#x27;);
				$(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).append($t.grid.fhDiv);
				var htbl = $(&quot;.ui-jqgrid-htable&quot;,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).clone(true);
				// groupheader support - only if useColSpanstyle is false
				if($t.p.groupHeader) {
					$(&quot;tr.jqg-first-row-header, tr.jqg-third-row-header&quot;, htbl).each(function(){
						$(&quot;th:gt(&quot;+maxfrozen+&quot;)&quot;,this).remove();
					});
					var swapfroz = -1, fdel = -1, cs, rs;
					$(&quot;tr.jqg-second-row-header th&quot;, htbl).each(function(){
						cs= parseInt($(this).attr(&quot;colspan&quot;),10);
						rs= parseInt($(this).attr(&quot;rowspan&quot;),10);
						if(rs) {
							swapfroz++;
							fdel++;
						}
						if(cs) {
							swapfroz = swapfroz+cs;
							fdel++;
						}
						if(swapfroz === maxfrozen) {
							return false;
						}
					});
					if(swapfroz !== maxfrozen) {
						fdel = maxfrozen;
					}
					$(&quot;tr.jqg-second-row-header&quot;, htbl).each(function(){
						$(&quot;th:gt(&quot;+fdel+&quot;)&quot;,this).remove();
					});
				} else {
					$(&quot;tr&quot;,htbl).each(function(){
						$(&quot;th:gt(&quot;+maxfrozen+&quot;)&quot;,this).remove();
					});
				}
				$(htbl).width(1);
				// resizing stuff
				$($t.grid.fhDiv).append(htbl)
				.mousemove(function (e) {
					if($t.grid.resizing){ $t.grid.dragMove(e);return false; }
				});
				$($t).bind(&#x27;jqGridResizeStop.setFrozenColumns&#x27;, function (e, w, index) {
					var rhth = $(&quot;.ui-jqgrid-htable&quot;,$t.grid.fhDiv);
					$(&quot;th:eq(&quot;+index+&quot;)&quot;,rhth).width( w );
					var btd = $(&quot;.ui-jqgrid-btable&quot;,$t.grid.fbDiv);
					$(&quot;tr:first td:eq(&quot;+index+&quot;)&quot;,btd).width( w );
				});
				// sorting stuff
				$($t).bind(&#x27;jqGridSortCol.setFrozenColumns&#x27;, function (e, index, idxcol) {

					var previousSelectedTh = $(&quot;tr.ui-jqgrid-labels:last th:eq(&quot;+$t.p.lastsort+&quot;)&quot;,$t.grid.fhDiv), newSelectedTh = $(&quot;tr.ui-jqgrid-labels:last th:eq(&quot;+idxcol+&quot;)&quot;,$t.grid.fhDiv);

					$(&quot;span.ui-grid-ico-sort&quot;,previousSelectedTh).addClass(&#x27;ui-state-disabled&#x27;);
					$(previousSelectedTh).attr(&quot;aria-selected&quot;,&quot;false&quot;);
					$(&quot;span.ui-icon-&quot;+$t.p.sortorder,newSelectedTh).removeClass(&#x27;ui-state-disabled&#x27;);
					$(newSelectedTh).attr(&quot;aria-selected&quot;,&quot;true&quot;);
					if(!$t.p.viewsortcols[0]) {
						if($t.p.lastsort !== idxcol) {
							$(&quot;span.s-ico&quot;,previousSelectedTh).hide();
							$(&quot;span.s-ico&quot;,newSelectedTh).show();
						}
					}
				});

				// data stuff
				//TODO support for setRowData
				$(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).append($t.grid.fbDiv);
				$($t.grid.bDiv).scroll(function () {
					$($t.grid.fbDiv).scrollTop($(this).scrollTop());
				});
				if($t.p.hoverrows === true) {
					$(&quot;#&quot;+$.jgrid.jqID($t.p.id)).unbind(&#x27;mouseover&#x27;).unbind(&#x27;mouseout&#x27;);
				}
				$($t).bind(&#x27;jqGridAfterGridComplete.setFrozenColumns&#x27;, function () {
					$(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot;_frozen&quot;).remove();
					$($t.grid.fbDiv).height($($t.grid.bDiv).height()-16);
					var btbl = $(&quot;#&quot;+$.jgrid.jqID($t.p.id)).clone(true);
					$(&quot;tr[role=row]&quot;,btbl).each(function(){
						$(&quot;td[role=gridcell]:gt(&quot;+maxfrozen+&quot;)&quot;,this).remove();
					});

					$(btbl).width(1).attr(&quot;id&quot;,$t.p.id+&quot;_frozen&quot;);
					$($t.grid.fbDiv).append(btbl);
					if($t.p.hoverrows === true) {
						$(&quot;tr.jqgrow&quot;, btbl).hover(
							function(){ $(this).addClass(&quot;ui-state-hover&quot;); $(&quot;#&quot;+$.jgrid.jqID(this.id), &quot;#&quot;+$.jgrid.jqID($t.p.id)).addClass(&quot;ui-state-hover&quot;); },
							function(){ $(this).removeClass(&quot;ui-state-hover&quot;); $(&quot;#&quot;+$.jgrid.jqID(this.id), &quot;#&quot;+$.jgrid.jqID($t.p.id)).removeClass(&quot;ui-state-hover&quot;); }
						);
						$(&quot;tr.jqgrow&quot;, &quot;#&quot;+$.jgrid.jqID($t.p.id)).hover(
							function(){ $(this).addClass(&quot;ui-state-hover&quot;); $(&quot;#&quot;+$.jgrid.jqID(this.id), &quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot;_frozen&quot;).addClass(&quot;ui-state-hover&quot;);},
							function(){ $(this).removeClass(&quot;ui-state-hover&quot;); $(&quot;#&quot;+$.jgrid.jqID(this.id), &quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot;_frozen&quot;).removeClass(&quot;ui-state-hover&quot;); }
						);
					}
					btbl=null;
				});
				if(!$t.grid.hDiv.loading) {
					$($t).triggerHandler(&quot;jqGridAfterGridComplete&quot;);
				}
				$t.p.frozenColumns = true;
			}
		});
	},
	destroyFrozenColumns :  function() {
		return this.each(function() {
			if ( !this.grid ) {return;}
			if(this.p.frozenColumns === true) {
				var $t = this;
				$($t.grid.fhDiv).remove();
				$($t.grid.fbDiv).remove();
				$t.grid.fhDiv = null; $t.grid.fbDiv=null;
				$(this).unbind(&#x27;.setFrozenColumns&#x27;);
				if($t.p.hoverrows === true) {
					var ptr;
					$(&quot;#&quot;+$.jgrid.jqID($t.p.id)).bind(&#x27;mouseover&#x27;,function(e) {
						ptr = $(e.target).closest(&quot;tr.jqgrow&quot;);
						if($(ptr).attr(&quot;class&quot;) !== &quot;ui-subgrid&quot;) {
						$(ptr).addClass(&quot;ui-state-hover&quot;);
					}
					}).bind(&#x27;mouseout&#x27;,function(e) {
						ptr = $(e.target).closest(&quot;tr.jqgrow&quot;);
						$(ptr).removeClass(&quot;ui-state-hover&quot;);
					});
				}
				this.p.frozenColumns = false;
			}
		});
	}
});
})(jQuery);
/*
 * jqModal - Minimalist Modaling with jQuery
 *   (http://dev.iceburg.net/jquery/jqmodal/)
 *
 * Copyright (c) 2007,2008 Brice Burgess &lt;bhb@iceburg.net&gt;
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * $Version: 07/06/2008 +r13
 */
(function($) {
$.fn.jqm=function(o){
var p={
overlay: 50,
closeoverlay : true,
overlayClass: &#x27;jqmOverlay&#x27;,
closeClass: &#x27;jqmClose&#x27;,
trigger: &#x27;.jqModal&#x27;,
ajax: F,
ajaxText: &#x27;&#x27;,
target: F,
modal: F,
toTop: F,
onShow: F,
onHide: F,
onLoad: F
};
return this.each(function(){if(this._jqm)return H[this._jqm].c=$.extend({},H[this._jqm].c,o);s++;this._jqm=s;
H[s]={c:$.extend(p,$.jqm.params,o),a:F,w:$(this).addClass(&#x27;jqmID&#x27;+s),s:s};
if(p.trigger)$(this).jqmAddTrigger(p.trigger);
});};

$.fn.jqmAddClose=function(e){return hs(this,e,&#x27;jqmHide&#x27;);};
$.fn.jqmAddTrigger=function(e){return hs(this,e,&#x27;jqmShow&#x27;);};
$.fn.jqmShow=function(t){return this.each(function(){$.jqm.open(this._jqm,t);});};
$.fn.jqmHide=function(t){return this.each(function(){$.jqm.close(this._jqm,t)});};

$.jqm = {
hash:{},
open:function(s,t){var h=H[s],c=h.c,cc=&#x27;.&#x27;+c.closeClass,z=(parseInt(h.w.css(&#x27;z-index&#x27;)));z=(z&gt;0)?z:3000;var o=$(&#x27;&lt;div&gt;&lt;/div&gt;&#x27;).css({height:&#x27;100%&#x27;,width:&#x27;100%&#x27;,position:&#x27;fixed&#x27;,left:0,top:0,&#x27;z-index&#x27;:z-1,opacity:c.overlay/100});if(h.a)return F;h.t=t;h.a=true;h.w.css(&#x27;z-index&#x27;,z);
 if(c.modal) {if(!A[0])setTimeout(function(){L(&#x27;bind&#x27;);},1);A.push(s);}
 else if(c.overlay &gt; 0) {if(c.closeoverlay) h.w.jqmAddClose(o);}
 else o=F;

 h.o=(o)?o.addClass(c.overlayClass).prependTo(&#x27;body&#x27;):F;

 if(c.ajax) {var r=c.target||h.w,u=c.ajax;r=(typeof r == &#x27;string&#x27;)?$(r,h.w):$(r);u=(u.substr(0,1) == &#x27;@&#x27;)?$(t).attr(u.substring(1)):u;
  r.html(c.ajaxText).load(u,function(){if(c.onLoad)c.onLoad.call(this,h);if(cc)h.w.jqmAddClose($(cc,h.w));e(h);});}
 else if(cc)h.w.jqmAddClose($(cc,h.w));

 if(c.toTop&amp;&amp;h.o)h.w.before(&#x27;&lt;span id=&quot;jqmP&#x27;+h.w[0]._jqm+&#x27;&quot;&gt;&lt;/span&gt;&#x27;).insertAfter(h.o);
 (c.onShow)?c.onShow(h):h.w.show();e(h);return F;
},
close:function(s){var h=H[s];if(!h.a)return F;h.a=F;
 if(A[0]){A.pop();if(!A[0])L(&#x27;unbind&#x27;);}
 if(h.c.toTop&amp;&amp;h.o)$(&#x27;#jqmP&#x27;+h.w[0]._jqm).after(h.w).remove();
 if(h.c.onHide)h.c.onHide(h);else{h.w.hide();if(h.o)h.o.remove();} return F;
},
params:{}};
var s=0,H=$.jqm.hash,A=[],F=false,
e=function(h){f(h);},
f=function(h){try{$(&#x27;:input:visible&#x27;,h.w)[0].focus();}catch(_){}},
L=function(t){$(document)[t](&quot;keypress&quot;,m)[t](&quot;keydown&quot;,m)[t](&quot;mousedown&quot;,m);},
m=function(e){var h=H[A[A.length-1]],r=(!$(e.target).parents(&#x27;.jqmID&#x27;+h.s)[0]);if(r){$(&#x27;.jqmID&#x27;+h.s).each(function(){var $self=$(this),offset=$self.offset();if(offset.top&lt;=e.pageY &amp;&amp; e.pageY&lt;=offset.top+$self.height() &amp;&amp; offset.left&lt;=e.pageX &amp;&amp; e.pageX&lt;=offset.left+$self.width()){r=false;return false;}});f(h);}return !r;},
hs=function(w,t,c){return w.each(function(){var s=this._jqm;$(t).each(function() {
 if(!this[c]){this[c]=[];$(this).click(function(){for(var i in {jqmShow:1,jqmHide:1})for(var s in this[i])if(H[this[i][s]])H[this[i][s]].w[i](this);return F;});}this[c].push(s);});});};
})(jQuery);/*
 * jqDnR - Minimalistic Drag&#x27;n&#x27;Resize for jQuery.
 *
 * Copyright (c) 2007 Brice Burgess &lt;bhb@iceburg.net&gt;, http://www.iceburg.net
 * Licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * $Version: 2007.08.19 +r2
 */

(function($){
$.fn.jqDrag=function(h){return i(this,h,&#x27;d&#x27;);};
$.fn.jqResize=function(h,ar){return i(this,h,&#x27;r&#x27;,ar);};
$.jqDnR={
	dnr:{},
	e:0,
	drag:function(v){
		if(M.k == &#x27;d&#x27;){E.css({left:M.X+v.pageX-M.pX,top:M.Y+v.pageY-M.pY});}
		else {
			E.css({width:Math.max(v.pageX-M.pX+M.W,0),height:Math.max(v.pageY-M.pY+M.H,0)});
			if(M1){E1.css({width:Math.max(v.pageX-M1.pX+M1.W,0),height:Math.max(v.pageY-M1.pY+M1.H,0)});}
		}
		return false;
	},
	stop:function(){
		//E.css(&#x27;opacity&#x27;,M.o);
		$(document).unbind(&#x27;mousemove&#x27;,J.drag).unbind(&#x27;mouseup&#x27;,J.stop);
	}
};
var J=$.jqDnR,M=J.dnr,E=J.e,E1,M1,
i=function(e,h,k,aR){
	return e.each(function(){
		h=(h)?$(h,e):e;
		h.bind(&#x27;mousedown&#x27;,{e:e,k:k},function(v){
			var d=v.data,p={};E=d.e;E1 = aR ? $(aR) : false;
			// attempt utilization of dimensions plugin to fix IE issues
			if(E.css(&#x27;position&#x27;) != &#x27;relative&#x27;){try{E.position(p);}catch(e){}}
			M={
				X:p.left||f(&#x27;left&#x27;)||0,
				Y:p.top||f(&#x27;top&#x27;)||0,
				W:f(&#x27;width&#x27;)||E[0].scrollWidth||0,
				H:f(&#x27;height&#x27;)||E[0].scrollHeight||0,
				pX:v.pageX,
				pY:v.pageY,
				k:d.k
				//o:E.css(&#x27;opacity&#x27;)
			};
			// also resize
			if(E1 &amp;&amp; d.k != &#x27;d&#x27;){
				M1={
					X:p.left||f1(&#x27;left&#x27;)||0,
					Y:p.top||f1(&#x27;top&#x27;)||0,
					W:E1[0].offsetWidth||f1(&#x27;width&#x27;)||0,
					H:E1[0].offsetHeight||f1(&#x27;height&#x27;)||0,
					pX:v.pageX,
					pY:v.pageY,
					k:d.k
				};
			} else {M1 = false;}
			//E.css({opacity:0.8});
			if($(&quot;input.hasDatepicker&quot;,E[0])[0]) {
			try {$(&quot;input.hasDatepicker&quot;,E[0]).datepicker(&#x27;hide&#x27;);}catch (dpe){}
			}
			$(document).mousemove($.jqDnR.drag).mouseup($.jqDnR.stop);
			return false;
		});
	});
},
f=function(k){return parseInt(E.css(k),10)||false;},
f1=function(k){return parseInt(E1.css(k),10)||false;};
})(jQuery);/*
	The below work is licensed under Creative Commons GNU LGPL License.

	Original work:

	License:     http://creativecommons.org/licenses/LGPL/2.1/
	Author:      Stefan Goessner/2006
	Web:         http://goessner.net/

	Modifications made:

	Version:     0.9-p5
	Description: Restructured code, JSLint validated (no strict whitespaces),
	             added handling of empty arrays, empty strings, and int/floats values.
	Author:      Michael Schler/2008-01-29
	Web:         http://michael.hinnerup.net/blog/2008/01/26/converting-json-to-xml-and-xml-to-json/

	Description: json2xml added support to convert functions as CDATA
	             so it will be easy to write characters that cause some problems when convert
	Author:      Tony Tomov
*/

/*global alert */
var xmlJsonClass = {
	// Param &quot;xml&quot;: Element or document DOM node.
	// Param &quot;tab&quot;: Tab or indent string for pretty output formatting omit or use empty string &quot;&quot; to supress.
	// Returns:     JSON string
	xml2json: function(xml, tab) {
		if (xml.nodeType === 9) {
			// document node
			xml = xml.documentElement;
		}
		var nws = this.removeWhite(xml);
		var obj = this.toObj(nws);
		var json = this.toJson(obj, xml.nodeName, &quot;\t&quot;);
		return &quot;{\n&quot; + tab + (tab ? json.replace(/\t/g, tab) : json.replace(/\t|\n/g, &quot;&quot;)) + &quot;\n}&quot;;
	},

	// Param &quot;o&quot;:   JavaScript object
	// Param &quot;tab&quot;: tab or indent string for pretty output formatting omit or use empty string &quot;&quot; to supress.
	// Returns:     XML string
	json2xml: function(o, tab) {
		var toXml = function(v, name, ind) {
			var xml = &quot;&quot;;
			var i, n;
			if (v instanceof Array) {
				if (v.length === 0) {
					xml += ind + &quot;&lt;&quot;+name+&quot;&gt;__EMPTY_ARRAY_&lt;/&quot;+name+&quot;&gt;\n&quot;;
				}
				else {
					for (i = 0, n = v.length; i &lt; n; i += 1) {
						var sXml = ind + toXml(v[i], name, ind+&quot;\t&quot;) + &quot;\n&quot;;
						xml += sXml;
					}
				}
			}
			else if (typeof(v) === &quot;object&quot;) {
				var hasChild = false;
				xml += ind + &quot;&lt;&quot; + name;
				var m;
				for (m in v) if (v.hasOwnProperty(m)) {
					if (m.charAt(0) === &quot;@&quot;) {
						xml += &quot; &quot; + m.substr(1) + &quot;=\&quot;&quot; + v[m].toString() + &quot;\&quot;&quot;;
					}
					else {
						hasChild = true;
					}
				}
				xml += hasChild ? &quot;&gt;&quot; : &quot;/&gt;&quot;;
				if (hasChild) {
					for (m in v) if (v.hasOwnProperty(m)) {
						if (m === &quot;#text&quot;) {
							xml += v[m];
						}
						else if (m === &quot;#cdata&quot;) {
							xml += &quot;&lt;![CDATA[&quot; + v[m] + &quot;]]&gt;&quot;;
						}
						else if (m.charAt(0) !== &quot;@&quot;) {
							xml += toXml(v[m], m, ind+&quot;\t&quot;);
						}
					}
					xml += (xml.charAt(xml.length - 1) === &quot;\n&quot; ? ind : &quot;&quot;) + &quot;&lt;/&quot; + name + &quot;&gt;&quot;;
				}
			}
			else if (typeof(v) === &quot;function&quot;) {
				xml += ind + &quot;&lt;&quot; + name + &quot;&gt;&quot; + &quot;&lt;![CDATA[&quot; + v + &quot;]]&gt;&quot; + &quot;&lt;/&quot; + name + &quot;&gt;&quot;;
			}
			else {
				if (v === undefined ) { v = &quot;&quot;; }
				if (v.toString() === &quot;\&quot;\&quot;&quot; || v.toString().length === 0) {
					xml += ind + &quot;&lt;&quot; + name + &quot;&gt;__EMPTY_STRING_&lt;/&quot; + name + &quot;&gt;&quot;;
				}
				else {
					xml += ind + &quot;&lt;&quot; + name + &quot;&gt;&quot; + v.toString() + &quot;&lt;/&quot; + name + &quot;&gt;&quot;;
				}
			}
			return xml;
		};
		var xml = &quot;&quot;;
		var m;
		for (m in o) if (o.hasOwnProperty(m)) {
			xml += toXml(o[m], m, &quot;&quot;);
		}
		return tab ? xml.replace(/\t/g, tab) : xml.replace(/\t|\n/g, &quot;&quot;);
	},
	// Internal methods
	toObj: function(xml) {
		var o = {};
		var FuncTest = /function/i;
		if (xml.nodeType === 1) {
			// element node ..
			if (xml.attributes.length) {
				// element with attributes ..
				var i;
				for (i = 0; i &lt; xml.attributes.length; i += 1) {
					o[&quot;@&quot; + xml.attributes[i].nodeName] = (xml.attributes[i].nodeValue || &quot;&quot;).toString();
				}
			}
			if (xml.firstChild) {
				// element has child nodes ..
				var textChild = 0, cdataChild = 0, hasElementChild = false;
				var n;
				for (n = xml.firstChild; n; n = n.nextSibling) {
					if (n.nodeType === 1) {
						hasElementChild = true;
					}
					else if (n.nodeType === 3 &amp;&amp; n.nodeValue.match(/[^ \f\n\r\t\v]/)) {
						// non-whitespace text
						textChild += 1;
					}
					else if (n.nodeType === 4) {
						// cdata section node
						cdataChild += 1;
					}
				}
				if (hasElementChild) {
					if (textChild &lt; 2 &amp;&amp; cdataChild &lt; 2) {
						// structured element with evtl. a single text or/and cdata node ..
						this.removeWhite(xml);
						for (n = xml.firstChild; n; n = n.nextSibling) {
							if (n.nodeType === 3) {
								// text node
								o[&quot;#text&quot;] = this.escape(n.nodeValue);
							}
							else if (n.nodeType === 4) {
								// cdata node
								if (FuncTest.test(n.nodeValue)) {
									o[n.nodeName] = [o[n.nodeName], n.nodeValue];
								} else {
									o[&quot;#cdata&quot;] = this.escape(n.nodeValue);
								}
							}
							else if (o[n.nodeName]) {
								// multiple occurence of element ..
								if (o[n.nodeName] instanceof Array) {
									o[n.nodeName][o[n.nodeName].length] = this.toObj(n);
								}
								else {
									o[n.nodeName] = [o[n.nodeName], this.toObj(n)];
								}
							}
							else {
								// first occurence of element ..
								o[n.nodeName] = this.toObj(n);
							}
						}
					}
					else {
						// mixed content
						if (!xml.attributes.length) {
							o = this.escape(this.innerXml(xml));
						}
						else {
							o[&quot;#text&quot;] = this.escape(this.innerXml(xml));
						}
					}
				}
				else if (textChild) {
					// pure text
					if (!xml.attributes.length) {
						o = this.escape(this.innerXml(xml));
						if (o === &quot;__EMPTY_ARRAY_&quot;) {
							o = &quot;[]&quot;;
						} else if (o === &quot;__EMPTY_STRING_&quot;) {
							o = &quot;&quot;;
						}
					}
					else {
						o[&quot;#text&quot;] = this.escape(this.innerXml(xml));
					}
				}
				else if (cdataChild) {
					// cdata
					if (cdataChild &gt; 1) {
						o = this.escape(this.innerXml(xml));
					}
					else {
						for (n = xml.firstChild; n; n = n.nextSibling) {
							if(FuncTest.test(xml.firstChild.nodeValue)) {
								o = xml.firstChild.nodeValue;
								break;
							} else {
								o[&quot;#cdata&quot;] = this.escape(n.nodeValue);
							}
						}
					}
				}
			}
			if (!xml.attributes.length &amp;&amp; !xml.firstChild) {
				o = null;
			}
		}
		else if (xml.nodeType === 9) {
			// document.node
			o = this.toObj(xml.documentElement);
		}
		else {
			alert(&quot;unhandled node type: &quot; + xml.nodeType);
		}
		return o;
	},
	toJson: function(o, name, ind, wellform) {
		if(wellform === undefined) wellform = true;
		var json = name ? (&quot;\&quot;&quot; + name + &quot;\&quot;&quot;) : &quot;&quot;, tab = &quot;\t&quot;, newline = &quot;\n&quot;;
		if(!wellform) {
			tab= &quot;&quot;; newline= &quot;&quot;;
		}

		if (o === &quot;[]&quot;) {
			json += (name ? &quot;:[]&quot; : &quot;[]&quot;);
		}
		else if (o instanceof Array) {
			var n, i, ar=[];
			for (i = 0, n = o.length; i &lt; n; i += 1) {
				ar[i] = this.toJson(o[i], &quot;&quot;, ind + tab, wellform);
			}
			json += (name ? &quot;:[&quot; : &quot;[&quot;) + (ar.length &gt; 1 ? (newline + ind + tab + ar.join(&quot;,&quot;+newline + ind + tab) + newline + ind) : ar.join(&quot;&quot;)) + &quot;]&quot;;
		}
		else if (o === null) {
			json += (name &amp;&amp; &quot;:&quot;) + &quot;null&quot;;
		}
		else if (typeof(o) === &quot;object&quot;) {
			var arr = [], m;
			for (m in o) {
				if (o.hasOwnProperty(m)) {
					arr[arr.length] = this.toJson(o[m], m, ind + tab, wellform);
			}
		}
			json += (name ? &quot;:{&quot; : &quot;{&quot;) + (arr.length &gt; 1 ? (newline + ind + tab + arr.join(&quot;,&quot;+newline + ind + tab) + newline + ind) : arr.join(&quot;&quot;)) + &quot;}&quot;;
		}
		else if (typeof(o) === &quot;string&quot;) {
			/*
			var objRegExp  = /(^-?\d+\.?\d*$)/;
			var FuncTest = /function/i;
			var os = o.toString();
			if (objRegExp.test(os) || FuncTest.test(os) || os===&quot;false&quot; || os===&quot;true&quot;) {
				// int or float
				json += (name &amp;&amp; &quot;:&quot;)  + &quot;\&quot;&quot; +os + &quot;\&quot;&quot;;
			}
			else {
			*/
				json += (name &amp;&amp; &quot;:&quot;) + &quot;\&quot;&quot; + o.replace(/\\/g,&#x27;\\\\&#x27;).replace(/\&quot;/g,&#x27;\\&quot;&#x27;) + &quot;\&quot;&quot;;
			//}
			}
		else {
			json += (name &amp;&amp; &quot;:&quot;) +  o.toString();
		}
		return json;
	},
	innerXml: function(node) {
		var s = &quot;&quot;;
		if (&quot;innerHTML&quot; in node) {
			s = node.innerHTML;
		}
		else {
			var asXml = function(n) {
				var s = &quot;&quot;, i;
				if (n.nodeType === 1) {
					s += &quot;&lt;&quot; + n.nodeName;
					for (i = 0; i &lt; n.attributes.length; i += 1) {
						s += &quot; &quot; + n.attributes[i].nodeName + &quot;=\&quot;&quot; + (n.attributes[i].nodeValue || &quot;&quot;).toString() + &quot;\&quot;&quot;;
					}
					if (n.firstChild) {
						s += &quot;&gt;&quot;;
						for (var c = n.firstChild; c; c = c.nextSibling) {
							s += asXml(c);
						}
						s += &quot;&lt;/&quot; + n.nodeName + &quot;&gt;&quot;;
					}
					else {
						s += &quot;/&gt;&quot;;
					}
				}
				else if (n.nodeType === 3) {
					s += n.nodeValue;
				}
				else if (n.nodeType === 4) {
					s += &quot;&lt;![CDATA[&quot; + n.nodeValue + &quot;]]&gt;&quot;;
				}
				return s;
			};
			for (var c = node.firstChild; c; c = c.nextSibling) {
				s += asXml(c);
			}
		}
		return s;
	},
	escape: function(txt) {
		return txt.replace(/[\\]/g, &quot;\\\\&quot;).replace(/[\&quot;]/g, &#x27;\\&quot;&#x27;).replace(/[\n]/g, &#x27;\\n&#x27;).replace(/[\r]/g, &#x27;\\r&#x27;);
	},
	removeWhite: function(e) {
		e.normalize();
		var n;
		for (n = e.firstChild; n; ) {
			if (n.nodeType === 3) {
				// text node
				if (!n.nodeValue.match(/[^ \f\n\r\t\v]/)) {
					// pure whitespace text node
					var nxt = n.nextSibling;
					e.removeChild(n);
					n = nxt;
				}
				else {
					n = n.nextSibling;
				}
			}
			else if (n.nodeType === 1) {
				// element node
				this.removeWhite(n);
				n = n.nextSibling;
			}
			else {
				// any other node
				n = n.nextSibling;
			}
		}
		return e;
	}
};/*
**
 * formatter for values but most of the values if for jqGrid
 * Some of this was inspired and based on how YUI does the table datagrid but in jQuery fashion
 * we are trying to keep it as light as possible
 * Joshua Burnett josh@9ci.com
 * http://www.greenbill.com
 *
 * Changes from Tony Tomov tony@trirand.com
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
 *
**/
/*jshint eqeqeq:false */
/*global jQuery */

(function($) {
&quot;use strict&quot;;
	$.fmatter = {};
	//opts can be id:row id for the row, rowdata:the data for the row, colmodel:the column model for this column
	//example {id:1234,}
	$.extend($.fmatter,{
		isBoolean : function(o) {
			return typeof o === &#x27;boolean&#x27;;
		},
		isObject : function(o) {
			return (o &amp;&amp; (typeof o === &#x27;object&#x27; || $.isFunction(o))) || false;
		},
		isString : function(o) {
			return typeof o === &#x27;string&#x27;;
		},
		isNumber : function(o) {
			return typeof o === &#x27;number&#x27; &amp;&amp; isFinite(o);
		},
		isValue : function (o) {
			return (this.isObject(o) || this.isString(o) || this.isNumber(o) || this.isBoolean(o));
		},
		isEmpty : function(o) {
			if(!this.isString(o) &amp;&amp; this.isValue(o)) {
				return false;
			}
			if (!this.isValue(o)){
				return true;
			}
			o = $.trim(o).replace(/\&amp;nbsp\;/ig,&#x27;&#x27;).replace(/\&amp;#160\;/ig,&#x27;&#x27;);
			return o===&quot;&quot;;
		}
	});
	$.fn.fmatter = function(formatType, cellval, opts, rwd, act) {
		// build main options before element iteration
		var v=cellval;
		opts = $.extend({}, $.jgrid.formatter, opts);

		try {
			v = $.fn.fmatter[formatType].call(this, cellval, opts, rwd, act);
		} catch(fe){}
		return v;
	};
	$.fmatter.util = {
		// Taken from YAHOO utils
		NumberFormat : function(nData,opts) {
			if(!$.fmatter.isNumber(nData)) {
				nData *= 1;
			}
			if($.fmatter.isNumber(nData)) {
				var bNegative = (nData &lt; 0);
				var sOutput = String(nData);
				var sDecimalSeparator = opts.decimalSeparator || &quot;.&quot;;
				var nDotIndex;
				if($.fmatter.isNumber(opts.decimalPlaces)) {
					// Round to the correct decimal place
					var nDecimalPlaces = opts.decimalPlaces;
					var nDecimal = Math.pow(10, nDecimalPlaces);
					sOutput = String(Math.round(nData*nDecimal)/nDecimal);
					nDotIndex = sOutput.lastIndexOf(&quot;.&quot;);
					if(nDecimalPlaces &gt; 0) {
					// Add the decimal separator
						if(nDotIndex &lt; 0) {
							sOutput += sDecimalSeparator;
							nDotIndex = sOutput.length-1;
						}
						// Replace the &quot;.&quot;
						else if(sDecimalSeparator !== &quot;.&quot;){
							sOutput = sOutput.replace(&quot;.&quot;,sDecimalSeparator);
						}
					// Add missing zeros
						while((sOutput.length - 1 - nDotIndex) &lt; nDecimalPlaces) {
							sOutput += &quot;0&quot;;
						}
					}
				}
				if(opts.thousandsSeparator) {
					var sThousandsSeparator = opts.thousandsSeparator;
					nDotIndex = sOutput.lastIndexOf(sDecimalSeparator);
					nDotIndex = (nDotIndex &gt; -1) ? nDotIndex : sOutput.length;
					var sNewOutput = sOutput.substring(nDotIndex);
					var nCount = -1, i;
					for (i=nDotIndex; i&gt;0; i--) {
						nCount++;
						if ((nCount%3 === 0) &amp;&amp; (i !== nDotIndex) &amp;&amp; (!bNegative || (i &gt; 1))) {
							sNewOutput = sThousandsSeparator + sNewOutput;
						}
						sNewOutput = sOutput.charAt(i-1) + sNewOutput;
					}
					sOutput = sNewOutput;
				}
				// Prepend prefix
				sOutput = (opts.prefix) ? opts.prefix + sOutput : sOutput;
				// Append suffix
				sOutput = (opts.suffix) ? sOutput + opts.suffix : sOutput;
				return sOutput;

			}
			return nData;
		}
	};
	$.fn.fmatter.defaultFormat = function(cellval, opts) {
		return ($.fmatter.isValue(cellval) &amp;&amp; cellval!==&quot;&quot; ) ?  cellval : opts.defaultValue || &quot;&amp;#160;&quot;;
	};
	$.fn.fmatter.email = function(cellval, opts) {
		if(!$.fmatter.isEmpty(cellval)) {
			return &quot;&lt;a href=\&quot;mailto:&quot; + cellval + &quot;\&quot;&gt;&quot; + cellval + &quot;&lt;/a&gt;&quot;;
		}
		return $.fn.fmatter.defaultFormat(cellval,opts );
	};
	$.fn.fmatter.checkbox =function(cval, opts) {
		var op = $.extend({},opts.checkbox), ds;
		if(opts.colModel !== undefined &amp;&amp; opts.colModel.formatoptions !== undefined) {
			op = $.extend({},op,opts.colModel.formatoptions);
		}
		if(op.disabled===true) {ds = &quot;disabled=\&quot;disabled\&quot;&quot;;} else {ds=&quot;&quot;;}
		if($.fmatter.isEmpty(cval) || cval === undefined ) {cval = $.fn.fmatter.defaultFormat(cval,op);}
		cval=String(cval);
		cval=(cval+&quot;&quot;).toLowerCase();
		var bchk = cval.search(/(false|f|0|no|n|off|undefined)/i)&lt;0 ? &quot; checked=&#x27;checked&#x27; &quot; : &quot;&quot;;
		return &quot;&lt;input type=\&quot;checkbox\&quot; &quot; + bchk  + &quot; value=\&quot;&quot;+ cval+&quot;\&quot; offval=\&quot;no\&quot; &quot;+ds+ &quot;/&gt;&quot;;
	};
	$.fn.fmatter.link = function(cellval, opts) {
		var op = {target:opts.target};
		var target = &quot;&quot;;
		if(opts.colModel !== undefined &amp;&amp; opts.colModel.formatoptions !== undefined) {
			op = $.extend({},op,opts.colModel.formatoptions);
		}
		if(op.target) {target = &#x27;target=&#x27; + op.target;}
		if(!$.fmatter.isEmpty(cellval)) {
			return &quot;&lt;a &quot;+target+&quot; href=\&quot;&quot; + cellval + &quot;\&quot;&gt;&quot; + cellval + &quot;&lt;/a&gt;&quot;;
		}
		return $.fn.fmatter.defaultFormat(cellval,opts);
	};
	$.fn.fmatter.showlink = function(cellval, opts) {
		var op = {baseLinkUrl: opts.baseLinkUrl,showAction:opts.showAction, addParam: opts.addParam || &quot;&quot;, target: opts.target, idName: opts.idName},
		target = &quot;&quot;, idUrl;
		if(opts.colModel !== undefined &amp;&amp; opts.colModel.formatoptions !== undefined) {
			op = $.extend({},op,opts.colModel.formatoptions);
		}
		if(op.target) {target = &#x27;target=&#x27; + op.target;}
		idUrl = op.baseLinkUrl+op.showAction + &#x27;?&#x27;+ op.idName+&#x27;=&#x27;+opts.rowId+op.addParam;
		if($.fmatter.isString(cellval) || $.fmatter.isNumber(cellval)) {	//add this one even if its blank string
			return &quot;&lt;a &quot;+target+&quot; href=\&quot;&quot; + idUrl + &quot;\&quot;&gt;&quot; + cellval + &quot;&lt;/a&gt;&quot;;
		}
		return $.fn.fmatter.defaultFormat(cellval,opts);
	};
	$.fn.fmatter.integer = function(cellval, opts) {
		var op = $.extend({},opts.integer);
		if(opts.colModel !== undefined &amp;&amp; opts.colModel.formatoptions !== undefined) {
			op = $.extend({},op,opts.colModel.formatoptions);
		}
		if($.fmatter.isEmpty(cellval)) {
			return op.defaultValue;
		}
		return $.fmatter.util.NumberFormat(cellval,op);
	};
	$.fn.fmatter.number = function (cellval, opts) {
		var op = $.extend({},opts.number);
		if(opts.colModel !== undefined &amp;&amp; opts.colModel.formatoptions !== undefined) {
			op = $.extend({},op,opts.colModel.formatoptions);
		}
		if($.fmatter.isEmpty(cellval)) {
			return op.defaultValue;
		}
		return $.fmatter.util.NumberFormat(cellval,op);
	};
	$.fn.fmatter.currency = function (cellval, opts) {
		var op = $.extend({},opts.currency);
		if(opts.colModel !== undefined &amp;&amp; opts.colModel.formatoptions !== undefined) {
			op = $.extend({},op,opts.colModel.formatoptions);
		}
		if($.fmatter.isEmpty(cellval)) {
			return op.defaultValue;
		}
		return $.fmatter.util.NumberFormat(cellval,op);
	};
	$.fn.fmatter.date = function (cellval, opts, rwd, act) {
		var op = $.extend({},opts.date);
		if(opts.colModel !== undefined &amp;&amp; opts.colModel.formatoptions !== undefined) {
			op = $.extend({},op,opts.colModel.formatoptions);
		}
		if(!op.reformatAfterEdit &amp;&amp; act === &#x27;edit&#x27;){
			return $.fn.fmatter.defaultFormat(cellval, opts);
		}
		if(!$.fmatter.isEmpty(cellval)) {
			return $.jgrid.parseDate(op.srcformat,cellval,op.newformat,op);
		}
		return $.fn.fmatter.defaultFormat(cellval, opts);
	};
	$.fn.fmatter.select = function (cellval,opts) {
		// jqGrid specific
		cellval = String(cellval);
		var oSelect = false, ret=[], sep, delim;
		if(opts.colModel.formatoptions !== undefined){
			oSelect= opts.colModel.formatoptions.value;
			sep = opts.colModel.formatoptions.separator === undefined ? &quot;:&quot; : opts.colModel.formatoptions.separator;
			delim = opts.colModel.formatoptions.delimiter === undefined ? &quot;;&quot; : opts.colModel.formatoptions.delimiter;
		} else if(opts.colModel.editoptions !== undefined){
			oSelect= opts.colModel.editoptions.value;
			sep = opts.colModel.editoptions.separator === undefined ? &quot;:&quot; : opts.colModel.editoptions.separator;
			delim = opts.colModel.editoptions.delimiter === undefined ? &quot;;&quot; : opts.colModel.editoptions.delimiter;
		}
		if (oSelect) {
			var	msl =  opts.colModel.editoptions.multiple === true ? true : false,
			scell = [], sv;
			if(msl) {scell = cellval.split(&quot;,&quot;);scell = $.map(scell,function(n){return $.trim(n);});}
			if ($.fmatter.isString(oSelect)) {
				// mybe here we can use some caching with care ????
				var so = oSelect.split(delim), j=0, i;
				for(i=0; i&lt;so.length;i++){
					sv = so[i].split(sep);
					if(sv.length &gt; 2 ) {
						sv[1] = $.map(sv,function(n,i){if(i&gt;0) {return n;}}).join(sep);
					}
					if(msl) {
						if($.inArray(sv[0],scell)&gt;-1) {
							ret[j] = sv[1];
							j++;
						}
					} else if($.trim(sv[0]) === $.trim(cellval)) {
						ret[0] = sv[1];
						break;
					}
				}
			} else if($.fmatter.isObject(oSelect)) {
				// this is quicker
				if(msl) {
					ret = $.map(scell, function(n){
						return oSelect[n];
					});
				} else {
					ret[0] = oSelect[cellval] || &quot;&quot;;
				}
			}
		}
		cellval = ret.join(&quot;, &quot;);
		return  cellval === &quot;&quot; ? $.fn.fmatter.defaultFormat(cellval,opts) : cellval;
	};
	$.fn.fmatter.rowactions = function(act) {
		var $tr = $(this).closest(&quot;tr.jqgrow&quot;),
			rid = $tr.attr(&quot;id&quot;),
			$id = $(this).closest(&quot;table.ui-jqgrid-btable&quot;).attr(&#x27;id&#x27;).replace(/_frozen([^_]*)$/,&#x27;$1&#x27;),
			$grid = $(&quot;#&quot;+$id),
			$t = $grid[0],
			p = $t.p,
			cm = p.colModel[$.jgrid.getCellIndex(this)],
			$actionsDiv = cm.frozen ? $(&quot;tr#&quot;+rid+&quot; td:eq(&quot;+$.jgrid.getCellIndex(this)+&quot;) &gt; div&quot;,$grid) :$(this).parent(),
			op = {
				extraparam: {}
			},
			saverow = function(rowid, res) {
				if($.isFunction(op.afterSave)) { op.afterSave.call($t, rowid, res); }
				$actionsDiv.find(&quot;div.ui-inline-edit,div.ui-inline-del&quot;).show();
				$actionsDiv.find(&quot;div.ui-inline-save,div.ui-inline-cancel&quot;).hide();
			},
			restorerow = function(rowid) {
				if($.isFunction(op.afterRestore)) { op.afterRestore.call($t, rowid); }
				$actionsDiv.find(&quot;div.ui-inline-edit,div.ui-inline-del&quot;).show();
				$actionsDiv.find(&quot;div.ui-inline-save,div.ui-inline-cancel&quot;).hide();
			};

		if (cm.formatoptions !== undefined) {
			op = $.extend(op,cm.formatoptions);
		}
		if (p.editOptions !== undefined) {
			op.editOptions = p.editOptions;
		}
		if (p.delOptions !== undefined) {
			op.delOptions = p.delOptions;
		}
		if ($tr.hasClass(&quot;jqgrid-new-row&quot;)){
			op.extraparam[p.prmNames.oper] = p.prmNames.addoper;
		}
		var actop = {
			keys: op.keys,
			oneditfunc: op.onEdit,
			successfunc: op.onSuccess,
			url: op.url,
			extraparam: op.extraparam,
			aftersavefunc: saverow,
			errorfunc: op.onError,
			afterrestorefunc: restorerow,
			restoreAfterError: op.restoreAfterError,
			mtype: op.mtype
		};
		switch(act)
		{
			case &#x27;edit&#x27;:
				$grid.jqGrid(&#x27;editRow&#x27;, rid, actop);
				$actionsDiv.find(&quot;div.ui-inline-edit,div.ui-inline-del&quot;).hide();
				$actionsDiv.find(&quot;div.ui-inline-save,div.ui-inline-cancel&quot;).show();
				$grid.triggerHandler(&quot;jqGridAfterGridComplete&quot;);
				break;
			case &#x27;save&#x27;:
				if ($grid.jqGrid(&#x27;saveRow&#x27;, rid, actop)) {
					$actionsDiv.find(&quot;div.ui-inline-edit,div.ui-inline-del&quot;).show();
					$actionsDiv.find(&quot;div.ui-inline-save,div.ui-inline-cancel&quot;).hide();
					$grid.triggerHandler(&quot;jqGridAfterGridComplete&quot;);
				}
				break;
			case &#x27;cancel&#x27; :
				$grid.jqGrid(&#x27;restoreRow&#x27;, rid, restorerow);
				$actionsDiv.find(&quot;div.ui-inline-edit,div.ui-inline-del&quot;).show();
				$actionsDiv.find(&quot;div.ui-inline-save,div.ui-inline-cancel&quot;).hide();
				$grid.triggerHandler(&quot;jqGridAfterGridComplete&quot;);
				break;
			case &#x27;del&#x27;:
				$grid.jqGrid(&#x27;delGridRow&#x27;, rid, op.delOptions);
				break;
			case &#x27;formedit&#x27;:
				$grid.jqGrid(&#x27;setSelection&#x27;, rid);
				$grid.jqGrid(&#x27;editGridRow&#x27;, rid, op.editOptions);
				break;
		}
	};
	$.fn.fmatter.actions = function(cellval,opts) {
		var op={keys:false, editbutton:true, delbutton:true, editformbutton: false},
			rowid=opts.rowId, str=&quot;&quot;,ocl;
		if(opts.colModel.formatoptions !== undefined) {
			op = $.extend(op,opts.colModel.formatoptions);
		}
		if(rowid === undefined || $.fmatter.isEmpty(rowid)) {return &quot;&quot;;}
		if(op.editformbutton){
			ocl = &quot;id=&#x27;jEditButton_&quot;+rowid+&quot;&#x27; onclick=jQuery.fn.fmatter.rowactions.call(this,&#x27;formedit&#x27;); onmouseover=jQuery(this).addClass(&#x27;ui-state-hover&#x27;); onmouseout=jQuery(this).removeClass(&#x27;ui-state-hover&#x27;); &quot;;
			str += &quot;&lt;div title=&#x27;&quot;+$.jgrid.nav.edittitle+&quot;&#x27; style=&#x27;float:left;cursor:pointer;&#x27; class=&#x27;ui-pg-div ui-inline-edit&#x27; &quot;+ocl+&quot;&gt;&lt;span class=&#x27;ui-icon ui-icon-pencil&#x27;&gt;&lt;/span&gt;&lt;/div&gt;&quot;;
		} else if(op.editbutton){
			ocl = &quot;id=&#x27;jEditButton_&quot;+rowid+&quot;&#x27; onclick=jQuery.fn.fmatter.rowactions.call(this,&#x27;edit&#x27;); onmouseover=jQuery(this).addClass(&#x27;ui-state-hover&#x27;); onmouseout=jQuery(this).removeClass(&#x27;ui-state-hover&#x27;) &quot;;
			str += &quot;&lt;div title=&#x27;&quot;+$.jgrid.nav.edittitle+&quot;&#x27; style=&#x27;float:left;cursor:pointer;&#x27; class=&#x27;ui-pg-div ui-inline-edit&#x27; &quot;+ocl+&quot;&gt;&lt;span class=&#x27;ui-icon ui-icon-pencil&#x27;&gt;&lt;/span&gt;&lt;/div&gt;&quot;;
		}
		if(op.delbutton) {
			ocl = &quot;id=&#x27;jDeleteButton_&quot;+rowid+&quot;&#x27; onclick=jQuery.fn.fmatter.rowactions.call(this,&#x27;del&#x27;); onmouseover=jQuery(this).addClass(&#x27;ui-state-hover&#x27;); onmouseout=jQuery(this).removeClass(&#x27;ui-state-hover&#x27;); &quot;;
			str += &quot;&lt;div title=&#x27;&quot;+$.jgrid.nav.deltitle+&quot;&#x27; style=&#x27;float:left;margin-left:5px;&#x27; class=&#x27;ui-pg-div ui-inline-del&#x27; &quot;+ocl+&quot;&gt;&lt;span class=&#x27;ui-icon ui-icon-trash&#x27;&gt;&lt;/span&gt;&lt;/div&gt;&quot;;
		}
		ocl = &quot;id=&#x27;jSaveButton_&quot;+rowid+&quot;&#x27; onclick=jQuery.fn.fmatter.rowactions.call(this,&#x27;save&#x27;); onmouseover=jQuery(this).addClass(&#x27;ui-state-hover&#x27;); onmouseout=jQuery(this).removeClass(&#x27;ui-state-hover&#x27;); &quot;;
		str += &quot;&lt;div title=&#x27;&quot;+$.jgrid.edit.bSubmit+&quot;&#x27; style=&#x27;float:left;display:none&#x27; class=&#x27;ui-pg-div ui-inline-save&#x27; &quot;+ocl+&quot;&gt;&lt;span class=&#x27;ui-icon ui-icon-disk&#x27;&gt;&lt;/span&gt;&lt;/div&gt;&quot;;
		ocl = &quot;id=&#x27;jCancelButton_&quot;+rowid+&quot;&#x27; onclick=jQuery.fn.fmatter.rowactions.call(this,&#x27;cancel&#x27;); onmouseover=jQuery(this).addClass(&#x27;ui-state-hover&#x27;); onmouseout=jQuery(this).removeClass(&#x27;ui-state-hover&#x27;); &quot;;
		str += &quot;&lt;div title=&#x27;&quot;+$.jgrid.edit.bCancel+&quot;&#x27; style=&#x27;float:left;display:none;margin-left:5px;&#x27; class=&#x27;ui-pg-div ui-inline-cancel&#x27; &quot;+ocl+&quot;&gt;&lt;span class=&#x27;ui-icon ui-icon-cancel&#x27;&gt;&lt;/span&gt;&lt;/div&gt;&quot;;
		return &quot;&lt;div style=&#x27;margin-left:8px;&#x27;&gt;&quot; + str + &quot;&lt;/div&gt;&quot;;
	};
	$.unformat = function (cellval,options,pos,cnt) {
		// specific for jqGrid only
		var ret, formatType = options.colModel.formatter,
		op =options.colModel.formatoptions || {}, sep,
		re = /([\.\*\_\&#x27;\(\)\{\}\+\?\\])/g,
		unformatFunc = options.colModel.unformat||($.fn.fmatter[formatType] &amp;&amp; $.fn.fmatter[formatType].unformat);
		if(unformatFunc !== undefined &amp;&amp; $.isFunction(unformatFunc) ) {
			ret = unformatFunc.call(this, $(cellval).text(), options, cellval);
		} else if(formatType !== undefined &amp;&amp; $.fmatter.isString(formatType) ) {
			var opts = $.jgrid.formatter || {}, stripTag;
			switch(formatType) {
				case &#x27;integer&#x27; :
					op = $.extend({},opts.integer,op);
					sep = op.thousandsSeparator.replace(re,&quot;\\$1&quot;);
					stripTag = new RegExp(sep, &quot;g&quot;);
					ret = $(cellval).text().replace(stripTag,&#x27;&#x27;);
					break;
				case &#x27;number&#x27; :
					op = $.extend({},opts.number,op);
					sep = op.thousandsSeparator.replace(re,&quot;\\$1&quot;);
					stripTag = new RegExp(sep, &quot;g&quot;);
					ret = $(cellval).text().replace(stripTag,&quot;&quot;).replace(op.decimalSeparator,&#x27;.&#x27;);
					break;
				case &#x27;currency&#x27;:
					op = $.extend({},opts.currency,op);
					sep = op.thousandsSeparator.replace(re,&quot;\\$1&quot;);
					stripTag = new RegExp(sep, &quot;g&quot;);
					ret = $(cellval).text();
					if (op.prefix &amp;&amp; op.prefix.length) {
						ret = ret.substr(op.prefix.length);
					}
					if (op.suffix &amp;&amp; op.suffix.length) {
						ret = ret.substr(0, ret.length - op.suffix.length);
					}
					ret = ret.replace(stripTag,&#x27;&#x27;).replace(op.decimalSeparator,&#x27;.&#x27;);
					break;
				case &#x27;checkbox&#x27;:
					var cbv = (options.colModel.editoptions) ? options.colModel.editoptions.value.split(&quot;:&quot;) : [&quot;Yes&quot;,&quot;No&quot;];
					ret = $(&#x27;input&#x27;,cellval).is(&quot;:checked&quot;) ? cbv[0] : cbv[1];
					break;
				case &#x27;select&#x27; :
					ret = $.unformat.select(cellval,options,pos,cnt);
					break;
				case &#x27;actions&#x27;:
					return &quot;&quot;;
				default:
					ret= $(cellval).text();
			}
		}
		return ret !== undefined ? ret : cnt===true ? $(cellval).text() : $.jgrid.htmlDecode($(cellval).html());
	};
	$.unformat.select = function (cellval,options,pos,cnt) {
		// Spacial case when we have local data and perform a sort
		// cnt is set to true only in sortDataArray
		var ret = [];
		var cell = $(cellval).text();
		if(cnt===true) {return cell;}
		var op = $.extend({}, options.colModel.formatoptions !== undefined ? options.colModel.formatoptions: options.colModel.editoptions),
		sep = op.separator === undefined ? &quot;:&quot; : op.separator,
		delim = op.delimiter === undefined ? &quot;;&quot; : op.delimiter;

		if(op.value){
			var oSelect = op.value,
			msl =  op.multiple === true ? true : false,
			scell = [], sv;
			if(msl) {scell = cell.split(&quot;,&quot;);scell = $.map(scell,function(n){return $.trim(n);});}
			if ($.fmatter.isString(oSelect)) {
				var so = oSelect.split(delim), j=0, i;
				for(i=0; i&lt;so.length;i++){
					sv = so[i].split(sep);
					if(sv.length &gt; 2 ) {
						sv[1] = $.map(sv,function(n,i){if(i&gt;0) {return n;}}).join(sep);
					}
					if(msl) {
						if($.inArray(sv[1],scell)&gt;-1) {
							ret[j] = sv[0];
							j++;
						}
					} else if($.trim(sv[1]) === $.trim(cell)) {
						ret[0] = sv[0];
						break;
					}
				}
			} else if($.fmatter.isObject(oSelect) || $.isArray(oSelect) ){
				if(!msl) {scell[0] =  cell;}
				ret = $.map(scell, function(n){
					var rv;
					$.each(oSelect, function(i,val){
						if (val === n) {
							rv = i;
							return false;
						}
					});
					if( rv !== undefined ) {return rv;}
				});
			}
			return ret.join(&quot;, &quot;);
		}
		return cell || &quot;&quot;;
	};
	$.unformat.date = function (cellval, opts) {
		var op = $.jgrid.formatter.date || {};
		if(opts.formatoptions !== undefined) {
			op = $.extend({},op,opts.formatoptions);
		}
		if(!$.fmatter.isEmpty(cellval)) {
			return $.jgrid.parseDate(op.newformat,cellval,op.srcformat,op);
		}
		return $.fn.fmatter.defaultFormat(cellval, opts);
	};
})(jQuery);
/*jshint eqeqeq:false */
/*global jQuery */
(function($){
/*
 * jqGrid common function
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
*/
&quot;use strict&quot;;
$.extend($.jgrid,{
// Modal functions
	showModal : function(h) {
		h.w.show();
	},
	closeModal : function(h) {
		h.w.hide().attr(&quot;aria-hidden&quot;,&quot;true&quot;);
		if(h.o) {h.o.remove();}
	},
	hideModal : function (selector,o) {
		o = $.extend({jqm : true, gb :&#x27;&#x27;}, o || {});
		if(o.onClose) {
			var oncret = o.gb &amp;&amp; typeof o.gb === &quot;string&quot; &amp;&amp; o.gb.substr(0,6) === &quot;#gbox_&quot; ? o.onClose.call($(&quot;#&quot; + o.gb.substr(6))[0], selector) : o.onClose(selector);
			if (typeof oncret === &#x27;boolean&#x27;  &amp;&amp; !oncret ) { return; }
		}
		if ($.fn.jqm &amp;&amp; o.jqm === true) {
			$(selector).attr(&quot;aria-hidden&quot;,&quot;true&quot;).jqmHide();
		} else {
			if(o.gb !== &#x27;&#x27;) {
				try {$(&quot;.jqgrid-overlay:first&quot;,o.gb).hide();} catch (e){}
			}
			$(selector).hide().attr(&quot;aria-hidden&quot;,&quot;true&quot;);
		}
	},
//Helper functions
	findPos : function(obj) {
		var curleft = 0, curtop = 0;
		if (obj.offsetParent) {
			do {
				curleft += obj.offsetLeft;
				curtop += obj.offsetTop;
			} while (obj = obj.offsetParent);
			//do not change obj == obj.offsetParent
		}
		return [curleft,curtop];
	},
	createModal : function(aIDs, content, p, insertSelector, posSelector, appendsel, css) {
		p = $.extend(true, {}, $.jgrid.jqModal || {}, p);
		var mw  = document.createElement(&#x27;div&#x27;), rtlsup, self = this;
		css = $.extend({}, css || {});
		rtlsup = $(p.gbox).attr(&quot;dir&quot;) === &quot;rtl&quot; ? true : false;
		mw.className= &quot;ui-widget ui-widget-content ui-corner-all ui-jqdialog&quot;;
		mw.id = aIDs.themodal;
		var mh = document.createElement(&#x27;div&#x27;);
		mh.className = &quot;ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix&quot;;
		mh.id = aIDs.modalhead;
		$(mh).append(&quot;&lt;span class=&#x27;ui-jqdialog-title&#x27;&gt;&quot;+p.caption+&quot;&lt;/span&gt;&quot;);
		var ahr= $(&quot;&lt;a class=&#x27;ui-jqdialog-titlebar-close ui-corner-all&#x27;&gt;&lt;/a&gt;&quot;)
		.hover(function(){ahr.addClass(&#x27;ui-state-hover&#x27;);},
			function(){ahr.removeClass(&#x27;ui-state-hover&#x27;);})
		.append(&quot;&lt;span class=&#x27;ui-icon ui-icon-closethick&#x27;&gt;&lt;/span&gt;&quot;);
		$(mh).append(ahr);
		if(rtlsup) {
			mw.dir = &quot;rtl&quot;;
			$(&quot;.ui-jqdialog-title&quot;,mh).css(&quot;float&quot;,&quot;right&quot;);
			$(&quot;.ui-jqdialog-titlebar-close&quot;,mh).css(&quot;left&quot;,0.3+&quot;em&quot;);
		} else {
			mw.dir = &quot;ltr&quot;;
			$(&quot;.ui-jqdialog-title&quot;,mh).css(&quot;float&quot;,&quot;left&quot;);
			$(&quot;.ui-jqdialog-titlebar-close&quot;,mh).css(&quot;right&quot;,0.3+&quot;em&quot;);
		}
		var mc = document.createElement(&#x27;div&#x27;);
		$(mc).addClass(&quot;ui-jqdialog-content ui-widget-content&quot;).attr(&quot;id&quot;,aIDs.modalcontent);
		$(mc).append(content);
		mw.appendChild(mc);
		$(mw).prepend(mh);
		if(appendsel===true) { $(&#x27;body&#x27;).append(mw); } //append as first child in body -for alert dialog
		else if (typeof appendsel === &quot;string&quot;) {
			$(appendsel).append(mw);
		} else {$(mw).insertBefore(insertSelector);}
		$(mw).css(css);
		if(p.jqModal === undefined) {p.jqModal = true;} // internal use
		var coord = {};
		if ( $.fn.jqm &amp;&amp; p.jqModal === true) {
			if(p.left ===0 &amp;&amp; p.top===0 &amp;&amp; p.overlay) {
				var pos = [];
				pos = $.jgrid.findPos(posSelector);
				p.left = pos[0] + 4;
				p.top = pos[1] + 4;
			}
			coord.top = p.top+&quot;px&quot;;
			coord.left = p.left;
		} else if(p.left !==0 || p.top!==0) {
			coord.left = p.left;
			coord.top = p.top+&quot;px&quot;;
		}
		$(&quot;a.ui-jqdialog-titlebar-close&quot;,mh).click(function(){
			var oncm = $(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal)).data(&quot;onClose&quot;) || p.onClose;
			var gboxclose = $(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal)).data(&quot;gbox&quot;) || p.gbox;
			self.hideModal(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal),{gb:gboxclose,jqm:p.jqModal,onClose:oncm});
			return false;
		});
		if (p.width === 0 || !p.width) {p.width = 300;}
		if(p.height === 0 || !p.height) {p.height =200;}
		if(!p.zIndex) {
			var parentZ = $(insertSelector).parents(&quot;*[role=dialog]&quot;).filter(&#x27;:first&#x27;).css(&quot;z-index&quot;);
			if(parentZ) {
				p.zIndex = parseInt(parentZ,10)+2;
			} else {
				p.zIndex = 950;
			}
		}
		var rtlt = 0;
		if( rtlsup &amp;&amp; coord.left &amp;&amp; !appendsel) {
			rtlt = $(p.gbox).width()- (!isNaN(p.width) ? parseInt(p.width,10) :0) - 8; // to do
		// just in case
			coord.left = parseInt(coord.left,10) + parseInt(rtlt,10);
		}
		if(coord.left) { coord.left += &quot;px&quot;; }
		$(mw).css($.extend({
			width: isNaN(p.width) ? &quot;auto&quot;: p.width+&quot;px&quot;,
			height:isNaN(p.height) ? &quot;auto&quot; : p.height + &quot;px&quot;,
			zIndex:p.zIndex,
			overflow: &#x27;hidden&#x27;
		},coord))
		.attr({tabIndex: &quot;-1&quot;,&quot;role&quot;:&quot;dialog&quot;,&quot;aria-labelledby&quot;:aIDs.modalhead,&quot;aria-hidden&quot;:&quot;true&quot;});
		if(p.drag === undefined) { p.drag=true;}
		if(p.resize === undefined) {p.resize=true;}
		if (p.drag) {
			$(mh).css(&#x27;cursor&#x27;,&#x27;move&#x27;);
			if($.fn.jqDrag) {
				$(mw).jqDrag(mh);
			} else {
				try {
					$(mw).draggable({handle: $(&quot;#&quot;+$.jgrid.jqID(mh.id))});
				} catch (e) {}
			}
		}
		if(p.resize) {
			if($.fn.jqResize) {
				$(mw).append(&quot;&lt;div class=&#x27;jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se&#x27;&gt;&lt;/div&gt;&quot;);
				$(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal)).jqResize(&quot;.jqResize&quot;,aIDs.scrollelm ? &quot;#&quot;+$.jgrid.jqID(aIDs.scrollelm) : false);
			} else {
				try {
					$(mw).resizable({handles: &#x27;se, sw&#x27;,alsoResize: aIDs.scrollelm ? &quot;#&quot;+$.jgrid.jqID(aIDs.scrollelm) : false});
				} catch (r) {}
			}
		}
		if(p.closeOnEscape === true){
			$(mw).keydown( function( e ) {
				if( e.which == 27 ) {
					var cone = $(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal)).data(&quot;onClose&quot;) || p.onClose;
					self.hideModal(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal),{gb:p.gbox,jqm:p.jqModal,onClose: cone});
				}
			});
		}
	},
	viewModal : function (selector,o){
		o = $.extend({
			toTop: true,
			overlay: 10,
			modal: false,
			overlayClass : &#x27;ui-widget-overlay&#x27;,
			onShow: $.jgrid.showModal,
			onHide: $.jgrid.closeModal,
			gbox: &#x27;&#x27;,
			jqm : true,
			jqM : true
		}, o || {});
		if ($.fn.jqm &amp;&amp; o.jqm === true) {
			if(o.jqM) { $(selector).attr(&quot;aria-hidden&quot;,&quot;false&quot;).jqm(o).jqmShow(); }
			else {$(selector).attr(&quot;aria-hidden&quot;,&quot;false&quot;).jqmShow();}
		} else {
			if(o.gbox !== &#x27;&#x27;) {
				$(&quot;.jqgrid-overlay:first&quot;,o.gbox).show();
				$(selector).data(&quot;gbox&quot;,o.gbox);
			}
			$(selector).show().attr(&quot;aria-hidden&quot;,&quot;false&quot;);
			try{$(&#x27;:input:visible&#x27;,selector)[0].focus();}catch(_){}
		}
	},
	info_dialog : function(caption, content,c_b, modalopt) {
		var mopt = {
			width:290,
			height:&#x27;auto&#x27;,
			dataheight: &#x27;auto&#x27;,
			drag: true,
			resize: false,
			left:250,
			top:170,
			zIndex : 1000,
			jqModal : true,
			modal : false,
			closeOnEscape : true,
			align: &#x27;center&#x27;,
			buttonalign : &#x27;center&#x27;,
			buttons : []
		// {text:&#x27;textbutt&#x27;, id:&quot;buttid&quot;, onClick : function(){...}}
		// if the id is not provided we set it like info_button_+ the index in the array - i.e info_button_0,info_button_1...
		};
		$.extend(true, mopt, $.jgrid.jqModal || {}, {caption:&quot;&lt;b&gt;&quot;+caption+&quot;&lt;/b&gt;&quot;}, modalopt || {});
		var jm = mopt.jqModal, self = this;
		if($.fn.jqm &amp;&amp; !jm) { jm = false; }
		// in case there is no jqModal
		var buttstr =&quot;&quot;, i;
		if(mopt.buttons.length &gt; 0) {
			for(i=0;i&lt;mopt.buttons.length;i++) {
				if(mopt.buttons[i].id === undefined) { mopt.buttons[i].id = &quot;info_button_&quot;+i; }
				buttstr += &quot;&lt;a id=&#x27;&quot;+mopt.buttons[i].id+&quot;&#x27; class=&#x27;fm-button ui-state-default ui-corner-all&#x27;&gt;&quot;+mopt.buttons[i].text+&quot;&lt;/a&gt;&quot;;
			}
		}
		var dh = isNaN(mopt.dataheight) ? mopt.dataheight : mopt.dataheight+&quot;px&quot;,
		cn = &quot;text-align:&quot;+mopt.align+&quot;;&quot;;
		var cnt = &quot;&lt;div id=&#x27;info_id&#x27;&gt;&quot;;
		cnt += &quot;&lt;div id=&#x27;infocnt&#x27; style=&#x27;margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:&quot;+dh+&quot;;&quot;+cn+&quot;&#x27;&gt;&quot;+content+&quot;&lt;/div&gt;&quot;;
		cnt += c_b ? &quot;&lt;div class=&#x27;ui-widget-content ui-helper-clearfix&#x27; style=&#x27;text-align:&quot;+mopt.buttonalign+&quot;;padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;&#x27;&gt;&lt;a id=&#x27;closedialog&#x27; class=&#x27;fm-button ui-state-default ui-corner-all&#x27;&gt;&quot;+c_b+&quot;&lt;/a&gt;&quot;+buttstr+&quot;&lt;/div&gt;&quot; :
			buttstr !== &quot;&quot;  ? &quot;&lt;div class=&#x27;ui-widget-content ui-helper-clearfix&#x27; style=&#x27;text-align:&quot;+mopt.buttonalign+&quot;;padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;&#x27;&gt;&quot;+buttstr+&quot;&lt;/div&gt;&quot; : &quot;&quot;;
		cnt += &quot;&lt;/div&gt;&quot;;

		try {
			if($(&quot;#info_dialog&quot;).attr(&quot;aria-hidden&quot;) === &quot;false&quot;) {
				$.jgrid.hideModal(&quot;#info_dialog&quot;,{jqm:jm});
			}
			$(&quot;#info_dialog&quot;).remove();
		} catch (e){}
		$.jgrid.createModal({
			themodal:&#x27;info_dialog&#x27;,
			modalhead:&#x27;info_head&#x27;,
			modalcontent:&#x27;info_content&#x27;,
			scrollelm: &#x27;infocnt&#x27;},
			cnt,
			mopt,
			&#x27;&#x27;,&#x27;&#x27;,true
		);
		// attach onclick after inserting into the dom
		if(buttstr) {
			$.each(mopt.buttons,function(i){
				$(&quot;#&quot;+$.jgrid.jqID(this.id),&quot;#info_id&quot;).bind(&#x27;click&#x27;,function(){mopt.buttons[i].onClick.call($(&quot;#info_dialog&quot;)); return false;});
			});
		}
		$(&quot;#closedialog&quot;, &quot;#info_id&quot;).click(function(){
			self.hideModal(&quot;#info_dialog&quot;,{
				jqm:jm,
				onClose: $(&quot;#info_dialog&quot;).data(&quot;onClose&quot;) || mopt.onClose,
				gb: $(&quot;#info_dialog&quot;).data(&quot;gbox&quot;) || mopt.gbox
			});
			return false;
		});
		$(&quot;.fm-button&quot;,&quot;#info_dialog&quot;).hover(
			function(){$(this).addClass(&#x27;ui-state-hover&#x27;);},
			function(){$(this).removeClass(&#x27;ui-state-hover&#x27;);}
		);
		if($.isFunction(mopt.beforeOpen) ) { mopt.beforeOpen(); }
		$.jgrid.viewModal(&quot;#info_dialog&quot;,{
			onHide: function(h) {
				h.w.hide().remove();
				if(h.o) { h.o.remove(); }
			},
			modal :mopt.modal,
			jqm:jm
		});
		if($.isFunction(mopt.afterOpen) ) { mopt.afterOpen(); }
		try{ $(&quot;#info_dialog&quot;).focus();} catch (m){}
	},
	bindEv: function  (el, opt) {
		var $t = this;
		if($.isFunction(opt.dataInit)) {
			opt.dataInit.call($t,el,opt);
		}
		if(opt.dataEvents) {
			$.each(opt.dataEvents, function() {
				if (this.data !== undefined) {
					$(el).bind(this.type, this.data, this.fn);
				} else {
					$(el).bind(this.type, this.fn);
				}
			});
		}
	},
// Form Functions
	createEl : function(eltype,options,vl,autowidth, ajaxso) {
		var elem = &quot;&quot;, $t = this;
		function setAttributes(elm, atr, exl ) {
			var exclude = [&#x27;dataInit&#x27;,&#x27;dataEvents&#x27;,&#x27;dataUrl&#x27;, &#x27;buildSelect&#x27;,&#x27;sopt&#x27;, &#x27;searchhidden&#x27;, &#x27;defaultValue&#x27;, &#x27;attr&#x27;, &#x27;custom_element&#x27;, &#x27;custom_value&#x27;];
			if(exl !== undefined &amp;&amp; $.isArray(exl)) {
				$.merge(exclude, exl);
			}
			$.each(atr, function(key, value){
				if($.inArray(key, exclude) === -1) {
					$(elm).attr(key,value);
				}
			});
			if(!atr.hasOwnProperty(&#x27;id&#x27;)) {
				$(elm).attr(&#x27;id&#x27;, $.jgrid.randId());
			}
		}
		switch (eltype)
		{
			case &quot;textarea&quot; :
				elem = document.createElement(&quot;textarea&quot;);
				if(autowidth) {
					if(!options.cols) { $(elem).css({width:&quot;98%&quot;});}
				} else if (!options.cols) { options.cols = 20; }
				if(!options.rows) { options.rows = 2; }
				if(vl===&#x27;&amp;nbsp;&#x27; || vl===&#x27;&amp;#160;&#x27; || (vl.length===1 &amp;&amp; vl.charCodeAt(0)===160)) {vl=&quot;&quot;;}
				elem.value = vl;
				setAttributes(elem, options);
				$(elem).attr({&quot;role&quot;:&quot;textbox&quot;,&quot;multiline&quot;:&quot;true&quot;});
			break;
			case &quot;checkbox&quot; : //what code for simple checkbox
				elem = document.createElement(&quot;input&quot;);
				elem.type = &quot;checkbox&quot;;
				if( !options.value ) {
					var vl1 = (vl+&quot;&quot;).toLowerCase();
					if(vl1.search(/(false|f|0|no|n|off|undefined)/i)&lt;0 &amp;&amp; vl1!==&quot;&quot;) {
						elem.checked=true;
						elem.defaultChecked=true;
						elem.value = vl;
					} else {
						elem.value = &quot;on&quot;;
					}
					$(elem).attr(&quot;offval&quot;,&quot;off&quot;);
				} else {
					var cbval = options.value.split(&quot;:&quot;);
					if(vl === cbval[0]) {
						elem.checked=true;
						elem.defaultChecked=true;
					}
					elem.value = cbval[0];
					$(elem).attr(&quot;offval&quot;,cbval[1]);
				}
				setAttributes(elem, options, [&#x27;value&#x27;]);
				$(elem).attr(&quot;role&quot;,&quot;checkbox&quot;);
			break;
			case &quot;select&quot; :
				elem = document.createElement(&quot;select&quot;);
				elem.setAttribute(&quot;role&quot;,&quot;select&quot;);
				var msl, ovm = [];
				if(options.multiple===true) {
					msl = true;
					elem.multiple=&quot;multiple&quot;;
					$(elem).attr(&quot;aria-multiselectable&quot;,&quot;true&quot;);
				} else { msl = false; }
				if(options.dataUrl !== undefined) {
					var rowid = options.name ? String(options.id).substring(0, String(options.id).length - String(options.name).length - 1) : String(options.id),
						postData = options.postData || ajaxso.postData;

					if ($t.p &amp;&amp; $t.p.idPrefix) {
						rowid = $.jgrid.stripPref($t.p.idPrefix, rowid);
					}
					$.ajax($.extend({
						url: $.isFunction(options.dataUrl) ? options.dataUrl.call($t, rowid, vl, String(options.name)) : options.dataUrl,
						type : &quot;GET&quot;,
						dataType: &quot;html&quot;,
						data: $.isFunction(postData) ? postData.call($t, rowid, vl, String(options.name)) : postData,
						context: {elem:elem, options:options, vl:vl},
						success: function(data){
							var ovm = [], elem = this.elem, vl = this.vl,
							options = $.extend({},this.options),
							msl = options.multiple===true,
							a = $.isFunction(options.buildSelect) ? options.buildSelect.call($t,data) : data;
							if(typeof a === &#x27;string&#x27;) {
								a = $( $.trim( a ) ).html();
							}
							if(a) {
								$(elem).append(a);
								setAttributes(elem, options, postData ? [&#x27;postData&#x27;] : undefined );
								if(options.size === undefined) { options.size =  msl ? 3 : 1;}
								if(msl) {
									ovm = vl.split(&quot;,&quot;);
									ovm = $.map(ovm,function(n){return $.trim(n);});
								} else {
									ovm[0] = $.trim(vl);
								}
								//$(elem).attr(options);
								setTimeout(function(){
									$(&quot;option&quot;,elem).each(function(i){
										//if(i===0) { this.selected = &quot;&quot;; }
										// fix IE8/IE7 problem with selecting of the first item on multiple=true
										if (i === 0 &amp;&amp; elem.multiple) { this.selected = false; }
										$(this).attr(&quot;role&quot;,&quot;option&quot;);
										if($.inArray($.trim($(this).text()),ovm) &gt; -1 || $.inArray($.trim($(this).val()),ovm) &gt; -1 ) {
											this.selected= &quot;selected&quot;;
										}
									});
								},0);
							}
						}
					},ajaxso || {}));
				} else if(options.value) {
					var i;
					if(options.size === undefined) {
						options.size = msl ? 3 : 1;
					}
					if(msl) {
						ovm = vl.split(&quot;,&quot;);
						ovm = $.map(ovm,function(n){return $.trim(n);});
					}
					if(typeof options.value === &#x27;function&#x27;) { options.value = options.value(); }
					var so,sv, ov,
					sep = options.separator === undefined ? &quot;:&quot; : options.separator,
					delim = options.delimiter === undefined ? &quot;;&quot; : options.delimiter;
					if(typeof options.value === &#x27;string&#x27;) {
						so = options.value.split(delim);
						for(i=0; i&lt;so.length;i++){
							sv = so[i].split(sep);
							if(sv.length &gt; 2 ) {
								sv[1] = $.map(sv,function(n,ii){if(ii&gt;0) { return n;} }).join(sep);
							}
							ov = document.createElement(&quot;option&quot;);
							ov.setAttribute(&quot;role&quot;,&quot;option&quot;);
							ov.value = sv[0]; ov.innerHTML = sv[1];
							elem.appendChild(ov);
							if (!msl &amp;&amp;  ($.trim(sv[0]) === $.trim(vl) || $.trim(sv[1]) === $.trim(vl))) { ov.selected =&quot;selected&quot;; }
							if (msl &amp;&amp; ($.inArray($.trim(sv[1]), ovm)&gt;-1 || $.inArray($.trim(sv[0]), ovm)&gt;-1)) {ov.selected =&quot;selected&quot;;}
						}
					} else if (typeof options.value === &#x27;object&#x27;) {
						var oSv = options.value, key;
						for (key in oSv) {
							if (oSv.hasOwnProperty(key ) ){
								ov = document.createElement(&quot;option&quot;);
								ov.setAttribute(&quot;role&quot;,&quot;option&quot;);
								ov.value = key; ov.innerHTML = oSv[key];
								elem.appendChild(ov);
								if (!msl &amp;&amp;  ( $.trim(key) === $.trim(vl) || $.trim(oSv[key]) === $.trim(vl)) ) { ov.selected =&quot;selected&quot;; }
								if (msl &amp;&amp; ($.inArray($.trim(oSv[key]),ovm)&gt;-1 || $.inArray($.trim(key),ovm)&gt;-1)) { ov.selected =&quot;selected&quot;; }
							}
						}
					}
					setAttributes(elem, options, [&#x27;value&#x27;]);
				}
			break;
			case &quot;text&quot; :
			case &quot;password&quot; :
			case &quot;button&quot; :
				var role;
				if(eltype===&quot;button&quot;) { role = &quot;button&quot;; }
				else { role = &quot;textbox&quot;; }
				elem = document.createElement(&quot;input&quot;);
				elem.type = eltype;
				elem.value = vl;
				setAttributes(elem, options);
				if(eltype !== &quot;button&quot;){
					if(autowidth) {
						if(!options.size) { $(elem).css({width:&quot;98%&quot;}); }
					} else if (!options.size) { options.size = 20; }
				}
				$(elem).attr(&quot;role&quot;,role);
			break;
			case &quot;image&quot; :
			case &quot;file&quot; :
				elem = document.createElement(&quot;input&quot;);
				elem.type = eltype;
				setAttributes(elem, options);
				break;
			case &quot;custom&quot; :
				elem = document.createElement(&quot;span&quot;);
				try {
					if($.isFunction(options.custom_element)) {
						var celm = options.custom_element.call($t,vl,options);
						if(celm) {
							celm = $(celm).addClass(&quot;customelement&quot;).attr({id:options.id,name:options.name});
							$(elem).empty().append(celm);
						} else {
							throw &quot;e2&quot;;
						}
					} else {
						throw &quot;e1&quot;;
					}
				} catch (e) {
					if (e===&quot;e1&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function &#x27;custom_element&#x27; &quot;+$.jgrid.edit.msg.nodefined, $.jgrid.edit.bClose);}
					if (e===&quot;e2&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function &#x27;custom_element&#x27; &quot;+$.jgrid.edit.msg.novalue,$.jgrid.edit.bClose);}
					else { $.jgrid.info_dialog($.jgrid.errors.errcap,typeof e===&quot;string&quot;?e:e.message,$.jgrid.edit.bClose); }
				}
			break;
		}
		return elem;
	},
// Date Validation Javascript
	checkDate : function (format, date) {
		var daysInFebruary = function(year){
		// February has 29 days in any year evenly divisible by four,
		// EXCEPT for centurial years which are not also divisible by 400.
			return (((year % 4 === 0) &amp;&amp; ( year % 100 !== 0 || (year % 400 === 0))) ? 29 : 28 );
		},
		tsp = {}, sep;
		format = format.toLowerCase();
		//we search for /,-,. for the date separator
		if(format.indexOf(&quot;/&quot;) !== -1) {
			sep = &quot;/&quot;;
		} else if(format.indexOf(&quot;-&quot;) !== -1) {
			sep = &quot;-&quot;;
		} else if(format.indexOf(&quot;.&quot;) !== -1) {
			sep = &quot;.&quot;;
		} else {
			sep = &quot;/&quot;;
		}
		format = format.split(sep);
		date = date.split(sep);
		if (date.length !== 3) { return false; }
		var j=-1,yln, dln=-1, mln=-1, i;
		for(i=0;i&lt;format.length;i++){
			var dv =  isNaN(date[i]) ? 0 : parseInt(date[i],10);
			tsp[format[i]] = dv;
			yln = format[i];
			if(yln.indexOf(&quot;y&quot;) !== -1) { j=i; }
			if(yln.indexOf(&quot;m&quot;) !== -1) { mln=i; }
			if(yln.indexOf(&quot;d&quot;) !== -1) { dln=i; }
		}
		if (format[j] === &quot;y&quot; || format[j] === &quot;yyyy&quot;) {
			yln=4;
		} else if(format[j] ===&quot;yy&quot;){
			yln = 2;
		} else {
			yln = -1;
		}
		var daysInMonth = [0,31,29,31,30,31,30,31,31,30,31,30,31],
		strDate;
		if (j === -1) {
			return false;
		}
			strDate = tsp[format[j]].toString();
			if(yln === 2 &amp;&amp; strDate.length === 1) {yln = 1;}
			if (strDate.length !== yln || (tsp[format[j]]===0 &amp;&amp; date[j]!==&quot;00&quot;)){
				return false;
			}
		if(mln === -1) {
			return false;
		}
			strDate = tsp[format[mln]].toString();
			if (strDate.length&lt;1 || tsp[format[mln]]&lt;1 || tsp[format[mln]]&gt;12){
				return false;
			}
		if(dln === -1) {
			return false;
		}
			strDate = tsp[format[dln]].toString();
			if (strDate.length&lt;1 || tsp[format[dln]]&lt;1 || tsp[format[dln]]&gt;31 || (tsp[format[mln]]===2 &amp;&amp; tsp[format[dln]]&gt;daysInFebruary(tsp[format[j]])) || tsp[format[dln]] &gt; daysInMonth[tsp[format[mln]]]){
				return false;
			}
		return true;
	},
	isEmpty : function(val)
	{
		if (val.match(/^\s+$/) || val === &quot;&quot;)	{
			return true;
		}
			return false;
	},
	checkTime : function(time){
	// checks only hh:ss (and optional am/pm)
		var re = /^(\d{1,2}):(\d{2})([apAP][Mm])?$/,regs;
		if(!$.jgrid.isEmpty(time))
		{
			regs = time.match(re);
			if(regs) {
				if(regs[3]) {
					if(regs[1] &lt; 1 || regs[1] &gt; 12) { return false; }
				} else {
					if(regs[1] &gt; 23) { return false; }
				}
				if(regs[2] &gt; 59) {
					return false;
				}
			} else {
				return false;
			}
		}
		return true;
	},
	checkValues : function(val, valref, customobject, nam) {
		var edtrul,i, nm, dft, len, g = this, cm = g.p.colModel;
		if(customobject === undefined) {
			if(typeof valref===&#x27;string&#x27;){
				for( i =0, len=cm.length;i&lt;len; i++){
					if(cm[i].name===valref) {
						edtrul = cm[i].editrules;
						valref = i;
						if(cm[i].formoptions != null) { nm = cm[i].formoptions.label; }
						break;
					}
				}
			} else if(valref &gt;=0) {
				edtrul = cm[valref].editrules;
			}
		} else {
			edtrul = customobject;
			nm = nam===undefined ? &quot;_&quot; : nam;
		}
		if(edtrul) {
			if(!nm) { nm = g.p.colNames != null ? g.p.colNames[valref] : cm[valref].label; }
			if(edtrul.required === true) {
				if( $.jgrid.isEmpty(val) )  { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.required,&quot;&quot;]; }
			}
			// force required
			var rqfield = edtrul.required === false ? false : true;
			if(edtrul.number === true) {
				if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) {
					if(isNaN(val)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.number,&quot;&quot;]; }
				}
			}
			if(edtrul.minValue !== undefined &amp;&amp; !isNaN(edtrul.minValue)) {
				if (parseFloat(val) &lt; parseFloat(edtrul.minValue) ) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.minValue+&quot; &quot;+edtrul.minValue,&quot;&quot;];}
			}
			if(edtrul.maxValue !== undefined &amp;&amp; !isNaN(edtrul.maxValue)) {
				if (parseFloat(val) &gt; parseFloat(edtrul.maxValue) ) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.maxValue+&quot; &quot;+edtrul.maxValue,&quot;&quot;];}
			}
			var filter;
			if(edtrul.email === true) {
				if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) {
				// taken from $ Validate plugin
					filter = /^((([a-z]|\d|[!#\$%&amp;&#x27;\*\+\-\/=\?\^_&#x60;{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&amp;&#x27;\*\+\-\/=\?\^_&#x60;{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;
					if(!filter.test(val)) {return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.email,&quot;&quot;];}
				}
			}
			if(edtrul.integer === true) {
				if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) {
					if(isNaN(val)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.integer,&quot;&quot;]; }
					if ((val % 1 !== 0) || (val.indexOf(&#x27;.&#x27;) !== -1)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.integer,&quot;&quot;];}
				}
			}
			if(edtrul.date === true) {
				if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) {
					if(cm[valref].formatoptions &amp;&amp; cm[valref].formatoptions.newformat) {
						dft = cm[valref].formatoptions.newformat;
						if( $.jgrid.formatter.date.masks.hasOwnProperty(dft) ) {
							dft = $.jgrid.formatter.date.masks[dft];
						}
					} else {
						dft = cm[valref].datefmt || &quot;Y-m-d&quot;;
					}
					if(!$.jgrid.checkDate (dft, val)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.date+&quot; - &quot;+dft,&quot;&quot;]; }
				}
			}
			if(edtrul.time === true) {
				if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) {
					if(!$.jgrid.checkTime (val)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.date+&quot; - hh:mm (am/pm)&quot;,&quot;&quot;]; }
				}
			}
			if(edtrul.url === true) {
				if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) {
					filter = /^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&amp;#;&#x60;~=%!]*)(\.\w{2,})?)*\/?)/i;
					if(!filter.test(val)) {return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.url,&quot;&quot;];}
				}
			}
			if(edtrul.custom === true) {
				if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) {
					if($.isFunction(edtrul.custom_func)) {
						var ret = edtrul.custom_func.call(g,val,nm,valref);
						return $.isArray(ret) ? ret : [false,$.jgrid.edit.msg.customarray,&quot;&quot;];
					}
					return [false,$.jgrid.edit.msg.customfcheck,&quot;&quot;];
				}
			}
		}
		return [true,&quot;&quot;,&quot;&quot;];
	}
});
})(jQuery);
/*
 * jqFilter  jQuery jqGrid filter addon.
 * Copyright (c) 2011, Tony Tomov, tony@trirand.com
 * Dual licensed under the MIT and GPL licenses
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
 *
 * The work is inspired from this Stefan Pirvu
 * http://www.codeproject.com/KB/scripting/json-filtering.aspx
 *
 * The filter uses JSON entities to hold filter rules and groups. Here is an example of a filter:

{ &quot;groupOp&quot;: &quot;AND&quot;,
      &quot;groups&quot; : [
        { &quot;groupOp&quot;: &quot;OR&quot;,
            &quot;rules&quot;: [
                { &quot;field&quot;: &quot;name&quot;, &quot;op&quot;: &quot;eq&quot;, &quot;data&quot;: &quot;England&quot; },
                { &quot;field&quot;: &quot;id&quot;, &quot;op&quot;: &quot;le&quot;, &quot;data&quot;: &quot;5&quot;}
             ]
        }
      ],
      &quot;rules&quot;: [
        { &quot;field&quot;: &quot;name&quot;, &quot;op&quot;: &quot;eq&quot;, &quot;data&quot;: &quot;Romania&quot; },
        { &quot;field&quot;: &quot;id&quot;, &quot;op&quot;: &quot;le&quot;, &quot;data&quot;: &quot;1&quot;}
      ]
}
*/
/*jshint eqeqeq:false, eqnull:true, devel:true */
/*global jQuery */

(function ($) {
&quot;use strict&quot;;

$.fn.jqFilter = function( arg ) {
	if (typeof arg === &#x27;string&#x27;) {

		var fn = $.fn.jqFilter[arg];
		if (!fn) {
			throw (&quot;jqFilter - No such method: &quot; + arg);
		}
		var args = $.makeArray(arguments).slice(1);
		return fn.apply(this,args);
	}

	var p = $.extend(true,{
		filter: null,
		columns: [],
		onChange : null,
		afterRedraw : null,
		checkValues : null,
		error: false,
		errmsg : &quot;&quot;,
		errorcheck : true,
		showQuery : true,
		sopt : null,
		ops : [],
		operands : null,
		numopts : [&#x27;eq&#x27;,&#x27;ne&#x27;, &#x27;lt&#x27;, &#x27;le&#x27;, &#x27;gt&#x27;, &#x27;ge&#x27;, &#x27;nu&#x27;, &#x27;nn&#x27;, &#x27;in&#x27;, &#x27;ni&#x27;],
		stropts : [&#x27;eq&#x27;, &#x27;ne&#x27;, &#x27;bw&#x27;, &#x27;bn&#x27;, &#x27;ew&#x27;, &#x27;en&#x27;, &#x27;cn&#x27;, &#x27;nc&#x27;, &#x27;nu&#x27;, &#x27;nn&#x27;, &#x27;in&#x27;, &#x27;ni&#x27;],
		strarr : [&#x27;text&#x27;, &#x27;string&#x27;, &#x27;blob&#x27;],
		groupOps : [{ op: &quot;AND&quot;, text: &quot;AND&quot; },	{ op: &quot;OR&quot;,  text: &quot;OR&quot; }],
		groupButton : true,
		ruleButtons : true,
		direction : &quot;ltr&quot;
	}, $.jgrid.filter, arg || {});
	return this.each( function() {
		if (this.filter) {return;}
		this.p = p;
		// setup filter in case if they is not defined
		if (this.p.filter === null || this.p.filter === undefined) {
			this.p.filter = {
				groupOp: this.p.groupOps[0].op,
				rules: [],
				groups: []
			};
		}
		var i, len = this.p.columns.length, cl,
		isIE = /msie/i.test(navigator.userAgent) &amp;&amp; !window.opera;

		// translating the options
		this.p.initFilter = $.extend(true,{},this.p.filter);

		// set default values for the columns if they are not set
		if( !len ) {return;}
		for(i=0; i &lt; len; i++) {
			cl = this.p.columns[i];
			if( cl.stype ) {
				// grid compatibility
				cl.inputtype = cl.stype;
			} else if(!cl.inputtype) {
				cl.inputtype = &#x27;text&#x27;;
			}
			if( cl.sorttype ) {
				// grid compatibility
				cl.searchtype = cl.sorttype;
			} else if (!cl.searchtype) {
				cl.searchtype = &#x27;string&#x27;;
			}
			if(cl.hidden === undefined) {
				// jqGrid compatibility
				cl.hidden = false;
			}
			if(!cl.label) {
				cl.label = cl.name;
			}
			if(cl.index) {
				cl.name = cl.index;
			}
			if(!cl.hasOwnProperty(&#x27;searchoptions&#x27;)) {
				cl.searchoptions = {};
			}
			if(!cl.hasOwnProperty(&#x27;searchrules&#x27;)) {
				cl.searchrules = {};
			}

		}
		if(this.p.showQuery) {
			$(this).append(&quot;&lt;table class=&#x27;queryresult ui-widget ui-widget-content&#x27; style=&#x27;display:block;max-width:440px;border:0px none;&#x27; dir=&#x27;&quot;+this.p.direction+&quot;&#x27;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#x27;query&#x27;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;);
		}
		var getGrid = function () {
			return $(&quot;#&quot; + $.jgrid.jqID(p.id))[0] || null;
		};
		/*
		 *Perform checking.
		 *
		*/
		var checkData = function(val, colModelItem) {
			var ret = [true,&quot;&quot;], $t = getGrid();
			if($.isFunction(colModelItem.searchrules)) {
				ret = colModelItem.searchrules.call($t, val, colModelItem);
			} else if($.jgrid &amp;&amp; $.jgrid.checkValues) {
				try {
					ret = $.jgrid.checkValues.call($t, val, -1, colModelItem.searchrules, colModelItem.label);
				} catch (e) {}
			}
			if(ret &amp;&amp; ret.length &amp;&amp; ret[0] === false) {
				p.error = !ret[0];
				p.errmsg = ret[1];
			}
		};
		/* moving to common
		randId = function() {
			return Math.floor(Math.random()*10000).toString();
		};
		*/

		this.onchange = function (  ){
			// clear any error
			this.p.error = false;
			this.p.errmsg=&quot;&quot;;
			return $.isFunction(this.p.onChange) ? this.p.onChange.call( this, this.p ) : false;
		};
		/*
		 * Redraw the filter every time when new field is added/deleted
		 * and field is  changed
		 */
		this.reDraw = function() {
			$(&quot;table.group:first&quot;,this).remove();
			var t = this.createTableForGroup(p.filter, null);
			$(this).append(t);
			if($.isFunction(this.p.afterRedraw) ) {
				this.p.afterRedraw.call(this, this.p);
			}
		};
		/*
		 * Creates a grouping data for the filter
		 * @param group - object
		 * @param parentgroup - object
		 */
		this.createTableForGroup = function(group, parentgroup) {
			var that = this,  i;
			// this table will hold all the group (tables) and rules (rows)
			var table = $(&quot;&lt;table class=&#x27;group ui-widget ui-widget-content&#x27; style=&#x27;border:0px none;&#x27;&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;),
			// create error message row
			align = &quot;left&quot;;
			if(this.p.direction === &quot;rtl&quot;) {
				align = &quot;right&quot;;
				table.attr(&quot;dir&quot;,&quot;rtl&quot;);
			}
			if(parentgroup === null) {
				table.append(&quot;&lt;tr class=&#x27;error&#x27; style=&#x27;display:none;&#x27;&gt;&lt;th colspan=&#x27;5&#x27; class=&#x27;ui-state-error&#x27; align=&#x27;&quot;+align+&quot;&#x27;&gt;&lt;/th&gt;&lt;/tr&gt;&quot;);
			}

			var tr = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;);
			table.append(tr);
			// this header will hold the group operator type and group action buttons for
			// creating subgroup &quot;+ {}&quot;, creating rule &quot;+&quot; or deleting the group &quot;-&quot;
			var th = $(&quot;&lt;th colspan=&#x27;5&#x27; align=&#x27;&quot;+align+&quot;&#x27;&gt;&lt;/th&gt;&quot;);
			tr.append(th);

			if(this.p.ruleButtons === true) {
			// dropdown for: choosing group operator type
			var groupOpSelect = $(&quot;&lt;select class=&#x27;opsel&#x27;&gt;&lt;/select&gt;&quot;);
			th.append(groupOpSelect);
			// populate dropdown with all posible group operators: or, and
			var str= &quot;&quot;, selected;
			for (i = 0; i &lt; p.groupOps.length; i++) {
				selected =  group.groupOp === that.p.groupOps[i].op ? &quot; selected=&#x27;selected&#x27;&quot; :&quot;&quot;;
				str += &quot;&lt;option value=&#x27;&quot;+that.p.groupOps[i].op+&quot;&#x27;&quot; + selected+&quot;&gt;&quot;+that.p.groupOps[i].text+&quot;&lt;/option&gt;&quot;;
			}

			groupOpSelect
			.append(str)
			.bind(&#x27;change&#x27;,function() {
				group.groupOp = $(groupOpSelect).val();
				that.onchange(); // signals that the filter has changed
			});
			}
			// button for adding a new subgroup
			var inputAddSubgroup =&quot;&lt;span&gt;&lt;/span&gt;&quot;;
			if(this.p.groupButton) {
				inputAddSubgroup = $(&quot;&lt;input type=&#x27;button&#x27; value=&#x27;+ {}&#x27; title=&#x27;Add subgroup&#x27; class=&#x27;add-group&#x27;/&gt;&quot;);
				inputAddSubgroup.bind(&#x27;click&#x27;,function() {
					if (group.groups === undefined ) {
						group.groups = [];
					}

					group.groups.push({
						groupOp: p.groupOps[0].op,
						rules: [],
						groups: []
					}); // adding a new group

					that.reDraw(); // the html has changed, force reDraw

					that.onchange(); // signals that the filter has changed
					return false;
				});
			}
			th.append(inputAddSubgroup);
			if(this.p.ruleButtons === true) {
			// button for adding a new rule
			var inputAddRule = $(&quot;&lt;input type=&#x27;button&#x27; value=&#x27;+&#x27; title=&#x27;Add rule&#x27; class=&#x27;add-rule ui-add&#x27;/&gt;&quot;), cm;
			inputAddRule.bind(&#x27;click&#x27;,function() {
				//if(!group) { group = {};}
				if (group.rules === undefined) {
					group.rules = [];
				}
				for (i = 0; i &lt; that.p.columns.length; i++) {
				// but show only serchable and serchhidden = true fields
					var searchable = (that.p.columns[i].search === undefined) ?  true: that.p.columns[i].search,
					hidden = (that.p.columns[i].hidden === true),
					ignoreHiding = (that.p.columns[i].searchoptions.searchhidden === true);
					if ((ignoreHiding &amp;&amp; searchable) || (searchable &amp;&amp; !hidden)) {
						cm = that.p.columns[i];
						break;
					}
				}

				var opr;
				if( cm.searchoptions.sopt ) {opr = cm.searchoptions.sopt;}
				else if(that.p.sopt) { opr= that.p.sopt; }
				else if  ( $.inArray(cm.searchtype, that.p.strarr) !== -1 ) {opr = that.p.stropts;}
				else {opr = that.p.numopts;}

				group.rules.push({
					field: cm.name,
					op: opr[0],
					data: &quot;&quot;
				}); // adding a new rule

				that.reDraw(); // the html has changed, force reDraw
				// for the moment no change have been made to the rule, so
				// this will not trigger onchange event
				return false;
			});
			th.append(inputAddRule);
			}

			// button for delete the group
			if (parentgroup !== null) { // ignore the first group
				var inputDeleteGroup = $(&quot;&lt;input type=&#x27;button&#x27; value=&#x27;-&#x27; title=&#x27;Delete group&#x27; class=&#x27;delete-group&#x27;/&gt;&quot;);
				th.append(inputDeleteGroup);
				inputDeleteGroup.bind(&#x27;click&#x27;,function() {
				// remove group from parent
					for (i = 0; i &lt; parentgroup.groups.length; i++) {
						if (parentgroup.groups[i] === group) {
							parentgroup.groups.splice(i, 1);
							break;
						}
					}

					that.reDraw(); // the html has changed, force reDraw

					that.onchange(); // signals that the filter has changed
					return false;
				});
			}

			// append subgroup rows
			if (group.groups !== undefined) {
				for (i = 0; i &lt; group.groups.length; i++) {
					var trHolderForSubgroup = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;);
					table.append(trHolderForSubgroup);

					var tdFirstHolderForSubgroup = $(&quot;&lt;td class=&#x27;first&#x27;&gt;&lt;/td&gt;&quot;);
					trHolderForSubgroup.append(tdFirstHolderForSubgroup);

					var tdMainHolderForSubgroup = $(&quot;&lt;td colspan=&#x27;4&#x27;&gt;&lt;/td&gt;&quot;);
					tdMainHolderForSubgroup.append(this.createTableForGroup(group.groups[i], group));
					trHolderForSubgroup.append(tdMainHolderForSubgroup);
				}
			}
			if(group.groupOp === undefined) {
				group.groupOp = that.p.groupOps[0].op;
			}

			// append rules rows
			if (group.rules !== undefined) {
				for (i = 0; i &lt; group.rules.length; i++) {
					table.append(
                       this.createTableRowForRule(group.rules[i], group)
					);
				}
			}

			return table;
		};
		/*
		 * Create the rule data for the filter
		 */
		this.createTableRowForRule = function(rule, group ) {
			// save current entity in a variable so that it could
			// be referenced in anonimous method calls

			var that=this, $t = getGrid(), tr = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;),
			//document.createElement(&quot;tr&quot;),

			// first column used for padding
			//tdFirstHolderForRule = document.createElement(&quot;td&quot;),
			i, op, trpar, cm, str=&quot;&quot;, selected;
			//tdFirstHolderForRule.setAttribute(&quot;class&quot;, &quot;first&quot;);
			tr.append(&quot;&lt;td class=&#x27;first&#x27;&gt;&lt;/td&gt;&quot;);


			// create field container
			var ruleFieldTd = $(&quot;&lt;td class=&#x27;columns&#x27;&gt;&lt;/td&gt;&quot;);
			tr.append(ruleFieldTd);


			// dropdown for: choosing field
			var ruleFieldSelect = $(&quot;&lt;select&gt;&lt;/select&gt;&quot;), ina, aoprs = [];
			ruleFieldTd.append(ruleFieldSelect);
			ruleFieldSelect.bind(&#x27;change&#x27;,function() {
				rule.field = $(ruleFieldSelect).val();

				trpar = $(this).parents(&quot;tr:first&quot;);
				for (i=0;i&lt;that.p.columns.length;i++) {
					if(that.p.columns[i].name ===  rule.field) {
						cm = that.p.columns[i];
						break;
					}
				}
				if(!cm) {return;}
				cm.searchoptions.id = $.jgrid.randId();
				if(isIE &amp;&amp; cm.inputtype === &quot;text&quot;) {
					if(!cm.searchoptions.size) {
						cm.searchoptions.size = 10;
					}
				}
				var elm = $.jgrid.createEl.call($t, cm.inputtype,cm.searchoptions, &quot;&quot;, true, that.p.ajaxSelectOptions || {}, true);
				$(elm).addClass(&quot;input-elm&quot;);
				//that.createElement(rule, &quot;&quot;);

				if( cm.searchoptions.sopt ) {op = cm.searchoptions.sopt;}
				else if(that.p.sopt) { op= that.p.sopt; }
				else if  ($.inArray(cm.searchtype, that.p.strarr) !== -1) {op = that.p.stropts;}
				else {op = that.p.numopts;}
				// operators
				var s =&quot;&quot;, so = 0;
				aoprs = [];
				$.each(that.p.ops, function() { aoprs.push(this.oper); });
				for ( i = 0 ; i &lt; op.length; i++) {
					ina = $.inArray(op[i],aoprs);
					if(ina !== -1) {
						if(so===0) {
							rule.op = that.p.ops[ina].oper;
						}
						s += &quot;&lt;option value=&#x27;&quot;+that.p.ops[ina].oper+&quot;&#x27;&gt;&quot;+that.p.ops[ina].text+&quot;&lt;/option&gt;&quot;;
						so++;
					}
				}
				$(&quot;.selectopts&quot;,trpar).empty().append( s );
				$(&quot;.selectopts&quot;,trpar)[0].selectedIndex = 0;
				if( $.jgrid.msie &amp;&amp; $.jgrid.msiever() &lt; 9) {
					var sw = parseInt($(&quot;select.selectopts&quot;,trpar)[0].offsetWidth, 10) + 1;
					$(&quot;.selectopts&quot;,trpar).width( sw );
					$(&quot;.selectopts&quot;,trpar).css(&quot;width&quot;,&quot;auto&quot;);
				}
				// data
				$(&quot;.data&quot;,trpar).empty().append( elm );
				$.jgrid.bindEv.call($t, elm, cm.searchoptions);
				$(&quot;.input-elm&quot;,trpar).bind(&#x27;change&#x27;,function( e ) {
					var elem = e.target;
					rule.data = elem.nodeName.toUpperCase() === &quot;SPAN&quot; &amp;&amp; cm.searchoptions &amp;&amp; $.isFunction(cm.searchoptions.custom_value) ?
						cm.searchoptions.custom_value.call($t, $(elem).children(&quot;.customelement:first&quot;), &#x27;get&#x27;) : elem.value;
					that.onchange(); // signals that the filter has changed
				});
				setTimeout(function(){ //IE, Opera, Chrome
				rule.data = $(elm).val();
				that.onchange();  // signals that the filter has changed
				}, 0);
			});

			// populate drop down with user provided column definitions
			var j=0;
			for (i = 0; i &lt; that.p.columns.length; i++) {
				// but show only serchable and serchhidden = true fields
				var searchable = (that.p.columns[i].search === undefined) ? true: that.p.columns[i].search,
				hidden = (that.p.columns[i].hidden === true),
				ignoreHiding = (that.p.columns[i].searchoptions.searchhidden === true);
				if ((ignoreHiding &amp;&amp; searchable) || (searchable &amp;&amp; !hidden)) {
					selected = &quot;&quot;;
					if(rule.field === that.p.columns[i].name) {
						selected = &quot; selected=&#x27;selected&#x27;&quot;;
						j=i;
					}
					str += &quot;&lt;option value=&#x27;&quot;+that.p.columns[i].name+&quot;&#x27;&quot; +selected+&quot;&gt;&quot;+that.p.columns[i].label+&quot;&lt;/option&gt;&quot;;
				}
			}
			ruleFieldSelect.append( str );


			// create operator container
			var ruleOperatorTd = $(&quot;&lt;td class=&#x27;operators&#x27;&gt;&lt;/td&gt;&quot;);
			tr.append(ruleOperatorTd);
			cm = p.columns[j];
			// create it here so it can be referentiated in the onchange event
			//var RD = that.createElement(rule, rule.data);
			cm.searchoptions.id = $.jgrid.randId();
			if(isIE &amp;&amp; cm.inputtype === &quot;text&quot;) {
				if(!cm.searchoptions.size) {
					cm.searchoptions.size = 10;
				}
			}
			var ruleDataInput = $.jgrid.createEl.call($t, cm.inputtype,cm.searchoptions, rule.data, true, that.p.ajaxSelectOptions || {}, true);
			if(rule.op === &#x27;nu&#x27; || rule.op === &#x27;nn&#x27;) {
				$(ruleDataInput).attr(&#x27;readonly&#x27;,&#x27;true&#x27;);
				$(ruleDataInput).attr(&#x27;disabled&#x27;,&#x27;true&#x27;);
			} //retain the state of disabled text fields in case of null ops
			// dropdown for: choosing operator
			var ruleOperatorSelect = $(&quot;&lt;select class=&#x27;selectopts&#x27;&gt;&lt;/select&gt;&quot;);
			ruleOperatorTd.append(ruleOperatorSelect);
			ruleOperatorSelect.bind(&#x27;change&#x27;,function() {
				rule.op = $(ruleOperatorSelect).val();
				trpar = $(this).parents(&quot;tr:first&quot;);
				var rd = $(&quot;.input-elm&quot;,trpar)[0];
				if (rule.op === &quot;nu&quot; || rule.op === &quot;nn&quot;) { // disable for operator &quot;is null&quot; and &quot;is not null&quot;
					rule.data = &quot;&quot;;
					if(rd.tagName.toUpperCase() !== &#x27;SELECT&#x27;) rd.value = &quot;&quot;;
					rd.setAttribute(&quot;readonly&quot;, &quot;true&quot;);
					rd.setAttribute(&quot;disabled&quot;, &quot;true&quot;);
				} else {
					if(rd.tagName.toUpperCase() === &#x27;SELECT&#x27;) rule.data = rd.value;
					rd.removeAttribute(&quot;readonly&quot;);
					rd.removeAttribute(&quot;disabled&quot;);
				}

				that.onchange();  // signals that the filter has changed
			});

			// populate drop down with all available operators
			if( cm.searchoptions.sopt ) {op = cm.searchoptions.sopt;}
			else if(that.p.sopt) { op= that.p.sopt; }
			else if  ($.inArray(cm.searchtype, that.p.strarr) !== -1) {op = that.p.stropts;}
			else {op = that.p.numopts;}
			str=&quot;&quot;;
			$.each(that.p.ops, function() { aoprs.push(this.oper); });
			for ( i = 0; i &lt; op.length; i++) {
				ina = $.inArray(op[i],aoprs);
				if(ina !== -1) {
					selected = rule.op === that.p.ops[ina].oper ? &quot; selected=&#x27;selected&#x27;&quot; : &quot;&quot;;
					str += &quot;&lt;option value=&#x27;&quot;+that.p.ops[ina].oper+&quot;&#x27;&quot;+selected+&quot;&gt;&quot;+that.p.ops[ina].text+&quot;&lt;/option&gt;&quot;;
				}
			}
			ruleOperatorSelect.append( str );
			// create data container
			var ruleDataTd = $(&quot;&lt;td class=&#x27;data&#x27;&gt;&lt;/td&gt;&quot;);
			tr.append(ruleDataTd);

			// textbox for: data
			// is created previously
			//ruleDataInput.setAttribute(&quot;type&quot;, &quot;text&quot;);
			ruleDataTd.append(ruleDataInput);
			$.jgrid.bindEv.call($t, ruleDataInput, cm.searchoptions);
			$(ruleDataInput)
			.addClass(&quot;input-elm&quot;)
			.bind(&#x27;change&#x27;, function() {
				rule.data = cm.inputtype === &#x27;custom&#x27; ? cm.searchoptions.custom_value.call($t, $(this).children(&quot;.customelement:first&quot;),&#x27;get&#x27;) : $(this).val();
				that.onchange(); // signals that the filter has changed
			});

			// create action container
			var ruleDeleteTd = $(&quot;&lt;td&gt;&lt;/td&gt;&quot;);
			tr.append(ruleDeleteTd);

			// create button for: delete rule
			if(this.p.ruleButtons === true) {
			var ruleDeleteInput = $(&quot;&lt;input type=&#x27;button&#x27; value=&#x27;-&#x27; title=&#x27;Delete rule&#x27; class=&#x27;delete-rule ui-del&#x27;/&gt;&quot;);
			ruleDeleteTd.append(ruleDeleteInput);
			//$(ruleDeleteInput).html(&quot;&quot;).height(20).width(30).button({icons: {  primary: &quot;ui-icon-minus&quot;, text:false}});
			ruleDeleteInput.bind(&#x27;click&#x27;,function() {
				// remove rule from group
				for (i = 0; i &lt; group.rules.length; i++) {
					if (group.rules[i] === rule) {
						group.rules.splice(i, 1);
						break;
					}
				}

				that.reDraw(); // the html has changed, force reDraw

				that.onchange(); // signals that the filter has changed
				return false;
			});
			}
			return tr;
		};

		this.getStringForGroup = function(group) {
			var s = &quot;(&quot;, index;
			if (group.groups !== undefined) {
				for (index = 0; index &lt; group.groups.length; index++) {
					if (s.length &gt; 1) {
						s += &quot; &quot; + group.groupOp + &quot; &quot;;
					}
					try {
						s += this.getStringForGroup(group.groups[index]);
					} catch (eg) {alert(eg);}
				}
			}

			if (group.rules !== undefined) {
				try{
					for (index = 0; index &lt; group.rules.length; index++) {
						if (s.length &gt; 1) {
							s += &quot; &quot; + group.groupOp + &quot; &quot;;
						}
						s += this.getStringForRule(group.rules[index]);
					}
				} catch (e) {alert(e);}
			}

			s += &quot;)&quot;;

			if (s === &quot;()&quot;) {
				return &quot;&quot;; // ignore groups that don&#x27;t have rules
			}
			return s;
		};
		this.getStringForRule = function(rule) {
			var opUF = &quot;&quot;,opC=&quot;&quot;, i, cm, ret, val,
			numtypes = [&#x27;int&#x27;, &#x27;integer&#x27;, &#x27;float&#x27;, &#x27;number&#x27;, &#x27;currency&#x27;]; // jqGrid
			for (i = 0; i &lt; this.p.ops.length; i++) {
				if (this.p.ops[i].oper === rule.op) {
					opUF = this.p.operands.hasOwnProperty(rule.op) ? this.p.operands[rule.op] : &quot;&quot;;
					opC = this.p.ops[i].oper;
					break;
				}
			}
			for (i=0; i&lt;this.p.columns.length; i++) {
				if(this.p.columns[i].name === rule.field) {
					cm = this.p.columns[i];
					break;
				}
			}
			if (cm == undefined) { return &quot;&quot;; }
			val = rule.data;
			if(opC === &#x27;bw&#x27; || opC === &#x27;bn&#x27;) { val = val+&quot;%&quot;; }
			if(opC === &#x27;ew&#x27; || opC === &#x27;en&#x27;) { val = &quot;%&quot;+val; }
			if(opC === &#x27;cn&#x27; || opC === &#x27;nc&#x27;) { val = &quot;%&quot;+val+&quot;%&quot;; }
			if(opC === &#x27;in&#x27; || opC === &#x27;ni&#x27;) { val = &quot; (&quot;+val+&quot;)&quot;; }
			if(p.errorcheck) { checkData(rule.data, cm); }
			if($.inArray(cm.searchtype, numtypes) !== -1 || opC === &#x27;nn&#x27; || opC === &#x27;nu&#x27;) { ret = rule.field + &quot; &quot; + opUF + &quot; &quot; + val; }
			else { ret = rule.field + &quot; &quot; + opUF + &quot; \&quot;&quot; + val + &quot;\&quot;&quot;; }
			return ret;
		};
		this.resetFilter = function () {
			this.p.filter = $.extend(true,{},this.p.initFilter);
			this.reDraw();
			this.onchange();
		};
		this.hideError = function() {
			$(&quot;th.ui-state-error&quot;, this).html(&quot;&quot;);
			$(&quot;tr.error&quot;, this).hide();
		};
		this.showError = function() {
			$(&quot;th.ui-state-error&quot;, this).html(this.p.errmsg);
			$(&quot;tr.error&quot;, this).show();
		};
		this.toUserFriendlyString = function() {
			return this.getStringForGroup(p.filter);
		};
		this.toString = function() {
			// this will obtain a string that can be used to match an item.
			var that = this;
			function getStringRule(rule) {
				if(that.p.errorcheck) {
					var i, cm;
					for (i=0; i&lt;that.p.columns.length; i++) {
						if(that.p.columns[i].name === rule.field) {
							cm = that.p.columns[i];
							break;
						}
					}
					if(cm) {checkData(rule.data, cm);}
				}
				return rule.op + &quot;(item.&quot; + rule.field + &quot;,&#x27;&quot; + rule.data + &quot;&#x27;)&quot;;
			}

			function getStringForGroup(group) {
				var s = &quot;(&quot;, index;

				if (group.groups !== undefined) {
					for (index = 0; index &lt; group.groups.length; index++) {
						if (s.length &gt; 1) {
							if (group.groupOp === &quot;OR&quot;) {
								s += &quot; || &quot;;
							}
							else {
								s += &quot; &amp;&amp; &quot;;
							}
						}
						s += getStringForGroup(group.groups[index]);
					}
				}

				if (group.rules !== undefined) {
					for (index = 0; index &lt; group.rules.length; index++) {
						if (s.length &gt; 1) {
							if (group.groupOp === &quot;OR&quot;) {
								s += &quot; || &quot;;
							}
							else  {
								s += &quot; &amp;&amp; &quot;;
							}
						}
						s += getStringRule(group.rules[index]);
					}
				}

				s += &quot;)&quot;;

				if (s === &quot;()&quot;) {
					return &quot;&quot;; // ignore groups that don&#x27;t have rules
				}
				return s;
			}

			return getStringForGroup(this.p.filter);
		};

		// Here we init the filter
		this.reDraw();

		if(this.p.showQuery) {
			this.onchange();
		}
		// mark is as created so that it will not be created twice on this element
		this.filter = true;
	});
};
$.extend($.fn.jqFilter,{
	/*
	 * Return SQL like string. Can be used directly
	 */
	toSQLString : function()
	{
		var s =&quot;&quot;;
		this.each(function(){
			s = this.toUserFriendlyString();
		});
		return s;
	},
	/*
	 * Return filter data as object.
	 */
	filterData : function()
	{
		var s;
		this.each(function(){
			s = this.p.filter;
		});
		return s;

	},
	getParameter : function (param) {
		if(param !== undefined) {
			if (this.p.hasOwnProperty(param) ) {
				return this.p[param];
			}
		}
		return this.p;
	},
	resetFilter: function() {
		return this.each(function(){
			this.resetFilter();
		});
	},
	addFilter: function (pfilter) {
		if (typeof pfilter === &quot;string&quot;) {
			pfilter = $.jgrid.parse( pfilter );
	}
		this.each(function(){
			this.p.filter = pfilter;
			this.reDraw();
			this.onchange();
		});
	}

});
})(jQuery);
/*jshint eqeqeq:false, eqnull:true, devel:true */
/*global xmlJsonClass, jQuery */
(function($){
/**
 * jqGrid extension for form editing Grid Data
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/
&quot;use strict&quot;;
var rp_ge = {};
$.jgrid.extend({
	searchGrid : function (p) {
		p = $.extend(true, {
			recreateFilter: false,
			drag: true,
			sField:&#x27;searchField&#x27;,
			sValue:&#x27;searchString&#x27;,
			sOper: &#x27;searchOper&#x27;,
			sFilter: &#x27;filters&#x27;,
			loadDefaults: true, // this options activates loading of default filters from grid&#x27;s postData for Multipe Search only.
			beforeShowSearch: null,
			afterShowSearch : null,
			onInitializeSearch: null,
			afterRedraw : null,
			afterChange: null,
			closeAfterSearch : false,
			closeAfterReset: false,
			closeOnEscape : false,
			searchOnEnter : false,
			multipleSearch : false,
			multipleGroup : false,
			//cloneSearchRowOnAdd: true,
			top : 0,
			left: 0,
			jqModal : true,
			modal: false,
			resize : true,
			width: 450,
			height: &#x27;auto&#x27;,
			dataheight: &#x27;auto&#x27;,
			showQuery: false,
			errorcheck : true,
			sopt: null,
			stringResult: undefined,
			onClose : null,
			onSearch : null,
			onReset : null,
			toTop : true,
			overlay : 30,
			columns : [],
			tmplNames : null,
			tmplFilters : null,
			tmplLabel : &#x27; Template: &#x27;,
			showOnLoad: false,
			layer: null,
			operands : { &quot;eq&quot; :&quot;=&quot;, &quot;ne&quot;:&quot;&lt;&gt;&quot;,&quot;lt&quot;:&quot;&lt;&quot;,&quot;le&quot;:&quot;&lt;=&quot;,&quot;gt&quot;:&quot;&gt;&quot;,&quot;ge&quot;:&quot;&gt;=&quot;,&quot;bw&quot;:&quot;LIKE&quot;,&quot;bn&quot;:&quot;NOT LIKE&quot;,&quot;in&quot;:&quot;IN&quot;,&quot;ni&quot;:&quot;NOT IN&quot;,&quot;ew&quot;:&quot;LIKE&quot;,&quot;en&quot;:&quot;NOT LIKE&quot;,&quot;cn&quot;:&quot;LIKE&quot;,&quot;nc&quot;:&quot;NOT LIKE&quot;,&quot;nu&quot;:&quot;IS NULL&quot;,&quot;nn&quot;:&quot;ISNOT NULL&quot;}
		}, $.jgrid.search, p || {});
		return this.each(function() {
			var $t = this;
			if(!$t.grid) {return;}
			var fid = &quot;fbox_&quot;+$t.p.id,
			showFrm = true,
			mustReload = true,
			IDs = {themodal:&#x27;searchmod&#x27;+fid,modalhead:&#x27;searchhd&#x27;+fid,modalcontent:&#x27;searchcnt&#x27;+fid, scrollelm : fid},
			defaultFilters  = $t.p.postData[p.sFilter];
			if(typeof defaultFilters === &quot;string&quot;) {
				defaultFilters = $.jgrid.parse( defaultFilters );
			}
			if(p.recreateFilter === true) {
				$(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).remove();
			}
			function showFilter(_filter) {
				showFrm = $($t).triggerHandler(&quot;jqGridFilterBeforeShow&quot;, [_filter]);
				if(showFrm === undefined) {
					showFrm = true;
				}
				if(showFrm &amp;&amp; $.isFunction(p.beforeShowSearch)) {
					showFrm = p.beforeShowSearch.call($t,_filter);
				}
				if(showFrm) {
					$.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(fid),jqm:p.jqModal, modal:p.modal, overlay: p.overlay, toTop: p.toTop});
					$($t).triggerHandler(&quot;jqGridFilterAfterShow&quot;, [_filter]);
					if($.isFunction(p.afterShowSearch)) {
						p.afterShowSearch.call($t, _filter);
					}
				}
			}
			if ( $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal))[0] !== undefined ) {
				showFilter($(&quot;#fbox_&quot;+$.jgrid.jqID(+$t.p.id)));
			} else {
				var fil = $(&quot;&lt;div&gt;&lt;div id=&#x27;&quot;+fid+&quot;&#x27; class=&#x27;searchFilter&#x27; style=&#x27;overflow:auto&#x27;&gt;&lt;/div&gt;&lt;/div&gt;&quot;).insertBefore(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)),
				align = &quot;left&quot;, butleft =&quot;&quot;;
				if($t.p.direction === &quot;rtl&quot;) {
					align = &quot;right&quot;;
					butleft = &quot; style=&#x27;text-align:left&#x27;&quot;;
					fil.attr(&quot;dir&quot;,&quot;rtl&quot;);
				}
				var columns = $.extend([],$t.p.colModel),
				bS  =&quot;&lt;a id=&#x27;&quot;+fid+&quot;_search&#x27; class=&#x27;fm-button ui-state-default ui-corner-all fm-button-icon-right ui-reset&#x27;&gt;&lt;span class=&#x27;ui-icon ui-icon-search&#x27;&gt;&lt;/span&gt;&quot;+p.Find+&quot;&lt;/a&gt;&quot;,
				bC  =&quot;&lt;a id=&#x27;&quot;+fid+&quot;_reset&#x27; class=&#x27;fm-button ui-state-default ui-corner-all fm-button-icon-left ui-search&#x27;&gt;&lt;span class=&#x27;ui-icon ui-icon-arrowreturnthick-1-w&#x27;&gt;&lt;/span&gt;&quot;+p.Reset+&quot;&lt;/a&gt;&quot;,
				bQ = &quot;&quot;, tmpl=&quot;&quot;, colnm, found = false, bt, cmi=-1;
				if(p.showQuery) {
					bQ =&quot;&lt;a id=&#x27;&quot;+fid+&quot;_query&#x27; class=&#x27;fm-button ui-state-default ui-corner-all fm-button-icon-left&#x27;&gt;&lt;span class=&#x27;ui-icon ui-icon-comment&#x27;&gt;&lt;/span&gt;Query&lt;/a&gt;&quot;;
				}
				if(!p.columns.length) {
					$.each(columns, function(i,n){
						if(!n.label) {
							n.label = $t.p.colNames[i];
						}
						// find first searchable column and set it if no default filter
						if(!found) {
							var searchable = (n.search === undefined) ?  true: n.search ,
							hidden = (n.hidden === true),
							ignoreHiding = (n.searchoptions &amp;&amp; n.searchoptions.searchhidden === true);
							if ((ignoreHiding &amp;&amp; searchable) || (searchable &amp;&amp; !hidden)) {
								found = true;
								colnm = n.index || n.name;
								cmi =i;
							}
						}
					});
				} else {
					columns = p.columns;
					cmi = 0;
					colnm = columns[0].index || columns[0].name;
				}
				// old behaviour
				if( (!defaultFilters &amp;&amp; colnm) || p.multipleSearch === false  ) {
					var cmop = &quot;eq&quot;;
					if(cmi &gt;=0 &amp;&amp; columns[cmi].searchoptions &amp;&amp; columns[cmi].searchoptions.sopt) {
						cmop = columns[cmi].searchoptions.sopt[0];
					} else if(p.sopt &amp;&amp; p.sopt.length) {
						cmop = p.sopt[0];
					}
					defaultFilters = {groupOp: &quot;AND&quot;, rules: [{field: colnm, op: cmop, data: &quot;&quot;}]};
				}
				found = false;
				if(p.tmplNames &amp;&amp; p.tmplNames.length) {
					found = true;
					tmpl = p.tmplLabel;
					tmpl += &quot;&lt;select class=&#x27;ui-template&#x27;&gt;&quot;;
					tmpl += &quot;&lt;option value=&#x27;default&#x27;&gt;Default&lt;/option&gt;&quot;;
					$.each(p.tmplNames, function(i,n){
						tmpl += &quot;&lt;option value=&#x27;&quot;+i+&quot;&#x27;&gt;&quot;+n+&quot;&lt;/option&gt;&quot;;
					});
					tmpl += &quot;&lt;/select&gt;&quot;;
				}

				bt = &quot;&lt;table class=&#x27;EditTable&#x27; style=&#x27;border:0px none;margin-top:5px&#x27; id=&#x27;&quot;+fid+&quot;_2&#x27;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td colspan=&#x27;2&#x27;&gt;&lt;hr class=&#x27;ui-widget-content&#x27; style=&#x27;margin:1px&#x27;/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#x27;EditButton&#x27; style=&#x27;text-align:&quot;+align+&quot;&#x27;&gt;&quot;+bC+tmpl+&quot;&lt;/td&gt;&lt;td class=&#x27;EditButton&#x27; &quot;+butleft+&quot;&gt;&quot;+bQ+bS+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;;
				fid = $.jgrid.jqID( fid);
				$(&quot;#&quot;+fid).jqFilter({
					columns : columns,
					filter: p.loadDefaults ? defaultFilters : null,
					showQuery: p.showQuery,
					errorcheck : p.errorcheck,
					sopt: p.sopt,
					groupButton : p.multipleGroup,
					ruleButtons : p.multipleSearch,
					afterRedraw : p.afterRedraw,
					ops : p.odata,
					operands : p.operands,
					ajaxSelectOptions: $t.p.ajaxSelectOptions,
					groupOps: p.groupOps,
					onChange : function() {
						if(this.p.showQuery) {
							$(&#x27;.query&#x27;,this).html(this.toUserFriendlyString());
						}
						if ($.isFunction(p.afterChange)) {
							p.afterChange.call($t, $(&quot;#&quot;+fid), p);
						}
					},
					direction : $t.p.direction,
					id: $t.p.id
				});
				fil.append( bt );
				if(found &amp;&amp; p.tmplFilters &amp;&amp; p.tmplFilters.length) {
					$(&quot;.ui-template&quot;, fil).bind(&#x27;change&#x27;, function(){
						var curtempl = $(this).val();
						if(curtempl===&quot;default&quot;) {
							$(&quot;#&quot;+fid).jqFilter(&#x27;addFilter&#x27;, defaultFilters);
						} else {
							$(&quot;#&quot;+fid).jqFilter(&#x27;addFilter&#x27;, p.tmplFilters[parseInt(curtempl,10)]);
						}
						return false;
					});
				}
				if(p.multipleGroup === true) {p.multipleSearch = true;}
				$($t).triggerHandler(&quot;jqGridFilterInitialize&quot;, [$(&quot;#&quot;+fid)]);
				if($.isFunction(p.onInitializeSearch) ) {
					p.onInitializeSearch.call($t, $(&quot;#&quot;+fid));
				}
				p.gbox = &quot;#gbox_&quot;+fid;
				if (p.layer) {
					$.jgrid.createModal(IDs ,fil,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id))[0], &quot;#&quot;+$.jgrid.jqID(p.layer), {position: &quot;relative&quot;});
				} else {
					$.jgrid.createModal(IDs ,fil,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id))[0]);
				}
				if (p.searchOnEnter || p.closeOnEscape) {
					$(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).keydown(function (e) {
						var $target = $(e.target);
						if (p.searchOnEnter &amp;&amp; e.which === 13 &amp;&amp; // 13 === $.ui.keyCode.ENTER
								!$target.hasClass(&#x27;add-group&#x27;) &amp;&amp; !$target.hasClass(&#x27;add-rule&#x27;) &amp;&amp;
								!$target.hasClass(&#x27;delete-group&#x27;) &amp;&amp; !$target.hasClass(&#x27;delete-rule&#x27;) &amp;&amp;
								(!$target.hasClass(&quot;fm-button&quot;) || !$target.is(&quot;[id$=_query]&quot;))) {
							$(&quot;#&quot;+fid+&quot;_search&quot;).click();
							return false;
						}
						if (p.closeOnEscape &amp;&amp; e.which === 27) { // 27 === $.ui.keyCode.ESCAPE
							$(&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).find(&quot;.ui-jqdialog-titlebar-close&quot;).click();
							return false;
						}
					});
				}
				if(bQ) {
					$(&quot;#&quot;+fid+&quot;_query&quot;).bind(&#x27;click&#x27;, function(){
						$(&quot;.queryresult&quot;, fil).toggle();
						return false;
					});
				}
				if (p.stringResult===undefined) {
					// to provide backward compatibility, inferring stringResult value from multipleSearch
					p.stringResult = p.multipleSearch;
				}
				$(&quot;#&quot;+fid+&quot;_search&quot;).bind(&#x27;click&#x27;, function(){
					var fl = $(&quot;#&quot;+fid), sdata={}, res, filters;
					fl.find(&quot;.input-elm:focus&quot;).change();
					filters = fl.jqFilter(&#x27;filterData&#x27;);
					if(p.errorcheck) {
						fl[0].hideError();
						if(!p.showQuery) {fl.jqFilter(&#x27;toSQLString&#x27;);}
						if(fl[0].p.error) {
							fl[0].showError();
							return false;
						}
					}

					if(p.stringResult) {
						try {
							// xmlJsonClass or JSON.stringify
							res = xmlJsonClass.toJson(filters, &#x27;&#x27;, &#x27;&#x27;, false);
						} catch (e) {
							try {
								res = JSON.stringify(filters);
							} catch (e2) { }
						}
						if(typeof res===&quot;string&quot;) {
							sdata[p.sFilter] = res;
							$.each([p.sField,p.sValue, p.sOper], function() {sdata[this] = &quot;&quot;;});
						}
					} else {
						if(p.multipleSearch) {
							sdata[p.sFilter] = filters;
							$.each([p.sField,p.sValue, p.sOper], function() {sdata[this] = &quot;&quot;;});
						} else {
							sdata[p.sField] = filters.rules[0].field;
							sdata[p.sValue] = filters.rules[0].data;
							sdata[p.sOper] = filters.rules[0].op;
							sdata[p.sFilter] = &quot;&quot;;
						}
					}
					$t.p.search = true;
					$.extend($t.p.postData,sdata);
					mustReload = $($t).triggerHandler(&quot;jqGridFilterSearch&quot;);
					if( mustReload === undefined) {
						mustReload = true;
					}
					if(mustReload &amp;&amp; $.isFunction(p.onSearch) ) {
						mustReload = p.onSearch.call($t, $t.p.filters);
					}
					if (mustReload !== false) {
						$($t).trigger(&quot;reloadGrid&quot;,[{page:1}]);
					}
					if(p.closeAfterSearch) {
						$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:p.jqModal,onClose: p.onClose});
					}
					return false;
				});
				$(&quot;#&quot;+fid+&quot;_reset&quot;).bind(&#x27;click&#x27;, function(){
					var sdata={},
					fl = $(&quot;#&quot;+fid);
					$t.p.search = false;
					$t.p.resetsearch =  true;
					if(p.multipleSearch===false) {
						sdata[p.sField] = sdata[p.sValue] = sdata[p.sOper] = &quot;&quot;;
					} else {
						sdata[p.sFilter] = &quot;&quot;;
					}
					fl[0].resetFilter();
					if(found) {
						$(&quot;.ui-template&quot;, fil).val(&quot;default&quot;);
					}
					$.extend($t.p.postData,sdata);
					mustReload = $($t).triggerHandler(&quot;jqGridFilterReset&quot;);
					if(mustReload === undefined) {
						mustReload = true;
					}
					if(mustReload &amp;&amp; $.isFunction(p.onReset) ) {
						mustReload = p.onReset.call($t);
					}
					if(mustReload !== false) {
						$($t).trigger(&quot;reloadGrid&quot;,[{page:1}]);
					}
					if (p.closeAfterReset) {
						$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:p.jqModal,onClose: p.onClose});
					}
					return false;
				});
				showFilter($(&quot;#&quot;+fid));
				$(&quot;.fm-button:not(.ui-state-disabled)&quot;,fil).hover(
					function(){$(this).addClass(&#x27;ui-state-hover&#x27;);},
					function(){$(this).removeClass(&#x27;ui-state-hover&#x27;);}
				);
			}
		});
	},
	editGridRow : function(rowid, p){
		p = $.extend(true, {
			top : 0,
			left: 0,
			width: 300,
			datawidth: &#x27;auto&#x27;,
			height: &#x27;auto&#x27;,
			dataheight: &#x27;auto&#x27;,
			modal: false,
			overlay : 30,
			drag: true,
			resize: true,
			url: null,
			mtype : &quot;POST&quot;,
			clearAfterAdd :true,
			closeAfterEdit : false,
			reloadAfterSubmit : true,
			onInitializeForm: null,
			beforeInitData: null,
			beforeShowForm: null,
			afterShowForm: null,
			beforeSubmit: null,
			afterSubmit: null,
			onclickSubmit: null,
			afterComplete: null,
			onclickPgButtons : null,
			afterclickPgButtons: null,
			editData : {},
			recreateForm : false,
			jqModal : true,
			closeOnEscape : false,
			addedrow : &quot;first&quot;,
			topinfo : &#x27;&#x27;,
			bottominfo: &#x27;&#x27;,
			saveicon : [],
			closeicon : [],
			savekey: [false,13],
			navkeys: [false,38,40],
			checkOnSubmit : false,
			checkOnUpdate : false,
			_savedData : {},
			processing : false,
			onClose : null,
			ajaxEditOptions : {},
			serializeEditData : null,
			viewPagerButtons : true,
			overlayClass : &#x27;ui-widget-overlay&#x27;
		}, $.jgrid.edit, p || {});
		rp_ge[$(this)[0].p.id] = p;
		return this.each(function(){
			var $t = this;
			if (!$t.grid || !rowid) {return;}
			var gID = $t.p.id,
			frmgr = &quot;FrmGrid_&quot;+gID, frmtborg = &quot;TblGrid_&quot;+gID, frmtb = &quot;#&quot;+$.jgrid.jqID(frmtborg),
			IDs = {themodal:&#x27;editmod&#x27;+gID,modalhead:&#x27;edithd&#x27;+gID,modalcontent:&#x27;editcnt&#x27;+gID, scrollelm : frmgr},
			onBeforeShow = $.isFunction(rp_ge[$t.p.id].beforeShowForm) ? rp_ge[$t.p.id].beforeShowForm : false,
			onAfterShow = $.isFunction(rp_ge[$t.p.id].afterShowForm) ? rp_ge[$t.p.id].afterShowForm : false,
			onBeforeInit = $.isFunction(rp_ge[$t.p.id].beforeInitData) ? rp_ge[$t.p.id].beforeInitData : false,
			onInitializeForm = $.isFunction(rp_ge[$t.p.id].onInitializeForm) ? rp_ge[$t.p.id].onInitializeForm : false,
			showFrm = true,
			maxCols = 1, maxRows=0,	postdata, diff, frmoper;
			frmgr = $.jgrid.jqID(frmgr);
			if (rowid === &quot;new&quot;) {
				rowid = &quot;_empty&quot;;
				frmoper = &quot;add&quot;;
				p.caption=rp_ge[$t.p.id].addCaption;
			} else {
				p.caption=rp_ge[$t.p.id].editCaption;
				frmoper = &quot;edit&quot;;
			}
			if(!p.recreateForm) {
				if( $($t).data(&quot;formProp&quot;) ) {
					$.extend(rp_ge[$(this)[0].p.id], $($t).data(&quot;formProp&quot;));
				}
			}
			var closeovrl = true;
			if(p.checkOnUpdate &amp;&amp; p.jqModal &amp;&amp; !p.modal) {
				closeovrl = false;
			}
			function getFormData(){
				$(frmtb+&quot; &gt; tbody &gt; tr &gt; td &gt; .FormElement&quot;).each(function() {
					var celm = $(&quot;.customelement&quot;, this);
					if (celm.length) {
						var  elem = celm[0], nm = $(elem).attr(&#x27;name&#x27;);
						$.each($t.p.colModel, function(){
							if(this.name === nm &amp;&amp; this.editoptions &amp;&amp; $.isFunction(this.editoptions.custom_value)) {
								try {
									postdata[nm] = this.editoptions.custom_value.call($t, $(&quot;#&quot;+$.jgrid.jqID(nm),frmtb),&#x27;get&#x27;);
									if (postdata[nm] === undefined) {throw &quot;e1&quot;;}
								} catch (e) {
									if (e===&quot;e1&quot;) {$.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function &#x27;custom_value&#x27; &quot;+$.jgrid.edit.msg.novalue,$.jgrid.edit.bClose);}
									else {$.jgrid.info_dialog($.jgrid.errors.errcap,e.message,$.jgrid.edit.bClose);}
								}
								return true;
							}
						});
					} else {
					switch ($(this).get(0).type) {
						case &quot;checkbox&quot;:
							if($(this).is(&quot;:checked&quot;)) {
								postdata[this.name]= $(this).val();
							}else {
								var ofv = $(this).attr(&quot;offval&quot;);
								postdata[this.name]= ofv;
							}
						break;
						case &quot;select-one&quot;:
							postdata[this.name]= $(&quot;option:selected&quot;,this).val();
						break;
						case &quot;select-multiple&quot;:
							postdata[this.name]= $(this).val();
							if(postdata[this.name]) {postdata[this.name] = postdata[this.name].join(&quot;,&quot;);}
							else {postdata[this.name] =&quot;&quot;;}
							var selectedText = [];
							$(&quot;option:selected&quot;,this).each(
								function(i,selected){
									selectedText[i] = $(selected).text();
								}
							);
						break;
						case &quot;password&quot;:
						case &quot;text&quot;:
						case &quot;textarea&quot;:
						case &quot;button&quot;:
							postdata[this.name] = $(this).val();

						break;
					}
					if($t.p.autoencode) {postdata[this.name] = $.jgrid.htmlEncode(postdata[this.name]);}
					}
				});
				return true;
			}
			function createData(rowid,obj,tb,maxcols){
				var nm, hc,trdata, cnt=0,tmp, dc,elc, retpos=[], ind=false,
				tdtmpl = &quot;&lt;td class=&#x27;CaptionTD&#x27;&gt;&amp;#160;&lt;/td&gt;&lt;td class=&#x27;DataTD&#x27;&gt;&amp;#160;&lt;/td&gt;&quot;, tmpl=&quot;&quot;, i; //*2
				for (i =1; i&lt;=maxcols;i++) {
					tmpl += tdtmpl;
				}
				if(rowid !== &#x27;_empty&#x27;) {
					ind = $(obj).jqGrid(&quot;getInd&quot;,rowid);
				}
				$(obj.p.colModel).each( function(i) {
					nm = this.name;
					// hidden fields are included in the form
					if(this.editrules &amp;&amp; this.editrules.edithidden === true) {
						hc = false;
					} else {
						hc = this.hidden === true ? true : false;
					}
					dc = hc ? &quot;style=&#x27;display:none&#x27;&quot; : &quot;&quot;;
					if ( nm !== &#x27;cb&#x27; &amp;&amp; nm !== &#x27;subgrid&#x27; &amp;&amp; this.editable===true &amp;&amp; nm !== &#x27;rn&#x27;) {
						if(ind === false) {
							tmp = &quot;&quot;;
						} else {
							if(nm === obj.p.ExpandColumn &amp;&amp; obj.p.treeGrid === true) {
								tmp = $(&quot;td[role=&#x27;gridcell&#x27;]:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).text();
							} else {
								try {
									tmp =  $.unformat.call(obj, $(&quot;td[role=&#x27;gridcell&#x27;]:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]),{rowId:rowid, colModel:this},i);
								} catch (_) {
									tmp =  (this.edittype &amp;&amp; this.edittype === &quot;textarea&quot;) ? $(&quot;td[role=&#x27;gridcell&#x27;]:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).text() : $(&quot;td[role=&#x27;gridcell&#x27;]:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).html();
								}
								if(!tmp || tmp === &quot;&amp;nbsp;&quot; || tmp === &quot;&amp;#160;&quot; || (tmp.length===1 &amp;&amp; tmp.charCodeAt(0)===160) ) {tmp=&#x27;&#x27;;}
							}
						}
						var opt = $.extend({}, this.editoptions || {} ,{id:nm,name:nm}),
						frmopt = $.extend({}, {elmprefix:&#x27;&#x27;,elmsuffix:&#x27;&#x27;,rowabove:false,rowcontent:&#x27;&#x27;}, this.formoptions || {}),
						rp = parseInt(frmopt.rowpos,10) || cnt+1,
						cp = parseInt((parseInt(frmopt.colpos,10) || 1)*2,10);
						if(rowid === &quot;_empty&quot; &amp;&amp; opt.defaultValue ) {
							tmp = $.isFunction(opt.defaultValue) ? opt.defaultValue.call($t) : opt.defaultValue;
						}
						if(!this.edittype) {this.edittype = &quot;text&quot;;}
						if($t.p.autoencode) {tmp = $.jgrid.htmlDecode(tmp);}
						elc = $.jgrid.createEl.call($t,this.edittype,opt,tmp,false,$.extend({},$.jgrid.ajaxOptions,obj.p.ajaxSelectOptions || {}));
						//if(tmp === &quot;&quot; &amp;&amp; this.edittype == &quot;checkbox&quot;) {tmp = $(elc).attr(&quot;offval&quot;);}
						//if(tmp === &quot;&quot; &amp;&amp; this.edittype == &quot;select&quot;) {tmp = $(&quot;option:eq(0)&quot;,elc).text();}
						if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData[nm] = tmp;}
						$(elc).addClass(&quot;FormElement&quot;);
						if( $.inArray(this.edittype, [&#x27;text&#x27;,&#x27;textarea&#x27;,&#x27;password&#x27;,&#x27;select&#x27;]) &gt; -1) {
							$(elc).addClass(&quot;ui-widget-content ui-corner-all&quot;);
						}
						trdata = $(tb).find(&quot;tr[rowpos=&quot;+rp+&quot;]&quot;);
						if(frmopt.rowabove) {
							var newdata = $(&quot;&lt;tr&gt;&lt;td class=&#x27;contentinfo&#x27; colspan=&#x27;&quot;+(maxcols*2)+&quot;&#x27;&gt;&quot;+frmopt.rowcontent+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
							$(tb).append(newdata);
							newdata[0].rp = rp;
						}
						if ( trdata.length===0 ) {
							trdata = $(&quot;&lt;tr &quot;+dc+&quot; rowpos=&#x27;&quot;+rp+&quot;&#x27;&gt;&lt;/tr&gt;&quot;).addClass(&quot;FormData&quot;).attr(&quot;id&quot;,&quot;tr_&quot;+nm);
							$(trdata).append(tmpl);
							$(tb).append(trdata);
							trdata[0].rp = rp;
						}
						$(&quot;td:eq(&quot;+(cp-2)+&quot;)&quot;,trdata[0]).html(frmopt.label === undefined ? obj.p.colNames[i]: frmopt.label);
						$(&quot;td:eq(&quot;+(cp-1)+&quot;)&quot;,trdata[0]).append(frmopt.elmprefix).append(elc).append(frmopt.elmsuffix);
						if(this.edittype===&#x27;custom&#x27; &amp;&amp; $.isFunction(opt.custom_value) ) {
							opt.custom_value.call($t, $(&quot;#&quot;+nm,&quot;#&quot;+frmgr),&#x27;set&#x27;,tmp);
						}
						$.jgrid.bindEv.call($t, elc, opt);
						retpos[cnt] = i;
						cnt++;
					}
				});
				if( cnt &gt; 0) {
					var idrow = $(&quot;&lt;tr class=&#x27;FormData&#x27; style=&#x27;display:none&#x27;&gt;&lt;td class=&#x27;CaptionTD&#x27;&gt;&lt;/td&gt;&lt;td colspan=&#x27;&quot;+ (maxcols*2-1)+&quot;&#x27; class=&#x27;DataTD&#x27;&gt;&lt;input class=&#x27;FormElement&#x27; id=&#x27;id_g&#x27; type=&#x27;text&#x27; name=&#x27;&quot;+obj.p.id+&quot;_id&#x27; value=&#x27;&quot;+rowid+&quot;&#x27;/&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
					idrow[0].rp = cnt+999;
					$(tb).append(idrow);
					if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData[obj.p.id+&quot;_id&quot;] = rowid;}
				}
				return retpos;
			}
			function fillData(rowid,obj,fmid){
				var nm,cnt=0,tmp, fld,opt,vl,vlc;
				if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData = {};rp_ge[$t.p.id]._savedData[obj.p.id+&quot;_id&quot;]=rowid;}
				var cm = obj.p.colModel;
				if(rowid === &#x27;_empty&#x27;) {
					$(cm).each(function(){
						nm = this.name;
						opt = $.extend({}, this.editoptions || {} );
						fld = $(&quot;#&quot;+$.jgrid.jqID(nm),&quot;#&quot;+fmid);
						if(fld &amp;&amp; fld.length &amp;&amp; fld[0] !== null) {
							vl = &quot;&quot;;
							if(this.edittype === &#x27;custom&#x27; &amp;&amp; $.isFunction(opt.custom_value)) {
								opt.custom_value.call($t, $(&quot;#&quot;+nm,&quot;#&quot;+fmid),&#x27;set&#x27;,vl);
							} else if(opt.defaultValue ) {
								vl = $.isFunction(opt.defaultValue) ? opt.defaultValue.call($t) : opt.defaultValue;
								if(fld[0].type===&#x27;checkbox&#x27;) {
									vlc = vl.toLowerCase();
									if(vlc.search(/(false|f|0|no|n|off|undefined)/i)&lt;0 &amp;&amp; vlc!==&quot;&quot;) {
										fld[0].checked = true;
										fld[0].defaultChecked = true;
										fld[0].value = vl;
									} else {
										fld[0].checked = false;
										fld[0].defaultChecked = false;
									}
								} else {fld.val(vl);}
							} else {
								if( fld[0].type===&#x27;checkbox&#x27; ) {
									fld[0].checked = false;
									fld[0].defaultChecked = false;
									vl = $(fld).attr(&quot;offval&quot;);
								} else if (fld[0].type &amp;&amp; fld[0].type.substr(0,6)===&#x27;select&#x27;) {
									fld[0].selectedIndex = 0;
								} else {
									fld.val(vl);
								}
							}
							if(rp_ge[$t.p.id].checkOnSubmit===true || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData[nm] = vl;}
						}
					});
					$(&quot;#id_g&quot;,&quot;#&quot;+fmid).val(rowid);
					return;
				}
				var tre = $(obj).jqGrid(&quot;getInd&quot;,rowid,true);
				if(!tre) {return;}
				$(&#x27;td[role=&quot;gridcell&quot;]&#x27;,tre).each( function(i) {
					nm = cm[i].name;
					// hidden fields are included in the form
					if ( nm !== &#x27;cb&#x27; &amp;&amp; nm !== &#x27;subgrid&#x27; &amp;&amp; nm !== &#x27;rn&#x27; &amp;&amp; cm[i].editable===true) {
						if(nm === obj.p.ExpandColumn &amp;&amp; obj.p.treeGrid === true) {
							tmp = $(this).text();
						} else {
							try {
								tmp =  $.unformat.call(obj, $(this),{rowId:rowid, colModel:cm[i]},i);
							} catch (_) {
								tmp = cm[i].edittype===&quot;textarea&quot; ? $(this).text() : $(this).html();
							}
						}
						if($t.p.autoencode) {tmp = $.jgrid.htmlDecode(tmp);}
						if(rp_ge[$t.p.id].checkOnSubmit===true || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData[nm] = tmp;}
						nm = $.jgrid.jqID(nm);
						switch (cm[i].edittype) {
							case &quot;password&quot;:
							case &quot;text&quot;:
							case &quot;button&quot; :
							case &quot;image&quot;:
							case &quot;textarea&quot;:
								if(tmp === &quot;&amp;nbsp;&quot; || tmp === &quot;&amp;#160;&quot; || (tmp.length===1 &amp;&amp; tmp.charCodeAt(0)===160) ) {tmp=&#x27;&#x27;;}
								$(&quot;#&quot;+nm,&quot;#&quot;+fmid).val(tmp);
								break;
							case &quot;select&quot;:
								var opv = tmp.split(&quot;,&quot;);
								opv = $.map(opv,function(n){return $.trim(n);});
								$(&quot;#&quot;+nm+&quot; option&quot;,&quot;#&quot;+fmid).each(function(){
									if (!cm[i].editoptions.multiple &amp;&amp; ($.trim(tmp) === $.trim($(this).text()) || opv[0] === $.trim($(this).text()) || opv[0] === $.trim($(this).val())) ){
										this.selected= true;
									} else if (cm[i].editoptions.multiple){
										if(  $.inArray($.trim($(this).text()), opv ) &gt; -1 || $.inArray($.trim($(this).val()), opv ) &gt; -1  ){
											this.selected = true;
										}else{
											this.selected = false;
										}
									} else {
										this.selected = false;
									}
								});
								break;
							case &quot;checkbox&quot;:
								tmp = String(tmp);
								if(cm[i].editoptions &amp;&amp; cm[i].editoptions.value) {
									var cb = cm[i].editoptions.value.split(&quot;:&quot;);
									if(cb[0] === tmp) {
										$(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;]({&quot;checked&quot;:true, &quot;defaultChecked&quot; : true});
									} else {
										$(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;]({&quot;checked&quot;:false, &quot;defaultChecked&quot; : false});
									}
								} else {
									tmp = tmp.toLowerCase();
									if(tmp.search(/(false|f|0|no|n|off|undefined)/i)&lt;0 &amp;&amp; tmp!==&quot;&quot;) {
										$(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;,true);
										$(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;defaultChecked&quot;,true); //ie
									} else {
										$(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;, false);
										$(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;defaultChecked&quot;, false); //ie
									}
								}
								break;
							case &#x27;custom&#x27; :
								try {
									if(cm[i].editoptions &amp;&amp; $.isFunction(cm[i].editoptions.custom_value)) {
										cm[i].editoptions.custom_value.call($t, $(&quot;#&quot;+nm,&quot;#&quot;+fmid),&#x27;set&#x27;,tmp);
									} else {throw &quot;e1&quot;;}
								} catch (e) {
									if (e===&quot;e1&quot;) {$.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function &#x27;custom_value&#x27; &quot;+$.jgrid.edit.msg.nodefined,$.jgrid.edit.bClose);}
									else {$.jgrid.info_dialog($.jgrid.errors.errcap,e.message,$.jgrid.edit.bClose);}
								}
								break;
						}
						cnt++;
					}
				});
				if(cnt&gt;0) {$(&quot;#id_g&quot;,frmtb).val(rowid);}
			}
			function setNulls() {
				$.each($t.p.colModel, function(i,n){
					if(n.editoptions &amp;&amp; n.editoptions.NullIfEmpty === true) {
						if(postdata.hasOwnProperty(n.name) &amp;&amp; postdata[n.name] === &quot;&quot;) {
							postdata[n.name] = &#x27;null&#x27;;
						}
					}
				});
			}
			function postIt() {
				var copydata, ret=[true,&quot;&quot;,&quot;&quot;], onCS = {}, opers = $t.p.prmNames, idname, oper, key, selr, i;

				var retvals = $($t).triggerHandler(&quot;jqGridAddEditBeforeCheckValues&quot;, [$(&quot;#&quot;+frmgr), frmoper]);
				if(retvals &amp;&amp; typeof retvals === &#x27;object&#x27;) {postdata = retvals;}

				if($.isFunction(rp_ge[$t.p.id].beforeCheckValues)) {
					retvals = rp_ge[$t.p.id].beforeCheckValues.call($t, postdata,$(&quot;#&quot;+frmgr),frmoper);
					if(retvals &amp;&amp; typeof retvals === &#x27;object&#x27;) {postdata = retvals;}
				}
				for( key in postdata ){
					if(postdata.hasOwnProperty(key)) {
						ret = $.jgrid.checkValues.call($t,postdata[key],key);
						if(ret[0] === false) {break;}
					}
				}
				setNulls();
				if(ret[0]) {
					onCS = $($t).triggerHandler(&quot;jqGridAddEditClickSubmit&quot;, [rp_ge[$t.p.id], postdata, frmoper]);
					if( onCS === undefined &amp;&amp; $.isFunction( rp_ge[$t.p.id].onclickSubmit)) {
						onCS = rp_ge[$t.p.id].onclickSubmit.call($t, rp_ge[$t.p.id], postdata, frmoper) || {};
					}
					ret = $($t).triggerHandler(&quot;jqGridAddEditBeforeSubmit&quot;, [postdata, $(&quot;#&quot;+frmgr), frmoper]);
					if(ret === undefined) {
						ret = [true,&quot;&quot;,&quot;&quot;];
					}
					if( ret[0] &amp;&amp; $.isFunction(rp_ge[$t.p.id].beforeSubmit))  {
						ret = rp_ge[$t.p.id].beforeSubmit.call($t,postdata,$(&quot;#&quot;+frmgr), frmoper);
					}
				}

				if(ret[0] &amp;&amp; !rp_ge[$t.p.id].processing) {
					rp_ge[$t.p.id].processing = true;
					$(&quot;#sData&quot;, frmtb+&quot;_2&quot;).addClass(&#x27;ui-state-active&#x27;);
					oper = opers.oper;
					idname = opers.id;
					// we add to pos data array the action - the name is oper
					postdata[oper] = ($.trim(postdata[$t.p.id+&quot;_id&quot;]) === &quot;_empty&quot;) ? opers.addoper : opers.editoper;
					if(postdata[oper] !== opers.addoper) {
						postdata[idname] = postdata[$t.p.id+&quot;_id&quot;];
					} else {
						// check to see if we have allredy this field in the form and if yes lieve it
						if( postdata[idname] === undefined ) {postdata[idname] = postdata[$t.p.id+&quot;_id&quot;];}
					}
					delete postdata[$t.p.id+&quot;_id&quot;];
					postdata = $.extend(postdata,rp_ge[$t.p.id].editData,onCS);
					if($t.p.treeGrid === true)  {
						if(postdata[oper] === opers.addoper) {
						selr = $($t).jqGrid(&quot;getGridParam&quot;, &#x27;selrow&#x27;);
							var tr_par_id = $t.p.treeGridModel === &#x27;adjacency&#x27; ? $t.p.treeReader.parent_id_field : &#x27;parent_id&#x27;;
							postdata[tr_par_id] = selr;
						}
						for(i in $t.p.treeReader){
							if($t.p.treeReader.hasOwnProperty(i)) {
								var itm = $t.p.treeReader[i];
								if(postdata.hasOwnProperty(itm)) {
									if(postdata[oper] === opers.addoper &amp;&amp; i === &#x27;parent_id_field&#x27;) {continue;}
									delete postdata[itm];
								}
							}
						}
					}

					postdata[idname] = $.jgrid.stripPref($t.p.idPrefix, postdata[idname]);
					var ajaxOptions = $.extend({
						url: rp_ge[$t.p.id].url || $($t).jqGrid(&#x27;getGridParam&#x27;,&#x27;editurl&#x27;),
						type: rp_ge[$t.p.id].mtype,
						data: $.isFunction(rp_ge[$t.p.id].serializeEditData) ? rp_ge[$t.p.id].serializeEditData.call($t,postdata) :  postdata,
						complete:function(data,status){
							var key;
							postdata[idname] = $t.p.idPrefix + postdata[idname];
							if(data.status &gt;= 300 &amp;&amp; data.status !== 304) {
								ret[0] = false;
								ret[1] = $($t).triggerHandler(&quot;jqGridAddEditErrorTextFormat&quot;, [data, frmoper]);
								if ($.isFunction(rp_ge[$t.p.id].errorTextFormat)) {
									ret[1] = rp_ge[$t.p.id].errorTextFormat.call($t, data, frmoper);
								} else {
									ret[1] = status + &quot; Status: &#x27;&quot; + data.statusText + &quot;&#x27;. Error code: &quot; + data.status;
								}
							} else {
								// data is posted successful
								// execute aftersubmit with the returned data from server
								ret = $($t).triggerHandler(&quot;jqGridAddEditAfterSubmit&quot;, [data, postdata, frmoper]);
								if(ret === undefined) {
									ret = [true,&quot;&quot;,&quot;&quot;];
								}
								if( ret[0] &amp;&amp; $.isFunction(rp_ge[$t.p.id].afterSubmit) ) {
									ret = rp_ge[$t.p.id].afterSubmit.call($t, data,postdata, frmoper);
								}
							}
							if(ret[0] === false) {
								$(&quot;#FormError&gt;td&quot;,frmtb).html(ret[1]);
								$(&quot;#FormError&quot;,frmtb).show();
							} else {
								if($t.p.autoencode) {
									$.each(postdata,function(n,v){
										postdata[n] = $.jgrid.htmlDecode(v);
									});
								}
								//rp_ge[$t.p.id].reloadAfterSubmit = rp_ge[$t.p.id].reloadAfterSubmit &amp;&amp; $t.p.datatype != &quot;local&quot;;
								// the action is add
								if(postdata[oper] === opers.addoper ) {
									//id processing
									// user not set the id ret[2]
									if(!ret[2]) {ret[2] = $.jgrid.randId();}
									postdata[idname] = ret[2];
									if(rp_ge[$t.p.id].reloadAfterSubmit) {
										$($t).trigger(&quot;reloadGrid&quot;);
									} else {
										if($t.p.treeGrid === true){
											$($t).jqGrid(&quot;addChildNode&quot;,ret[2],selr,postdata );
										} else {
											$($t).jqGrid(&quot;addRowData&quot;,ret[2],postdata,p.addedrow);
										}
									}
									if(rp_ge[$t.p.id].closeAfterAdd) {
										if($t.p.treeGrid !== true){
											$($t).jqGrid(&quot;setSelection&quot;,ret[2]);
										}
										$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose});
									} else if (rp_ge[$t.p.id].clearAfterAdd) {
										fillData(&quot;_empty&quot;,$t,frmgr);
									}
								} else {
									// the action is update
									if(rp_ge[$t.p.id].reloadAfterSubmit) {
										$($t).trigger(&quot;reloadGrid&quot;);
										if( !rp_ge[$t.p.id].closeAfterEdit ) {setTimeout(function(){$($t).jqGrid(&quot;setSelection&quot;,postdata[idname]);},1000);}
									} else {
										if($t.p.treeGrid === true) {
											$($t).jqGrid(&quot;setTreeRow&quot;, postdata[idname],postdata);
										} else {
											$($t).jqGrid(&quot;setRowData&quot;, postdata[idname],postdata);
										}
									}
									if(rp_ge[$t.p.id].closeAfterEdit) {$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose});}
								}
								if($.isFunction(rp_ge[$t.p.id].afterComplete)) {
									copydata = data;
									setTimeout(function(){
										$($t).triggerHandler(&quot;jqGridAddEditAfterComplete&quot;, [copydata, postdata, $(&quot;#&quot;+frmgr), frmoper]);
										rp_ge[$t.p.id].afterComplete.call($t, copydata, postdata, $(&quot;#&quot;+frmgr), frmoper);
										copydata=null;
									},500);
								}
								if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) {
									$(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false);
									if(rp_ge[$t.p.id]._savedData[$t.p.id+&quot;_id&quot;] !== &quot;_empty&quot;){
										for(key in rp_ge[$t.p.id]._savedData) {
											if(rp_ge[$t.p.id]._savedData.hasOwnProperty(key) &amp;&amp; postdata[key]) {
												rp_ge[$t.p.id]._savedData[key] = postdata[key];
											}
										}
									}
								}
							}
							rp_ge[$t.p.id].processing=false;
							$(&quot;#sData&quot;, frmtb+&quot;_2&quot;).removeClass(&#x27;ui-state-active&#x27;);
							try{$(&#x27;:input:visible&#x27;,&quot;#&quot;+frmgr)[0].focus();} catch (e){}
						}
					}, $.jgrid.ajaxOptions, rp_ge[$t.p.id].ajaxEditOptions );

					if (!ajaxOptions.url &amp;&amp; !rp_ge[$t.p.id].useDataProxy) {
						if ($.isFunction($t.p.dataProxy)) {
							rp_ge[$t.p.id].useDataProxy = true;
						} else {
							ret[0]=false;ret[1] += &quot; &quot;+$.jgrid.errors.nourl;
						}
					}
					if (ret[0]) {
						if (rp_ge[$t.p.id].useDataProxy) {
							var dpret = $t.p.dataProxy.call($t, ajaxOptions, &quot;set_&quot;+$t.p.id);
							if(dpret === undefined) {
								dpret = [true, &quot;&quot;];
							}
							if(dpret[0] === false ) {
								ret[0] = false;
								ret[1] = dpret[1] || &quot;Error deleting the selected row!&quot; ;
							} else {
								if(ajaxOptions.data.oper === opers.addoper &amp;&amp; rp_ge[$t.p.id].closeAfterAdd ) {
									$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose});
								}
								if(ajaxOptions.data.oper === opers.editoper &amp;&amp; rp_ge[$t.p.id].closeAfterEdit ) {
									$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose});
								}
							}
						} else {
							$.ajax(ajaxOptions);
						}
					}
				}
				if(ret[0] === false) {
					$(&quot;#FormError&gt;td&quot;,frmtb).html(ret[1]);
					$(&quot;#FormError&quot;,frmtb).show();
					// return;
				}
			}
			function compareData(nObj, oObj ) {
				var ret = false,key;
				for (key in nObj) {
					if(nObj.hasOwnProperty(key) &amp;&amp; nObj[key] != oObj[key]) {
						ret = true;
						break;
					}
				}
				return ret;
			}
			function checkUpdates () {
				var stat = true;
				$(&quot;#FormError&quot;,frmtb).hide();
				if(rp_ge[$t.p.id].checkOnUpdate) {
					postdata = {};
					getFormData();
					diff = compareData(postdata,rp_ge[$t.p.id]._savedData);
					if(diff) {
						$(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,true);
						$(&quot;.confirm&quot;,&quot;#&quot;+IDs.themodal).show();
						stat = false;
					}
				}
				return stat;
			}
			function restoreInline()
			{
				var i;
				if (rowid !== &quot;_empty&quot; &amp;&amp; $t.p.savedRow !== undefined &amp;&amp; $t.p.savedRow.length &gt; 0 &amp;&amp; $.isFunction($.fn.jqGrid.restoreRow)) {
					for (i=0;i&lt;$t.p.savedRow.length;i++) {
						if ($t.p.savedRow[i].id == rowid) {
							$($t).jqGrid(&#x27;restoreRow&#x27;,rowid);
							break;
						}
					}
				}
			}
			function updateNav(cr, posarr){
				var totr = posarr[1].length-1;
				if (cr===0) {
					$(&quot;#pData&quot;,frmtb+&quot;_2&quot;).addClass(&#x27;ui-state-disabled&#x27;);
				} else if( posarr[1][cr-1] !== undefined &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(posarr[1][cr-1])).hasClass(&#x27;ui-state-disabled&#x27;)) {
						$(&quot;#pData&quot;,frmtb+&quot;_2&quot;).addClass(&#x27;ui-state-disabled&#x27;);
				} else {
					$(&quot;#pData&quot;,frmtb+&quot;_2&quot;).removeClass(&#x27;ui-state-disabled&#x27;);
				}

				if (cr===totr) {
					$(&quot;#nData&quot;,frmtb+&quot;_2&quot;).addClass(&#x27;ui-state-disabled&#x27;);
				} else if( posarr[1][cr+1] !== undefined &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(posarr[1][cr+1])).hasClass(&#x27;ui-state-disabled&#x27;)) {
					$(&quot;#nData&quot;,frmtb+&quot;_2&quot;).addClass(&#x27;ui-state-disabled&#x27;);
				} else {
					$(&quot;#nData&quot;,frmtb+&quot;_2&quot;).removeClass(&#x27;ui-state-disabled&#x27;);
				}
			}
			function getCurrPos() {
				var rowsInGrid = $($t).jqGrid(&quot;getDataIDs&quot;),
				selrow = $(&quot;#id_g&quot;,frmtb).val(),
				pos = $.inArray(selrow,rowsInGrid);
				return [pos,rowsInGrid];
			}

			var dh = isNaN(rp_ge[$(this)[0].p.id].dataheight) ? rp_ge[$(this)[0].p.id].dataheight : rp_ge[$(this)[0].p.id].dataheight+&quot;px&quot;,
			dw = isNaN(rp_ge[$(this)[0].p.id].datawidth) ? rp_ge[$(this)[0].p.id].datawidth : rp_ge[$(this)[0].p.id].datawidth+&quot;px&quot;,
			frm = $(&quot;&lt;form name=&#x27;FormPost&#x27; id=&#x27;&quot;+frmgr+&quot;&#x27; class=&#x27;FormGrid&#x27; onSubmit=&#x27;return false;&#x27; style=&#x27;width:&quot;+dw+&quot;;overflow:auto;position:relative;height:&quot;+dh+&quot;;&#x27;&gt;&lt;/form&gt;&quot;).data(&quot;disabled&quot;,false),
			tbl = $(&quot;&lt;table id=&#x27;&quot;+frmtborg+&quot;&#x27; class=&#x27;EditTable&#x27; cellspacing=&#x27;0&#x27; cellpadding=&#x27;0&#x27; border=&#x27;0&#x27;&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;);
			showFrm = $($t).triggerHandler(&quot;jqGridAddEditBeforeInitData&quot;, [$(&quot;#&quot;+frmgr), frmoper]);
			if(showFrm === undefined) {
				showFrm = true;
			}
			if(showFrm &amp;&amp; onBeforeInit) {
				showFrm = onBeforeInit.call($t,$(&quot;#&quot;+frmgr),frmoper);
			}
			if(showFrm === false) {return;}
			restoreInline();
			$($t.p.colModel).each( function() {
				var fmto = this.formoptions;
				maxCols = Math.max(maxCols, fmto ? fmto.colpos || 0 : 0 );
				maxRows = Math.max(maxRows, fmto ? fmto.rowpos || 0 : 0 );
			});
			$(frm).append(tbl);
			var flr = $(&quot;&lt;tr id=&#x27;FormError&#x27; style=&#x27;display:none&#x27;&gt;&lt;td class=&#x27;ui-state-error&#x27; colspan=&#x27;&quot;+(maxCols*2)+&quot;&#x27;&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
			flr[0].rp = 0;
			$(tbl).append(flr);
			//topinfo
			flr = $(&quot;&lt;tr style=&#x27;display:none&#x27; class=&#x27;tinfo&#x27;&gt;&lt;td class=&#x27;topinfo&#x27; colspan=&#x27;&quot;+(maxCols*2)+&quot;&#x27;&gt;&quot;+rp_ge[$t.p.id].topinfo+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
			flr[0].rp = 0;
			$(tbl).append(flr);
			// set the id.
			// use carefull only to change here colproperties.
			// create data
			var rtlb = $t.p.direction === &quot;rtl&quot; ? true :false,
			bp = rtlb ? &quot;nData&quot; : &quot;pData&quot;,
			bn = rtlb ? &quot;pData&quot; : &quot;nData&quot;;
			createData(rowid,$t,tbl,maxCols);
			// buttons at footer
			var bP = &quot;&lt;a id=&#x27;&quot;+bp+&quot;&#x27; class=&#x27;fm-button ui-state-default ui-corner-left&#x27;&gt;&lt;span class=&#x27;ui-icon ui-icon-triangle-1-w&#x27;&gt;&lt;/span&gt;&lt;/a&gt;&quot;,
			bN = &quot;&lt;a id=&#x27;&quot;+bn+&quot;&#x27; class=&#x27;fm-button ui-state-default ui-corner-right&#x27;&gt;&lt;span class=&#x27;ui-icon ui-icon-triangle-1-e&#x27;&gt;&lt;/span&gt;&lt;/a&gt;&quot;,
			bS  =&quot;&lt;a id=&#x27;sData&#x27; class=&#x27;fm-button ui-state-default ui-corner-all&#x27;&gt;&quot;+p.bSubmit+&quot;&lt;/a&gt;&quot;,
			bC  =&quot;&lt;a id=&#x27;cData&#x27; class=&#x27;fm-button ui-state-default ui-corner-all&#x27;&gt;&quot;+p.bCancel+&quot;&lt;/a&gt;&quot;;
			var bt = &quot;&lt;table border=&#x27;0&#x27; cellspacing=&#x27;0&#x27; cellpadding=&#x27;0&#x27; class=&#x27;EditTable&#x27; id=&#x27;&quot;+frmtborg+&quot;_2&#x27;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td colspan=&#x27;2&#x27;&gt;&lt;hr class=&#x27;ui-widget-content&#x27; style=&#x27;margin:1px&#x27;/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr id=&#x27;Act_Buttons&#x27;&gt;&lt;td class=&#x27;navButton&#x27;&gt;&quot;+(rtlb ? bN+bP : bP+bN)+&quot;&lt;/td&gt;&lt;td class=&#x27;EditButton&#x27;&gt;&quot;+bS+bC+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;;
			bt += &quot;&lt;tr style=&#x27;display:none&#x27; class=&#x27;binfo&#x27;&gt;&lt;td class=&#x27;bottominfo&#x27; colspan=&#x27;2&#x27;&gt;&quot;+rp_ge[$t.p.id].bottominfo+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;;
			bt += &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;;
			if(maxRows &gt;  0) {
				var sd=[];
				$.each($(tbl)[0].rows,function(i,r){
					sd[i] = r;
				});
				sd.sort(function(a,b){
					if(a.rp &gt; b.rp) {return 1;}
					if(a.rp &lt; b.rp) {return -1;}
					return 0;
				});
				$.each(sd, function(index, row) {
					$(&#x27;tbody&#x27;,tbl).append(row);
				});
			}
			p.gbox = &quot;#gbox_&quot;+$.jgrid.jqID(gID);
			var cle = false;
			if(p.closeOnEscape===true){
				p.closeOnEscape = false;
				cle = true;
			}
			var tms = $(&quot;&lt;div&gt;&lt;/div&gt;&quot;).append(frm).append(bt);
			$.jgrid.createModal(IDs,tms, rp_ge[$(this)[0].p.id] ,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id))[0]);
			if(rtlb) {
				$(&quot;#pData, #nData&quot;,frmtb+&quot;_2&quot;).css(&quot;float&quot;,&quot;right&quot;);
				$(&quot;.EditButton&quot;,frmtb+&quot;_2&quot;).css(&quot;text-align&quot;,&quot;left&quot;);
			}
			if(rp_ge[$t.p.id].topinfo) {$(&quot;.tinfo&quot;,frmtb).show();}
			if(rp_ge[$t.p.id].bottominfo) {$(&quot;.binfo&quot;,frmtb+&quot;_2&quot;).show();}
			tms = null;bt=null;
			$(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).keydown( function( e ) {
				var wkey = e.target;
				if ($(&quot;#&quot;+frmgr).data(&quot;disabled&quot;)===true ) {return false;}//??
				if(rp_ge[$t.p.id].savekey[0] === true &amp;&amp; e.which === rp_ge[$t.p.id].savekey[1]) { // save
					if(wkey.tagName !== &quot;TEXTAREA&quot;) {
						$(&quot;#sData&quot;, frmtb+&quot;_2&quot;).trigger(&quot;click&quot;);
						return false;
					}
				}
				if(e.which === 27) {
					if(!checkUpdates()) {return false;}
					if(cle)	{$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:p.gbox,jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose});}
					return false;
				}
				if(rp_ge[$t.p.id].navkeys[0]===true) {
					if($(&quot;#id_g&quot;,frmtb).val() === &quot;_empty&quot;) {return true;}
					if(e.which === rp_ge[$t.p.id].navkeys[1]){ //up
						$(&quot;#pData&quot;, frmtb+&quot;_2&quot;).trigger(&quot;click&quot;);
						return false;
					}
					if(e.which === rp_ge[$t.p.id].navkeys[2]){ //down
						$(&quot;#nData&quot;, frmtb+&quot;_2&quot;).trigger(&quot;click&quot;);
						return false;
					}
				}
			});
			if(p.checkOnUpdate) {
				$(&quot;a.ui-jqdialog-titlebar-close span&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).removeClass(&quot;jqmClose&quot;);
				$(&quot;a.ui-jqdialog-titlebar-close&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).unbind(&quot;click&quot;)
				.click(function(){
					if(!checkUpdates()) {return false;}
					$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose});
					return false;
				});
			}
			p.saveicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-disk&quot;],p.saveicon);
			p.closeicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-close&quot;],p.closeicon);
			// beforeinitdata after creation of the form
			if(p.saveicon[0]===true) {
				$(&quot;#sData&quot;,frmtb+&quot;_2&quot;).addClass(p.saveicon[1] === &quot;right&quot; ? &#x27;fm-button-icon-right&#x27; : &#x27;fm-button-icon-left&#x27;)
				.append(&quot;&lt;span class=&#x27;ui-icon &quot;+p.saveicon[2]+&quot;&#x27;&gt;&lt;/span&gt;&quot;);
			}
			if(p.closeicon[0]===true) {
				$(&quot;#cData&quot;,frmtb+&quot;_2&quot;).addClass(p.closeicon[1] === &quot;right&quot; ? &#x27;fm-button-icon-right&#x27; : &#x27;fm-button-icon-left&#x27;)
				.append(&quot;&lt;span class=&#x27;ui-icon &quot;+p.closeicon[2]+&quot;&#x27;&gt;&lt;/span&gt;&quot;);
			}
			if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) {
				bS  =&quot;&lt;a id=&#x27;sNew&#x27; class=&#x27;fm-button ui-state-default ui-corner-all&#x27; style=&#x27;z-index:1002&#x27;&gt;&quot;+p.bYes+&quot;&lt;/a&gt;&quot;;
				bN  =&quot;&lt;a id=&#x27;nNew&#x27; class=&#x27;fm-button ui-state-default ui-corner-all&#x27; style=&#x27;z-index:1002&#x27;&gt;&quot;+p.bNo+&quot;&lt;/a&gt;&quot;;
				bC  =&quot;&lt;a id=&#x27;cNew&#x27; class=&#x27;fm-button ui-state-default ui-corner-all&#x27; style=&#x27;z-index:1002&#x27;&gt;&quot;+p.bExit+&quot;&lt;/a&gt;&quot;;
				var zI = p.zIndex  || 999;zI ++;
				$(&quot;&lt;div class=&#x27;&quot;+ p.overlayClass+&quot; jqgrid-overlay confirm&#x27; style=&#x27;z-index:&quot;+zI+&quot;;display:none;&#x27;&gt;&amp;#160;&quot;+&quot;&lt;/div&gt;&lt;div class=&#x27;confirm ui-widget-content ui-jqconfirm&#x27; style=&#x27;z-index:&quot;+(zI+1)+&quot;&#x27;&gt;&quot;+p.saveData+&quot;&lt;br/&gt;&lt;br/&gt;&quot;+bS+bN+bC+&quot;&lt;/div&gt;&quot;).insertAfter(&quot;#&quot;+frmgr);
				$(&quot;#sNew&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).click(function(){
					postIt();
					$(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false);
					$(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hide();
					return false;
				});
				$(&quot;#nNew&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).click(function(){
					$(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hide();
					$(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false);
					setTimeout(function(){$(&quot;:input:visible&quot;,&quot;#&quot;+frmgr)[0].focus();},0);
					return false;
				});
				$(&quot;#cNew&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).click(function(){
					$(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hide();
					$(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false);
					$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose});
					return false;
				});
			}
			// here initform - only once
			$($t).triggerHandler(&quot;jqGridAddEditInitializeForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]);
			if(onInitializeForm) {onInitializeForm.call($t,$(&quot;#&quot;+frmgr), frmoper);}
			if(rowid===&quot;_empty&quot; || !rp_ge[$t.p.id].viewPagerButtons) {$(&quot;#pData,#nData&quot;,frmtb+&quot;_2&quot;).hide();} else {$(&quot;#pData,#nData&quot;,frmtb+&quot;_2&quot;).show();}
			$($t).triggerHandler(&quot;jqGridAddEditBeforeShowForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]);
			if(onBeforeShow) { onBeforeShow.call($t, $(&quot;#&quot;+frmgr), frmoper);}
			$(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).data(&quot;onClose&quot;,rp_ge[$t.p.id].onClose);
			$.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{
				gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),
				jqm:p.jqModal,
				overlay: p.overlay,
				modal:p.modal,
				overlayClass: p.overlayClass,
				onHide :  function(h) {
					$($t).data(&quot;formProp&quot;, {
						top:parseFloat($(h.w).css(&quot;top&quot;)),
						left : parseFloat($(h.w).css(&quot;left&quot;)),
						width : $(h.w).width(),
						height : $(h.w).height(),
						dataheight : $(&quot;#&quot;+frmgr).height(),
						datawidth: $(&quot;#&quot;+frmgr).width()
					});
					h.w.remove();
					if(h.o) {h.o.remove();}
				}
			});
			if(!closeovrl) {
				$(&quot;.&quot; + $.jgrid.jqID(p.overlayClass)).click(function(){
					if(!checkUpdates()) {return false;}
					$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose});
					return false;
				});
			}
			$(&quot;.fm-button&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hover(
				function(){$(this).addClass(&#x27;ui-state-hover&#x27;);},
				function(){$(this).removeClass(&#x27;ui-state-hover&#x27;);}
			);
			$(&quot;#sData&quot;, frmtb+&quot;_2&quot;).click(function(){
				postdata = {};
				$(&quot;#FormError&quot;,frmtb).hide();
				// all depend on ret array
				//ret[0] - succes
				//ret[1] - msg if not succes
				//ret[2] - the id  that will be set if reload after submit false
				getFormData();
				if(postdata[$t.p.id+&quot;_id&quot;] === &quot;_empty&quot;)	{postIt();}
				else if(p.checkOnSubmit===true ) {
					diff = compareData(postdata,rp_ge[$t.p.id]._savedData);
					if(diff) {
						$(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,true);
						$(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).show();
					} else {
						postIt();
					}
				} else {
					postIt();
				}
				return false;
			});
			$(&quot;#cData&quot;, frmtb+&quot;_2&quot;).click(function(){
				if(!checkUpdates()) {return false;}
				$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose});
				return false;
			});
			$(&quot;#nData&quot;, frmtb+&quot;_2&quot;).click(function(){
				if(!checkUpdates()) {return false;}
				$(&quot;#FormError&quot;,frmtb).hide();
				var npos = getCurrPos();
				npos[0] = parseInt(npos[0],10);
				if(npos[0] !== -1 &amp;&amp; npos[1][npos[0]+1]) {
					$($t).triggerHandler(&quot;jqGridAddEditClickPgButtons&quot;, [&#x27;next&#x27;,$(&quot;#&quot;+frmgr),npos[1][npos[0]]]);
					var nposret;
					if($.isFunction(p.onclickPgButtons)) {
						nposret = p.onclickPgButtons.call($t, &#x27;next&#x27;,$(&quot;#&quot;+frmgr),npos[1][npos[0]]);
						if( nposret !== undefined &amp;&amp; nposret === false ) {return false;}
					}
					if( $(&quot;#&quot;+$.jgrid.jqID(npos[1][npos[0]+1])).hasClass(&#x27;ui-state-disabled&#x27;)) {return false;}
					fillData(npos[1][npos[0]+1],$t,frmgr);
					$($t).jqGrid(&quot;setSelection&quot;,npos[1][npos[0]+1]);
					$($t).triggerHandler(&quot;jqGridAddEditAfterClickPgButtons&quot;, [&#x27;next&#x27;,$(&quot;#&quot;+frmgr),npos[1][npos[0]]]);
					if($.isFunction(p.afterclickPgButtons)) {
						p.afterclickPgButtons.call($t, &#x27;next&#x27;,$(&quot;#&quot;+frmgr),npos[1][npos[0]+1]);
					}
					updateNav(npos[0]+1,npos);
				}
				return false;
			});
			$(&quot;#pData&quot;, frmtb+&quot;_2&quot;).click(function(){
				if(!checkUpdates()) {return false;}
				$(&quot;#FormError&quot;,frmtb).hide();
				var ppos = getCurrPos();
				if(ppos[0] !== -1 &amp;&amp; ppos[1][ppos[0]-1]) {
					$($t).triggerHandler(&quot;jqGridAddEditClickPgButtons&quot;, [&#x27;prev&#x27;,$(&quot;#&quot;+frmgr),ppos[1][ppos[0]]]);
					var pposret;
					if($.isFunction(p.onclickPgButtons)) {
						pposret = p.onclickPgButtons.call($t, &#x27;prev&#x27;,$(&quot;#&quot;+frmgr),ppos[1][ppos[0]]);
						if( pposret !== undefined &amp;&amp; pposret === false ) {return false;}
					}
					if( $(&quot;#&quot;+$.jgrid.jqID(ppos[1][ppos[0]-1])).hasClass(&#x27;ui-state-disabled&#x27;)) {return false;}
					fillData(ppos[1][ppos[0]-1],$t,frmgr);
					$($t).jqGrid(&quot;setSelection&quot;,ppos[1][ppos[0]-1]);
					$($t).triggerHandler(&quot;jqGridAddEditAfterClickPgButtons&quot;, [&#x27;prev&#x27;,$(&quot;#&quot;+frmgr),ppos[1][ppos[0]]]);
					if($.isFunction(p.afterclickPgButtons)) {
						p.afterclickPgButtons.call($t, &#x27;prev&#x27;,$(&quot;#&quot;+frmgr),ppos[1][ppos[0]-1]);
					}
					updateNav(ppos[0]-1,ppos);
				}
				return false;
			});
			$($t).triggerHandler(&quot;jqGridAddEditAfterShowForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]);
			if(onAfterShow) { onAfterShow.call($t, $(&quot;#&quot;+frmgr), frmoper); }
			var posInit =getCurrPos();
			updateNav(posInit[0],posInit);
		});
	},
	viewGridRow : function(rowid, p){
		p = $.extend(true, {
			top : 0,
			left: 0,
			width: 0,
			datawidth: &#x27;auto&#x27;,
			height: &#x27;auto&#x27;,
			dataheight: &#x27;auto&#x27;,
			modal: false,
			overlay: 30,
			drag: true,
			resize: true,
			jqModal: true,
			closeOnEscape : false,
			labelswidth: &#x27;30%&#x27;,
			closeicon: [],
			navkeys: [false,38,40],
			onClose: null,
			beforeShowForm : null,
			beforeInitData : null,
			viewPagerButtons : true,
			recreateForm : false
		}, $.jgrid.view, p || {});
		rp_ge[$(this)[0].p.id] = p;
		return this.each(function(){
			var $t = this;
			if (!$t.grid || !rowid) {return;}
			var gID = $t.p.id,
			frmgr = &quot;ViewGrid_&quot;+$.jgrid.jqID( gID  ), frmtb = &quot;ViewTbl_&quot; + $.jgrid.jqID( gID ),
			frmgr_id = &quot;ViewGrid_&quot;+gID, frmtb_id = &quot;ViewTbl_&quot;+gID,
			IDs = {themodal:&#x27;viewmod&#x27;+gID,modalhead:&#x27;viewhd&#x27;+gID,modalcontent:&#x27;viewcnt&#x27;+gID, scrollelm : frmgr},
			onBeforeInit = $.isFunction(rp_ge[$t.p.id].beforeInitData) ? rp_ge[$t.p.id].beforeInitData : false,
			showFrm = true,
			maxCols = 1, maxRows=0;
			if(!p.recreateForm) {
				if( $($t).data(&quot;viewProp&quot;) ) {
					$.extend(rp_ge[$(this)[0].p.id], $($t).data(&quot;viewProp&quot;));
				}
			}
			function focusaref(){ //Sfari 3 issues
				if(rp_ge[$t.p.id].closeOnEscape===true || rp_ge[$t.p.id].navkeys[0]===true) {
					setTimeout(function(){$(&quot;.ui-jqdialog-titlebar-close&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).focus();},0);
				}
			}
			function createData(rowid,obj,tb,maxcols){
				var nm, hc,trdata, cnt=0,tmp, dc, retpos=[], ind=false, i,
				tdtmpl = &quot;&lt;td class=&#x27;CaptionTD form-view-label ui-widget-content&#x27; width=&#x27;&quot;+p.labelswidth+&quot;&#x27;&gt;&amp;#160;&lt;/td&gt;&lt;td class=&#x27;DataTD form-view-data ui-helper-reset ui-widget-content&#x27;&gt;&amp;#160;&lt;/td&gt;&quot;, tmpl=&quot;&quot;,
				tdtmpl2 = &quot;&lt;td class=&#x27;CaptionTD form-view-label ui-widget-content&#x27;&gt;&amp;#160;&lt;/td&gt;&lt;td class=&#x27;DataTD form-view-data ui-widget-content&#x27;&gt;&amp;#160;&lt;/td&gt;&quot;,
				fmtnum = [&#x27;integer&#x27;,&#x27;number&#x27;,&#x27;currency&#x27;],max1 =0, max2=0 ,maxw,setme, viewfld;
				for (i=1;i&lt;=maxcols;i++) {
					tmpl += i === 1 ? tdtmpl : tdtmpl2;
				}
				// find max number align rigth with property formatter
				$(obj.p.colModel).each( function() {
					if(this.editrules &amp;&amp; this.editrules.edithidden === true) {
						hc = false;
					} else {
						hc = this.hidden === true ? true : false;
					}
					if(!hc &amp;&amp; this.align===&#x27;right&#x27;) {
						if(this.formatter &amp;&amp; $.inArray(this.formatter,fmtnum) !== -1 ) {
							max1 = Math.max(max1,parseInt(this.width,10));
						} else {
							max2 = Math.max(max2,parseInt(this.width,10));
						}
					}
				});
				maxw  = max1 !==0 ? max1 : max2 !==0 ? max2 : 0;
				ind = $(obj).jqGrid(&quot;getInd&quot;,rowid);
				$(obj.p.colModel).each( function(i) {
					nm = this.name;
					setme = false;
					// hidden fields are included in the form
					if(this.editrules &amp;&amp; this.editrules.edithidden === true) {
						hc = false;
					} else {
						hc = this.hidden === true ? true : false;
					}
					dc = hc ? &quot;style=&#x27;display:none&#x27;&quot; : &quot;&quot;;
					viewfld = (typeof this.viewable !== &#x27;boolean&#x27;) ? true : this.viewable;
					if ( nm !== &#x27;cb&#x27; &amp;&amp; nm !== &#x27;subgrid&#x27; &amp;&amp; nm !== &#x27;rn&#x27; &amp;&amp; viewfld) {
						if(ind === false) {
							tmp = &quot;&quot;;
						} else {
							if(nm === obj.p.ExpandColumn &amp;&amp; obj.p.treeGrid === true) {
								tmp = $(&quot;td:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).text();
							} else {
								tmp = $(&quot;td:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).html();
							}
						}
						setme = this.align === &#x27;right&#x27; &amp;&amp; maxw !==0 ? true : false;
						var frmopt = $.extend({},{rowabove:false,rowcontent:&#x27;&#x27;}, this.formoptions || {}),
						rp = parseInt(frmopt.rowpos,10) || cnt+1,
						cp = parseInt((parseInt(frmopt.colpos,10) || 1)*2,10);
						if(frmopt.rowabove) {
							var newdata = $(&quot;&lt;tr&gt;&lt;td class=&#x27;contentinfo&#x27; colspan=&#x27;&quot;+(maxcols*2)+&quot;&#x27;&gt;&quot;+frmopt.rowcontent+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
							$(tb).append(newdata);
							newdata[0].rp = rp;
						}
						trdata = $(tb).find(&quot;tr[rowpos=&quot;+rp+&quot;]&quot;);
						if ( trdata.length===0 ) {
							trdata = $(&quot;&lt;tr &quot;+dc+&quot; rowpos=&#x27;&quot;+rp+&quot;&#x27;&gt;&lt;/tr&gt;&quot;).addClass(&quot;FormData&quot;).attr(&quot;id&quot;,&quot;trv_&quot;+nm);
							$(trdata).append(tmpl);
							$(tb).append(trdata);
							trdata[0].rp = rp;
						}
						$(&quot;td:eq(&quot;+(cp-2)+&quot;)&quot;,trdata[0]).html(&#x27;&lt;b&gt;&#x27;+ (frmopt.label === undefined ? obj.p.colNames[i]: frmopt.label)+&#x27;&lt;/b&gt;&#x27;);
						$(&quot;td:eq(&quot;+(cp-1)+&quot;)&quot;,trdata[0]).append(&quot;&lt;span&gt;&quot;+tmp+&quot;&lt;/span&gt;&quot;).attr(&quot;id&quot;,&quot;v_&quot;+nm);
						if(setme){
							$(&quot;td:eq(&quot;+(cp-1)+&quot;) span&quot;,trdata[0]).css({&#x27;text-align&#x27;:&#x27;right&#x27;,width:maxw+&quot;px&quot;});
						}
						retpos[cnt] = i;
						cnt++;
					}
				});
				if( cnt &gt; 0) {
					var idrow = $(&quot;&lt;tr class=&#x27;FormData&#x27; style=&#x27;display:none&#x27;&gt;&lt;td class=&#x27;CaptionTD&#x27;&gt;&lt;/td&gt;&lt;td colspan=&#x27;&quot;+ (maxcols*2-1)+&quot;&#x27; class=&#x27;DataTD&#x27;&gt;&lt;input class=&#x27;FormElement&#x27; id=&#x27;id_g&#x27; type=&#x27;text&#x27; name=&#x27;id&#x27; value=&#x27;&quot;+rowid+&quot;&#x27;/&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
					idrow[0].rp = cnt+99;
					$(tb).append(idrow);
				}
				return retpos;
			}
			function fillData(rowid,obj){
				var nm, hc,cnt=0,tmp,trv;
				trv = $(obj).jqGrid(&quot;getInd&quot;,rowid,true);
				if(!trv) {return;}
				$(&#x27;td&#x27;,trv).each( function(i) {
					nm = obj.p.colModel[i].name;
					// hidden fields are included in the form
					if(obj.p.colModel[i].editrules &amp;&amp; obj.p.colModel[i].editrules.edithidden === true) {
						hc = false;
					} else {
						hc = obj.p.colModel[i].hidden === true ? true : false;
					}
					if ( nm !== &#x27;cb&#x27; &amp;&amp; nm !== &#x27;subgrid&#x27; &amp;&amp; nm !== &#x27;rn&#x27;) {
						if(nm === obj.p.ExpandColumn &amp;&amp; obj.p.treeGrid === true) {
							tmp = $(this).text();
						} else {
							tmp = $(this).html();
						}
						nm = $.jgrid.jqID(&quot;v_&quot;+nm);
						$(&quot;#&quot;+nm+&quot; span&quot;,&quot;#&quot;+frmtb).html(tmp);
						if (hc) {$(&quot;#&quot;+nm,&quot;#&quot;+frmtb).parents(&quot;tr:first&quot;).hide();}
						cnt++;
					}
				});
				if(cnt&gt;0) {$(&quot;#id_g&quot;,&quot;#&quot;+frmtb).val(rowid);}
			}
			function updateNav(cr,posarr){
				var totr = posarr[1].length-1;
				if (cr===0) {
					$(&quot;#pData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).addClass(&#x27;ui-state-disabled&#x27;);
				} else if( posarr[1][cr-1] !== undefined &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(posarr[1][cr-1])).hasClass(&#x27;ui-state-disabled&#x27;)) {
					$(&quot;#pData&quot;,frmtb+&quot;_2&quot;).addClass(&#x27;ui-state-disabled&#x27;);
				} else {
					$(&quot;#pData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).removeClass(&#x27;ui-state-disabled&#x27;);
				}
				if (cr===totr) {
					$(&quot;#nData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).addClass(&#x27;ui-state-disabled&#x27;);
				} else if( posarr[1][cr+1] !== undefined &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(posarr[1][cr+1])).hasClass(&#x27;ui-state-disabled&#x27;)) {
					$(&quot;#nData&quot;,frmtb+&quot;_2&quot;).addClass(&#x27;ui-state-disabled&#x27;);
				} else {
					$(&quot;#nData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).removeClass(&#x27;ui-state-disabled&#x27;);
				}
			}
			function getCurrPos() {
				var rowsInGrid = $($t).jqGrid(&quot;getDataIDs&quot;),
				selrow = $(&quot;#id_g&quot;,&quot;#&quot;+frmtb).val(),
				pos = $.inArray(selrow,rowsInGrid);
				return [pos,rowsInGrid];
			}

			var dh = isNaN(rp_ge[$(this)[0].p.id].dataheight) ? rp_ge[$(this)[0].p.id].dataheight : rp_ge[$(this)[0].p.id].dataheight+&quot;px&quot;,
			dw = isNaN(rp_ge[$(this)[0].p.id].datawidth) ? rp_ge[$(this)[0].p.id].datawidth : rp_ge[$(this)[0].p.id].datawidth+&quot;px&quot;,
			frm = $(&quot;&lt;form name=&#x27;FormPost&#x27; id=&#x27;&quot;+frmgr_id+&quot;&#x27; class=&#x27;FormGrid&#x27; style=&#x27;width:&quot;+dw+&quot;;overflow:auto;position:relative;height:&quot;+dh+&quot;;&#x27;&gt;&lt;/form&gt;&quot;),
			tbl =$(&quot;&lt;table id=&#x27;&quot;+frmtb_id+&quot;&#x27; class=&#x27;EditTable&#x27; cellspacing=&#x27;1&#x27; cellpadding=&#x27;2&#x27; border=&#x27;0&#x27; style=&#x27;table-layout:fixed&#x27;&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;);
			if(onBeforeInit) {
				showFrm = onBeforeInit.call($t,$(&quot;#&quot;+frmgr));
				if(showFrm === undefined) {
					showFrm = true;
				}
			}
			if(showFrm === false) {return;}
			$($t.p.colModel).each( function() {
				var fmto = this.formoptions;
				maxCols = Math.max(maxCols, fmto ? fmto.colpos || 0 : 0 );
				maxRows = Math.max(maxRows, fmto ? fmto.rowpos || 0 : 0 );
			});
			// set the id.
			$(frm).append(tbl);
			createData(rowid, $t, tbl, maxCols);
			var rtlb = $t.p.direction === &quot;rtl&quot; ? true :false,
			bp = rtlb ? &quot;nData&quot; : &quot;pData&quot;,
			bn = rtlb ? &quot;pData&quot; : &quot;nData&quot;,
				// buttons at footer
			bP = &quot;&lt;a id=&#x27;&quot;+bp+&quot;&#x27; class=&#x27;fm-button ui-state-default ui-corner-left&#x27;&gt;&lt;span class=&#x27;ui-icon ui-icon-triangle-1-w&#x27;&gt;&lt;/span&gt;&lt;/a&gt;&quot;,
			bN = &quot;&lt;a id=&#x27;&quot;+bn+&quot;&#x27; class=&#x27;fm-button ui-state-default ui-corner-right&#x27;&gt;&lt;span class=&#x27;ui-icon ui-icon-triangle-1-e&#x27;&gt;&lt;/span&gt;&lt;/a&gt;&quot;,
			bC  =&quot;&lt;a id=&#x27;cData&#x27; class=&#x27;fm-button ui-state-default ui-corner-all&#x27;&gt;&quot;+p.bClose+&quot;&lt;/a&gt;&quot;;
			if(maxRows &gt;  0) {
				var sd=[];
				$.each($(tbl)[0].rows,function(i,r){
					sd[i] = r;
				});
				sd.sort(function(a,b){
					if(a.rp &gt; b.rp) {return 1;}
					if(a.rp &lt; b.rp) {return -1;}
					return 0;
				});
				$.each(sd, function(index, row) {
					$(&#x27;tbody&#x27;,tbl).append(row);
				});
			}
			p.gbox = &quot;#gbox_&quot;+$.jgrid.jqID(gID);
			var bt = $(&quot;&lt;div&gt;&lt;/div&gt;&quot;).append(frm).append(&quot;&lt;table border=&#x27;0&#x27; class=&#x27;EditTable&#x27; id=&#x27;&quot;+frmtb+&quot;_2&#x27;&gt;&lt;tbody&gt;&lt;tr id=&#x27;Act_Buttons&#x27;&gt;&lt;td class=&#x27;navButton&#x27; width=&#x27;&quot;+p.labelswidth+&quot;&#x27;&gt;&quot;+(rtlb ? bN+bP : bP+bN)+&quot;&lt;/td&gt;&lt;td class=&#x27;EditButton&#x27;&gt;&quot;+bC+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;);
			$.jgrid.createModal(IDs,bt,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id))[0]);
			if(rtlb) {
				$(&quot;#pData, #nData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).css(&quot;float&quot;,&quot;right&quot;);
				$(&quot;.EditButton&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).css(&quot;text-align&quot;,&quot;left&quot;);
			}
			if(!p.viewPagerButtons) {$(&quot;#pData, #nData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).hide();}
			bt = null;
			$(&quot;#&quot;+IDs.themodal).keydown( function( e ) {
				if(e.which === 27) {
					if(rp_ge[$t.p.id].closeOnEscape) {$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:p.gbox,jqm:p.jqModal, onClose: p.onClose});}
					return false;
				}
				if(p.navkeys[0]===true) {
					if(e.which === p.navkeys[1]){ //up
						$(&quot;#pData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).trigger(&quot;click&quot;);
						return false;
					}
					if(e.which === p.navkeys[2]){ //down
						$(&quot;#nData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).trigger(&quot;click&quot;);
						return false;
					}
				}
			});
			p.closeicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-close&quot;],p.closeicon);
			if(p.closeicon[0]===true) {
				$(&quot;#cData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).addClass(p.closeicon[1] === &quot;right&quot; ? &#x27;fm-button-icon-right&#x27; : &#x27;fm-button-icon-left&#x27;)
				.append(&quot;&lt;span class=&#x27;ui-icon &quot;+p.closeicon[2]+&quot;&#x27;&gt;&lt;/span&gt;&quot;);
			}
			if($.isFunction(p.beforeShowForm)) {p.beforeShowForm.call($t,$(&quot;#&quot;+frmgr));}
			$.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{
				gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),
				jqm:p.jqModal,
				overlay: p.overlay,
				modal:p.modal,
				onHide :  function(h) {
					$($t).data(&quot;viewProp&quot;, {
						top:parseFloat($(h.w).css(&quot;top&quot;)),
						left : parseFloat($(h.w).css(&quot;left&quot;)),
						width : $(h.w).width(),
						height : $(h.w).height(),
						dataheight : $(&quot;#&quot;+frmgr).height(),
						datawidth: $(&quot;#&quot;+frmgr).width()
					});
					h.w.remove();
					if(h.o) {h.o.remove();}
				}
			});
			$(&quot;.fm-button:not(.ui-state-disabled)&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).hover(
				function(){$(this).addClass(&#x27;ui-state-hover&#x27;);},
				function(){$(this).removeClass(&#x27;ui-state-hover&#x27;);}
			);
			focusaref();
			$(&quot;#cData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).click(function(){
				$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: p.onClose});
				return false;
			});
			$(&quot;#nData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).click(function(){
				$(&quot;#FormError&quot;,&quot;#&quot;+frmtb).hide();
				var npos = getCurrPos();
				npos[0] = parseInt(npos[0],10);
				if(npos[0] !== -1 &amp;&amp; npos[1][npos[0]+1]) {
					if($.isFunction(p.onclickPgButtons)) {
						p.onclickPgButtons.call($t,&#x27;next&#x27;,$(&quot;#&quot;+frmgr),npos[1][npos[0]]);
					}
					fillData(npos[1][npos[0]+1],$t);
					$($t).jqGrid(&quot;setSelection&quot;,npos[1][npos[0]+1]);
					if($.isFunction(p.afterclickPgButtons)) {
						p.afterclickPgButtons.call($t,&#x27;next&#x27;,$(&quot;#&quot;+frmgr),npos[1][npos[0]+1]);
					}
					updateNav(npos[0]+1,npos);
				}
				focusaref();
				return false;
			});
			$(&quot;#pData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).click(function(){
				$(&quot;#FormError&quot;,&quot;#&quot;+frmtb).hide();
				var ppos = getCurrPos();
				if(ppos[0] !== -1 &amp;&amp; ppos[1][ppos[0]-1]) {
					if($.isFunction(p.onclickPgButtons)) {
						p.onclickPgButtons.call($t,&#x27;prev&#x27;,$(&quot;#&quot;+frmgr),ppos[1][ppos[0]]);
					}
					fillData(ppos[1][ppos[0]-1],$t);
					$($t).jqGrid(&quot;setSelection&quot;,ppos[1][ppos[0]-1]);
					if($.isFunction(p.afterclickPgButtons)) {
						p.afterclickPgButtons.call($t,&#x27;prev&#x27;,$(&quot;#&quot;+frmgr),ppos[1][ppos[0]-1]);
					}
					updateNav(ppos[0]-1,ppos);
				}
				focusaref();
				return false;
			});
			var posInit =getCurrPos();
			updateNav(posInit[0],posInit);
		});
	},
	delGridRow : function(rowids,p) {
		p = $.extend(true, {
			top : 0,
			left: 0,
			width: 240,
			height: &#x27;auto&#x27;,
			dataheight : &#x27;auto&#x27;,
			modal: false,
			overlay: 30,
			drag: true,
			resize: true,
			url : &#x27;&#x27;,
			mtype : &quot;POST&quot;,
			reloadAfterSubmit: true,
			beforeShowForm: null,
			beforeInitData : null,
			afterShowForm: null,
			beforeSubmit: null,
			onclickSubmit: null,
			afterSubmit: null,
			jqModal : true,
			closeOnEscape : false,
			delData: {},
			delicon : [],
			cancelicon : [],
			onClose : null,
			ajaxDelOptions : {},
			processing : false,
			serializeDelData : null,
			useDataProxy : false
		}, $.jgrid.del, p ||{});
		rp_ge[$(this)[0].p.id] = p;
		return this.each(function(){
			var $t = this;
			if (!$t.grid ) {return;}
			if(!rowids) {return;}
			var onBeforeShow = $.isFunction( rp_ge[$t.p.id].beforeShowForm  ),
			onAfterShow = $.isFunction( rp_ge[$t.p.id].afterShowForm ),
			onBeforeInit = $.isFunction(rp_ge[$t.p.id].beforeInitData) ? rp_ge[$t.p.id].beforeInitData : false,
			gID = $t.p.id, onCS = {},
			showFrm = true,
			dtbl = &quot;DelTbl_&quot;+$.jgrid.jqID(gID),postd, idname, opers, oper,
			dtbl_id = &quot;DelTbl_&quot; + gID,
			IDs = {themodal:&#x27;delmod&#x27;+gID,modalhead:&#x27;delhd&#x27;+gID,modalcontent:&#x27;delcnt&#x27;+gID, scrollelm: dtbl};
			if ($.isArray(rowids)) {rowids = rowids.join();}
			if ( $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal))[0] !== undefined ) {
				if(onBeforeInit) {
					showFrm = onBeforeInit.call($t,$(&quot;#&quot;+dtbl));
					if(showFrm === undefined) {
						showFrm = true;
					}
				}
				if(showFrm === false) {return;}
				$(&quot;#DelData&gt;td&quot;,&quot;#&quot;+dtbl).text(rowids);
				$(&quot;#DelError&quot;,&quot;#&quot;+dtbl).hide();
				if( rp_ge[$t.p.id].processing === true) {
					rp_ge[$t.p.id].processing=false;
					$(&quot;#dData&quot;, &quot;#&quot;+dtbl).removeClass(&#x27;ui-state-active&#x27;);
				}
				if(onBeforeShow) {rp_ge[$t.p.id].beforeShowForm.call($t,$(&quot;#&quot;+dtbl));}
				$.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:rp_ge[$t.p.id].jqModal,jqM: false, overlay: rp_ge[$t.p.id].overlay, modal:rp_ge[$t.p.id].modal});
				if(onAfterShow) {rp_ge[$t.p.id].afterShowForm.call($t,$(&quot;#&quot;+dtbl));}
			} else {
				var dh = isNaN(rp_ge[$t.p.id].dataheight) ? rp_ge[$t.p.id].dataheight : rp_ge[$t.p.id].dataheight+&quot;px&quot;,
				dw = isNaN(p.datawidth) ? p.datawidth : p.datawidth+&quot;px&quot;,
				tbl = &quot;&lt;div id=&#x27;&quot;+dtbl_id+&quot;&#x27; class=&#x27;formdata&#x27; style=&#x27;width:&quot;+dw+&quot;;overflow:auto;position:relative;height:&quot;+dh+&quot;;&#x27;&gt;&quot;;
				tbl += &quot;&lt;table class=&#x27;DelTable&#x27;&gt;&lt;tbody&gt;&quot;;
				// error data
				tbl += &quot;&lt;tr id=&#x27;DelError&#x27; style=&#x27;display:none&#x27;&gt;&lt;td class=&#x27;ui-state-error&#x27;&gt;&lt;/td&gt;&lt;/tr&gt;&quot;;
				tbl += &quot;&lt;tr id=&#x27;DelData&#x27; style=&#x27;display:none&#x27;&gt;&lt;td &gt;&quot;+rowids+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;;
				tbl += &quot;&lt;tr&gt;&lt;td class=\&quot;delmsg\&quot; style=\&quot;white-space:pre;\&quot;&gt;&quot;+rp_ge[$t.p.id].msg+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td &gt;&amp;#160;&lt;/td&gt;&lt;/tr&gt;&quot;;
				// buttons at footer
				tbl += &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&quot;;
				var bS  = &quot;&lt;a id=&#x27;dData&#x27; class=&#x27;fm-button ui-state-default ui-corner-all&#x27;&gt;&quot;+p.bSubmit+&quot;&lt;/a&gt;&quot;,
				bC  = &quot;&lt;a id=&#x27;eData&#x27; class=&#x27;fm-button ui-state-default ui-corner-all&#x27;&gt;&quot;+p.bCancel+&quot;&lt;/a&gt;&quot;;
				tbl += &quot;&lt;table cellspacing=&#x27;0&#x27; cellpadding=&#x27;0&#x27; border=&#x27;0&#x27; class=&#x27;EditTable&#x27; id=&#x27;&quot;+dtbl+&quot;_2&#x27;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;hr class=&#x27;ui-widget-content&#x27; style=&#x27;margin:1px&#x27;/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#x27;DelButton EditButton&#x27;&gt;&quot;+bS+&quot;&amp;#160;&quot;+bC+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;;
				p.gbox = &quot;#gbox_&quot;+$.jgrid.jqID(gID);
				$.jgrid.createModal(IDs,tbl,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id))[0]);

				if(onBeforeInit) {
					showFrm = onBeforeInit.call($t,$(&quot;#&quot;+dtbl));
					if(showFrm === undefined) {
						showFrm = true;
					}
				}
				if(showFrm === false) {return;}

				$(&quot;.fm-button&quot;,&quot;#&quot;+dtbl+&quot;_2&quot;).hover(
					function(){$(this).addClass(&#x27;ui-state-hover&#x27;);},
					function(){$(this).removeClass(&#x27;ui-state-hover&#x27;);}
				);
				p.delicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-scissors&quot;],rp_ge[$t.p.id].delicon);
				p.cancelicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-cancel&quot;],rp_ge[$t.p.id].cancelicon);
				if(p.delicon[0]===true) {
					$(&quot;#dData&quot;,&quot;#&quot;+dtbl+&quot;_2&quot;).addClass(p.delicon[1] === &quot;right&quot; ? &#x27;fm-button-icon-right&#x27; : &#x27;fm-button-icon-left&#x27;)
					.append(&quot;&lt;span class=&#x27;ui-icon &quot;+p.delicon[2]+&quot;&#x27;&gt;&lt;/span&gt;&quot;);
				}
				if(p.cancelicon[0]===true) {
					$(&quot;#eData&quot;,&quot;#&quot;+dtbl+&quot;_2&quot;).addClass(p.cancelicon[1] === &quot;right&quot; ? &#x27;fm-button-icon-right&#x27; : &#x27;fm-button-icon-left&#x27;)
					.append(&quot;&lt;span class=&#x27;ui-icon &quot;+p.cancelicon[2]+&quot;&#x27;&gt;&lt;/span&gt;&quot;);
				}
				$(&quot;#dData&quot;,&quot;#&quot;+dtbl+&quot;_2&quot;).click(function(){
					var ret=[true,&quot;&quot;], pk,
					postdata = $(&quot;#DelData&gt;td&quot;,&quot;#&quot;+dtbl).text(); //the pair is name=val1,val2,...
					onCS = {};
					if( $.isFunction( rp_ge[$t.p.id].onclickSubmit ) ) {onCS = rp_ge[$t.p.id].onclickSubmit.call($t,rp_ge[$t.p.id], postdata) || {};}
					if( $.isFunction( rp_ge[$t.p.id].beforeSubmit ) ) {ret = rp_ge[$t.p.id].beforeSubmit.call($t,postdata);}
					if(ret[0] &amp;&amp; !rp_ge[$t.p.id].processing) {
						rp_ge[$t.p.id].processing = true;
						opers = $t.p.prmNames;
						postd = $.extend({},rp_ge[$t.p.id].delData, onCS);
						oper = opers.oper;
						postd[oper] = opers.deloper;
						idname = opers.id;
						postdata = String(postdata).split(&quot;,&quot;);
						if(!postdata.length) { return false; }
						for(pk in postdata) {
							if(postdata.hasOwnProperty(pk)) {
								postdata[pk] = $.jgrid.stripPref($t.p.idPrefix, postdata[pk]);
							}
						}
						postd[idname] = postdata.join();
						$(this).addClass(&#x27;ui-state-active&#x27;);
						var ajaxOptions = $.extend({
							url: rp_ge[$t.p.id].url || $($t).jqGrid(&#x27;getGridParam&#x27;,&#x27;editurl&#x27;),
							type: rp_ge[$t.p.id].mtype,
							data: $.isFunction(rp_ge[$t.p.id].serializeDelData) ? rp_ge[$t.p.id].serializeDelData.call($t,postd) : postd,
							complete:function(data,status){
								var i;
								if(data.status &gt;= 300 &amp;&amp; data.status !== 304) {
									ret[0] = false;
									if ($.isFunction(rp_ge[$t.p.id].errorTextFormat)) {
										ret[1] = rp_ge[$t.p.id].errorTextFormat.call($t,data);
									} else {
										ret[1] = status + &quot; Status: &#x27;&quot; + data.statusText + &quot;&#x27;. Error code: &quot; + data.status;
									}
								} else {
									// data is posted successful
									// execute aftersubmit with the returned data from server
									if( $.isFunction( rp_ge[$t.p.id].afterSubmit ) ) {
										ret = rp_ge[$t.p.id].afterSubmit.call($t,data,postd);
									}
								}
								if(ret[0] === false) {
									$(&quot;#DelError&gt;td&quot;,&quot;#&quot;+dtbl).html(ret[1]);
									$(&quot;#DelError&quot;,&quot;#&quot;+dtbl).show();
								} else {
									if(rp_ge[$t.p.id].reloadAfterSubmit &amp;&amp; $t.p.datatype !== &quot;local&quot;) {
										$($t).trigger(&quot;reloadGrid&quot;);
									} else {
										if($t.p.treeGrid===true){
												try {$($t).jqGrid(&quot;delTreeNode&quot;,$t.p.idPrefix+postdata[0]);} catch(e){}
										} else {
											for(i=0;i&lt;postdata.length;i++) {
												$($t).jqGrid(&quot;delRowData&quot;,$t.p.idPrefix+ postdata[i]);
											}
										}
										$t.p.selrow = null;
										$t.p.selarrrow = [];
									}
									if($.isFunction(rp_ge[$t.p.id].afterComplete)) {
										setTimeout(function(){rp_ge[$t.p.id].afterComplete.call($t,data,postdata);},500);
									}
								}
								rp_ge[$t.p.id].processing=false;
								$(&quot;#dData&quot;, &quot;#&quot;+dtbl+&quot;_2&quot;).removeClass(&#x27;ui-state-active&#x27;);
								if(ret[0]) {$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose});}
							}
						}, $.jgrid.ajaxOptions, rp_ge[$t.p.id].ajaxDelOptions);


						if (!ajaxOptions.url &amp;&amp; !rp_ge[$t.p.id].useDataProxy) {
							if ($.isFunction($t.p.dataProxy)) {
								rp_ge[$t.p.id].useDataProxy = true;
							} else {
								ret[0]=false;ret[1] += &quot; &quot;+$.jgrid.errors.nourl;
							}
						}
						if (ret[0]) {
							if (rp_ge[$t.p.id].useDataProxy) {
								var dpret = $t.p.dataProxy.call($t, ajaxOptions, &quot;del_&quot;+$t.p.id);
								if(dpret === undefined) {
									dpret = [true, &quot;&quot;];
								}
								if(dpret[0] === false ) {
									ret[0] = false;
									ret[1] = dpret[1] || &quot;Error deleting the selected row!&quot; ;
								} else {
									$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose});
								}
							}
							else {$.ajax(ajaxOptions);}
						}
					}

					if(ret[0] === false) {
						$(&quot;#DelError&gt;td&quot;,&quot;#&quot;+dtbl).html(ret[1]);
						$(&quot;#DelError&quot;,&quot;#&quot;+dtbl).show();
					}
					return false;
				});
				$(&quot;#eData&quot;, &quot;#&quot;+dtbl+&quot;_2&quot;).click(function(){
					$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:rp_ge[$t.p.id].jqModal, onClose: rp_ge[$t.p.id].onClose});
					return false;
				});
				if(onBeforeShow) {rp_ge[$t.p.id].beforeShowForm.call($t,$(&quot;#&quot;+dtbl));}
				$.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:rp_ge[$t.p.id].jqModal, overlay: rp_ge[$t.p.id].overlay, modal:rp_ge[$t.p.id].modal});
				if(onAfterShow) {rp_ge[$t.p.id].afterShowForm.call($t,$(&quot;#&quot;+dtbl));}
			}
			if(rp_ge[$t.p.id].closeOnEscape===true) {
				setTimeout(function(){$(&quot;.ui-jqdialog-titlebar-close&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).focus();},0);
			}
		});
	},
	navGrid : function (elem, o, pEdit,pAdd,pDel,pSearch, pView) {
		o = $.extend({
			edit: true,
			editicon: &quot;ui-icon-pencil&quot;,
			add: true,
			addicon:&quot;ui-icon-plus&quot;,
			del: true,
			delicon:&quot;ui-icon-trash&quot;,
			search: true,
			searchicon:&quot;ui-icon-search&quot;,
			refresh: true,
			refreshicon:&quot;ui-icon-refresh&quot;,
			refreshstate: &#x27;firstpage&#x27;,
			view: false,
			viewicon : &quot;ui-icon-document&quot;,
			position : &quot;left&quot;,
			closeOnEscape : true,
			beforeRefresh : null,
			afterRefresh : null,
			cloneToTop : false,
			alertwidth : 200,
			alertheight : &#x27;auto&#x27;,
			alerttop: null,
			alertleft: null,
			alertzIndex : null
		}, $.jgrid.nav, o ||{});
		return this.each(function() {
			if(this.nav) {return;}
			var alertIDs = {themodal: &#x27;alertmod_&#x27; + this.p.id, modalhead: &#x27;alerthd_&#x27; + this.p.id,modalcontent: &#x27;alertcnt_&#x27; + this.p.id},
			$t = this, twd, tdw;
			if(!$t.grid || typeof elem !== &#x27;string&#x27;) {return;}
			if ($(&quot;#&quot;+alertIDs.themodal)[0] === undefined) {
				if(!o.alerttop &amp;&amp; !o.alertleft) {
					if (window.innerWidth !== undefined) {
						o.alertleft = window.innerWidth;
						o.alerttop = window.innerHeight;
					} else if (document.documentElement !== undefined &amp;&amp; document.documentElement.clientWidth !== undefined &amp;&amp; document.documentElement.clientWidth !== 0) {
						o.alertleft = document.documentElement.clientWidth;
						o.alerttop = document.documentElement.clientHeight;
					} else {
						o.alertleft=1024;
						o.alerttop=768;
					}
					o.alertleft = o.alertleft/2 - parseInt(o.alertwidth,10)/2;
					o.alerttop = o.alerttop/2-25;
				}
				$.jgrid.createModal(alertIDs,
					&quot;&lt;div&gt;&quot;+o.alerttext+&quot;&lt;/div&gt;&lt;span tabindex=&#x27;0&#x27;&gt;&lt;span tabindex=&#x27;-1&#x27; id=&#x27;jqg_alrt&#x27;&gt;&lt;/span&gt;&lt;/span&gt;&quot;,
					{
						gbox:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),
						jqModal:true,
						drag:true,
						resize:true,
						caption:o.alertcap,
						top:o.alerttop,
						left:o.alertleft,
						width:o.alertwidth,
						height: o.alertheight,
						closeOnEscape:o.closeOnEscape,
						zIndex: o.alertzIndex
					},
					&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),
					$(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id))[0],
					true
				);
			}
			var clone = 1, i,
			onHoverIn = function () {
				if (!$(this).hasClass(&#x27;ui-state-disabled&#x27;)) {
					$(this).addClass(&quot;ui-state-hover&quot;);
				}
			},
			onHoverOut = function () {
				$(this).removeClass(&quot;ui-state-hover&quot;);
			};
			if(o.cloneToTop &amp;&amp; $t.p.toppager) {clone = 2;}
			for(i = 0; i&lt;clone; i++) {
				var tbd,
				navtbl = $(&quot;&lt;table cellspacing=&#x27;0&#x27; cellpadding=&#x27;0&#x27; border=&#x27;0&#x27; class=&#x27;ui-pg-table navtable&#x27; style=&#x27;float:left;table-layout:auto;&#x27;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;),
				sep = &quot;&lt;td class=&#x27;ui-pg-button ui-state-disabled&#x27; style=&#x27;width:4px;&#x27;&gt;&lt;span class=&#x27;ui-separator&#x27;&gt;&lt;/span&gt;&lt;/td&gt;&quot;,
				pgid, elemids;
				if(i===0) {
					pgid = elem;
					elemids = $t.p.id;
					if(pgid === $t.p.toppager) {
						elemids += &quot;_top&quot;;
						clone = 1;
					}
				} else {
					pgid = $t.p.toppager;
					elemids = $t.p.id+&quot;_top&quot;;
				}
				if($t.p.direction === &quot;rtl&quot;) {$(navtbl).attr(&quot;dir&quot;,&quot;rtl&quot;).css(&quot;float&quot;,&quot;right&quot;);}
				if (o.add) {
					pAdd = pAdd || {};
					tbd = $(&quot;&lt;td class=&#x27;ui-pg-button ui-corner-all&#x27;&gt;&lt;/td&gt;&quot;);
					$(tbd).append(&quot;&lt;div class=&#x27;ui-pg-div&#x27;&gt;&lt;span class=&#x27;ui-icon &quot;+o.addicon+&quot;&#x27;&gt;&lt;/span&gt;&quot;+o.addtext+&quot;&lt;/div&gt;&quot;);
					$(&quot;tr&quot;,navtbl).append(tbd);
					$(tbd,navtbl)
					.attr({&quot;title&quot;:o.addtitle || &quot;&quot;,id : pAdd.id || &quot;add_&quot;+elemids})
					.click(function(){
						if (!$(this).hasClass(&#x27;ui-state-disabled&#x27;)) {
							if ($.isFunction( o.addfunc )) {
								o.addfunc.call($t);
							} else {
								$($t).jqGrid(&quot;editGridRow&quot;,&quot;new&quot;,pAdd);
							}
						}
						return false;
					}).hover(onHoverIn, onHoverOut);
					tbd = null;
				}
				if (o.edit) {
					tbd = $(&quot;&lt;td class=&#x27;ui-pg-button ui-corner-all&#x27;&gt;&lt;/td&gt;&quot;);
					pEdit = pEdit || {};
					$(tbd).append(&quot;&lt;div class=&#x27;ui-pg-div&#x27;&gt;&lt;span class=&#x27;ui-icon &quot;+o.editicon+&quot;&#x27;&gt;&lt;/span&gt;&quot;+o.edittext+&quot;&lt;/div&gt;&quot;);
					$(&quot;tr&quot;,navtbl).append(tbd);
					$(tbd,navtbl)
					.attr({&quot;title&quot;:o.edittitle || &quot;&quot;,id: pEdit.id || &quot;edit_&quot;+elemids})
					.click(function(){
						if (!$(this).hasClass(&#x27;ui-state-disabled&#x27;)) {
							var sr = $t.p.selrow;
							if (sr) {
								if($.isFunction( o.editfunc ) ) {
									o.editfunc.call($t, sr);
								} else {
									$($t).jqGrid(&quot;editGridRow&quot;,sr,pEdit);
								}
							} else {
								$.jgrid.viewModal(&quot;#&quot;+alertIDs.themodal,{gbox:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:true});
								$(&quot;#jqg_alrt&quot;).focus();
							}
						}
						return false;
					}).hover(onHoverIn, onHoverOut);
					tbd = null;
				}
				if (o.view) {
					tbd = $(&quot;&lt;td class=&#x27;ui-pg-button ui-corner-all&#x27;&gt;&lt;/td&gt;&quot;);
					pView = pView || {};
					$(tbd).append(&quot;&lt;div class=&#x27;ui-pg-div&#x27;&gt;&lt;span class=&#x27;ui-icon &quot;+o.viewicon+&quot;&#x27;&gt;&lt;/span&gt;&quot;+o.viewtext+&quot;&lt;/div&gt;&quot;);
					$(&quot;tr&quot;,navtbl).append(tbd);
					$(tbd,navtbl)
					.attr({&quot;title&quot;:o.viewtitle || &quot;&quot;,id: pView.id || &quot;view_&quot;+elemids})
					.click(function(){
						if (!$(this).hasClass(&#x27;ui-state-disabled&#x27;)) {
							var sr = $t.p.selrow;
							if (sr) {
								if($.isFunction( o.viewfunc ) ) {
									o.viewfunc.call($t, sr);
								} else {
									$($t).jqGrid(&quot;viewGridRow&quot;,sr,pView);
								}
							} else {
								$.jgrid.viewModal(&quot;#&quot;+alertIDs.themodal,{gbox:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:true});
								$(&quot;#jqg_alrt&quot;).focus();
							}
						}
						return false;
					}).hover(onHoverIn, onHoverOut);
					tbd = null;
				}
				if (o.del) {
					tbd = $(&quot;&lt;td class=&#x27;ui-pg-button ui-corner-all&#x27;&gt;&lt;/td&gt;&quot;);
					pDel = pDel || {};
					$(tbd).append(&quot;&lt;div class=&#x27;ui-pg-div&#x27;&gt;&lt;span class=&#x27;ui-icon &quot;+o.delicon+&quot;&#x27;&gt;&lt;/span&gt;&quot;+o.deltext+&quot;&lt;/div&gt;&quot;);
					$(&quot;tr&quot;,navtbl).append(tbd);
					$(tbd,navtbl)
					.attr({&quot;title&quot;:o.deltitle || &quot;&quot;,id: pDel.id || &quot;del_&quot;+elemids})
					.click(function(){
						if (!$(this).hasClass(&#x27;ui-state-disabled&#x27;)) {
							var dr;
							if($t.p.multiselect) {
								dr = $t.p.selarrrow;
								if(dr.length===0) {dr = null;}
							} else {
								dr = $t.p.selrow;
							}
							if(dr){
								if($.isFunction( o.delfunc )){
									o.delfunc.call($t, dr);
								}else{
									$($t).jqGrid(&quot;delGridRow&quot;,dr,pDel);
								}
							} else  {
								$.jgrid.viewModal(&quot;#&quot;+alertIDs.themodal,{gbox:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:true});$(&quot;#jqg_alrt&quot;).focus();
							}
						}
						return false;
					}).hover(onHoverIn, onHoverOut);
					tbd = null;
				}
				if(o.add || o.edit || o.del || o.view) {$(&quot;tr&quot;,navtbl).append(sep);}
				if (o.search) {
					tbd = $(&quot;&lt;td class=&#x27;ui-pg-button ui-corner-all&#x27;&gt;&lt;/td&gt;&quot;);
					pSearch = pSearch || {};
					$(tbd).append(&quot;&lt;div class=&#x27;ui-pg-div&#x27;&gt;&lt;span class=&#x27;ui-icon &quot;+o.searchicon+&quot;&#x27;&gt;&lt;/span&gt;&quot;+o.searchtext+&quot;&lt;/div&gt;&quot;);
					$(&quot;tr&quot;,navtbl).append(tbd);
					$(tbd,navtbl)
					.attr({&quot;title&quot;:o.searchtitle  || &quot;&quot;,id:pSearch.id || &quot;search_&quot;+elemids})
					.click(function(){
						if (!$(this).hasClass(&#x27;ui-state-disabled&#x27;)) {
							if($.isFunction( o.searchfunc )) {
								o.searchfunc.call($t, pSearch);
							} else {
								$($t).jqGrid(&quot;searchGrid&quot;,pSearch);
							}
						}
						return false;
					}).hover(onHoverIn, onHoverOut);
					if (pSearch.showOnLoad &amp;&amp; pSearch.showOnLoad === true) {
						$(tbd,navtbl).click();
					}
					tbd = null;
				}
				if (o.refresh) {
					tbd = $(&quot;&lt;td class=&#x27;ui-pg-button ui-corner-all&#x27;&gt;&lt;/td&gt;&quot;);
					$(tbd).append(&quot;&lt;div class=&#x27;ui-pg-div&#x27;&gt;&lt;span class=&#x27;ui-icon &quot;+o.refreshicon+&quot;&#x27;&gt;&lt;/span&gt;&quot;+o.refreshtext+&quot;&lt;/div&gt;&quot;);
					$(&quot;tr&quot;,navtbl).append(tbd);
					$(tbd,navtbl)
					.attr({&quot;title&quot;:o.refreshtitle  || &quot;&quot;,id: &quot;refresh_&quot;+elemids})
					.click(function(){
						if (!$(this).hasClass(&#x27;ui-state-disabled&#x27;)) {
							if($.isFunction(o.beforeRefresh)) {o.beforeRefresh.call($t);}
							$t.p.search = false;
							$t.p.resetsearch =  true;
							try {
								var gID = $t.p.id;
								$t.p.postData.filters =&quot;&quot;;
								try {
								$(&quot;#fbox_&quot;+$.jgrid.jqID(gID)).jqFilter(&#x27;resetFilter&#x27;);
								} catch(ef) {}
								if($.isFunction($t.clearToolbar)) {$t.clearToolbar.call($t,false);}
							} catch (e) {}
							switch (o.refreshstate) {
								case &#x27;firstpage&#x27;:
									$($t).trigger(&quot;reloadGrid&quot;, [{page:1}]);
									break;
								case &#x27;current&#x27;:
									$($t).trigger(&quot;reloadGrid&quot;, [{current:true}]);
									break;
							}
							if($.isFunction(o.afterRefresh)) {o.afterRefresh.call($t);}
						}
						return false;
					}).hover(onHoverIn, onHoverOut);
					tbd = null;
				}
				tdw = $(&quot;.ui-jqgrid&quot;).css(&quot;font-size&quot;) || &quot;11px&quot;;
				$(&#x27;body&#x27;).append(&quot;&lt;div id=&#x27;testpg2&#x27; class=&#x27;ui-jqgrid ui-widget ui-widget-content&#x27; style=&#x27;font-size:&quot;+tdw+&quot;;visibility:hidden;&#x27; &gt;&lt;/div&gt;&quot;);
				twd = $(navtbl).clone().appendTo(&quot;#testpg2&quot;).width();
				$(&quot;#testpg2&quot;).remove();
				$(pgid+&quot;_&quot;+o.position,pgid).append(navtbl);
				if($t.p._nvtd) {
					if(twd &gt; $t.p._nvtd[0] ) {
						$(pgid+&quot;_&quot;+o.position,pgid).width(twd);
						$t.p._nvtd[0] = twd;
					}
					$t.p._nvtd[1] = twd;
				}
				tdw =null;twd=null;navtbl =null;
				this.nav = true;
			}
		});
	},
	navButtonAdd : function (elem, p) {
		p = $.extend({
			caption : &quot;newButton&quot;,
			title: &#x27;&#x27;,
			buttonicon : &#x27;ui-icon-newwin&#x27;,
			onClickButton: null,
			position : &quot;last&quot;,
			cursor : &#x27;pointer&#x27;
		}, p ||{});
		return this.each(function() {
			if( !this.grid)  {return;}
			if( typeof elem === &quot;string&quot; &amp;&amp; elem.indexOf(&quot;#&quot;) !== 0) {elem = &quot;#&quot;+$.jgrid.jqID(elem);}
			var findnav = $(&quot;.navtable&quot;,elem)[0], $t = this;
			if (findnav) {
				if( p.id &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(p.id), findnav)[0] !== undefined )  {return;}
				var tbd = $(&quot;&lt;td&gt;&lt;/td&gt;&quot;);
				if(p.buttonicon.toString().toUpperCase() === &quot;NONE&quot;) {
                    $(tbd).addClass(&#x27;ui-pg-button ui-corner-all&#x27;).append(&quot;&lt;div class=&#x27;ui-pg-div&#x27;&gt;&quot;+p.caption+&quot;&lt;/div&gt;&quot;);
				} else	{
					$(tbd).addClass(&#x27;ui-pg-button ui-corner-all&#x27;).append(&quot;&lt;div class=&#x27;ui-pg-div&#x27;&gt;&lt;span class=&#x27;ui-icon &quot;+p.buttonicon+&quot;&#x27;&gt;&lt;/span&gt;&quot;+p.caption+&quot;&lt;/div&gt;&quot;);
				}
				if(p.id) {$(tbd).attr(&quot;id&quot;,p.id);}
				if(p.position===&#x27;first&#x27;){
					if(findnav.rows[0].cells.length ===0 ) {
						$(&quot;tr&quot;,findnav).append(tbd);
					} else {
						$(&quot;tr td:eq(0)&quot;,findnav).before(tbd);
					}
				} else {
					$(&quot;tr&quot;,findnav).append(tbd);
				}
				$(tbd,findnav)
				.attr(&quot;title&quot;,p.title  || &quot;&quot;)
				.click(function(e){
					if (!$(this).hasClass(&#x27;ui-state-disabled&#x27;)) {
						if ($.isFunction(p.onClickButton) ) {p.onClickButton.call($t,e);}
					}
					return false;
				})
				.hover(
					function () {
						if (!$(this).hasClass(&#x27;ui-state-disabled&#x27;)) {
							$(this).addClass(&#x27;ui-state-hover&#x27;);
						}
					},
					function () {$(this).removeClass(&quot;ui-state-hover&quot;);}
				);
			}
		});
	},
	navSeparatorAdd:function (elem,p) {
		p = $.extend({
			sepclass : &quot;ui-separator&quot;,
			sepcontent: &#x27;&#x27;,
			position : &quot;last&quot;
		}, p ||{});
		return this.each(function() {
			if( !this.grid)  {return;}
			if( typeof elem === &quot;string&quot; &amp;&amp; elem.indexOf(&quot;#&quot;) !== 0) {elem = &quot;#&quot;+$.jgrid.jqID(elem);}
			var findnav = $(&quot;.navtable&quot;,elem)[0];
			if(findnav) {
				var sep = &quot;&lt;td class=&#x27;ui-pg-button ui-state-disabled&#x27; style=&#x27;width:4px;&#x27;&gt;&lt;span class=&#x27;&quot;+p.sepclass+&quot;&#x27;&gt;&lt;/span&gt;&quot;+p.sepcontent+&quot;&lt;/td&gt;&quot;;
				if (p.position === &#x27;first&#x27;) {
					if (findnav.rows[0].cells.length === 0) {
						$(&quot;tr&quot;, findnav).append(sep);
					} else {
						$(&quot;tr td:eq(0)&quot;, findnav).before(sep);
					}
				} else {
					$(&quot;tr&quot;, findnav).append(sep);
				}
			}
		});
	},
	GridToForm : function( rowid, formid ) {
		return this.each(function(){
			var $t = this, i;
			if (!$t.grid) {return;}
			var rowdata = $($t).jqGrid(&quot;getRowData&quot;,rowid);
			if (rowdata) {
				for(i in rowdata) {
					if(rowdata.hasOwnProperty(i)) {
					if ( $(&quot;[name=&quot;+$.jgrid.jqID(i)+&quot;]&quot;,formid).is(&quot;input:radio&quot;) || $(&quot;[name=&quot;+$.jgrid.jqID(i)+&quot;]&quot;,formid).is(&quot;input:checkbox&quot;))  {
						$(&quot;[name=&quot;+$.jgrid.jqID(i)+&quot;]&quot;,formid).each( function() {
							if( $(this).val() == rowdata[i] ) {
								$(this)[$t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;,true);
							} else {
								$(this)[$t.p.useProp ? &#x27;prop&#x27;: &#x27;attr&#x27;](&quot;checked&quot;, false);
							}
						});
					} else {
					// this is very slow on big table and form.
						$(&quot;[name=&quot;+$.jgrid.jqID(i)+&quot;]&quot;,formid).val(rowdata[i]);
					}
				}
			}
			}
		});
	},
	FormToGrid : function(rowid, formid, mode, position){
		return this.each(function() {
			var $t = this;
			if(!$t.grid) {return;}
			if(!mode) {mode = &#x27;set&#x27;;}
			if(!position) {position = &#x27;first&#x27;;}
			var fields = $(formid).serializeArray();
			var griddata = {};
			$.each(fields, function(i, field){
				griddata[field.name] = field.value;
			});
			if(mode===&#x27;add&#x27;) {$($t).jqGrid(&quot;addRowData&quot;,rowid,griddata, position);}
			else if(mode===&#x27;set&#x27;) {$($t).jqGrid(&quot;setRowData&quot;,rowid,griddata);}
		});
	}
});
})(jQuery);
/*jshint eqeqeq:false, eqnull:true, devel:true */
/*global jQuery */
(function($){
/**
 * jqGrid extension for manipulating Grid Data
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/
&quot;use strict&quot;;
$.jgrid.inlineEdit = $.jgrid.inlineEdit || {};
$.jgrid.extend({
//Editing
	editRow : function(rowid,keys,oneditfunc,successfunc, url, extraparam, aftersavefunc,errorfunc, afterrestorefunc) {
		// Compatible mode old versions
		var o={}, args = $.makeArray(arguments).slice(1);

		if( $.type(args[0]) === &quot;object&quot; ) {
			o = args[0];
		} else {
			if (keys !== undefined) { o.keys = keys; }
			if ($.isFunction(oneditfunc)) { o.oneditfunc = oneditfunc; }
			if ($.isFunction(successfunc)) { o.successfunc = successfunc; }
			if (url !== undefined) { o.url = url; }
			if (extraparam !== undefined) { o.extraparam = extraparam; }
			if ($.isFunction(aftersavefunc)) { o.aftersavefunc = aftersavefunc; }
			if ($.isFunction(errorfunc)) { o.errorfunc = errorfunc; }
			if ($.isFunction(afterrestorefunc)) { o.afterrestorefunc = afterrestorefunc; }
			// last two not as param, but as object (sorry)
			//if (restoreAfterError !== undefined) { o.restoreAfterError = restoreAfterError; }
			//if (mtype !== undefined) { o.mtype = mtype || &quot;POST&quot;; }
		}
		o = $.extend(true, {
			keys : false,
			oneditfunc: null,
			successfunc: null,
			url: null,
			extraparam: {},
			aftersavefunc: null,
			errorfunc: null,
			afterrestorefunc: null,
			restoreAfterError: true,
			mtype: &quot;POST&quot;
		}, $.jgrid.inlineEdit, o );

		// End compatible
		return this.each(function(){
			var $t = this, nm, tmp, editable, cnt=0, focus=null, svr={}, ind,cm, bfer;
			if (!$t.grid ) { return; }
			ind = $($t).jqGrid(&quot;getInd&quot;,rowid,true);
			if( ind === false ) {return;}
			bfer = $.isFunction( o.beforeEditRow ) ? o.beforeEditRow.call($t,o, rowid) :  undefined;
			if( bfer === undefined ) {
				bfer = true;
			}
			if(!bfer) { return; }
			editable = $(ind).attr(&quot;editable&quot;) || &quot;0&quot;;
			if (editable === &quot;0&quot; &amp;&amp; !$(ind).hasClass(&quot;not-editable-row&quot;)) {
				cm = $t.p.colModel;
				$(&#x27;td[role=&quot;gridcell&quot;]&#x27;,ind).each( function(i) {
					nm = cm[i].name;
					var treeg = $t.p.treeGrid===true &amp;&amp; nm === $t.p.ExpandColumn;
					if(treeg) { tmp = $(&quot;span:first&quot;,this).html();}
					else {
						try {
							tmp = $.unformat.call($t,this,{rowId:rowid, colModel:cm[i]},i);
						} catch (_) {
							tmp =  ( cm[i].edittype &amp;&amp; cm[i].edittype === &#x27;textarea&#x27; ) ? $(this).text() : $(this).html();
						}
					}
					if ( nm !== &#x27;cb&#x27; &amp;&amp; nm !== &#x27;subgrid&#x27; &amp;&amp; nm !== &#x27;rn&#x27;) {
						if($t.p.autoencode) { tmp = $.jgrid.htmlDecode(tmp); }
						svr[nm]=tmp;
						if(cm[i].editable===true) {
							if(focus===null) { focus = i; }
							if (treeg) { $(&quot;span:first&quot;,this).html(&quot;&quot;); }
							else { $(this).html(&quot;&quot;); }
							var opt = $.extend({},cm[i].editoptions || {},{id:rowid+&quot;_&quot;+nm,name:nm});
							if(!cm[i].edittype) { cm[i].edittype = &quot;text&quot;; }
							if(tmp === &quot;&amp;nbsp;&quot; || tmp === &quot;&amp;#160;&quot; || (tmp.length===1 &amp;&amp; tmp.charCodeAt(0)===160) ) {tmp=&#x27;&#x27;;}
							var elc = $.jgrid.createEl.call($t,cm[i].edittype,opt,tmp,true,$.extend({},$.jgrid.ajaxOptions,$t.p.ajaxSelectOptions || {}));
							$(elc).addClass(&quot;editable&quot;);
							if(treeg) { $(&quot;span:first&quot;,this).append(elc); }
							else { $(this).append(elc); }
							$.jgrid.bindEv.call($t, elc, opt);
							//Again IE
							if(cm[i].edittype === &quot;select&quot; &amp;&amp; cm[i].editoptions!==undefined &amp;&amp; cm[i].editoptions.multiple===true  &amp;&amp; cm[i].editoptions.dataUrl===undefined &amp;&amp; $.jgrid.msie) {
								$(elc).width($(elc).width());
							}
							cnt++;
						}
					}
				});
				if(cnt &gt; 0) {
					svr.id = rowid; $t.p.savedRow.push(svr);
					$(ind).attr(&quot;editable&quot;,&quot;1&quot;);
					setTimeout(function(){$(&quot;td:eq(&quot;+focus+&quot;) input&quot;,ind).focus();},0);
					if(o.keys===true) {
						$(ind).bind(&quot;keydown&quot;,function(e) {
							if (e.keyCode === 27) {
								$($t).jqGrid(&quot;restoreRow&quot;,rowid, o.afterrestorefunc);
								if($t.p._inlinenav) {
									try {
										$($t).jqGrid(&#x27;showAddEditButtons&#x27;);
									} catch (eer1) {}
								}
								return false;
							}
							if (e.keyCode === 13) {
								var ta = e.target;
								if(ta.tagName === &#x27;TEXTAREA&#x27;) { return true; }
								if( $($t).jqGrid(&quot;saveRow&quot;, rowid, o ) ) {
									if($t.p._inlinenav) {
										try {
											$($t).jqGrid(&#x27;showAddEditButtons&#x27;);
										} catch (eer2) {}
									}
								}
								return false;
							}
						});
					}
					$($t).triggerHandler(&quot;jqGridInlineEditRow&quot;, [rowid, o]);
					if( $.isFunction(o.oneditfunc)) { o.oneditfunc.call($t, rowid); }
				}
			}
		});
	},
	saveRow : function(rowid, successfunc, url, extraparam, aftersavefunc,errorfunc, afterrestorefunc) {
		// Compatible mode old versions
		var args = $.makeArray(arguments).slice(1), o = {};

		if( $.type(args[0]) === &quot;object&quot; ) {
			o = args[0];
		} else {
			if ($.isFunction(successfunc)) { o.successfunc = successfunc; }
			if (url !== undefined) { o.url = url; }
			if (extraparam !== undefined) { o.extraparam = extraparam; }
			if ($.isFunction(aftersavefunc)) { o.aftersavefunc = aftersavefunc; }
			if ($.isFunction(errorfunc)) { o.errorfunc = errorfunc; }
			if ($.isFunction(afterrestorefunc)) { o.afterrestorefunc = afterrestorefunc; }
		}
		o = $.extend(true, {
			successfunc: null,
			url: null,
			extraparam: {},
			aftersavefunc: null,
			errorfunc: null,
			afterrestorefunc: null,
			restoreAfterError: true,
			mtype: &quot;POST&quot;
		}, $.jgrid.inlineEdit, o );
		// End compatible

		var success = false;
		var $t = this[0], nm, tmp={}, tmp2={}, tmp3= {}, editable, fr, cv, ind;
		if (!$t.grid ) { return success; }
		ind = $($t).jqGrid(&quot;getInd&quot;,rowid,true);
		if(ind === false) {return success;}
		var bfsr = $.isFunction( o.beforeSaveRow ) ?	o.beforeSaveRow.call($t,o, rowid) :  undefined;
		if( bfsr === undefined ) {
			bfsr = true;
		}
		if(!bfsr) { return; }
		editable = $(ind).attr(&quot;editable&quot;);
		o.url = o.url || $t.p.editurl;
		if (editable===&quot;1&quot;) {
			var cm;
			$(&#x27;td[role=&quot;gridcell&quot;]&#x27;,ind).each(function(i) {
				cm = $t.p.colModel[i];
				nm = cm.name;
				if ( nm !== &#x27;cb&#x27; &amp;&amp; nm !== &#x27;subgrid&#x27; &amp;&amp; cm.editable===true &amp;&amp; nm !== &#x27;rn&#x27; &amp;&amp; !$(this).hasClass(&#x27;not-editable-cell&#x27;)) {
					switch (cm.edittype) {
						case &quot;checkbox&quot;:
							var cbv = [&quot;Yes&quot;,&quot;No&quot;];
							if(cm.editoptions ) {
								cbv = cm.editoptions.value.split(&quot;:&quot;);
							}
							tmp[nm]=  $(&quot;input&quot;,this).is(&quot;:checked&quot;) ? cbv[0] : cbv[1];
							break;
						case &#x27;text&#x27;:
						case &#x27;password&#x27;:
						case &#x27;textarea&#x27;:
						case &quot;button&quot; :
							tmp[nm]=$(&quot;input, textarea&quot;,this).val();
							break;
						case &#x27;select&#x27;:
							if(!cm.editoptions.multiple) {
								tmp[nm] = $(&quot;select option:selected&quot;,this).val();
								tmp2[nm] = $(&quot;select option:selected&quot;, this).text();
							} else {
								var sel = $(&quot;select&quot;,this), selectedText = [];
								tmp[nm] = $(sel).val();
								if(tmp[nm]) { tmp[nm]= tmp[nm].join(&quot;,&quot;); } else { tmp[nm] =&quot;&quot;; }
								$(&quot;select option:selected&quot;,this).each(
									function(i,selected){
										selectedText[i] = $(selected).text();
									}
								);
								tmp2[nm] = selectedText.join(&quot;,&quot;);
							}
							if(cm.formatter &amp;&amp; cm.formatter === &#x27;select&#x27;) { tmp2={}; }
							break;
						case &#x27;custom&#x27; :
							try {
								if(cm.editoptions &amp;&amp; $.isFunction(cm.editoptions.custom_value)) {
									tmp[nm] = cm.editoptions.custom_value.call($t, $(&quot;.customelement&quot;,this),&#x27;get&#x27;);
									if (tmp[nm] === undefined) { throw &quot;e2&quot;; }
								} else { throw &quot;e1&quot;; }
							} catch (e) {
								if (e===&quot;e1&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function &#x27;custom_value&#x27; &quot;+$.jgrid.edit.msg.nodefined,$.jgrid.edit.bClose); }
								if (e===&quot;e2&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function &#x27;custom_value&#x27; &quot;+$.jgrid.edit.msg.novalue,$.jgrid.edit.bClose); }
								else { $.jgrid.info_dialog($.jgrid.errors.errcap,e.message,$.jgrid.edit.bClose); }
							}
							break;
					}
					cv = $.jgrid.checkValues.call($t,tmp[nm],i);
					if(cv[0] === false) {
						return false;
					}
					if($t.p.autoencode) { tmp[nm] = $.jgrid.htmlEncode(tmp[nm]); }
					if(o.url !== &#x27;clientArray&#x27; &amp;&amp; cm.editoptions &amp;&amp; cm.editoptions.NullIfEmpty === true) {
						if(tmp[nm] === &quot;&quot;) {
							tmp3[nm] = &#x27;null&#x27;;
						}
					}
				}
			});
			if (cv[0] === false){
				try {
					var tr = $($t).jqGrid(&#x27;getGridRowById&#x27;, rowid), positions = $.jgrid.findPos(tr);
					$.jgrid.info_dialog($.jgrid.errors.errcap,cv[1],$.jgrid.edit.bClose,{left:positions[0],top:positions[1]+$(tr).outerHeight()});
				} catch (e) {
					alert(cv[1]);
				}
				return success;
			}
			var idname, opers = $t.p.prmNames, oldRowId = rowid;
			if ($t.p.keyIndex === false) {
				idname = opers.id;
			} else {
				idname = $t.p.colModel[$t.p.keyIndex +
					($t.p.rownumbers === true ? 1 : 0) +
					($t.p.multiselect === true ? 1 : 0) +
					($t.p.subGrid === true ? 1 : 0)].name;
			}
			if(tmp) {
				tmp[opers.oper] = opers.editoper;
				if (tmp[idname] === undefined || tmp[idname]===&quot;&quot;) {
					tmp[idname] = rowid;
				} else if (ind.id !== $t.p.idPrefix + tmp[idname]) {
					// rename rowid
					var oldid = $.jgrid.stripPref($t.p.idPrefix, rowid);
					if ($t.p._index[oldid] !== undefined) {
						$t.p._index[tmp[idname]] = $t.p._index[oldid];
						delete $t.p._index[oldid];
					}
					rowid = $t.p.idPrefix + tmp[idname];
					$(ind).attr(&quot;id&quot;, rowid);
					if ($t.p.selrow === oldRowId) {
						$t.p.selrow = rowid;
					}
					if ($.isArray($t.p.selarrrow)) {
						var i = $.inArray(oldRowId, $t.p.selarrrow);
						if (i&gt;=0) {
							$t.p.selarrrow[i] = rowid;
						}
					}
					if ($t.p.multiselect) {
						var newCboxId = &quot;jqg_&quot; + $t.p.id + &quot;_&quot; + rowid;
						$(&quot;input.cbox&quot;,ind)
							.attr(&quot;id&quot;, newCboxId)
							.attr(&quot;name&quot;, newCboxId);
					}
					// TODO: to test the case of frozen columns
				}
				if($t.p.inlineData === undefined) { $t.p.inlineData ={}; }
				tmp = $.extend({},tmp,$t.p.inlineData,o.extraparam);
			}
			if (o.url === &#x27;clientArray&#x27;) {
				tmp = $.extend({},tmp, tmp2);
				if($t.p.autoencode) {
					$.each(tmp,function(n,v){
						tmp[n] = $.jgrid.htmlDecode(v);
					});
				}
				var k, resp = $($t).jqGrid(&quot;setRowData&quot;,rowid,tmp);
				$(ind).attr(&quot;editable&quot;,&quot;0&quot;);
				for(k=0;k&lt;$t.p.savedRow.length;k++) {
					if( String($t.p.savedRow[k].id) === String(oldRowId)) {fr = k; break;}
				}
				if(fr &gt;= 0) { $t.p.savedRow.splice(fr,1); }
				$($t).triggerHandler(&quot;jqGridInlineAfterSaveRow&quot;, [rowid, resp, tmp, o]);
				if( $.isFunction(o.aftersavefunc) ) { o.aftersavefunc.call($t, rowid,resp, o); }
				success = true;
				$(ind).removeClass(&quot;jqgrid-new-row&quot;).unbind(&quot;keydown&quot;);
			} else {
				$(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).show();
				tmp3 = $.extend({},tmp,tmp3);
				tmp3[idname] = $.jgrid.stripPref($t.p.idPrefix, tmp3[idname]);
				$.ajax($.extend({
					url:o.url,
					data: $.isFunction($t.p.serializeRowData) ? $t.p.serializeRowData.call($t, tmp3) : tmp3,
					type: o.mtype,
					async : false, //?!?
					complete: function(res,stat){
						$(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).hide();
						if (stat === &quot;success&quot;){
							var ret = true, sucret, k;
							sucret = $($t).triggerHandler(&quot;jqGridInlineSuccessSaveRow&quot;, [res, rowid, o]);
							if (!$.isArray(sucret)) {sucret = [true, tmp];}
							if (sucret[0] &amp;&amp; $.isFunction(o.successfunc)) {sucret = o.successfunc.call($t, res);}
							if($.isArray(sucret)) {
								// expect array - status, data, rowid
								ret = sucret[0];
								tmp = sucret[1] || tmp;
							} else {
								ret = sucret;
							}
							if (ret===true) {
								if($t.p.autoencode) {
									$.each(tmp,function(n,v){
										tmp[n] = $.jgrid.htmlDecode(v);
									});
								}
								tmp = $.extend({},tmp, tmp2);
								$($t).jqGrid(&quot;setRowData&quot;,rowid,tmp);
								$(ind).attr(&quot;editable&quot;,&quot;0&quot;);
								for(k=0;k&lt;$t.p.savedRow.length;k++) {
									if( String($t.p.savedRow[k].id) === String(rowid)) {fr = k; break;}
								}
								if(fr &gt;= 0) { $t.p.savedRow.splice(fr,1); }
								$($t).triggerHandler(&quot;jqGridInlineAfterSaveRow&quot;, [rowid, res, tmp, o]);
								if( $.isFunction(o.aftersavefunc) ) { o.aftersavefunc.call($t, rowid,res); }
								success = true;
								$(ind).removeClass(&quot;jqgrid-new-row&quot;).unbind(&quot;keydown&quot;);
							} else {
								$($t).triggerHandler(&quot;jqGridInlineErrorSaveRow&quot;, [rowid, res, stat, null, o]);
								if($.isFunction(o.errorfunc) ) {
									o.errorfunc.call($t, rowid, res, stat, null);
								}
								if(o.restoreAfterError === true) {
									$($t).jqGrid(&quot;restoreRow&quot;,rowid, o.afterrestorefunc);
								}
							}
						}
					},
					error:function(res,stat,err){
						$(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).hide();
						$($t).triggerHandler(&quot;jqGridInlineErrorSaveRow&quot;, [rowid, res, stat, err, o]);
						if($.isFunction(o.errorfunc) ) {
							o.errorfunc.call($t, rowid, res, stat, err);
						} else {
							var rT = res.responseText || res.statusText;
							try {
								$.jgrid.info_dialog($.jgrid.errors.errcap,&#x27;&lt;div class=&quot;ui-state-error&quot;&gt;&#x27;+ rT +&#x27;&lt;/div&gt;&#x27;, $.jgrid.edit.bClose,{buttonalign:&#x27;right&#x27;});
							} catch(e) {
								alert(rT);
							}
						}
						if(o.restoreAfterError === true) {
							$($t).jqGrid(&quot;restoreRow&quot;,rowid, o.afterrestorefunc);
						}
					}
				}, $.jgrid.ajaxOptions, $t.p.ajaxRowOptions || {}));
			}
		}
		return success;
	},
	restoreRow : function(rowid, afterrestorefunc) {
		// Compatible mode old versions
		var args = $.makeArray(arguments).slice(1), o={};

		if( $.type(args[0]) === &quot;object&quot; ) {
			o = args[0];
		} else {
			if ($.isFunction(afterrestorefunc)) { o.afterrestorefunc = afterrestorefunc; }
		}
		o = $.extend(true, {}, $.jgrid.inlineEdit, o );

		// End compatible

		return this.each(function(){
			var $t= this, fr=-1, ind, ares={}, k;
			if (!$t.grid ) { return; }
			ind = $($t).jqGrid(&quot;getInd&quot;,rowid,true);
			if(ind === false) {return;}
			var bfcr = $.isFunction( o.beforeCancelRow ) ?	o.beforeCancelRow.call($t, o, sr) :  undefined;
			if( bfcr === undefined ) {
				bfcr = true;
			}
			if(!bfcr) { return; }
			for(k=0;k&lt;$t.p.savedRow.length;k++) {
				if( String($t.p.savedRow[k].id) === String(rowid)) {fr = k; break;}
			}
			if(fr &gt;= 0) {
				if($.isFunction($.fn.datepicker)) {
					try {
						$(&quot;input.hasDatepicker&quot;,&quot;#&quot;+$.jgrid.jqID(ind.id)).datepicker(&#x27;hide&#x27;);
					} catch (e) {}
				}
				$.each($t.p.colModel, function(){
					if(this.editable === true &amp;&amp; $t.p.savedRow[fr].hasOwnProperty(this.name)) {
						ares[this.name] = $t.p.savedRow[fr][this.name];
					}
				});
				$($t).jqGrid(&quot;setRowData&quot;,rowid,ares);
				$(ind).attr(&quot;editable&quot;,&quot;0&quot;).unbind(&quot;keydown&quot;);
				$t.p.savedRow.splice(fr,1);
				if($(&quot;#&quot;+$.jgrid.jqID(rowid), &quot;#&quot;+$.jgrid.jqID($t.p.id)).hasClass(&quot;jqgrid-new-row&quot;)){
					setTimeout(function(){
						$($t).jqGrid(&quot;delRowData&quot;,rowid);
						$($t).jqGrid(&#x27;showAddEditButtons&#x27;);
					},0);
				}
			}
			$($t).triggerHandler(&quot;jqGridInlineAfterRestoreRow&quot;, [rowid]);
			if ($.isFunction(o.afterrestorefunc))
			{
				o.afterrestorefunc.call($t, rowid);
			}
		});
	},
	addRow : function ( p ) {
		p = $.extend(true, {
			rowID : null,
			initdata : {},
			position :&quot;first&quot;,
			useDefValues : true,
			useFormatter : false,
			addRowParams : {extraparam:{}}
		},p  || {});
		return this.each(function(){
			if (!this.grid ) { return; }
			var $t = this;
			var bfar = $.isFunction( p.beforeAddRow ) ?	p.beforeAddRow.call($t,p.addRowParams) :  undefined;
			if( bfar === undefined ) {
				bfar = true;
			}
			if(!bfar) { return; }
			p.rowID = $.isFunction(p.rowID) ? p.rowID.call($t, p) : ( (p.rowID != null) ? p.rowID : $.jgrid.randId());
			if(p.useDefValues === true) {
				$($t.p.colModel).each(function(){
					if( this.editoptions &amp;&amp; this.editoptions.defaultValue ) {
						var opt = this.editoptions.defaultValue,
						tmp = $.isFunction(opt) ? opt.call($t) : opt;
						p.initdata[this.name] = tmp;
					}
				});
			}
			$($t).jqGrid(&#x27;addRowData&#x27;, p.rowID, p.initdata, p.position);
			p.rowID = $t.p.idPrefix + p.rowID;
			$(&quot;#&quot;+$.jgrid.jqID(p.rowID), &quot;#&quot;+$.jgrid.jqID($t.p.id)).addClass(&quot;jqgrid-new-row&quot;);
			if(p.useFormatter) {
				$(&quot;#&quot;+$.jgrid.jqID(p.rowID)+&quot; .ui-inline-edit&quot;, &quot;#&quot;+$.jgrid.jqID($t.p.id)).click();
			} else {
				var opers = $t.p.prmNames,
				oper = opers.oper;
				p.addRowParams.extraparam[oper] = opers.addoper;
				$($t).jqGrid(&#x27;editRow&#x27;, p.rowID, p.addRowParams);
				$($t).jqGrid(&#x27;setSelection&#x27;, p.rowID);
			}
		});
	},
	inlineNav : function (elem, o) {
		o = $.extend(true,{
			edit: true,
			editicon: &quot;ui-icon-pencil&quot;,
			add: true,
			addicon:&quot;ui-icon-plus&quot;,
			save: true,
			saveicon:&quot;ui-icon-disk&quot;,
			cancel: true,
			cancelicon:&quot;ui-icon-cancel&quot;,
			addParams : {addRowParams: {extraparam: {}}},
			editParams : {},
			restoreAfterSelect : true
		}, $.jgrid.nav, o ||{});
		return this.each(function(){
			if (!this.grid ) { return; }
			var $t = this, onSelect, gID = $.jgrid.jqID($t.p.id);
			$t.p._inlinenav = true;
			// detect the formatactions column
			if(o.addParams.useFormatter === true) {
				var cm = $t.p.colModel,i;
				for (i = 0; i&lt;cm.length; i++) {
					if(cm[i].formatter &amp;&amp; cm[i].formatter === &quot;actions&quot; ) {
						if(cm[i].formatoptions) {
							var defaults =  {
								keys:false,
								onEdit : null,
								onSuccess: null,
								afterSave:null,
								onError: null,
								afterRestore: null,
								extraparam: {},
								url: null
							},
							ap = $.extend( defaults, cm[i].formatoptions );
							o.addParams.addRowParams = {
								&quot;keys&quot; : ap.keys,
								&quot;oneditfunc&quot; : ap.onEdit,
								&quot;successfunc&quot; : ap.onSuccess,
								&quot;url&quot; : ap.url,
								&quot;extraparam&quot; : ap.extraparam,
								&quot;aftersavefunc&quot; : ap.afterSave,
								&quot;errorfunc&quot;: ap.onError,
								&quot;afterrestorefunc&quot; : ap.afterRestore
							};
						}
						break;
					}
				}
			}
			if(o.add) {
				$($t).jqGrid(&#x27;navButtonAdd&#x27;, elem,{
					caption : o.addtext,
					title : o.addtitle,
					buttonicon : o.addicon,
					id : $t.p.id+&quot;_iladd&quot;,
					onClickButton : function () {
						$($t).jqGrid(&#x27;addRow&#x27;, o.addParams);
						if(!o.addParams.useFormatter) {
							$(&quot;#&quot;+gID+&quot;_ilsave&quot;).removeClass(&#x27;ui-state-disabled&#x27;);
							$(&quot;#&quot;+gID+&quot;_ilcancel&quot;).removeClass(&#x27;ui-state-disabled&#x27;);
							$(&quot;#&quot;+gID+&quot;_iladd&quot;).addClass(&#x27;ui-state-disabled&#x27;);
							$(&quot;#&quot;+gID+&quot;_iledit&quot;).addClass(&#x27;ui-state-disabled&#x27;);
						}
					}
				});
			}
			if(o.edit) {
				$($t).jqGrid(&#x27;navButtonAdd&#x27;, elem,{
					caption : o.edittext,
					title : o.edittitle,
					buttonicon : o.editicon,
					id : $t.p.id+&quot;_iledit&quot;,
					onClickButton : function () {
						var sr = $($t).jqGrid(&#x27;getGridParam&#x27;,&#x27;selrow&#x27;);
						if(sr) {
							$($t).jqGrid(&#x27;editRow&#x27;, sr, o.editParams);
							$(&quot;#&quot;+gID+&quot;_ilsave&quot;).removeClass(&#x27;ui-state-disabled&#x27;);
							$(&quot;#&quot;+gID+&quot;_ilcancel&quot;).removeClass(&#x27;ui-state-disabled&#x27;);
							$(&quot;#&quot;+gID+&quot;_iladd&quot;).addClass(&#x27;ui-state-disabled&#x27;);
							$(&quot;#&quot;+gID+&quot;_iledit&quot;).addClass(&#x27;ui-state-disabled&#x27;);
						} else {
							$.jgrid.viewModal(&quot;#alertmod&quot;,{gbox:&quot;#gbox_&quot;+gID,jqm:true});$(&quot;#jqg_alrt&quot;).focus();
						}
					}
				});
			}
			if(o.save) {
				$($t).jqGrid(&#x27;navButtonAdd&#x27;, elem,{
					caption : o.savetext || &#x27;&#x27;,
					title : o.savetitle || &#x27;Save row&#x27;,
					buttonicon : o.saveicon,
					id : $t.p.id+&quot;_ilsave&quot;,
					onClickButton : function () {
						var sr = $t.p.savedRow[0].id;
						if(sr) {
							var opers = $t.p.prmNames,
							oper = opers.oper, tmpParams = o.editParams;
							if($(&quot;#&quot;+$.jgrid.jqID(sr), &quot;#&quot;+gID ).hasClass(&quot;jqgrid-new-row&quot;)) {
								o.addParams.addRowParams.extraparam[oper] = opers.addoper;
								tmpParams = o.addParams.addRowParams;
							} else {
								if(!o.editParams.extraparam) {
									o.editParams.extraparam = {};
								}
								o.editParams.extraparam[oper] = opers.editoper;
							}
							if( $($t).jqGrid(&#x27;saveRow&#x27;, sr, tmpParams) ) {
								$($t).jqGrid(&#x27;showAddEditButtons&#x27;);
							}
						} else {
							$.jgrid.viewModal(&quot;#alertmod&quot;,{gbox:&quot;#gbox_&quot;+gID,jqm:true});$(&quot;#jqg_alrt&quot;).focus();
						}
					}
				});
				$(&quot;#&quot;+gID+&quot;_ilsave&quot;).addClass(&#x27;ui-state-disabled&#x27;);
			}
			if(o.cancel) {
				$($t).jqGrid(&#x27;navButtonAdd&#x27;, elem,{
					caption : o.canceltext || &#x27;&#x27;,
					title : o.canceltitle || &#x27;Cancel row editing&#x27;,
					buttonicon : o.cancelicon,
					id : $t.p.id+&quot;_ilcancel&quot;,
					onClickButton : function () {
						var sr = $t.p.savedRow[0].id, cancelPrm = o.editParams;
						if(sr) {
							if($(&quot;#&quot;+$.jgrid.jqID(sr), &quot;#&quot;+gID ).hasClass(&quot;jqgrid-new-row&quot;)) {
								cancelPrm = o.addParams.addRowParams;
							}
							$($t).jqGrid(&#x27;restoreRow&#x27;, sr, cancelPrm);
							$($t).jqGrid(&#x27;showAddEditButtons&#x27;);
						} else {
							$.jgrid.viewModal(&quot;#alertmod&quot;,{gbox:&quot;#gbox_&quot;+gID,jqm:true});$(&quot;#jqg_alrt&quot;).focus();
						}
					}
				});
				$(&quot;#&quot;+gID+&quot;_ilcancel&quot;).addClass(&#x27;ui-state-disabled&#x27;);
			}
			if(o.restoreAfterSelect === true) {
				if($.isFunction($t.p.beforeSelectRow)) {
					onSelect = $t.p.beforeSelectRow;
				} else {
					onSelect =  false;
				}
				$t.p.beforeSelectRow = function(id, stat) {
					var ret = true;
					if($t.p.savedRow.length &gt; 0 &amp;&amp; $t.p._inlinenav===true &amp;&amp; ( id !== $t.p.selrow &amp;&amp; $t.p.selrow !==null) ) {
						if($t.p.selrow === o.addParams.rowID ) {
							$($t).jqGrid(&#x27;delRowData&#x27;, $t.p.selrow);
						} else {
							$($t).jqGrid(&#x27;restoreRow&#x27;, $t.p.selrow, o.editParams);
						}
						$($t).jqGrid(&#x27;showAddEditButtons&#x27;);
					}
					if(onSelect) {
						ret = onSelect.call($t, id, stat);
					}
					return ret;
				};
			}

		});
	},
	showAddEditButtons : function()  {
		return this.each(function(){
			if (!this.grid ) { return; }
			var gID = $.jgrid.jqID(this.p.id);
			$(&quot;#&quot;+gID+&quot;_ilsave&quot;).addClass(&#x27;ui-state-disabled&#x27;);
			$(&quot;#&quot;+gID+&quot;_ilcancel&quot;).addClass(&#x27;ui-state-disabled&#x27;);
			$(&quot;#&quot;+gID+&quot;_iladd&quot;).removeClass(&#x27;ui-state-disabled&#x27;);
			$(&quot;#&quot;+gID+&quot;_iledit&quot;).removeClass(&#x27;ui-state-disabled&#x27;);
		});
	}
//end inline edit
});
})(jQuery);
/*jshint eqeqeq:false */
/*global jQuery */
(function($){
/*
**
 * jqGrid extension for cellediting Grid Data
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/
/**
 * all events and options here are aded anonynous and not in the base grid
 * since the array is to big. Here is the order of execution.
 * From this point we use jQuery isFunction
 * formatCell
 * beforeEditCell,
 * onSelectCell (used only for noneditable cels)
 * afterEditCell,
 * beforeSaveCell, (called before validation of values if any)
 * beforeSubmitCell (if cellsubmit remote (ajax))
 * afterSubmitCell(if cellsubmit remote (ajax)),
 * afterSaveCell,
 * errorCell,
 * serializeCellData - new
 * Options
 * cellsubmit (remote,clientArray) (added in grid options)
 * cellurl
 * ajaxCellOptions
* */
&quot;use strict&quot;;
$.jgrid.extend({
	editCell : function (iRow,iCol, ed){
		return this.each(function (){
			var $t = this, nm, tmp,cc, cm;
			if (!$t.grid || $t.p.cellEdit !== true) {return;}
			iCol = parseInt(iCol,10);
			// select the row that can be used for other methods
			$t.p.selrow = $t.rows[iRow].id;
			if (!$t.p.knv) {$($t).jqGrid(&quot;GridNav&quot;);}
			// check to see if we have already edited cell
			if ($t.p.savedRow.length&gt;0) {
				// prevent second click on that field and enable selects
				if (ed===true ) {
					if(iRow == $t.p.iRow &amp;&amp; iCol == $t.p.iCol){
						return;
					}
				}
				// save the cell
				$($t).jqGrid(&quot;saveCell&quot;,$t.p.savedRow[0].id,$t.p.savedRow[0].ic);
			} else {
				window.setTimeout(function () { $(&quot;#&quot;+$.jgrid.jqID($t.p.knv)).attr(&quot;tabindex&quot;,&quot;-1&quot;).focus();},0);
			}
			cm = $t.p.colModel[iCol];
			nm = cm.name;
			if (nm===&#x27;subgrid&#x27; || nm===&#x27;cb&#x27; || nm===&#x27;rn&#x27;) {return;}
			cc = $(&quot;td:eq(&quot;+iCol+&quot;)&quot;,$t.rows[iRow]);
			if (cm.editable===true &amp;&amp; ed===true &amp;&amp; !cc.hasClass(&quot;not-editable-cell&quot;)) {
				if(parseInt($t.p.iCol,10)&gt;=0  &amp;&amp; parseInt($t.p.iRow,10)&gt;=0) {
					$(&quot;td:eq(&quot;+$t.p.iCol+&quot;)&quot;,$t.rows[$t.p.iRow]).removeClass(&quot;edit-cell ui-state-highlight&quot;);
					$($t.rows[$t.p.iRow]).removeClass(&quot;selected-row ui-state-hover&quot;);
				}
				$(cc).addClass(&quot;edit-cell ui-state-highlight&quot;);
				$($t.rows[iRow]).addClass(&quot;selected-row ui-state-hover&quot;);
				try {
					tmp =  $.unformat.call($t,cc,{rowId: $t.rows[iRow].id, colModel:cm},iCol);
				} catch (_) {
					tmp = ( cm.edittype &amp;&amp; cm.edittype === &#x27;textarea&#x27; ) ? $(cc).text() : $(cc).html();
				}
				if($t.p.autoencode) { tmp = $.jgrid.htmlDecode(tmp); }
				if (!cm.edittype) {cm.edittype = &quot;text&quot;;}
				$t.p.savedRow.push({id:iRow,ic:iCol,name:nm,v:tmp});
				if(tmp === &quot;&amp;nbsp;&quot; || tmp === &quot;&amp;#160;&quot; || (tmp.length===1 &amp;&amp; tmp.charCodeAt(0)===160) ) {tmp=&#x27;&#x27;;}
				if($.isFunction($t.p.formatCell)) {
					var tmp2 = $t.p.formatCell.call($t, $t.rows[iRow].id,nm,tmp,iRow,iCol);
					if(tmp2 !== undefined ) {tmp = tmp2;}
				}
				$($t).triggerHandler(&quot;jqGridBeforeEditCell&quot;, [$t.rows[iRow].id, nm, tmp, iRow, iCol]);
				if ($.isFunction($t.p.beforeEditCell)) {
					$t.p.beforeEditCell.call($t, $t.rows[iRow].id,nm,tmp,iRow,iCol);
				}
				var opt = $.extend({}, cm.editoptions || {} ,{id:iRow+&quot;_&quot;+nm,name:nm});
				var elc = $.jgrid.createEl.call($t,cm.edittype,opt,tmp,true,$.extend({},$.jgrid.ajaxOptions,$t.p.ajaxSelectOptions || {}));
				$(cc).html(&quot;&quot;).append(elc).attr(&quot;tabindex&quot;,&quot;0&quot;);
				$.jgrid.bindEv.call($t, elc, opt);
				window.setTimeout(function () { $(elc).focus();},0);
				$(&quot;input, select, textarea&quot;,cc).bind(&quot;keydown&quot;,function(e) {
					if (e.keyCode === 27) {
						if($(&quot;input.hasDatepicker&quot;,cc).length &gt;0) {
							if( $(&quot;.ui-datepicker&quot;).is(&quot;:hidden&quot;) )  { $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); }
							else { $(&quot;input.hasDatepicker&quot;,cc).datepicker(&#x27;hide&#x27;); }
						} else {
							$($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol);
						}
					} //ESC
					if (e.keyCode === 13) {
						$($t).jqGrid(&quot;saveCell&quot;,iRow,iCol);
						// Prevent default action
						return false;
					} //Enter
					if (e.keyCode === 9)  {
						if(!$t.grid.hDiv.loading ) {
							if (e.shiftKey) {$($t).jqGrid(&quot;prevCell&quot;,iRow,iCol);} //Shift TAb
							else {$($t).jqGrid(&quot;nextCell&quot;,iRow,iCol);} //Tab
						} else {
							return false;
						}
					}
					e.stopPropagation();
				});
				$($t).triggerHandler(&quot;jqGridAfterEditCell&quot;, [$t.rows[iRow].id, nm, tmp, iRow, iCol]);
				if ($.isFunction($t.p.afterEditCell)) {
					$t.p.afterEditCell.call($t, $t.rows[iRow].id,nm,tmp,iRow,iCol);
				}
			} else {
				if (parseInt($t.p.iCol,10)&gt;=0  &amp;&amp; parseInt($t.p.iRow,10)&gt;=0) {
					$(&quot;td:eq(&quot;+$t.p.iCol+&quot;)&quot;,$t.rows[$t.p.iRow]).removeClass(&quot;edit-cell ui-state-highlight&quot;);
					$($t.rows[$t.p.iRow]).removeClass(&quot;selected-row ui-state-hover&quot;);
				}
				cc.addClass(&quot;edit-cell ui-state-highlight&quot;);
				$($t.rows[iRow]).addClass(&quot;selected-row ui-state-hover&quot;);
				tmp = cc.html().replace(/\&amp;#160\;/ig,&#x27;&#x27;);
				$($t).triggerHandler(&quot;jqGridSelectCell&quot;, [$t.rows[iRow].id, nm, tmp, iRow, iCol]);
				if ($.isFunction($t.p.onSelectCell)) {
					$t.p.onSelectCell.call($t, $t.rows[iRow].id,nm,tmp,iRow,iCol);
				}
			}
			$t.p.iCol = iCol; $t.p.iRow = iRow;
		});
	},
	saveCell : function (iRow, iCol){
		return this.each(function(){
			var $t= this, fr;
			if (!$t.grid || $t.p.cellEdit !== true) {return;}
			if ( $t.p.savedRow.length &gt;= 1) {fr = 0;} else {fr=null;}
			if(fr !== null) {
				var cc = $(&quot;td:eq(&quot;+iCol+&quot;)&quot;,$t.rows[iRow]),v,v2,
				cm = $t.p.colModel[iCol], nm = cm.name, nmjq = $.jgrid.jqID(nm) ;
				switch (cm.edittype) {
					case &quot;select&quot;:
						if(!cm.editoptions.multiple) {
							v = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq+&quot; option:selected&quot;,$t.rows[iRow]).val();
							v2 = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq+&quot; option:selected&quot;,$t.rows[iRow]).text();
						} else {
							var sel = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq,$t.rows[iRow]), selectedText = [];
							v = $(sel).val();
							if(v) { v.join(&quot;,&quot;);} else { v=&quot;&quot;; }
							$(&quot;option:selected&quot;,sel).each(
								function(i,selected){
									selectedText[i] = $(selected).text();
								}
							);
							v2 = selectedText.join(&quot;,&quot;);
						}
						if(cm.formatter) { v2 = v; }
						break;
					case &quot;checkbox&quot;:
						var cbv  = [&quot;Yes&quot;,&quot;No&quot;];
						if(cm.editoptions){
							cbv = cm.editoptions.value.split(&quot;:&quot;);
						}
						v = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq,$t.rows[iRow]).is(&quot;:checked&quot;) ? cbv[0] : cbv[1];
						v2=v;
						break;
					case &quot;password&quot;:
					case &quot;text&quot;:
					case &quot;textarea&quot;:
					case &quot;button&quot; :
						v = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq,$t.rows[iRow]).val();
						v2=v;
						break;
					case &#x27;custom&#x27; :
						try {
							if(cm.editoptions &amp;&amp; $.isFunction(cm.editoptions.custom_value)) {
								v = cm.editoptions.custom_value.call($t, $(&quot;.customelement&quot;,cc),&#x27;get&#x27;);
								if (v===undefined) { throw &quot;e2&quot;;} else { v2=v; }
							} else { throw &quot;e1&quot;; }
						} catch (e) {
							if (e===&quot;e1&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function &#x27;custom_value&#x27; &quot;+$.jgrid.edit.msg.nodefined,$.jgrid.edit.bClose); }
							if (e===&quot;e2&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function &#x27;custom_value&#x27; &quot;+$.jgrid.edit.msg.novalue,$.jgrid.edit.bClose); }
							else {$.jgrid.info_dialog($.jgrid.errors.errcap,e.message,$.jgrid.edit.bClose); }
						}
						break;
				}
				// The common approach is if nothing changed do not do anything
				if (v2 !== $t.p.savedRow[fr].v){
					var vvv = $($t).triggerHandler(&quot;jqGridBeforeSaveCell&quot;, [$t.rows[iRow].id, nm, v, iRow, iCol]);
					if (vvv) {v = vvv; v2=vvv;}
					if ($.isFunction($t.p.beforeSaveCell)) {
						var vv = $t.p.beforeSaveCell.call($t, $t.rows[iRow].id,nm, v, iRow,iCol);
						if (vv) {v = vv; v2=vv;}
					}
					var cv = $.jgrid.checkValues.call($t,v,iCol);
					if(cv[0] === true) {
						var addpost = $($t).triggerHandler(&quot;jqGridBeforeSubmitCell&quot;, [$t.rows[iRow].id, nm, v, iRow, iCol]) || {};
						if ($.isFunction($t.p.beforeSubmitCell)) {
							addpost = $t.p.beforeSubmitCell.call($t, $t.rows[iRow].id,nm, v, iRow,iCol);
							if (!addpost) {addpost={};}
						}
						if( $(&quot;input.hasDatepicker&quot;,cc).length &gt;0) { $(&quot;input.hasDatepicker&quot;,cc).datepicker(&#x27;hide&#x27;); }
						if ($t.p.cellsubmit === &#x27;remote&#x27;) {
							if ($t.p.cellurl) {
								var postdata = {};
								if($t.p.autoencode) { v = $.jgrid.htmlEncode(v); }
								postdata[nm] = v;
								var idname,oper, opers;
								opers = $t.p.prmNames;
								idname = opers.id;
								oper = opers.oper;
								postdata[idname] = $.jgrid.stripPref($t.p.idPrefix, $t.rows[iRow].id);
								postdata[oper] = opers.editoper;
								postdata = $.extend(addpost,postdata);
								$(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).show();
								$t.grid.hDiv.loading = true;
								$.ajax( $.extend( {
									url: $t.p.cellurl,
									data :$.isFunction($t.p.serializeCellData) ? $t.p.serializeCellData.call($t, postdata) : postdata,
									type: &quot;POST&quot;,
									complete: function (result, stat) {
										$(&quot;#lui_&quot;+$t.p.id).hide();
										$t.grid.hDiv.loading = false;
										if (stat === &#x27;success&#x27;) {
											var ret = $($t).triggerHandler(&quot;jqGridAfterSubmitCell&quot;, [$t, result, postdata.id, nm, v, iRow, iCol]) || [true, &#x27;&#x27;];
											if (ret[0] === true &amp;&amp; $.isFunction($t.p.afterSubmitCell)) {
												ret = $t.p.afterSubmitCell.call($t, result,postdata.id,nm,v,iRow,iCol);
											}
											if(ret[0] === true){
												$(cc).empty();
												$($t).jqGrid(&quot;setCell&quot;,$t.rows[iRow].id, iCol, v2, false, false, true);
												$(cc).addClass(&quot;dirty-cell&quot;);
												$($t.rows[iRow]).addClass(&quot;edited&quot;);
												$($t).triggerHandler(&quot;jqGridAfterSaveCell&quot;, [$t.rows[iRow].id, nm, v, iRow, iCol]);
												if ($.isFunction($t.p.afterSaveCell)) {
													$t.p.afterSaveCell.call($t, $t.rows[iRow].id,nm, v, iRow,iCol);
												}
												$t.p.savedRow.splice(0,1);
											} else {
												$.jgrid.info_dialog($.jgrid.errors.errcap,ret[1],$.jgrid.edit.bClose);
												$($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol);
											}
										}
									},
									error:function(res,stat,err) {
										$(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).hide();
										$t.grid.hDiv.loading = false;
										$($t).triggerHandler(&quot;jqGridErrorCell&quot;, [res, stat, err]);
										if ($.isFunction($t.p.errorCell)) {
											$t.p.errorCell.call($t, res,stat,err);
											$($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol);
										} else {
											$.jgrid.info_dialog($.jgrid.errors.errcap,res.status+&quot; : &quot;+res.statusText+&quot;&lt;br/&gt;&quot;+stat,$.jgrid.edit.bClose);
											$($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol);
										}
									}
								}, $.jgrid.ajaxOptions, $t.p.ajaxCellOptions || {}));
							} else {
								try {
									$.jgrid.info_dialog($.jgrid.errors.errcap,$.jgrid.errors.nourl,$.jgrid.edit.bClose);
									$($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol);
								} catch (e) {}
							}
						}
						if ($t.p.cellsubmit === &#x27;clientArray&#x27;) {
							$(cc).empty();
							$($t).jqGrid(&quot;setCell&quot;,$t.rows[iRow].id,iCol, v2, false, false, true);
							$(cc).addClass(&quot;dirty-cell&quot;);
							$($t.rows[iRow]).addClass(&quot;edited&quot;);
							$($t).triggerHandler(&quot;jqGridAfterSaveCell&quot;, [$t.rows[iRow].id, nm, v, iRow, iCol]);
							if ($.isFunction($t.p.afterSaveCell)) {
								$t.p.afterSaveCell.call($t, $t.rows[iRow].id,nm, v, iRow,iCol);
							}
							$t.p.savedRow.splice(0,1);
						}
					} else {
						try {
							window.setTimeout(function(){$.jgrid.info_dialog($.jgrid.errors.errcap,v+&quot; &quot;+cv[1],$.jgrid.edit.bClose);},100);
							$($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol);
						} catch (e) {}
					}
				} else {
					$($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol);
				}
			}
			window.setTimeout(function () { $(&quot;#&quot;+$.jgrid.jqID($t.p.knv)).attr(&quot;tabindex&quot;,&quot;-1&quot;).focus();},0);
		});
	},
	restoreCell : function(iRow, iCol) {
		return this.each(function(){
			var $t= this, fr;
			if (!$t.grid || $t.p.cellEdit !== true ) {return;}
			if ( $t.p.savedRow.length &gt;= 1) {fr = 0;} else {fr=null;}
			if(fr !== null) {
				var cc = $(&quot;td:eq(&quot;+iCol+&quot;)&quot;,$t.rows[iRow]);
				// datepicker fix
				if($.isFunction($.fn.datepicker)) {
					try {
						$(&quot;input.hasDatepicker&quot;,cc).datepicker(&#x27;hide&#x27;);
					} catch (e) {}
				}
				$(cc).empty().attr(&quot;tabindex&quot;,&quot;-1&quot;);
				$($t).jqGrid(&quot;setCell&quot;,$t.rows[iRow].id, iCol, $t.p.savedRow[fr].v, false, false, true);
				$($t).triggerHandler(&quot;jqGridAfterRestoreCell&quot;, [$t.rows[iRow].id, $t.p.savedRow[fr].v, iRow, iCol]);
				if ($.isFunction($t.p.afterRestoreCell)) {
					$t.p.afterRestoreCell.call($t, $t.rows[iRow].id, $t.p.savedRow[fr].v, iRow, iCol);
				}
				$t.p.savedRow.splice(0,1);
			}
			window.setTimeout(function () { $(&quot;#&quot;+$t.p.knv).attr(&quot;tabindex&quot;,&quot;-1&quot;).focus();},0);
		});
	},
	nextCell : function (iRow,iCol) {
		return this.each(function (){
			var $t = this, nCol=false, i;
			if (!$t.grid || $t.p.cellEdit !== true) {return;}
			// try to find next editable cell
			for (i=iCol+1; i&lt;$t.p.colModel.length; i++) {
				if ( $t.p.colModel[i].editable ===true) {
					nCol = i; break;
				}
			}
			if(nCol !== false) {
				$($t).jqGrid(&quot;editCell&quot;,iRow,nCol,true);
			} else {
				if ($t.p.savedRow.length &gt;0) {
					$($t).jqGrid(&quot;saveCell&quot;,iRow,iCol);
				}
			}
		});
	},
	prevCell : function (iRow,iCol) {
		return this.each(function (){
			var $t = this, nCol=false, i;
			if (!$t.grid || $t.p.cellEdit !== true) {return;}
			// try to find next editable cell
			for (i=iCol-1; i&gt;=0; i--) {
				if ( $t.p.colModel[i].editable ===true) {
					nCol = i; break;
				}
			}
			if(nCol !== false) {
				$($t).jqGrid(&quot;editCell&quot;,iRow,nCol,true);
			} else {
				if ($t.p.savedRow.length &gt;0) {
					$($t).jqGrid(&quot;saveCell&quot;,iRow,iCol);
				}
			}
		});
	},
	GridNav : function() {
		return this.each(function () {
			var  $t = this;
			if (!$t.grid || $t.p.cellEdit !== true ) {return;}
			// trick to process keydown on non input elements
			$t.p.knv = $t.p.id + &quot;_kn&quot;;
			var selection = $(&quot;&lt;div style=&#x27;position:fixed;top:0px;width:1px;height:1px;&#x27; tabindex=&#x27;0&#x27;&gt;&lt;div tabindex=&#x27;-1&#x27; style=&#x27;width:1px;height:1px;&#x27; id=&#x27;&quot;+$t.p.knv+&quot;&#x27;&gt;&lt;/div&gt;&lt;/div&gt;&quot;),
			i, kdir;
			function scrollGrid(iR, iC, tp){
				if (tp.substr(0,1)===&#x27;v&#x27;) {
					var ch = $($t.grid.bDiv)[0].clientHeight,
					st = $($t.grid.bDiv)[0].scrollTop,
					nROT = $t.rows[iR].offsetTop+$t.rows[iR].clientHeight,
					pROT = $t.rows[iR].offsetTop;
					if(tp === &#x27;vd&#x27;) {
						if(nROT &gt;= ch) {
							$($t.grid.bDiv)[0].scrollTop = $($t.grid.bDiv)[0].scrollTop + $t.rows[iR].clientHeight;
						}
					}
					if(tp === &#x27;vu&#x27;){
						if (pROT &lt; st ) {
							$($t.grid.bDiv)[0].scrollTop = $($t.grid.bDiv)[0].scrollTop - $t.rows[iR].clientHeight;
						}
					}
				}
				if(tp===&#x27;h&#x27;) {
					var cw = $($t.grid.bDiv)[0].clientWidth,
					sl = $($t.grid.bDiv)[0].scrollLeft,
					nCOL = $t.rows[iR].cells[iC].offsetLeft+$t.rows[iR].cells[iC].clientWidth,
					pCOL = $t.rows[iR].cells[iC].offsetLeft;
					if(nCOL &gt;= cw+parseInt(sl,10)) {
						$($t.grid.bDiv)[0].scrollLeft = $($t.grid.bDiv)[0].scrollLeft + $t.rows[iR].cells[iC].clientWidth;
					} else if (pCOL &lt; sl) {
						$($t.grid.bDiv)[0].scrollLeft = $($t.grid.bDiv)[0].scrollLeft - $t.rows[iR].cells[iC].clientWidth;
					}
				}
			}
			function findNextVisible(iC,act){
				var ind, i;
				if(act === &#x27;lft&#x27;) {
					ind = iC+1;
					for (i=iC;i&gt;=0;i--){
						if ($t.p.colModel[i].hidden !== true) {
							ind = i;
							break;
						}
					}
				}
				if(act === &#x27;rgt&#x27;) {
					ind = iC-1;
					for (i=iC; i&lt;$t.p.colModel.length;i++){
						if ($t.p.colModel[i].hidden !== true) {
							ind = i;
							break;
						}
					}
				}
				return ind;
			}

			$(selection).insertBefore($t.grid.cDiv);
			$(&quot;#&quot;+$t.p.knv)
			.focus()
			.keydown(function (e){
				kdir = e.keyCode;
				if($t.p.direction === &quot;rtl&quot;) {
					if(kdir===37) { kdir = 39;}
					else if (kdir===39) { kdir = 37; }
				}
				switch (kdir) {
					case 38:
						if ($t.p.iRow-1 &gt;0 ) {
							scrollGrid($t.p.iRow-1,$t.p.iCol,&#x27;vu&#x27;);
							$($t).jqGrid(&quot;editCell&quot;,$t.p.iRow-1,$t.p.iCol,false);
						}
					break;
					case 40 :
						if ($t.p.iRow+1 &lt;=  $t.rows.length-1) {
							scrollGrid($t.p.iRow+1,$t.p.iCol,&#x27;vd&#x27;);
							$($t).jqGrid(&quot;editCell&quot;,$t.p.iRow+1,$t.p.iCol,false);
						}
					break;
					case 37 :
						if ($t.p.iCol -1 &gt;=  0) {
							i = findNextVisible($t.p.iCol-1,&#x27;lft&#x27;);
							scrollGrid($t.p.iRow, i,&#x27;h&#x27;);
							$($t).jqGrid(&quot;editCell&quot;,$t.p.iRow, i,false);
						}
					break;
					case 39 :
						if ($t.p.iCol +1 &lt;=  $t.p.colModel.length-1) {
							i = findNextVisible($t.p.iCol+1,&#x27;rgt&#x27;);
							scrollGrid($t.p.iRow,i,&#x27;h&#x27;);
							$($t).jqGrid(&quot;editCell&quot;,$t.p.iRow,i,false);
						}
					break;
					case 13:
						if (parseInt($t.p.iCol,10)&gt;=0 &amp;&amp; parseInt($t.p.iRow,10)&gt;=0) {
							$($t).jqGrid(&quot;editCell&quot;,$t.p.iRow,$t.p.iCol,true);
						}
					break;
					default :
						return true;
				}
				return false;
			});
		});
	},
	getChangedCells : function (mthd) {
		var ret=[];
		if (!mthd) {mthd=&#x27;all&#x27;;}
		this.each(function(){
			var $t= this,nm;
			if (!$t.grid || $t.p.cellEdit !== true ) {return;}
			$($t.rows).each(function(j){
				var res = {};
				if ($(this).hasClass(&quot;edited&quot;)) {
					$(&#x27;td&#x27;,this).each( function(i) {
						nm = $t.p.colModel[i].name;
						if ( nm !== &#x27;cb&#x27; &amp;&amp; nm !== &#x27;subgrid&#x27;) {
							if (mthd===&#x27;dirty&#x27;) {
								if ($(this).hasClass(&#x27;dirty-cell&#x27;)) {
									try {
										res[nm] = $.unformat.call($t,this,{rowId:$t.rows[j].id, colModel:$t.p.colModel[i]},i);
									} catch (e){
										res[nm] = $.jgrid.htmlDecode($(this).html());
									}
								}
							} else {
								try {
									res[nm] = $.unformat.call($t,this,{rowId:$t.rows[j].id,colModel:$t.p.colModel[i]},i);
								} catch (e) {
									res[nm] = $.jgrid.htmlDecode($(this).html());
								}
							}
						}
					});
					res.id = this.id;
					ret.push(res);
				}
			});
		});
		return ret;
	}
/// end  cell editing
});
})(jQuery);
/*jshint eqeqeq:false */
/*global jQuery */
(function($){
/**
 * jqGrid extension for SubGrid Data
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/
&quot;use strict&quot;;
$.jgrid.extend({
setSubGrid : function () {
	return this.each(function (){
		var $t = this, cm, i,
		suboptions = {
			plusicon : &quot;ui-icon-plus&quot;,
			minusicon : &quot;ui-icon-minus&quot;,
			openicon: &quot;ui-icon-carat-1-sw&quot;,
			expandOnLoad:  false,
			delayOnLoad : 50,
			selectOnExpand : false,
			selectOnCollapse : false,
			reloadOnExpand : true
		};
		$t.p.subGridOptions = $.extend(suboptions, $t.p.subGridOptions || {});
		$t.p.colNames.unshift(&quot;&quot;);
		$t.p.colModel.unshift({name:&#x27;subgrid&#x27;,width: $.jgrid.cell_width ?  $t.p.subGridWidth+$t.p.cellLayout : $t.p.subGridWidth,sortable: false,resizable:false,hidedlg:true,search:false,fixed:true});
		cm = $t.p.subGridModel;
		if(cm[0]) {
			cm[0].align = $.extend([],cm[0].align || []);
			for(i=0;i&lt;cm[0].name.length;i++) { cm[0].align[i] = cm[0].align[i] || &#x27;left&#x27;;}
		}
	});
},
addSubGridCell :function (pos,iRow) {
	var prp=&#x27;&#x27;,ic,sid;
	this.each(function(){
		prp = this.formatCol(pos,iRow);
		sid= this.p.id;
		ic = this.p.subGridOptions.plusicon;
	});
	return &quot;&lt;td role=\&quot;gridcell\&quot; aria-describedby=\&quot;&quot;+sid+&quot;_subgrid\&quot; class=\&quot;ui-sgcollapsed sgcollapsed\&quot; &quot;+prp+&quot;&gt;&lt;a style=&#x27;cursor:pointer;&#x27;&gt;&lt;span class=&#x27;ui-icon &quot;+ic+&quot;&#x27;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;&quot;;
},
addSubGrid : function( pos, sind ) {
	return this.each(function(){
		var ts = this;
		if (!ts.grid ) { return; }
		//-------------------------
		var subGridCell = function(trdiv,cell,pos)
		{
			var tddiv = $(&quot;&lt;td align=&#x27;&quot;+ts.p.subGridModel[0].align[pos]+&quot;&#x27;&gt;&lt;/td&gt;&quot;).html(cell);
			$(trdiv).append(tddiv);
		};
		var subGridXml = function(sjxml, sbid){
			var tddiv, i,  sgmap,
			dummy = $(&quot;&lt;table cellspacing=&#x27;0&#x27; cellpadding=&#x27;0&#x27; border=&#x27;0&#x27;&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;),
			trdiv = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;);
			for (i = 0; i&lt;ts.p.subGridModel[0].name.length; i++) {
				tddiv = $(&quot;&lt;th class=&#x27;ui-state-default ui-th-subgrid ui-th-column ui-th-&quot;+ts.p.direction+&quot;&#x27;&gt;&lt;/th&gt;&quot;);
				$(tddiv).html(ts.p.subGridModel[0].name[i]);
				$(tddiv).width( ts.p.subGridModel[0].width[i]);
				$(trdiv).append(tddiv);
			}
			$(dummy).append(trdiv);
			if (sjxml){
				sgmap = ts.p.xmlReader.subgrid;
				$(sgmap.root+&quot; &quot;+sgmap.row, sjxml).each( function(){
					trdiv = $(&quot;&lt;tr class=&#x27;ui-widget-content ui-subtblcell&#x27;&gt;&lt;/tr&gt;&quot;);
					if(sgmap.repeatitems === true) {
						$(sgmap.cell,this).each( function(i) {
							subGridCell(trdiv, $(this).text() || &#x27;&amp;#160;&#x27;,i);
						});
					} else {
						var f = ts.p.subGridModel[0].mapping || ts.p.subGridModel[0].name;
						if (f) {
							for (i=0;i&lt;f.length;i++) {
								subGridCell(trdiv, $(f[i],this).text() || &#x27;&amp;#160;&#x27;,i);
							}
						}
					}
					$(dummy).append(trdiv);
				});
			}
			var pID = $(&quot;table:first&quot;,ts.grid.bDiv).attr(&quot;id&quot;)+&quot;_&quot;;
			$(&quot;#&quot;+$.jgrid.jqID(pID+sbid)).append(dummy);
			ts.grid.hDiv.loading = false;
			$(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).hide();
			return false;
		};
		var subGridJson = function(sjxml, sbid){
			var tddiv,result,i,cur, sgmap,j,
			dummy = $(&quot;&lt;table cellspacing=&#x27;0&#x27; cellpadding=&#x27;0&#x27; border=&#x27;0&#x27;&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;),
			trdiv = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;);
			for (i = 0; i&lt;ts.p.subGridModel[0].name.length; i++) {
				tddiv = $(&quot;&lt;th class=&#x27;ui-state-default ui-th-subgrid ui-th-column ui-th-&quot;+ts.p.direction+&quot;&#x27;&gt;&lt;/th&gt;&quot;);
				$(tddiv).html(ts.p.subGridModel[0].name[i]);
				$(tddiv).width( ts.p.subGridModel[0].width[i]);
				$(trdiv).append(tddiv);
			}
			$(dummy).append(trdiv);
			if (sjxml){
				sgmap = ts.p.jsonReader.subgrid;
				result = $.jgrid.getAccessor(sjxml, sgmap.root);
				if ( result !== undefined ) {
					for (i=0;i&lt;result.length;i++) {
						cur = result[i];
						trdiv = $(&quot;&lt;tr class=&#x27;ui-widget-content ui-subtblcell&#x27;&gt;&lt;/tr&gt;&quot;);
						if(sgmap.repeatitems === true) {
							if(sgmap.cell) { cur=cur[sgmap.cell]; }
							for (j=0;j&lt;cur.length;j++) {
								subGridCell(trdiv, cur[j] || &#x27;&amp;#160;&#x27;,j);
							}
						} else {
							var f = ts.p.subGridModel[0].mapping || ts.p.subGridModel[0].name;
							if(f.length) {
								for (j=0;j&lt;f.length;j++) {
									subGridCell(trdiv, cur[f[j]] || &#x27;&amp;#160;&#x27;,j);
								}
							}
						}
						$(dummy).append(trdiv);
					}
				}
			}
			var pID = $(&quot;table:first&quot;,ts.grid.bDiv).attr(&quot;id&quot;)+&quot;_&quot;;
			$(&quot;#&quot;+$.jgrid.jqID(pID+sbid)).append(dummy);
			ts.grid.hDiv.loading = false;
			$(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).hide();
			return false;
		};
		var populatesubgrid = function( rd )
		{
			var sid,dp, i, j;
			sid = $(rd).attr(&quot;id&quot;);
			dp = {nd_: (new Date().getTime())};
			dp[ts.p.prmNames.subgridid]=sid;
			if(!ts.p.subGridModel[0]) { return false; }
			if(ts.p.subGridModel[0].params) {
				for(j=0; j &lt; ts.p.subGridModel[0].params.length; j++) {
					for(i=0; i&lt;ts.p.colModel.length; i++) {
						if(ts.p.colModel[i].name === ts.p.subGridModel[0].params[j]) {
							dp[ts.p.colModel[i].name]= $(&quot;td:eq(&quot;+i+&quot;)&quot;,rd).text().replace(/\&amp;#160\;/ig,&#x27;&#x27;);
						}
					}
				}
			}
			if(!ts.grid.hDiv.loading) {
				ts.grid.hDiv.loading = true;
				$(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).show();
				if(!ts.p.subgridtype) { ts.p.subgridtype = ts.p.datatype; }
				if($.isFunction(ts.p.subgridtype)) {
					ts.p.subgridtype.call(ts, dp);
				} else {
					ts.p.subgridtype = ts.p.subgridtype.toLowerCase();
				}
				switch(ts.p.subgridtype) {
					case &quot;xml&quot;:
					case &quot;json&quot;:
					$.ajax($.extend({
						type:ts.p.mtype,
						url: ts.p.subGridUrl,
						dataType:ts.p.subgridtype,
						data: $.isFunction(ts.p.serializeSubGridData)? ts.p.serializeSubGridData.call(ts, dp) : dp,
						complete: function(sxml) {
							if(ts.p.subgridtype === &quot;xml&quot;) {
								subGridXml(sxml.responseXML, sid);
							} else {
								subGridJson($.jgrid.parse(sxml.responseText),sid);
							}
							sxml=null;
						}
					}, $.jgrid.ajaxOptions, ts.p.ajaxSubgridOptions || {}));
					break;
				}
			}
			return false;
		};
		var _id, pID,atd, nhc=0, bfsc, r;
		$.each(ts.p.colModel,function(){
			if(this.hidden === true || this.name === &#x27;rn&#x27; || this.name === &#x27;cb&#x27;) {
				nhc++;
			}
		});
		var len = ts.rows.length, i=1;
		if( sind !== undefined &amp;&amp; sind &gt; 0) {
			i = sind;
			len = sind+1;
		}
		while(i &lt; len) {
			if($(ts.rows[i]).hasClass(&#x27;jqgrow&#x27;)) {
				$(ts.rows[i].cells[pos]).bind(&#x27;click&#x27;, function() {
					var tr = $(this).parent(&quot;tr&quot;)[0];
					r = tr.nextSibling;
					if($(this).hasClass(&quot;sgcollapsed&quot;)) {
						pID = ts.p.id;
						_id = tr.id;
						if(ts.p.subGridOptions.reloadOnExpand === true || ( ts.p.subGridOptions.reloadOnExpand === false &amp;&amp; !$(r).hasClass(&#x27;ui-subgrid&#x27;) ) ) {
							atd = pos &gt;=1 ? &quot;&lt;td colspan=&#x27;&quot;+pos+&quot;&#x27;&gt;&amp;#160;&lt;/td&gt;&quot;:&quot;&quot;;
							bfsc = $(ts).triggerHandler(&quot;jqGridSubGridBeforeExpand&quot;, [pID + &quot;_&quot; + _id, _id]);
							bfsc = (bfsc === false || bfsc === &#x27;stop&#x27;) ? false : true;
							if(bfsc &amp;&amp; $.isFunction(ts.p.subGridBeforeExpand)) {
								bfsc = ts.p.subGridBeforeExpand.call(ts, pID+&quot;_&quot;+_id,_id);
							}
							if(bfsc === false) {return false;}
							$(tr).after( &quot;&lt;tr role=&#x27;row&#x27; class=&#x27;ui-subgrid&#x27;&gt;&quot;+atd+&quot;&lt;td class=&#x27;ui-widget-content subgrid-cell&#x27;&gt;&lt;span class=&#x27;ui-icon &quot;+ts.p.subGridOptions.openicon+&quot;&#x27;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td colspan=&#x27;&quot;+parseInt(ts.p.colNames.length-1-nhc,10)+&quot;&#x27; class=&#x27;ui-widget-content subgrid-data&#x27;&gt;&lt;div id=&quot;+pID+&quot;_&quot;+_id+&quot; class=&#x27;tablediv&#x27;&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&quot; );
							$(ts).triggerHandler(&quot;jqGridSubGridRowExpanded&quot;, [pID + &quot;_&quot; + _id, _id]);
							if( $.isFunction(ts.p.subGridRowExpanded)) {
								ts.p.subGridRowExpanded.call(ts, pID+&quot;_&quot;+ _id,_id);
							} else {
								populatesubgrid(tr);
							}
						} else {
							$(r).show();
						}
						$(this).html(&quot;&lt;a style=&#x27;cursor:pointer;&#x27;&gt;&lt;span class=&#x27;ui-icon &quot;+ts.p.subGridOptions.minusicon+&quot;&#x27;&gt;&lt;/span&gt;&lt;/a&gt;&quot;).removeClass(&quot;sgcollapsed&quot;).addClass(&quot;sgexpanded&quot;);
						if(ts.p.subGridOptions.selectOnExpand) {
							$(ts).jqGrid(&#x27;setSelection&#x27;,_id);
						}
					} else if($(this).hasClass(&quot;sgexpanded&quot;)) {
						bfsc = $(ts).triggerHandler(&quot;jqGridSubGridRowColapsed&quot;, [pID + &quot;_&quot; + _id, _id]);
						bfsc = (bfsc === false || bfsc === &#x27;stop&#x27;) ? false : true;
						_id = tr.id;
						if( bfsc &amp;&amp;  $.isFunction(ts.p.subGridRowColapsed)) {
							bfsc = ts.p.subGridRowColapsed.call(ts, pID+&quot;_&quot;+_id,_id );
						}
						if(bfsc===false) {return false;}
						if(ts.p.subGridOptions.reloadOnExpand === true) {
							$(r).remove(&quot;.ui-subgrid&quot;);
						} else if($(r).hasClass(&#x27;ui-subgrid&#x27;)) { // incase of dynamic deleting
							$(r).hide();
						}
						$(this).html(&quot;&lt;a style=&#x27;cursor:pointer;&#x27;&gt;&lt;span class=&#x27;ui-icon &quot;+ts.p.subGridOptions.plusicon+&quot;&#x27;&gt;&lt;/span&gt;&lt;/a&gt;&quot;).removeClass(&quot;sgexpanded&quot;).addClass(&quot;sgcollapsed&quot;);
						if(ts.p.subGridOptions.selectOnCollapse) {
							$(ts).jqGrid(&#x27;setSelection&#x27;,_id);
						}
					}
					return false;
				});
			}
			i++;
		}
		if(ts.p.subGridOptions.expandOnLoad === true) {
			$(ts.rows).filter(&#x27;.jqgrow&#x27;).each(function(index,row){
				$(row.cells[0]).click();
			});
		}
		ts.subGridXml = function(xml,sid) {subGridXml(xml,sid);};
		ts.subGridJson = function(json,sid) {subGridJson(json,sid);};
	});
},
expandSubGridRow : function(rowid) {
	return this.each(function () {
		var $t = this;
		if(!$t.grid &amp;&amp; !rowid) {return;}
		if($t.p.subGrid===true) {
			var rc = $(this).jqGrid(&quot;getInd&quot;,rowid,true);
			if(rc) {
				var sgc = $(&quot;td.sgcollapsed&quot;,rc)[0];
				if(sgc) {
					$(sgc).trigger(&quot;click&quot;);
				}
			}
		}
	});
},
collapseSubGridRow : function(rowid) {
	return this.each(function () {
		var $t = this;
		if(!$t.grid &amp;&amp; !rowid) {return;}
		if($t.p.subGrid===true) {
			var rc = $(this).jqGrid(&quot;getInd&quot;,rowid,true);
			if(rc) {
				var sgc = $(&quot;td.sgexpanded&quot;,rc)[0];
				if(sgc) {
					$(sgc).trigger(&quot;click&quot;);
				}
			}
		}
	});
},
toggleSubGridRow : function(rowid) {
	return this.each(function () {
		var $t = this;
		if(!$t.grid &amp;&amp; !rowid) {return;}
		if($t.p.subGrid===true) {
			var rc = $(this).jqGrid(&quot;getInd&quot;,rowid,true);
			if(rc) {
				var sgc = $(&quot;td.sgcollapsed&quot;,rc)[0];
				if(sgc) {
					$(sgc).trigger(&quot;click&quot;);
				} else {
					sgc = $(&quot;td.sgexpanded&quot;,rc)[0];
					if(sgc) {
						$(sgc).trigger(&quot;click&quot;);
					}
				}
			}
		}
	});
}
});
})(jQuery);
/**
 * jqGrid extension - Tree Grid
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
**/

/*jshint eqeqeq:false */
/*global jQuery */
(function($) {
&quot;use strict&quot;;
$.jgrid.extend({
	setTreeNode : function(i, len){
		return this.each(function(){
			var $t = this;
			if( !$t.grid || !$t.p.treeGrid ) {return;}
			var expCol = $t.p.expColInd,
			expanded = $t.p.treeReader.expanded_field,
			isLeaf = $t.p.treeReader.leaf_field,
			level = $t.p.treeReader.level_field,
			icon = $t.p.treeReader.icon_field,
			loaded = $t.p.treeReader.loaded,  lft, rgt, curLevel, ident,lftpos, twrap,
			ldat, lf;
			while(i&lt;len) {
				var ind = $.jgrid.stripPref($t.p.idPrefix, $t.rows[i].id), dind = $t.p._index[ind], expan;
				ldat = $t.p.data[dind];
				//$t.rows[i].level = ldat[level];
				if($t.p.treeGridModel === &#x27;nested&#x27;) {
					if(!ldat[isLeaf]) {
					lft = parseInt(ldat[$t.p.treeReader.left_field],10);
					rgt = parseInt(ldat[$t.p.treeReader.right_field],10);
					// NS Model
						ldat[isLeaf] = (rgt === lft+1) ? &#x27;true&#x27; : &#x27;false&#x27;;
						$t.rows[i].cells[$t.p._treeleafpos].innerHTML = ldat[isLeaf];
					}
				}
				//else {
					//row.parent_id = rd[$t.p.treeReader.parent_id_field];
				//}
				curLevel = parseInt(ldat[level],10);
				if($t.p.tree_root_level === 0) {
					ident = curLevel+1;
					lftpos = curLevel;
				} else {
					ident = curLevel;
					lftpos = curLevel -1;
				}
				twrap = &quot;&lt;div class=&#x27;tree-wrap tree-wrap-&quot;+$t.p.direction+&quot;&#x27; style=&#x27;width:&quot;+(ident*18)+&quot;px;&#x27;&gt;&quot;;
				twrap += &quot;&lt;div style=&#x27;&quot;+($t.p.direction===&quot;rtl&quot; ? &quot;right:&quot; : &quot;left:&quot;)+(lftpos*18)+&quot;px;&#x27; class=&#x27;ui-icon &quot;;


				if(ldat[loaded] !== undefined) {
					if(ldat[loaded]===&quot;true&quot; || ldat[loaded]===true) {
						ldat[loaded] = true;
					} else {
						ldat[loaded] = false;
					}
				}
				if(ldat[isLeaf] === &quot;true&quot; || ldat[isLeaf] === true) {
					twrap += ((ldat[icon] !== undefined &amp;&amp; ldat[icon] !== &quot;&quot;) ? ldat[icon] : $t.p.treeIcons.leaf)+&quot; tree-leaf treeclick&quot;;
					ldat[isLeaf] = true;
					lf=&quot;leaf&quot;;
				} else {
					ldat[isLeaf] = false;
					lf=&quot;&quot;;
				}
				ldat[expanded] = ((ldat[expanded] === &quot;true&quot; || ldat[expanded] === true) ? true : false) &amp;&amp; (ldat[loaded] || ldat[loaded] === undefined);
				if(ldat[expanded] === false) {
					twrap += ((ldat[isLeaf] === true) ? &quot;&#x27;&quot; : $t.p.treeIcons.plus+&quot; tree-plus treeclick&#x27;&quot;);
				} else {
					twrap += ((ldat[isLeaf] === true) ? &quot;&#x27;&quot; : $t.p.treeIcons.minus+&quot; tree-minus treeclick&#x27;&quot;);
				}

				twrap += &quot;&gt;&lt;/div&gt;&lt;/div&gt;&quot;;
				$($t.rows[i].cells[expCol]).wrapInner(&quot;&lt;span class=&#x27;cell-wrapper&quot;+lf+&quot;&#x27;&gt;&lt;/span&gt;&quot;).prepend(twrap);

				if(curLevel !== parseInt($t.p.tree_root_level,10)) {
					var pn = $($t).jqGrid(&#x27;getNodeParent&#x27;,ldat);
					expan = pn &amp;&amp; pn.hasOwnProperty(expanded) ? pn[expanded] : true;
					if( !expan ){
						$($t.rows[i]).css(&quot;display&quot;,&quot;none&quot;);
					}
				}
				$($t.rows[i].cells[expCol])
					.find(&quot;div.treeclick&quot;)
					.bind(&quot;click&quot;,function(e){
						var target = e.target || e.srcElement,
						ind2 =$.jgrid.stripPref($t.p.idPrefix,$(target,$t.rows).closest(&quot;tr.jqgrow&quot;)[0].id),
						pos = $t.p._index[ind2];
						if(!$t.p.data[pos][isLeaf]){
							if($t.p.data[pos][expanded]){
								$($t).jqGrid(&quot;collapseRow&quot;,$t.p.data[pos]);
								$($t).jqGrid(&quot;collapseNode&quot;,$t.p.data[pos]);
							} else {
								$($t).jqGrid(&quot;expandRow&quot;,$t.p.data[pos]);
								$($t).jqGrid(&quot;expandNode&quot;,$t.p.data[pos]);
							}
						}
						return false;
					});
				if($t.p.ExpandColClick === true) {
					$($t.rows[i].cells[expCol])
						.find(&quot;span.cell-wrapper&quot;)
						.css(&quot;cursor&quot;,&quot;pointer&quot;)
						.bind(&quot;click&quot;,function(e) {
							var target = e.target || e.srcElement,
							ind2 =$.jgrid.stripPref($t.p.idPrefix,$(target,$t.rows).closest(&quot;tr.jqgrow&quot;)[0].id),
							pos = $t.p._index[ind2];
							if(!$t.p.data[pos][isLeaf]){
								if($t.p.data[pos][expanded]){
									$($t).jqGrid(&quot;collapseRow&quot;,$t.p.data[pos]);
									$($t).jqGrid(&quot;collapseNode&quot;,$t.p.data[pos]);
								} else {
									$($t).jqGrid(&quot;expandRow&quot;,$t.p.data[pos]);
									$($t).jqGrid(&quot;expandNode&quot;,$t.p.data[pos]);
								}
							}
							$($t).jqGrid(&quot;setSelection&quot;,ind2);
							return false;
						});
				}
				i++;
			}

		});
	},
	setTreeGrid : function() {
		return this.each(function (){
			var $t = this, i=0, pico, ecol = false, nm, key, tkey, dupcols=[];
			if(!$t.p.treeGrid) {return;}
			if(!$t.p.treedatatype ) {$.extend($t.p,{treedatatype: $t.p.datatype});}
			$t.p.subGrid = false;$t.p.altRows =false;
			$t.p.pgbuttons = false;$t.p.pginput = false;
			$t.p.gridview =  true;
			if($t.p.rowTotal === null ) { $t.p.rowNum = 10000; }
			$t.p.multiselect = false;$t.p.rowList = [];
			$t.p.expColInd = 0;
			pico = &#x27;ui-icon-triangle-1-&#x27; + ($t.p.direction===&quot;rtl&quot; ? &#x27;w&#x27; : &#x27;e&#x27;);
			$t.p.treeIcons = $.extend({plus:pico,minus:&#x27;ui-icon-triangle-1-s&#x27;,leaf:&#x27;ui-icon-radio-off&#x27;},$t.p.treeIcons || {});
			if($t.p.treeGridModel === &#x27;nested&#x27;) {
				$t.p.treeReader = $.extend({
					level_field: &quot;level&quot;,
					left_field:&quot;lft&quot;,
					right_field: &quot;rgt&quot;,
					leaf_field: &quot;isLeaf&quot;,
					expanded_field: &quot;expanded&quot;,
					loaded: &quot;loaded&quot;,
					icon_field: &quot;icon&quot;
				},$t.p.treeReader);
			} else if($t.p.treeGridModel === &#x27;adjacency&#x27;) {
				$t.p.treeReader = $.extend({
						level_field: &quot;level&quot;,
						parent_id_field: &quot;parent&quot;,
						leaf_field: &quot;isLeaf&quot;,
						expanded_field: &quot;expanded&quot;,
						loaded: &quot;loaded&quot;,
						icon_field: &quot;icon&quot;
				},$t.p.treeReader );
			}
			for ( key in $t.p.colModel){
				if($t.p.colModel.hasOwnProperty(key)) {
					nm = $t.p.colModel[key].name;
					if( nm === $t.p.ExpandColumn &amp;&amp; !ecol ) {
						ecol = true;
						$t.p.expColInd = i;
					}
					i++;
					//
					for(tkey in $t.p.treeReader) {
						if($t.p.treeReader.hasOwnProperty(tkey) &amp;&amp; $t.p.treeReader[tkey] === nm) {
							dupcols.push(nm);
						}
					}
				}
			}
			$.each($t.p.treeReader,function(j,n){
				if(n &amp;&amp; $.inArray(n, dupcols) === -1){
					if(j===&#x27;leaf_field&#x27;) { $t.p._treeleafpos= i; }
				i++;
					$t.p.colNames.push(n);
					$t.p.colModel.push({name:n,width:1,hidden:true,sortable:false,resizable:false,hidedlg:true,editable:true,search:false});
				}
			});
		});
	},
	expandRow: function (record){
		this.each(function(){
			var $t = this;
			if(!$t.grid || !$t.p.treeGrid) {return;}
			var childern = $($t).jqGrid(&quot;getNodeChildren&quot;,record),
			//if ($($t).jqGrid(&quot;isVisibleNode&quot;,record)) {
			expanded = $t.p.treeReader.expanded_field;
			$(childern).each(function(){
				var id  = $t.p.idPrefix + $.jgrid.getAccessor(this,$t.p.localReader.id);
				$($($t).jqGrid(&#x27;getGridRowById&#x27;, id)).css(&quot;display&quot;,&quot;&quot;);
				if(this[expanded]) {
					$($t).jqGrid(&quot;expandRow&quot;,this);
				}
			});
			//}
		});
	},
	collapseRow : function (record) {
		this.each(function(){
			var $t = this;
			if(!$t.grid || !$t.p.treeGrid) {return;}
			var childern = $($t).jqGrid(&quot;getNodeChildren&quot;,record),
			expanded = $t.p.treeReader.expanded_field;
			$(childern).each(function(){
				var id  = $t.p.idPrefix + $.jgrid.getAccessor(this,$t.p.localReader.id);
				$($($t).jqGrid(&#x27;getGridRowById&#x27;, id)).css(&quot;display&quot;,&quot;none&quot;);
				if(this[expanded]){
					$($t).jqGrid(&quot;collapseRow&quot;,this);
				}
			});
		});
	},
	// NS ,adjacency models
	getRootNodes : function() {
		var result = [];
		this.each(function(){
			var $t = this;
			if(!$t.grid || !$t.p.treeGrid) {return;}
			switch ($t.p.treeGridModel) {
				case &#x27;nested&#x27; :
					var level = $t.p.treeReader.level_field;
					$($t.p.data).each(function(){
						if(parseInt(this[level],10) === parseInt($t.p.tree_root_level,10)) {
							result.push(this);
						}
					});
					break;
				case &#x27;adjacency&#x27; :
					var parent_id = $t.p.treeReader.parent_id_field;
					$($t.p.data).each(function(){
						if(this[parent_id] === null || String(this[parent_id]).toLowerCase() === &quot;null&quot;) {
							result.push(this);
						}
					});
					break;
			}
		});
		return result;
	},
	getNodeDepth : function(rc) {
		var ret = null;
		this.each(function(){
			if(!this.grid || !this.p.treeGrid) {return;}
			var $t = this;
			switch ($t.p.treeGridModel) {
				case &#x27;nested&#x27; :
					var level = $t.p.treeReader.level_field;
					ret = parseInt(rc[level],10) - parseInt($t.p.tree_root_level,10);
					break;
				case &#x27;adjacency&#x27; :
					ret = $($t).jqGrid(&quot;getNodeAncestors&quot;,rc).length;
					break;
			}
		});
		return ret;
	},
	getNodeParent : function(rc) {
		var result = null;
		this.each(function(){
			var $t = this;
			if(!$t.grid || !$t.p.treeGrid) {return;}
			switch ($t.p.treeGridModel) {
				case &#x27;nested&#x27; :
					var lftc = $t.p.treeReader.left_field,
					rgtc = $t.p.treeReader.right_field,
					levelc = $t.p.treeReader.level_field,
					lft = parseInt(rc[lftc],10), rgt = parseInt(rc[rgtc],10), level = parseInt(rc[levelc],10);
					$(this.p.data).each(function(){
						if(parseInt(this[levelc],10) === level-1 &amp;&amp; parseInt(this[lftc],10) &lt; lft &amp;&amp; parseInt(this[rgtc],10) &gt; rgt) {
							result = this;
							return false;
						}
					});
					break;
				case &#x27;adjacency&#x27; :
					var parent_id = $t.p.treeReader.parent_id_field,
					dtid = $t.p.localReader.id;
					$(this.p.data).each(function(){
						if(this[dtid] === $.jgrid.stripPref($t.p.idPrefix, rc[parent_id]) ) {
							result = this;
							return false;
						}
					});
					break;
			}
		});
		return result;
	},
	getNodeChildren : function(rc) {
		var result = [];
		this.each(function(){
			var $t = this;
			if(!$t.grid || !$t.p.treeGrid) {return;}
			switch ($t.p.treeGridModel) {
				case &#x27;nested&#x27; :
					var lftc = $t.p.treeReader.left_field,
					rgtc = $t.p.treeReader.right_field,
					levelc = $t.p.treeReader.level_field,
					lft = parseInt(rc[lftc],10), rgt = parseInt(rc[rgtc],10), level = parseInt(rc[levelc],10);
					$(this.p.data).each(function(){
						if(parseInt(this[levelc],10) === level+1 &amp;&amp; parseInt(this[lftc],10) &gt; lft &amp;&amp; parseInt(this[rgtc],10) &lt; rgt) {
							result.push(this);
						}
					});
					break;
				case &#x27;adjacency&#x27; :
					var parent_id = $t.p.treeReader.parent_id_field,
					dtid = $t.p.localReader.id;
					$(this.p.data).each(function(){
						if(this[parent_id] == $.jgrid.stripPref($t.p.idPrefix, rc[dtid])) {
							result.push(this);
						}
					});
					break;
			}
		});
		return result;
	},
	getFullTreeNode : function(rc) {
		var result = [];
		this.each(function(){
			var $t = this, len;
			if(!$t.grid || !$t.p.treeGrid) {return;}
			switch ($t.p.treeGridModel) {
				case &#x27;nested&#x27; :
					var lftc = $t.p.treeReader.left_field,
					rgtc = $t.p.treeReader.right_field,
					levelc = $t.p.treeReader.level_field,
					lft = parseInt(rc[lftc],10), rgt = parseInt(rc[rgtc],10), level = parseInt(rc[levelc],10);
					$(this.p.data).each(function(){
						if(parseInt(this[levelc],10) &gt;= level &amp;&amp; parseInt(this[lftc],10) &gt;= lft &amp;&amp; parseInt(this[lftc],10) &lt;= rgt) {
							result.push(this);
						}
					});
					break;
				case &#x27;adjacency&#x27; :
					if(rc) {
					result.push(rc);
					var parent_id = $t.p.treeReader.parent_id_field,
					dtid = $t.p.localReader.id;
					$(this.p.data).each(function(i){
						len = result.length;
						for (i = 0; i &lt; len; i++) {
							if ($.jgrid.stripPref($t.p.idPrefix, result[i][dtid]) === this[parent_id]) {
								result.push(this);
								break;
							}
						}
					});
					}
					break;
			}
		});
		return result;
	},
	// End NS, adjacency Model
	getNodeAncestors : function(rc) {
		var ancestors = [];
		this.each(function(){
			if(!this.grid || !this.p.treeGrid) {return;}
			var parent = $(this).jqGrid(&quot;getNodeParent&quot;,rc);
			while (parent) {
				ancestors.push(parent);
				parent = $(this).jqGrid(&quot;getNodeParent&quot;,parent);
			}
		});
		return ancestors;
	},
	isVisibleNode : function(rc) {
		var result = true;
		this.each(function(){
			var $t = this;
			if(!$t.grid || !$t.p.treeGrid) {return;}
			var ancestors = $($t).jqGrid(&quot;getNodeAncestors&quot;,rc),
			expanded = $t.p.treeReader.expanded_field;
			$(ancestors).each(function(){
				result = result &amp;&amp; this[expanded];
				if(!result) {return false;}
			});
		});
		return result;
	},
	isNodeLoaded : function(rc) {
		var result;
		this.each(function(){
			var $t = this;
			if(!$t.grid || !$t.p.treeGrid) {return;}
			var isLeaf = $t.p.treeReader.leaf_field,
			loaded = $t.p.treeReader.loaded;
			if(rc !== undefined ) {
				if(rc[loaded] !== undefined) {
					result = rc[loaded];
				} else if( rc[isLeaf] || $($t).jqGrid(&quot;getNodeChildren&quot;,rc).length &gt; 0){
					result = true;
				} else {
					result = false;
				}
			} else {
				result = false;
			}
		});
		return result;
	},
	expandNode : function(rc) {
		return this.each(function(){
			if(!this.grid || !this.p.treeGrid) {return;}
			var expanded = this.p.treeReader.expanded_field,
			parent = this.p.treeReader.parent_id_field,
			loaded = this.p.treeReader.loaded,
			level = this.p.treeReader.level_field,
			lft = this.p.treeReader.left_field,
			rgt = this.p.treeReader.right_field;

			if(!rc[expanded]) {
				var id = $.jgrid.getAccessor(rc,this.p.localReader.id);
				var rc1 = $(&quot;#&quot; + this.p.idPrefix + $.jgrid.jqID(id),this.grid.bDiv)[0];
				var position = this.p._index[id];
				if( $(this).jqGrid(&quot;isNodeLoaded&quot;,this.p.data[position]) ) {
					rc[expanded] = true;
					$(&quot;div.treeclick&quot;,rc1).removeClass(this.p.treeIcons.plus+&quot; tree-plus&quot;).addClass(this.p.treeIcons.minus+&quot; tree-minus&quot;);
				} else if (!this.grid.hDiv.loading) {
					rc[expanded] = true;
					$(&quot;div.treeclick&quot;,rc1).removeClass(this.p.treeIcons.plus+&quot; tree-plus&quot;).addClass(this.p.treeIcons.minus+&quot; tree-minus&quot;);
					this.p.treeANode = rc1.rowIndex;
					this.p.datatype = this.p.treedatatype;
					if(this.p.treeGridModel === &#x27;nested&#x27;) {
						$(this).jqGrid(&quot;setGridParam&quot;,{postData:{nodeid:id,n_left:rc[lft],n_right:rc[rgt],n_level:rc[level]}});
					} else {
						$(this).jqGrid(&quot;setGridParam&quot;,{postData:{nodeid:id,parentid:rc[parent],n_level:rc[level]}} );
					}
					$(this).trigger(&quot;reloadGrid&quot;);
					rc[loaded] = true;
					if(this.p.treeGridModel === &#x27;nested&#x27;) {
						$(this).jqGrid(&quot;setGridParam&quot;,{postData:{nodeid:&#x27;&#x27;,n_left:&#x27;&#x27;,n_right:&#x27;&#x27;,n_level:&#x27;&#x27;}});
					} else {
						$(this).jqGrid(&quot;setGridParam&quot;,{postData:{nodeid:&#x27;&#x27;,parentid:&#x27;&#x27;,n_level:&#x27;&#x27;}});
					}
				}
			}
		});
	},
	collapseNode : function(rc) {
		return this.each(function(){
			if(!this.grid || !this.p.treeGrid) {return;}
			var expanded = this.p.treeReader.expanded_field;
			if(rc[expanded]) {
				rc[expanded] = false;
				var id = $.jgrid.getAccessor(rc,this.p.localReader.id);
				var rc1 = $(&quot;#&quot; + this.p.idPrefix + $.jgrid.jqID(id),this.grid.bDiv)[0];
				$(&quot;div.treeclick&quot;,rc1).removeClass(this.p.treeIcons.minus+&quot; tree-minus&quot;).addClass(this.p.treeIcons.plus+&quot; tree-plus&quot;);
			}
		});
	},
	SortTree : function( sortname, newDir, st, datefmt) {
		return this.each(function(){
			if(!this.grid || !this.p.treeGrid) {return;}
			var i, len,
			rec, records = [], $t = this, query, roots,
			rt = $(this).jqGrid(&quot;getRootNodes&quot;);
			// Sorting roots
			query = $.jgrid.from(rt);
			query.orderBy(sortname,newDir,st, datefmt);
			roots = query.select();

			// Sorting children
			for (i = 0, len = roots.length; i &lt; len; i++) {
				rec = roots[i];
				records.push(rec);
				$(this).jqGrid(&quot;collectChildrenSortTree&quot;,records, rec, sortname, newDir,st, datefmt);
			}
			$.each(records, function(index) {
				var id  = $.jgrid.getAccessor(this,$t.p.localReader.id);
				$(&#x27;#&#x27;+$.jgrid.jqID($t.p.id)+ &#x27; tbody tr:eq(&#x27;+index+&#x27;)&#x27;).after($(&#x27;tr#&#x27;+$.jgrid.jqID(id),$t.grid.bDiv));
			});
			query = null;roots=null;records=null;
		});
	},
	collectChildrenSortTree : function(records, rec, sortname, newDir,st, datefmt) {
		return this.each(function(){
			if(!this.grid || !this.p.treeGrid) {return;}
			var i, len,
			child, ch, query, children;
			ch = $(this).jqGrid(&quot;getNodeChildren&quot;,rec);
			query = $.jgrid.from(ch);
			query.orderBy(sortname, newDir, st, datefmt);
			children = query.select();
			for (i = 0, len = children.length; i &lt; len; i++) {
				child = children[i];
				records.push(child);
				$(this).jqGrid(&quot;collectChildrenSortTree&quot;,records, child, sortname, newDir, st, datefmt);
			}
		});
	},
	// experimental
	setTreeRow : function(rowid, data) {
		var success=false;
		this.each(function(){
			var t = this;
			if(!t.grid || !t.p.treeGrid) {return;}
			success = $(t).jqGrid(&quot;setRowData&quot;,rowid,data);
		});
		return success;
	},
	delTreeNode : function (rowid) {
		return this.each(function () {
			var $t = this, rid = $t.p.localReader.id, i,
			left = $t.p.treeReader.left_field,
			right = $t.p.treeReader.right_field, myright, width, res, key;
			if(!$t.grid || !$t.p.treeGrid) {return;}
			var rc = $t.p._index[rowid];
			if (rc !== undefined) {
				// nested
				myright = parseInt($t.p.data[rc][right],10);
				width = myright -  parseInt($t.p.data[rc][left],10) + 1;
				var dr = $($t).jqGrid(&quot;getFullTreeNode&quot;,$t.p.data[rc]);
				if(dr.length&gt;0){
					for (i=0;i&lt;dr.length;i++){
						$($t).jqGrid(&quot;delRowData&quot;,dr[i][rid]);
					}
				}
				if( $t.p.treeGridModel === &quot;nested&quot;) {
					// ToDo - update grid data
					res = $.jgrid.from($t.p.data)
						.greater(left,myright,{stype:&#x27;integer&#x27;})
						.select();
					if(res.length) {
						for( key in res) {
							if(res.hasOwnProperty(key)) {
								res[key][left] = parseInt(res[key][left],10) - width ;
							}
						}
					}
					res = $.jgrid.from($t.p.data)
						.greater(right,myright,{stype:&#x27;integer&#x27;})
						.select();
					if(res.length) {
						for( key in res) {
							if(res.hasOwnProperty(key)) {
								res[key][right] = parseInt(res[key][right],10) - width ;
							}
						}
					}
				}
			}
		});
	},
	addChildNode : function( nodeid, parentid, data, expandData ) {
		//return this.each(function(){
		var $t = this[0];
		if(data) {
			// we suppose tha the id is autoincremet and
			var expanded = $t.p.treeReader.expanded_field,
			isLeaf = $t.p.treeReader.leaf_field,
			level = $t.p.treeReader.level_field,
			//icon = $t.p.treeReader.icon_field,
			parent = $t.p.treeReader.parent_id_field,
			left = $t.p.treeReader.left_field,
			right = $t.p.treeReader.right_field,
			loaded = $t.p.treeReader.loaded,
			method, parentindex, parentdata, parentlevel, i, len, max=0, rowind = parentid, leaf, maxright;
			if(expandData===undefined) {expandData = false;}
			if ( nodeid === undefined || nodeid === null ) {
				i = $t.p.data.length-1;
				if(	i&gt;= 0 ) {
					while(i&gt;=0){max = Math.max(max, parseInt($t.p.data[i][$t.p.localReader.id],10)); i--;}
				}
				nodeid = max+1;
			}
			var prow = $($t).jqGrid(&#x27;getInd&#x27;, parentid);
			leaf = false;
			// if not a parent we assume root
			if ( parentid === undefined  || parentid === null || parentid===&quot;&quot;) {
				parentid = null;
				rowind = null;
				method = &#x27;last&#x27;;
				parentlevel = $t.p.tree_root_level;
				i = $t.p.data.length+1;
			} else {
				method = &#x27;after&#x27;;
				parentindex = $t.p._index[parentid];
				parentdata = $t.p.data[parentindex];
				parentid = parentdata[$t.p.localReader.id];
				parentlevel = parseInt(parentdata[level],10)+1;
				var childs = $($t).jqGrid(&#x27;getFullTreeNode&#x27;, parentdata);
				// if there are child nodes get the last index of it
				if(childs.length) {
					i = childs[childs.length-1][$t.p.localReader.id];
					rowind = i;
					i = $($t).jqGrid(&#x27;getInd&#x27;,rowind)+1;
				} else {
					i = $($t).jqGrid(&#x27;getInd&#x27;, parentid)+1;
				}
				// if the node is leaf
				if(parentdata[isLeaf]) {
					leaf = true;
					parentdata[expanded] = true;
					//var prow = $($t).jqGrid(&#x27;getInd&#x27;, parentid);
					$($t.rows[prow])
						.find(&quot;span.cell-wrapperleaf&quot;).removeClass(&quot;cell-wrapperleaf&quot;).addClass(&quot;cell-wrapper&quot;)
						.end()
						.find(&quot;div.tree-leaf&quot;).removeClass($t.p.treeIcons.leaf+&quot; tree-leaf&quot;).addClass($t.p.treeIcons.minus+&quot; tree-minus&quot;);
					$t.p.data[parentindex][isLeaf] = false;
					parentdata[loaded] = true;
				}
			}
			len = i+1;

			if( data[expanded]===undefined)  {data[expanded]= false;}
			if( data[loaded]===undefined )  { data[loaded] = false;}
			data[level] = parentlevel;
			if( data[isLeaf]===undefined) {data[isLeaf]= true;}
			if( $t.p.treeGridModel === &quot;adjacency&quot;) {
				data[parent] = parentid;
			}
			if( $t.p.treeGridModel === &quot;nested&quot;) {
				// this method requiere more attention
				var query, res, key;
				//maxright = parseInt(maxright,10);
				// ToDo - update grid data
				if(parentid !== null) {
					maxright = parseInt(parentdata[right],10);
					query = $.jgrid.from($t.p.data);
					query = query.greaterOrEquals(right,maxright,{stype:&#x27;integer&#x27;});
					res = query.select();
					if(res.length) {
						for( key in res) {
							if(res.hasOwnProperty(key)) {
								res[key][left] = res[key][left] &gt; maxright ? parseInt(res[key][left],10) +2 : res[key][left];
								res[key][right] = res[key][right] &gt;= maxright ? parseInt(res[key][right],10) +2 : res[key][right];
							}
						}
					}
					data[left] = maxright;
					data[right]= maxright+1;
				} else {
					maxright = parseInt( $($t).jqGrid(&#x27;getCol&#x27;, right, false, &#x27;max&#x27;), 10);
					res = $.jgrid.from($t.p.data)
						.greater(left,maxright,{stype:&#x27;integer&#x27;})
						.select();
					if(res.length) {
						for( key in res) {
							if(res.hasOwnProperty(key)) {
								res[key][left] = parseInt(res[key][left],10) +2 ;
							}
						}
					}
					res = $.jgrid.from($t.p.data)
						.greater(right,maxright,{stype:&#x27;integer&#x27;})
						.select();
					if(res.length) {
						for( key in res) {
							if(res.hasOwnProperty(key)) {
								res[key][right] = parseInt(res[key][right],10) +2 ;
							}
						}
					}
					data[left] = maxright+1;
					data[right] = maxright + 2;
				}
			}
			if( parentid === null || $($t).jqGrid(&quot;isNodeLoaded&quot;,parentdata) || leaf ) {
					$($t).jqGrid(&#x27;addRowData&#x27;, nodeid, data, method, rowind);
					$($t).jqGrid(&#x27;setTreeNode&#x27;, i, len);
			}
			if(parentdata &amp;&amp; !parentdata[expanded] &amp;&amp; expandData) {
				$($t.rows[prow])
					.find(&quot;div.treeclick&quot;)
					.click();
			}
		}
		//});
	}
});
})(jQuery);
/*jshint eqeqeq:false, eqnull:true */
/*global jQuery */
// Grouping module
(function($){
&quot;use strict&quot;;
$.extend($.jgrid,{
	template : function(format){ //jqgformat
		var args = $.makeArray(arguments).slice(1), j, al = args.length;
		if(format==null) { format = &quot;&quot;; }
		return format.replace(/\{([\w\-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g, function(m,i){
			if(!isNaN(parseInt(i,10))) {
				return args[parseInt(i,10)];
			}
			for(j=0; j &lt; al;j++) {
				if($.isArray(args[j])) {
					var nmarr = args[ j ],
					k = nmarr.length;
					while(k--) {
						if(i===nmarr[k].nm) {
							return nmarr[k].v;
						}
					}
				}
			}
		});
	}
});
$.jgrid.extend({
	groupingSetup : function () {
		return this.each(function (){
			var $t = this, i, j, cml, cm = $t.p.colModel, grp = $t.p.groupingView;
			if(grp !== null &amp;&amp; ( (typeof grp === &#x27;object&#x27;) || $.isFunction(grp) ) ) {
				if(!grp.groupField.length) {
					$t.p.grouping = false;
				} else {
					if (grp.visibiltyOnNextGrouping === undefined) {
						grp.visibiltyOnNextGrouping = [];
					}

					grp.lastvalues=[];
					if(!grp._locgr) {
						grp.groups =[];
					}
					grp.counters =[];
					for(i=0;i&lt;grp.groupField.length;i++) {
						if(!grp.groupOrder[i]) {
							grp.groupOrder[i] = &#x27;asc&#x27;;
						}
						if(!grp.groupText[i]) {
							grp.groupText[i] = &#x27;{0}&#x27;;
						}
						if( typeof grp.groupColumnShow[i] !== &#x27;boolean&#x27;) {
							grp.groupColumnShow[i] = true;
						}
						if( typeof grp.groupSummary[i] !== &#x27;boolean&#x27;) {
							grp.groupSummary[i] = false;
						}
						if( !grp.groupSummaryPos[i]) {
							grp.groupSummaryPos[i] = &#x27;footer&#x27;;
						}
						if(grp.groupColumnShow[i] === true) {
							grp.visibiltyOnNextGrouping[i] = true;
							$($t).jqGrid(&#x27;showCol&#x27;,grp.groupField[i]);
						} else {
							grp.visibiltyOnNextGrouping[i] = $(&quot;#&quot;+$.jgrid.jqID($t.p.id+&quot;_&quot;+grp.groupField[i])).is(&quot;:visible&quot;);
							$($t).jqGrid(&#x27;hideCol&#x27;,grp.groupField[i]);
						}
					}
					grp.summary =[];
					if(grp.hideFirstGroupCol) {
						grp.formatDisplayField[0] = function (v) { return v;};
					}
					for(j=0, cml = cm.length; j &lt; cml; j++) {
						if(grp.hideFirstGroupCol) {
							if(!cm[j].hidden &amp;&amp; grp.groupField[0] === cm[j].name) {
								cm[j].formatter = function(){return &#x27;&#x27;;};
							}
						}
						if(cm[j].summaryType ) {
							if(cm[j].summaryDivider) {
								grp.summary.push({nm:cm[j].name,st:cm[j].summaryType, v: &#x27;&#x27;, sd:cm[j].summaryDivider, vd:&#x27;&#x27;, sr: cm[j].summaryRound, srt: cm[j].summaryRoundType || &#x27;round&#x27;});
							} else {
								grp.summary.push({nm:cm[j].name,st:cm[j].summaryType, v: &#x27;&#x27;, sr: cm[j].summaryRound, srt: cm[j].summaryRoundType || &#x27;round&#x27;});
							}
						}
					}
				}
			} else {
				$t.p.grouping = false;
			}
		});
	},
	groupingPrepare : function ( record, irow ) {
		this.each(function(){
			var grp = this.p.groupingView, $t= this, i,
			grlen = grp.groupField.length,
			fieldName,
			v,
			displayName,
			displayValue,
			changed = 0;
			for(i=0;i&lt;grlen;i++) {
				fieldName = grp.groupField[i];
				displayName = grp.displayField[i];
				v = record[fieldName];
				displayValue = displayName == null ? null : record[displayName];

				if( displayValue == null ) {
					displayValue = v;
				}
				if( v !== undefined ) {
					if(irow === 0 ) {
						// First record always starts a new group
						grp.groups.push({idx:i,dataIndex:fieldName,value:v, displayValue: displayValue, startRow: irow, cnt:1, summary : [] } );
						grp.lastvalues[i] = v;
						grp.counters[i] = {cnt:1, pos:grp.groups.length-1, summary: $.extend(true,[],grp.summary)};
						$.each(grp.counters[i].summary,function() {
							if ($.isFunction(this.st)) {
								this.v = this.st.call($t, this.v, this.nm, record);
							} else {
								this.v = $($t).jqGrid(&#x27;groupingCalculations.handler&#x27;,this.st, this.v, this.nm, this.sr, this.srt, record);
								if(this.st.toLowerCase() === &#x27;avg&#x27; &amp;&amp; this.sd) {
									this.vd = $($t).jqGrid(&#x27;groupingCalculations.handler&#x27;,this.st, this.vd, this.sd, this.sr, this.srt, record);
								}
							}
						});
						grp.groups[grp.counters[i].pos].summary = grp.counters[i].summary;
					} else {
						if (typeof v !== &quot;object&quot; &amp;&amp; ($.isArray(grp.isInTheSameGroup) &amp;&amp; $.isFunction(grp.isInTheSameGroup[i]) ? ! grp.isInTheSameGroup[i].call($t, grp.lastvalues[i], v, i, grp): grp.lastvalues[i] !== v)) {
							// This record is not in same group as previous one
							grp.groups.push({idx:i,dataIndex:fieldName,value:v, displayValue: displayValue, startRow: irow, cnt:1, summary : [] } );
							grp.lastvalues[i] = v;
							changed = 1;
							grp.counters[i] = {cnt:1, pos:grp.groups.length-1, summary: $.extend(true,[],grp.summary)};
							$.each(grp.counters[i].summary,function() {
								if ($.isFunction(this.st)) {
									this.v = this.st.call($t, this.v, this.nm, record);
								} else {
									this.v = $($t).jqGrid(&#x27;groupingCalculations.handler&#x27;,this.st, this.v, this.nm, this.sr, this.srt, record);
									if(this.st.toLowerCase() === &#x27;avg&#x27; &amp;&amp; this.sd) {
										this.vd = $($t).jqGrid(&#x27;groupingCalculations.handler&#x27;,this.st, this.vd, this.sd, this.sr, this.srt, record);
									}
								}
							});
							grp.groups[grp.counters[i].pos].summary = grp.counters[i].summary;
						} else {
							if (changed === 1) {
								// This group has changed because an earlier group changed.
								grp.groups.push({idx:i,dataIndex:fieldName,value:v, displayValue: displayValue, startRow: irow, cnt:1, summary : [] } );
								grp.lastvalues[i] = v;
								grp.counters[i] = {cnt:1, pos:grp.groups.length-1, summary: $.extend(true,[],grp.summary)};
								$.each(grp.counters[i].summary,function() {
									if ($.isFunction(this.st)) {
										this.v = this.st.call($t, this.v, this.nm, record);
									} else {
										this.v = $($t).jqGrid(&#x27;groupingCalculations.handler&#x27;,this.st, this.v, this.nm, this.sr, this.srt, record);
										if(this.st.toLowerCase() === &#x27;avg&#x27; &amp;&amp; this.sd) {
											this.vd = $($t).jqGrid(&#x27;groupingCalculations.handler&#x27;,this.st, this.vd, this.sd, this.sr, this.srt, record);
										}
									}
								});
								grp.groups[grp.counters[i].pos].summary = grp.counters[i].summary;
							} else {
								grp.counters[i].cnt += 1;
								grp.groups[grp.counters[i].pos].cnt = grp.counters[i].cnt;
								$.each(grp.counters[i].summary,function() {
									if ($.isFunction(this.st)) {
										this.v = this.st.call($t, this.v, this.nm, record);
									} else {
										this.v = $($t).jqGrid(&#x27;groupingCalculations.handler&#x27;,this.st, this.v, this.nm, this.sr, this.srt, record);
										if(this.st.toLowerCase() === &#x27;avg&#x27; &amp;&amp; this.sd) {
											this.vd = $($t).jqGrid(&#x27;groupingCalculations.handler&#x27;,this.st, this.vd, this.sd, this.sr, this.srt, record);
										}
									}
								});
								grp.groups[grp.counters[i].pos].summary = grp.counters[i].summary;
							}
						}
					}
				}
			}
			//gdata.push( rData );
		});
		return this;
	},
	groupingToggle : function(hid){
		this.each(function(){
			var $t = this,
			grp = $t.p.groupingView,
			strpos = hid.split(&#x27;_&#x27;),
			num = parseInt(strpos[strpos.length-2], 10);
			strpos.splice(strpos.length-2,2);
			var uid = strpos.join(&quot;_&quot;),
			minus = grp.minusicon,
			plus = grp.plusicon,
			tar = $(&quot;#&quot;+$.jgrid.jqID(hid)),
			r = tar.length ? tar[0].nextSibling : null,
			tarspan = $(&quot;#&quot;+$.jgrid.jqID(hid)+&quot; span.&quot;+&quot;tree-wrap-&quot;+$t.p.direction),
			getGroupingLevelFromClass = function (className) {
				var nums = $.map(className.split(&quot; &quot;), function (item) {
					if (item.substring(0, uid.length + 1) === uid + &quot;_&quot;) {
						return parseInt(item.substring(uid.length + 1), 10);
					}
				});
				return nums.length &gt; 0 ? nums[0] : undefined;
			},
			itemGroupingLevel,
			showData,
			collapsed = false,
			frz = $t.p.frozenColumns ? $t.p.id+&quot;_frozen&quot; : false,
			tar2 = frz ? $(&quot;#&quot;+$.jgrid.jqID(hid), &quot;#&quot;+$.jgrid.jqID(frz) ) : false,
			r2 = (tar2 &amp;&amp; tar2.length) ? tar2[0].nextSibling : null;
			if( tarspan.hasClass(minus) ) {
				if(grp.showSummaryOnHide) {
					if(r){
						while(r) {
							if($(r).hasClass(&#x27;jqfoot&#x27;) ) {
								var lv = parseInt($(r).attr(&quot;jqfootlevel&quot;),10);
								if(  lv &lt;= num) {
									break;
								}
							}
							$(r).hide();
							r = r.nextSibling;
							if(frz) {
								$(r2).hide();
								r2 = r2.nextSibling;
							}
						}
					}
				} else  {
					if(r){
						while(r) {
							itemGroupingLevel = getGroupingLevelFromClass(r.className);
							if (itemGroupingLevel !== undefined &amp;&amp; itemGroupingLevel &lt;= num) {
								break;
							}
							$(r).hide();
							r = r.nextSibling;
							if(frz) {
								$(r2).hide();
								r2 = r2.nextSibling;
							}
						}
					}
				}
				tarspan.removeClass(minus).addClass(plus);
				collapsed = true;
			} else {
				if(r){
					showData = undefined;
					while(r) {
						itemGroupingLevel = getGroupingLevelFromClass(r.className);
						if (showData === undefined) {
							showData = itemGroupingLevel === undefined; // if the first row after the opening group is data row then show the data rows
						}
						if (itemGroupingLevel !== undefined) {
							if (itemGroupingLevel &lt;= num) {
								break;// next item of the same lever are found
							}
							if (itemGroupingLevel === num + 1) {
								$(r).show().find(&quot;&gt;td&gt;span.&quot;+&quot;tree-wrap-&quot;+$t.p.direction).removeClass(minus).addClass(plus);
								if(frz) {
									$(r2).show().find(&quot;&gt;td&gt;span.&quot;+&quot;tree-wrap-&quot;+$t.p.direction).removeClass(minus).addClass(plus);
								}
							}
						} else if (showData) {
							$(r).show();
							if(frz) {
								$(r2).show();
							}
						}
						r = r.nextSibling;
						if(frz) {
							r2 = r2.nextSibling;
						}
					}
				}
				tarspan.removeClass(plus).addClass(minus);
			}
			$($t).triggerHandler(&quot;jqGridGroupingClickGroup&quot;, [hid , collapsed]);
			if( $.isFunction($t.p.onClickGroup)) { $t.p.onClickGroup.call($t, hid , collapsed); }

		});
		return false;
	},
	groupingRender : function (grdata, colspans, page, rn ) {
		return this.each(function(){
			var $t = this,
			grp = $t.p.groupingView,
			str = &quot;&quot;, icon = &quot;&quot;, hid, clid, pmrtl = grp.groupCollapse ? grp.plusicon : grp.minusicon, gv, cp=[], len =grp.groupField.length;
			pmrtl += &quot; tree-wrap-&quot;+$t.p.direction;
			$.each($t.p.colModel, function (i,n){
				var ii;
				for(ii=0;ii&lt;len;ii++) {
					if(grp.groupField[ii] === n.name ) {
						cp[ii] = i;
						break;
					}
				}
			});
			var toEnd = 0;
			function findGroupIdx( ind , offset, grp) {
				var ret = false, i;
				if(offset===0) {
					ret = grp[ind];
				} else {
					var id = grp[ind].idx;
					if(id===0) {
						ret = grp[ind];
					}  else {
						for(i=ind;i &gt;= 0; i--) {
							if(grp[i].idx === id-offset) {
								ret = grp[i];
								break;
							}
						}
					}
				}
				return ret;
			}
			function buildSummaryTd(i, ik, grp, foffset) {
				var fdata = findGroupIdx(i, ik, grp),
				cm = $t.p.colModel,
				vv, grlen = fdata.cnt, str=&quot;&quot;, k;
				for(k=foffset; k&lt;colspans;k++) {
					var tmpdata = &quot;&lt;td &quot;+$t.formatCol(k,1,&#x27;&#x27;)+&quot;&gt;&amp;#160;&lt;/td&gt;&quot;,
					tplfld = &quot;{0}&quot;;
					$.each(fdata.summary,function(){
						if(this.nm === cm[k].name) {
							if(cm[k].summaryTpl)  {
								tplfld = cm[k].summaryTpl;
							}
							if(typeof this.st === &#x27;string&#x27; &amp;&amp; this.st.toLowerCase() === &#x27;avg&#x27;) {
								if(this.sd &amp;&amp; this.vd) {
									this.v = (this.v/this.vd);
								} else if(this.v &amp;&amp; grlen &gt; 0) {
									this.v = (this.v/grlen);
								}
							}
							try {
								this.groupCount = fdata.cnt;
								this.groupIndex = fdata.dataIndex;
								this.groupValue = fdata.value;
								vv = $t.formatter(&#x27;&#x27;, this.v, k, this);
							} catch (ef) {
								vv = this.v;
							}
							tmpdata= &quot;&lt;td &quot;+$t.formatCol(k,1,&#x27;&#x27;)+&quot;&gt;&quot;+$.jgrid.format(tplfld,vv)+ &quot;&lt;/td&gt;&quot;;
							return false;
						}
					});
					str += tmpdata;
				}
				return str;
			}
			var sumreverse = $.makeArray(grp.groupSummary);
			sumreverse.reverse();
			$.each(grp.groups,function(i,n){
				if(grp._locgr) {
					if( !(n.startRow +n.cnt &gt; (page-1)*rn &amp;&amp; n.startRow &lt; page*rn)) {
						return true;
					}
				}
				toEnd++;
				clid = $t.p.id+&quot;ghead_&quot;+n.idx;
				hid = clid+&quot;_&quot;+i;
				icon = &quot;&lt;span style=&#x27;cursor:pointer;&#x27; class=&#x27;ui-icon &quot;+pmrtl+&quot;&#x27; onclick=\&quot;jQuery(&#x27;#&quot;+$.jgrid.jqID($t.p.id)+&quot;&#x27;).jqGrid(&#x27;groupingToggle&#x27;,&#x27;&quot;+hid+&quot;&#x27;);return false;\&quot;&gt;&lt;/span&gt;&quot;;
				try {
					if ($.isArray(grp.formatDisplayField) &amp;&amp; $.isFunction(grp.formatDisplayField[n.idx])) {
						n.displayValue = grp.formatDisplayField[n.idx].call($t, n.displayValue, n.value, $t.p.colModel[cp[n.idx]], n.idx, grp);
						gv = n.displayValue;
					} else {
						gv = $t.formatter(hid, n.displayValue, cp[n.idx], n.value );
					}
				} catch (egv) {
					gv = n.displayValue;
				}
				if(grp.groupSummaryPos[n.idx] === &#x27;header&#x27;)  {
					str += &quot;&lt;tr id=\&quot;&quot;+hid+&quot;\&quot;&quot; +(grp.groupCollapse &amp;&amp; n.idx&gt;0 ? &quot; style=\&quot;display:none;\&quot; &quot; : &quot; &quot;) + &quot;role=\&quot;row\&quot; class= \&quot;ui-widget-content jqgroup ui-row-&quot;+$t.p.direction+&quot; &quot;+clid+&quot;\&quot;&gt;&lt;td style=\&quot;padding-left:&quot;+(n.idx * 12) + &quot;px;&quot;+&quot;\&quot;&gt;&quot;+icon+$.jgrid.template(grp.groupText[n.idx], gv, n.cnt, n.summary)+&quot;&lt;/td&gt;&quot;;
					str += buildSummaryTd(i, n.idx-1, grp.groups, 1);
					str += &quot;&lt;/tr&gt;&quot;;
				} else {
					str += &quot;&lt;tr id=\&quot;&quot;+hid+&quot;\&quot;&quot; +(grp.groupCollapse &amp;&amp; n.idx&gt;0 ? &quot; style=\&quot;display:none;\&quot; &quot; : &quot; &quot;) + &quot;role=\&quot;row\&quot; class= \&quot;ui-widget-content jqgroup ui-row-&quot;+$t.p.direction+&quot; &quot;+clid+&quot;\&quot;&gt;&lt;td style=\&quot;padding-left:&quot;+(n.idx * 12) + &quot;px;&quot;+&quot;\&quot; colspan=\&quot;&quot;+colspans+&quot;\&quot;&gt;&quot;+icon+$.jgrid.template(grp.groupText[n.idx], gv, n.cnt, n.summary)+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;;
				}
				var leaf = len-1 === n.idx;
				if( leaf ) {
					var gg = grp.groups[i+1], kk, ik, offset = 0, sgr = n.startRow,
					end = gg !== undefined ?  grp.groups[i+1].startRow : grdata.length;
					if(grp._locgr) {
						offset = (page-1)*rn;
						if(offset &gt; n.startRow) {
							sgr = offset;
						}
					}
					for(kk=sgr;kk&lt;end;kk++) {
						if(!grdata[kk - offset]) { break; }
						str += grdata[kk - offset].join(&#x27;&#x27;);
					}
					if(grp.groupSummaryPos[n.idx] !== &#x27;header&#x27;) {
						var jj;
						if (gg !== undefined) {
							for (jj = 0; jj &lt; grp.groupField.length; jj++) {
								if (gg.dataIndex === grp.groupField[jj]) {
									break;
								}
							}
							toEnd = grp.groupField.length - jj;
						}
						for (ik = 0; ik &lt; toEnd; ik++) {
							if(!sumreverse[ik]) { continue; }
							var hhdr = &quot;&quot;;
							if(grp.groupCollapse &amp;&amp; !grp.showSummaryOnHide) {
								hhdr = &quot; style=\&quot;display:none;\&quot;&quot;;
							}
							str += &quot;&lt;tr&quot;+hhdr+&quot; jqfootlevel=\&quot;&quot;+(n.idx-ik)+&quot;\&quot; role=\&quot;row\&quot; class=\&quot;ui-widget-content jqfoot ui-row-&quot;+$t.p.direction+&quot;\&quot;&gt;&quot;;
							str += buildSummaryTd(i, ik, grp.groups, 0);
							str += &quot;&lt;/tr&gt;&quot;;
						}
						toEnd = jj;
					}
				}
			});
			$(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first&quot;).append(str);
			// free up memory
			str = null;
		});
	},
	groupingGroupBy : function (name, options ) {
		return this.each(function(){
			var $t = this;
			if(typeof name === &quot;string&quot;) {
				name = [name];
			}
			var grp = $t.p.groupingView;
			$t.p.grouping = true;

			//Set default, in case visibilityOnNextGrouping is undefined
			if (grp.visibiltyOnNextGrouping === undefined) {
				grp.visibiltyOnNextGrouping = [];
			}
			var i;
			// show previous hidden groups if they are hidden and weren&#x27;t removed yet
			for(i=0;i&lt;grp.groupField.length;i++) {
				if(!grp.groupColumnShow[i] &amp;&amp; grp.visibiltyOnNextGrouping[i]) {
				$($t).jqGrid(&#x27;showCol&#x27;,grp.groupField[i]);
				}
			}
			// set visibility status of current group columns on next grouping
			for(i=0;i&lt;name.length;i++) {
				grp.visibiltyOnNextGrouping[i] = $(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot;_&quot;+$.jgrid.jqID(name[i])).is(&quot;:visible&quot;);
			}
			$t.p.groupingView = $.extend($t.p.groupingView, options || {});
			grp.groupField = name;
			$($t).trigger(&quot;reloadGrid&quot;);
		});
	},
	groupingRemove : function (current) {
		return this.each(function(){
			var $t = this;
			if(current === undefined) {
				current = true;
			}
			$t.p.grouping = false;
			if(current===true) {
				var grp = $t.p.groupingView, i;
				// show previous hidden groups if they are hidden and weren&#x27;t removed yet
				for(i=0;i&lt;grp.groupField.length;i++) {
				if (!grp.groupColumnShow[i] &amp;&amp; grp.visibiltyOnNextGrouping[i]) {
						$($t).jqGrid(&#x27;showCol&#x27;, grp.groupField);
					}
				}
				$(&quot;tr.jqgroup, tr.jqfoot&quot;,&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first&quot;).remove();
				$(&quot;tr.jqgrow:hidden&quot;,&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first&quot;).show();
			} else {
				$($t).trigger(&quot;reloadGrid&quot;);
			}
		});
	},
	groupingCalculations : {
		handler: function(fn, v, field, round, roundType, rc) {
			var funcs = {
				sum: function() {
					return parseFloat(v||0) + parseFloat((rc[field]||0));
				},

				min: function() {
					if(v===&quot;&quot;) {
						return parseFloat(rc[field]||0);
					}
					return Math.min(parseFloat(v),parseFloat(rc[field]||0));
				},

				max: function() {
					if(v===&quot;&quot;) {
						return parseFloat(rc[field]||0);
					}
					return Math.max(parseFloat(v),parseFloat(rc[field]||0));
				},

				count: function() {
					if(v===&quot;&quot;) {v=0;}
					if(rc.hasOwnProperty(field)) {
						return v+1;
					}
					return 0;
				},

				avg: function() {
					// the same as sum, but at end we divide it
					// so use sum instead of duplicating the code (?)
					return funcs.sum();
				}
			};

			if(!funcs[fn]) {
				throw (&quot;jqGrid Grouping No such method: &quot; + fn);
			}
			var res = funcs[fn]();

			if (round != null) {
				if (roundType === &#x27;fixed&#x27;) {
					res = res.toFixed(round);
				} else {
					var mul = Math.pow(10, round);
					res = Math.round(res * mul) / mul;
				}
			}

			return res;
		}
	}
});
})(jQuery);
/*jshint eqeqeq:false, eqnull:true, devel:true */
/*global jQuery, xmlJsonClass */
(function($){
/*
 * jqGrid extension for constructing Grid Data from external file
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/

&quot;use strict&quot;;
    $.jgrid.extend({
        jqGridImport : function(o) {
            o = $.extend({
                imptype : &quot;xml&quot;, // xml, json, xmlstring, jsonstring
                impstring: &quot;&quot;,
                impurl: &quot;&quot;,
                mtype: &quot;GET&quot;,
                impData : {},
                xmlGrid :{
                    config : &quot;roots&gt;grid&quot;,
                    data: &quot;roots&gt;rows&quot;
                },
                jsonGrid :{
                    config : &quot;grid&quot;,
                    data: &quot;data&quot;
                },
                ajaxOptions :{}
            }, o || {});
            return this.each(function(){
                var $t = this;
                var xmlConvert = function (xml,o) {
                    var cnfg = $(o.xmlGrid.config,xml)[0];
                    var xmldata = $(o.xmlGrid.data,xml)[0], jstr, jstr1, key;
                    if(xmlJsonClass.xml2json &amp;&amp; $.jgrid.parse) {
                        jstr = xmlJsonClass.xml2json(cnfg,&quot; &quot;);
                        jstr = $.jgrid.parse(jstr);
                        for(key in jstr) {
                            if(jstr.hasOwnProperty(key)) {
                                jstr1=jstr[key];
                            }
                        }
                        if(xmldata) {
                        // save the datatype
                            var svdatatype = jstr.grid.datatype;
                            jstr.grid.datatype = &#x27;xmlstring&#x27;;
                            jstr.grid.datastr = xml;
                            $($t).jqGrid( jstr1 ).jqGrid(&quot;setGridParam&quot;,{datatype:svdatatype});
                        } else {
                            $($t).jqGrid( jstr1 );
                        }
                        jstr = null;jstr1=null;
                    } else {
                        alert(&quot;xml2json or parse are not present&quot;);
                    }
                };
                var jsonConvert = function (jsonstr,o){
                    if (jsonstr &amp;&amp; typeof jsonstr === &#x27;string&#x27;) {
						var _jsonparse = false;
						if($.jgrid.useJSON) {
							$.jgrid.useJSON = false;
							_jsonparse = true;
						}
                        var json = $.jgrid.parse(jsonstr);
						if(_jsonparse) { $.jgrid.useJSON = true; }
                        var gprm = json[o.jsonGrid.config];
                        var jdata = json[o.jsonGrid.data];
                        if(jdata) {
                            var svdatatype = gprm.datatype;
                            gprm.datatype = &#x27;jsonstring&#x27;;
                            gprm.datastr = jdata;
                            $($t).jqGrid( gprm ).jqGrid(&quot;setGridParam&quot;,{datatype:svdatatype});
                        } else {
                            $($t).jqGrid( gprm );
                        }
                    }
                };
                switch (o.imptype){
                    case &#x27;xml&#x27;:
                        $.ajax($.extend({
                            url:o.impurl,
                            type:o.mtype,
                            data: o.impData,
                            dataType:&quot;xml&quot;,
                            complete: function(xml,stat) {
                                if(stat === &#x27;success&#x27;) {
                                    xmlConvert(xml.responseXML,o);
                                    $($t).triggerHandler(&quot;jqGridImportComplete&quot;, [xml, o]);
                                    if($.isFunction(o.importComplete)) {
                                        o.importComplete(xml);
                                    }
                                }
                                xml=null;
                            }
                        }, o.ajaxOptions));
                        break;
                    case &#x27;xmlstring&#x27; :
                        // we need to make just the conversion and use the same code as xml
                        if(o.impstring &amp;&amp; typeof o.impstring === &#x27;string&#x27;) {
                            var xmld = $.parseXML(o.impstring);
                            if(xmld) {
                                xmlConvert(xmld,o);
                                $($t).triggerHandler(&quot;jqGridImportComplete&quot;, [xmld, o]);
                                if($.isFunction(o.importComplete)) {
                                    o.importComplete(xmld);
                                }
                                o.impstring = null;
                            }
                            xmld = null;
                        }
                        break;
                    case &#x27;json&#x27;:
                        $.ajax($.extend({
                            url:o.impurl,
                            type:o.mtype,
                            data: o.impData,
                            dataType:&quot;json&quot;,
                            complete: function(json) {
                                try {
                                    jsonConvert(json.responseText,o );
                                    $($t).triggerHandler(&quot;jqGridImportComplete&quot;, [json, o]);
                                    if($.isFunction(o.importComplete)) {
                                        o.importComplete(json);
                                    }
                                } catch (ee){}
                                json=null;
                            }
                        }, o.ajaxOptions ));
                        break;
                    case &#x27;jsonstring&#x27; :
                        if(o.impstring &amp;&amp; typeof o.impstring === &#x27;string&#x27;) {
                            jsonConvert(o.impstring,o );
                            $($t).triggerHandler(&quot;jqGridImportComplete&quot;, [o.impstring, o]);
                            if($.isFunction(o.importComplete)) {
                                o.importComplete(o.impstring);
                            }
                            o.impstring = null;
                        }
                        break;
                }
            });
        },
        jqGridExport : function(o) {
            o = $.extend({
                exptype : &quot;xmlstring&quot;,
                root: &quot;grid&quot;,
                ident: &quot;\t&quot;
            }, o || {});
            var ret = null;
            this.each(function () {
                if(!this.grid) { return;}
                var key, gprm = $.extend(true, {},$(this).jqGrid(&quot;getGridParam&quot;));
                // we need to check for:
                // 1.multiselect, 2.subgrid  3. treegrid and remove the unneded columns from colNames
                if(gprm.rownumbers) {
                    gprm.colNames.splice(0,1);
                    gprm.colModel.splice(0,1);
                }
                if(gprm.multiselect) {
                    gprm.colNames.splice(0,1);
                    gprm.colModel.splice(0,1);
                }
                if(gprm.subGrid) {
                    gprm.colNames.splice(0,1);
                    gprm.colModel.splice(0,1);
                }
                gprm.knv = null;
                if(gprm.treeGrid) {
                    for (key in gprm.treeReader) {
                        if(gprm.treeReader.hasOwnProperty(key)) {
                            gprm.colNames.splice(gprm.colNames.length-1);
                            gprm.colModel.splice(gprm.colModel.length-1);
                        }
                    }
                }
                switch (o.exptype) {
                    case &#x27;xmlstring&#x27; :
                        ret = &quot;&lt;&quot;+o.root+&quot;&gt;&quot;+xmlJsonClass.json2xml(gprm,o.ident)+&quot;&lt;/&quot;+o.root+&quot;&gt;&quot;;
                        break;
                    case &#x27;jsonstring&#x27; :
                        ret = &quot;{&quot;+ xmlJsonClass.toJson(gprm,o.root,o.ident,false)+&quot;}&quot;;
                        if(gprm.postData.filters !== undefined) {
                            ret=ret.replace(/filters&quot;:&quot;/,&#x27;filters&quot;:&#x27;);
                            ret=ret.replace(/}]}&quot;/,&#x27;}]}&#x27;);
                        }
                        break;
                }
            });
            return ret;
        },
        excelExport : function(o) {
            o = $.extend({
                exptype : &quot;remote&quot;,
                url : null,
                oper: &quot;oper&quot;,
                tag: &quot;excel&quot;,
                exportOptions : {}
            }, o || {});
            return this.each(function(){
                if(!this.grid) { return;}
                var url;
                if(o.exptype === &quot;remote&quot;) {
                    var pdata = $.extend({},this.p.postData);
                    pdata[o.oper] = o.tag;
                    var params = jQuery.param(pdata);
                    if(o.url.indexOf(&quot;?&quot;) !== -1) { url = o.url+&quot;&amp;&quot;+params; }
                    else { url = o.url+&quot;?&quot;+params; }
                    window.location = url;
                }
            });
        }
    });
})(jQuery);
/*jshint evil:true, eqeqeq:false, eqnull:true, devel:true */
/*global jQuery */
(function($){
/*
**
 * jqGrid addons using jQuery UI
 * Author: Mark Williams
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
 * depends on jQuery UI
**/
&quot;use strict&quot;;
if ($.jgrid.msie &amp;&amp; $.jgrid.msiever()===8) {
	$.expr[&quot;:&quot;].hidden = function(elem) {
		return elem.offsetWidth === 0 || elem.offsetHeight === 0 ||
			elem.style.display === &quot;none&quot;;
	};
}
// requiere load multiselect before grid
$.jgrid._multiselect = false;
if($.ui) {
	if ($.ui.multiselect ) {
		if($.ui.multiselect.prototype._setSelected) {
			var setSelected = $.ui.multiselect.prototype._setSelected;
			$.ui.multiselect.prototype._setSelected = function(item,selected) {
				var ret = setSelected.call(this,item,selected);
				if (selected &amp;&amp; this.selectedList) {
					var elt = this.element;
					this.selectedList.find(&#x27;li&#x27;).each(function() {
						if ($(this).data(&#x27;optionLink&#x27;)) {
							$(this).data(&#x27;optionLink&#x27;).remove().appendTo(elt);
						}
					});
				}
				return ret;
			};
		}
		if($.ui.multiselect.prototype.destroy) {
			$.ui.multiselect.prototype.destroy = function() {
				this.element.show();
				this.container.remove();
				if ($.Widget === undefined) {
					$.widget.prototype.destroy.apply(this, arguments);
				} else {
					$.Widget.prototype.destroy.apply(this, arguments);
				}
			};
		}
		$.jgrid._multiselect = true;
	}
}

$.jgrid.extend({
	sortableColumns : function (tblrow)
	{
		return this.each(function (){
			var ts = this, tid= $.jgrid.jqID( ts.p.id );
			function start() {ts.p.disableClick = true;}
			var sortable_opts = {
				&quot;tolerance&quot; : &quot;pointer&quot;,
				&quot;axis&quot; : &quot;x&quot;,
				&quot;scrollSensitivity&quot;: &quot;1&quot;,
				&quot;items&quot;: &#x27;&gt;th:not(:has(#jqgh_&#x27;+tid+&#x27;_cb&#x27;+&#x27;,#jqgh_&#x27;+tid+&#x27;_rn&#x27;+&#x27;,#jqgh_&#x27;+tid+&#x27;_subgrid),:hidden)&#x27;,
				&quot;placeholder&quot;: {
					element: function(item) {
						var el = $(document.createElement(item[0].nodeName))
						.addClass(item[0].className+&quot; ui-sortable-placeholder ui-state-highlight&quot;)
						.removeClass(&quot;ui-sortable-helper&quot;)[0];
						return el;
					},
					update: function(self, p) {
						p.height(self.currentItem.innerHeight() - parseInt(self.currentItem.css(&#x27;paddingTop&#x27;)||0, 10) - parseInt(self.currentItem.css(&#x27;paddingBottom&#x27;)||0, 10));
						p.width(self.currentItem.innerWidth() - parseInt(self.currentItem.css(&#x27;paddingLeft&#x27;)||0, 10) - parseInt(self.currentItem.css(&#x27;paddingRight&#x27;)||0, 10));
					}
				},
				&quot;update&quot;: function(event, ui) {
					var p = $(ui.item).parent(),
					th = $(&quot;&gt;th&quot;, p),
					colModel = ts.p.colModel,
					cmMap = {}, tid= ts.p.id+&quot;_&quot;;
					$.each(colModel, function(i) { cmMap[this.name]=i; });
					var permutation = [];
					th.each(function() {
						var id = $(&quot;&gt;div&quot;, this).get(0).id.replace(/^jqgh_/, &quot;&quot;).replace(tid,&quot;&quot;);
							if (cmMap.hasOwnProperty(id)) {
								permutation.push(cmMap[id]);
							}
					});

					$(ts).jqGrid(&quot;remapColumns&quot;,permutation, true, true);
					if ($.isFunction(ts.p.sortable.update)) {
						ts.p.sortable.update(permutation);
					}
					setTimeout(function(){ts.p.disableClick=false;}, 50);
				}
			};
			if (ts.p.sortable.options) {
				$.extend(sortable_opts, ts.p.sortable.options);
			} else if ($.isFunction(ts.p.sortable)) {
				ts.p.sortable = { &quot;update&quot; : ts.p.sortable };
			}
			if (sortable_opts.start) {
				var s = sortable_opts.start;
				sortable_opts.start = function(e,ui) {
					start();
					s.call(this,e,ui);
				};
			} else {
				sortable_opts.start = start;
			}
			if (ts.p.sortable.exclude) {
				sortable_opts.items += &quot;:not(&quot;+ts.p.sortable.exclude+&quot;)&quot;;
			}
			tblrow.sortable(sortable_opts).data(&quot;sortable&quot;).floating = true;
		});
	},
    columnChooser : function(opts) {
        var self = this;
		if($(&quot;#colchooser_&quot;+$.jgrid.jqID(self[0].p.id)).length ) { return; }
        var selector = $(&#x27;&lt;div id=&quot;colchooser_&#x27;+self[0].p.id+&#x27;&quot; style=&quot;position:relative;overflow:hidden&quot;&gt;&lt;div&gt;&lt;select multiple=&quot;multiple&quot;&gt;&lt;/select&gt;&lt;/div&gt;&lt;/div&gt;&#x27;);
        var select = $(&#x27;select&#x27;, selector);

		function insert(perm,i,v) {
			if(i&gt;=0){
				var a = perm.slice();
				var b = a.splice(i,Math.max(perm.length-i,i));
				if(i&gt;perm.length) { i = perm.length; }
				a[i] = v;
				return a.concat(b);
			}
		}
        opts = $.extend({
            &quot;width&quot; : 420,
            &quot;height&quot; : 240,
            &quot;classname&quot; : null,
            &quot;done&quot; : function(perm) { if (perm) { self.jqGrid(&quot;remapColumns&quot;, perm, true); } },
            /* msel is either the name of a ui widget class that
               extends a multiselect, or a function that supports
               creating a multiselect object (with no argument,
               or when passed an object), and destroying it (when
               passed the string &quot;destroy&quot;). */
            &quot;msel&quot; : &quot;multiselect&quot;,
            /* &quot;msel_opts&quot; : {}, */

            /* dlog is either the name of a ui widget class that
               behaves in a dialog-like way, or a function, that
               supports creating a dialog (when passed dlog_opts)
               or destroying a dialog (when passed the string
               &quot;destroy&quot;)
               */
            &quot;dlog&quot; : &quot;dialog&quot;,
			&quot;dialog_opts&quot; : {
				&quot;minWidth&quot;: 470
			},
            /* dlog_opts is either an option object to be passed
               to &quot;dlog&quot;, or (more likely) a function that creates
               the options object.
               The default produces a suitable options object for
               ui.dialog */
            &quot;dlog_opts&quot; : function(opts) {
                var buttons = {};
                buttons[opts.bSubmit] = function() {
                    opts.apply_perm();
                    opts.cleanup(false);
                };
                buttons[opts.bCancel] = function() {
                    opts.cleanup(true);
                };
                return $.extend(true, {
                    &quot;buttons&quot;: buttons,
                    &quot;close&quot;: function() {
                        opts.cleanup(true);
                    },
					&quot;modal&quot; : opts.modal || false,
					&quot;resizable&quot;: opts.resizable || true,
                    &quot;width&quot;: opts.width+20
                }, opts.dialog_opts || {});
            },
            /* Function to get the permutation array, and pass it to the
               &quot;done&quot; function */
            &quot;apply_perm&quot; : function() {
                $(&#x27;option&#x27;,select).each(function() {
                    if (this.selected) {
                        self.jqGrid(&quot;showCol&quot;, colModel[this.value].name);
                    } else {
                        self.jqGrid(&quot;hideCol&quot;, colModel[this.value].name);
                    }
                });

                var perm = [];
				//fixedCols.slice(0);
                $(&#x27;option:selected&#x27;,select).each(function() { perm.push(parseInt(this.value,10)); });
                $.each(perm, function() { delete colMap[colModel[parseInt(this,10)].name]; });
                $.each(colMap, function() {
					var ti = parseInt(this,10);
					perm = insert(perm,ti,ti);
				});
                if (opts.done) {
                    opts.done.call(self, perm);
                }
            },
            /* Function to cleanup the dialog, and select. Also calls the
               done function with no permutation (to indicate that the
               columnChooser was aborted */
            &quot;cleanup&quot; : function(calldone) {
                call(opts.dlog, selector, &#x27;destroy&#x27;);
                call(opts.msel, select, &#x27;destroy&#x27;);
                selector.remove();
                if (calldone &amp;&amp; opts.done) {
                    opts.done.call(self);
                }
            },
			&quot;msel_opts&quot; : {}
        }, $.jgrid.col, opts || {});
		if($.ui) {
			if ($.ui.multiselect ) {
				if(opts.msel === &quot;multiselect&quot;) {
					if(!$.jgrid._multiselect) {
						// should be in language file
						alert(&quot;Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!&quot;);
						return;
					}
					opts.msel_opts = $.extend($.ui.multiselect.defaults,opts.msel_opts);
				}
			}
		}
        if (opts.caption) {
            selector.attr(&quot;title&quot;, opts.caption);
        }
        if (opts.classname) {
            selector.addClass(opts.classname);
            select.addClass(opts.classname);
        }
        if (opts.width) {
            $(&quot;&gt;div&quot;,selector).css({&quot;width&quot;: opts.width,&quot;margin&quot;:&quot;0 auto&quot;});
            select.css(&quot;width&quot;, opts.width);
        }
        if (opts.height) {
            $(&quot;&gt;div&quot;,selector).css(&quot;height&quot;, opts.height);
            select.css(&quot;height&quot;, opts.height - 10);
        }
        var colModel = self.jqGrid(&quot;getGridParam&quot;, &quot;colModel&quot;);
        var colNames = self.jqGrid(&quot;getGridParam&quot;, &quot;colNames&quot;);
        var colMap = {}, fixedCols = [];

        select.empty();
        $.each(colModel, function(i) {
            colMap[this.name] = i;
            if (this.hidedlg) {
                if (!this.hidden) {
                    fixedCols.push(i);
                }
                return;
            }

            select.append(&quot;&lt;option value=&#x27;&quot;+i+&quot;&#x27; &quot;+
                          (this.hidden?&quot;&quot;:&quot;selected=&#x27;selected&#x27;&quot;)+&quot;&gt;&quot;+$.jgrid.stripHtml(colNames[i])+&quot;&lt;/option&gt;&quot;);
        });
        function call(fn, obj) {
            if (!fn) { return; }
            if (typeof fn === &#x27;string&#x27;) {
                if ($.fn[fn]) {
                    $.fn[fn].apply(obj, $.makeArray(arguments).slice(2));
                }
            } else if ($.isFunction(fn)) {
                fn.apply(obj, $.makeArray(arguments).slice(2));
            }
        }

        var dopts = $.isFunction(opts.dlog_opts) ? opts.dlog_opts.call(self, opts) : opts.dlog_opts;
        call(opts.dlog, selector, dopts);
        var mopts = $.isFunction(opts.msel_opts) ? opts.msel_opts.call(self, opts) : opts.msel_opts;
        call(opts.msel, select, mopts);
    },
	sortableRows : function (opts) {
		// Can accept all sortable options and events
		return this.each(function(){
			var $t = this;
			if(!$t.grid) { return; }
			// Currently we disable a treeGrid sortable
			if($t.p.treeGrid) { return; }
			if($.fn.sortable) {
				opts = $.extend({
					&quot;cursor&quot;:&quot;move&quot;,
					&quot;axis&quot; : &quot;y&quot;,
					&quot;items&quot;: &quot;.jqgrow&quot;
					},
				opts || {});
				if(opts.start &amp;&amp; $.isFunction(opts.start)) {
					opts._start_ = opts.start;
					delete opts.start;
				} else {opts._start_=false;}
				if(opts.update &amp;&amp; $.isFunction(opts.update)) {
					opts._update_ = opts.update;
					delete opts.update;
				} else {opts._update_ = false;}
				opts.start = function(ev,ui) {
					$(ui.item).css(&quot;border-width&quot;,&quot;0&quot;);
					$(&quot;td&quot;,ui.item).each(function(i){
						this.style.width = $t.grid.cols[i].style.width;
					});
					if($t.p.subGrid) {
						var subgid = $(ui.item).attr(&quot;id&quot;);
						try {
							$($t).jqGrid(&#x27;collapseSubGridRow&#x27;,subgid);
						} catch (e) {}
					}
					if(opts._start_) {
						opts._start_.apply(this,[ev,ui]);
					}
				};
				opts.update = function (ev,ui) {
					$(ui.item).css(&quot;border-width&quot;,&quot;&quot;);
					if($t.p.rownumbers === true) {
						$(&quot;td.jqgrid-rownum&quot;,$t.rows).each(function( i ){
							$(this).html( i+1+(parseInt($t.p.page,10)-1)*parseInt($t.p.rowNum,10) );
						});
					}
					if(opts._update_) {
						opts._update_.apply(this,[ev,ui]);
					}
				};
				$(&quot;tbody:first&quot;,$t).sortable(opts);
				$(&quot;tbody:first&quot;,$t).disableSelection();
			}
		});
	},
	gridDnD : function(opts) {
		return this.each(function(){
		var $t = this, i, cn;
		if(!$t.grid) { return; }
		// Currently we disable a treeGrid drag and drop
		if($t.p.treeGrid) { return; }
		if(!$.fn.draggable || !$.fn.droppable) { return; }
		function updateDnD ()
		{
			var datadnd = $.data($t,&quot;dnd&quot;);
			$(&quot;tr.jqgrow:not(.ui-draggable)&quot;,$t).draggable($.isFunction(datadnd.drag) ? datadnd.drag.call($($t),datadnd) : datadnd.drag);
		}
		var appender = &quot;&lt;table id=&#x27;jqgrid_dnd&#x27; class=&#x27;ui-jqgrid-dnd&#x27;&gt;&lt;/table&gt;&quot;;
		if($(&quot;#jqgrid_dnd&quot;)[0] === undefined) {
			$(&#x27;body&#x27;).append(appender);
		}

		if(typeof opts === &#x27;string&#x27; &amp;&amp; opts === &#x27;updateDnD&#x27; &amp;&amp; $t.p.jqgdnd===true) {
			updateDnD();
			return;
		}
		opts = $.extend({
			&quot;drag&quot; : function (opts) {
				return $.extend({
					start : function (ev, ui) {
						var i, subgid;
						// if we are in subgrid mode try to collapse the node
						if($t.p.subGrid) {
							subgid = $(ui.helper).attr(&quot;id&quot;);
							try {
								$($t).jqGrid(&#x27;collapseSubGridRow&#x27;,subgid);
							} catch (e) {}
						}
						// hack
						// drag and drop does not insert tr in table, when the table has no rows
						// we try to insert new empty row on the target(s)
						for (i=0;i&lt;$.data($t,&quot;dnd&quot;).connectWith.length;i++){
							if($($.data($t,&quot;dnd&quot;).connectWith[i]).jqGrid(&#x27;getGridParam&#x27;,&#x27;reccount&#x27;) === 0 ){
								$($.data($t,&quot;dnd&quot;).connectWith[i]).jqGrid(&#x27;addRowData&#x27;,&#x27;jqg_empty_row&#x27;,{});
							}
						}
						ui.helper.addClass(&quot;ui-state-highlight&quot;);
						$(&quot;td&quot;,ui.helper).each(function(i) {
							this.style.width = $t.grid.headers[i].width+&quot;px&quot;;
						});
						if(opts.onstart &amp;&amp; $.isFunction(opts.onstart) ) { opts.onstart.call($($t),ev,ui); }
					},
					stop :function(ev,ui) {
						var i, ids;
						if(ui.helper.dropped &amp;&amp; !opts.dragcopy) {
							ids = $(ui.helper).attr(&quot;id&quot;);
							if(ids === undefined) { ids = $(this).attr(&quot;id&quot;); }
							$($t).jqGrid(&#x27;delRowData&#x27;,ids );
						}
						// if we have a empty row inserted from start event try to delete it
						for (i=0;i&lt;$.data($t,&quot;dnd&quot;).connectWith.length;i++){
							$($.data($t,&quot;dnd&quot;).connectWith[i]).jqGrid(&#x27;delRowData&#x27;,&#x27;jqg_empty_row&#x27;);
						}
						if(opts.onstop &amp;&amp; $.isFunction(opts.onstop) ) { opts.onstop.call($($t),ev,ui); }
					}
				},opts.drag_opts || {});
			},
			&quot;drop&quot; : function (opts) {
				return $.extend({
					accept: function(d) {
						if (!$(d).hasClass(&#x27;jqgrow&#x27;)) { return d;}
						var tid = $(d).closest(&quot;table.ui-jqgrid-btable&quot;);
						if(tid.length &gt; 0 &amp;&amp; $.data(tid[0],&quot;dnd&quot;) !== undefined) {
							var cn = $.data(tid[0],&quot;dnd&quot;).connectWith;
							return $.inArray(&#x27;#&#x27;+$.jgrid.jqID(this.id),cn) !== -1 ? true : false;
						}
						return false;
					},
					drop: function(ev, ui) {
						if (!$(ui.draggable).hasClass(&#x27;jqgrow&#x27;)) { return; }
						var accept = $(ui.draggable).attr(&quot;id&quot;);
						var getdata = ui.draggable.parent().parent().jqGrid(&#x27;getRowData&#x27;,accept);
						if(!opts.dropbyname) {
							var j =0, tmpdata = {}, nm, key;
							var dropmodel = $(&quot;#&quot;+$.jgrid.jqID(this.id)).jqGrid(&#x27;getGridParam&#x27;,&#x27;colModel&#x27;);
							try {
								for (key in getdata) {
									if (getdata.hasOwnProperty(key)) {
									nm = dropmodel[j].name;
									if( !(nm === &#x27;cb&#x27; || nm === &#x27;rn&#x27; || nm === &#x27;subgrid&#x27; )) {
										if(getdata.hasOwnProperty(key) &amp;&amp; dropmodel[j]) {
											tmpdata[nm] = getdata[key];
										}
									}
									j++;
								}
								}
								getdata = tmpdata;
							} catch (e) {}
						}
						ui.helper.dropped = true;
						if(opts.beforedrop &amp;&amp; $.isFunction(opts.beforedrop) ) {
							//parameters to this callback - event, element, data to be inserted, sender, reciever
							// should return object which will be inserted into the reciever
							var datatoinsert = opts.beforedrop.call(this,ev,ui,getdata,$(&#x27;#&#x27;+$.jgrid.jqID($t.p.id)),$(this));
							if (datatoinsert !== undefined &amp;&amp; datatoinsert !== null &amp;&amp; typeof datatoinsert === &quot;object&quot;) { getdata = datatoinsert; }
						}
						if(ui.helper.dropped) {
							var grid;
							if(opts.autoid) {
								if($.isFunction(opts.autoid)) {
									grid = opts.autoid.call(this,getdata);
								} else {
									grid = Math.ceil(Math.random()*1000);
									grid = opts.autoidprefix+grid;
								}
							}
							// NULL is interpreted as undefined while null as object
							$(&quot;#&quot;+$.jgrid.jqID(this.id)).jqGrid(&#x27;addRowData&#x27;,grid,getdata,opts.droppos);
						}
						if(opts.ondrop &amp;&amp; $.isFunction(opts.ondrop) ) { opts.ondrop.call(this,ev,ui, getdata); }
					}}, opts.drop_opts || {});
			},
			&quot;onstart&quot; : null,
			&quot;onstop&quot; : null,
			&quot;beforedrop&quot;: null,
			&quot;ondrop&quot; : null,
			&quot;drop_opts&quot; : {
				&quot;activeClass&quot;: &quot;ui-state-active&quot;,
				&quot;hoverClass&quot;: &quot;ui-state-hover&quot;
			},
			&quot;drag_opts&quot; : {
				&quot;revert&quot;: &quot;invalid&quot;,
				&quot;helper&quot;: &quot;clone&quot;,
				&quot;cursor&quot;: &quot;move&quot;,
				&quot;appendTo&quot; : &quot;#jqgrid_dnd&quot;,
				&quot;zIndex&quot;: 5000
			},
			&quot;dragcopy&quot;: false,
			&quot;dropbyname&quot; : false,
			&quot;droppos&quot; : &quot;first&quot;,
			&quot;autoid&quot; : true,
			&quot;autoidprefix&quot; : &quot;dnd_&quot;
		}, opts || {});

		if(!opts.connectWith) { return; }
		opts.connectWith = opts.connectWith.split(&quot;,&quot;);
		opts.connectWith = $.map(opts.connectWith,function(n){return $.trim(n);});
		$.data($t,&quot;dnd&quot;,opts);

		if($t.p.reccount !== 0 &amp;&amp; !$t.p.jqgdnd) {
			updateDnD();
		}
		$t.p.jqgdnd = true;
		for (i=0;i&lt;opts.connectWith.length;i++){
			cn =opts.connectWith[i];
			$(cn).droppable($.isFunction(opts.drop) ? opts.drop.call($($t),opts) : opts.drop);
		}
		});
	},
	gridResize : function(opts) {
		return this.each(function(){
			var $t = this, gID = $.jgrid.jqID($t.p.id);
			if(!$t.grid || !$.fn.resizable) { return; }
			opts = $.extend({}, opts || {});
			if(opts.alsoResize ) {
				opts._alsoResize_ = opts.alsoResize;
				delete opts.alsoResize;
			} else {
				opts._alsoResize_ = false;
			}
			if(opts.stop &amp;&amp; $.isFunction(opts.stop)) {
				opts._stop_ = opts.stop;
				delete opts.stop;
			} else {
				opts._stop_ = false;
			}
			opts.stop = function (ev, ui) {
				$($t).jqGrid(&#x27;setGridParam&#x27;,{height:$(&quot;#gview_&quot;+gID+&quot; .ui-jqgrid-bdiv&quot;).height()});
				$($t).jqGrid(&#x27;setGridWidth&#x27;,ui.size.width,opts.shrinkToFit);
				if(opts._stop_) { opts._stop_.call($t,ev,ui); }
			};
			if(opts._alsoResize_) {
				var optstest = &quot;{\&#x27;#gview_&quot;+gID+&quot; .ui-jqgrid-bdiv\&#x27;:true,&#x27;&quot; +opts._alsoResize_+&quot;&#x27;:true}&quot;;
				opts.alsoResize = eval(&#x27;(&#x27;+optstest+&#x27;)&#x27;); // the only way that I found to do this
			} else {
				opts.alsoResize = $(&quot;.ui-jqgrid-bdiv&quot;,&quot;#gview_&quot;+gID);
			}
			delete opts._alsoResize_;
			$(&quot;#gbox_&quot;+gID).resizable(opts);
		});
	}
});
})(jQuery);
/*
 Transform a table to a jqGrid.
 Peter Romianowski &lt;peter.romianowski@optivo.de&gt;
 If the first column of the table contains checkboxes or
 radiobuttons then the jqGrid is made selectable.
*/
// Addition - selector can be a class or id
function tableToGrid(selector, options) {
jQuery(selector).each(function() {
	if(this.grid) {return;} //Adedd from Tony Tomov
	// This is a small &quot;hack&quot; to make the width of the jqGrid 100%
	jQuery(this).width(&quot;99%&quot;);
	var w = jQuery(this).width();

	// Text whether we have single or multi select
	var inputCheckbox = jQuery(&#x27;tr td:first-child input[type=checkbox]:first&#x27;, jQuery(this));
	var inputRadio = jQuery(&#x27;tr td:first-child input[type=radio]:first&#x27;, jQuery(this));
	var selectMultiple = inputCheckbox.length &gt; 0;
	var selectSingle = !selectMultiple &amp;&amp; inputRadio.length &gt; 0;
	var selectable = selectMultiple || selectSingle;
	//var inputName = inputCheckbox.attr(&quot;name&quot;) || inputRadio.attr(&quot;name&quot;);

	// Build up the columnModel and the data
	var colModel = [];
	var colNames = [];
	jQuery(&#x27;th&#x27;, jQuery(this)).each(function() {
		if (colModel.length === 0 &amp;&amp; selectable) {
			colModel.push({
				name: &#x27;__selection__&#x27;,
				index: &#x27;__selection__&#x27;,
				width: 0,
				hidden: true
			});
			colNames.push(&#x27;__selection__&#x27;);
		} else {
			colModel.push({
				name: jQuery(this).attr(&quot;id&quot;) || jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(&#x27; &#x27;).join(&#x27;_&#x27;),
				index: jQuery(this).attr(&quot;id&quot;) || jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(&#x27; &#x27;).join(&#x27;_&#x27;),
				width: jQuery(this).width() || 150
			});
			colNames.push(jQuery(this).html());
		}
	});
	var data = [];
	var rowIds = [];
	var rowChecked = [];
	jQuery(&#x27;tbody &gt; tr&#x27;, jQuery(this)).each(function() {
		var row = {};
		var rowPos = 0;
		jQuery(&#x27;td&#x27;, jQuery(this)).each(function() {
			if (rowPos === 0 &amp;&amp; selectable) {
				var input = jQuery(&#x27;input&#x27;, jQuery(this));
				var rowId = input.attr(&quot;value&quot;);
				rowIds.push(rowId || data.length);
				if (input.is(&quot;:checked&quot;)) {
					rowChecked.push(rowId);
				}
				row[colModel[rowPos].name] = input.attr(&quot;value&quot;);
			} else {
				row[colModel[rowPos].name] = jQuery(this).html();
			}
			rowPos++;
		});
		if(rowPos &gt;0) { data.push(row); }
	});

	// Clear the original HTML table
	jQuery(this).empty();

	// Mark it as jqGrid
	jQuery(this).addClass(&quot;scroll&quot;);

	jQuery(this).jqGrid(jQuery.extend({
		datatype: &quot;local&quot;,
		width: w,
		colNames: colNames,
		colModel: colModel,
		multiselect: selectMultiple
		//inputName: inputName,
		//inputValueCol: imputName != null ? &quot;__selection__&quot; : null
	}, options || {}));

	// Add data
	var a;
	for (a = 0; a &lt; data.length; a++) {
		var id = null;
		if (rowIds.length &gt; 0) {
			id = rowIds[a];
			if (id &amp;&amp; id.replace) {
				// We have to do this since the value of a checkbox
				// or radio button can be anything
				id = encodeURIComponent(id).replace(/[.\-%]/g, &quot;_&quot;);
			}
		}
		if (id === null) {
			id = a + 1;
		}
		jQuery(this).jqGrid(&quot;addRowData&quot;,id, data[a]);
	}

	// Set the selection
	for (a = 0; a &lt; rowChecked.length; a++) {
		jQuery(this).jqGrid(&quot;setSelection&quot;,rowChecked[a]);
	}
});
};
/*jshint eqeqeq:false */
/*global jQuery */
(function($){
/**
 * jqGrid pivot functions
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
*/
&quot;use strict&quot;;
// To optimize the search we need custom array filter
// This code is taken from
// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter

function _pivotfilter (fn, context) {
	var i,
		value,
		result = [],
		length;

	if (!this || typeof fn !== &#x27;function&#x27; || (fn instanceof RegExp)) {
		throw new TypeError();
	}

	length = this.length;

	for (i = 0; i &lt; length; i++) {
		if (this.hasOwnProperty(i)) {
			value = this[i];
			if (fn.call(context, value, i, this)) {
				result.push(value);
				// We need break in order to cancel loop
				// in case the row is found
				break;
			}
		}
	}
	return result;
}
$.assocArraySize = function(obj) {
    // http://stackoverflow.com/a/6700/11236
    var size = 0, key;
    for (key in obj) {
        if (obj.hasOwnProperty(key)) {
        	size++;
        }
    }
    return size;
};

$.jgrid.extend({
	pivotSetup : function( data, options ){
		// data should come in json format
		// The function return the new colModel and the transformed data
		// again with group setup options which then will be passed to the grid
		var columns =[],
		pivotrows =[],
		summaries = [],
		member=[],
		groupOptions = {
			grouping : true,
			groupingView :  {
				groupField : [],
				groupSummary: [],
				groupSummaryPos:[]
			}
		},
		headers = [],
		o = $.extend ( {
			rowTotals : false,
			rowTotalsText : &#x27;Total&#x27;,
			// summary columns
			colTotals : false,
			groupSummary : true,
			groupSummaryPos :  &#x27;header&#x27;,
			frozenStaticCols : false
		}, options || {});
		this.each(function(){

			var
				row,
				rowindex,
				i,

				rowlen = data.length,
				xlen, ylen, aggrlen,
				tmp,
				newObj,
				r=0;
			// utility funcs
			/*
			 * Filter the data to a given criteria. Return the firt occurance
			 */
			function find(ar, fun, extra) {
				var res;
				res = _pivotfilter.call(ar, fun, extra);
				return res.length &gt; 0 ? res[0] : null;
			}
			/*
			 * Check if the grouped row column exist (See find)
			 * If the row is not find in pivot rows retun null,
			 * otherviese the column
			 */
			function findGroup(item, index) {
				var j = 0, ret = true, i;
				for(i in item) {
					if(item[i] != this[j]) {
						ret =  false;
						break;
					}
					j++;
					if(j&gt;=this.length) {
						break;
					}
				}
				if(ret) {
					rowindex =  index;
				}
				return ret;
			}
			/*
			 * Perform calculations of the pivot values.
			 */
			function calculation(oper, v, field, rc)  {
				var ret;
				switch (oper) {
					case  &quot;sum&quot; :
						ret = parseFloat(v||0) + parseFloat((rc[field]||0));
						break;
					case &quot;count&quot; :
						if(v===&quot;&quot; || v == null) {
							v=0;
						}
						if(rc.hasOwnProperty(field)) {
							ret = v+1;
						} else {
							ret = 0;
						}
						break;
					case &quot;min&quot; :
						if(v===&quot;&quot; || v == null) {
							ret = parseFloat(rc[field]||0);
						} else {
							ret =Math.min(parseFloat(v),parseFloat(rc[field]||0));
						}
						break;
					case &quot;max&quot; :
						if(v===&quot;&quot; || v == null) {
							ret = parseFloat(rc[field]||0);
						} else {
							ret = Math.max(parseFloat(v),parseFloat(rc[field]||0));
						}
						break;
				}
				return ret;
			}
			/*
			 * The function agragates the values of the pivot grid.
			 * Return the current row with pivot summary values
			 */
			function agregateFunc ( row, aggr, value, curr) {
				// default is sum
				var arrln = aggr.length, i, label, j, jv;
				if($.isArray(value)) {
					jv = value.length;
				} else {
					jv = 1;
				}
				member = [];
				member.root = 0;
				for(j=0;j&lt;jv;j++) {
					var  tmpmember = [], vl;
					for(i=0; i &lt; arrln; i++) {
						if(value == null) {
							label = $.trim(aggr[i].member)+&quot;_&quot;+aggr[i].aggregator;
							vl = label;
						} else {
							vl = value[j].replace(/\s+/g, &#x27;&#x27;);
							try {
								label = (arrln === 1 ? vl : vl+&quot;_&quot;+aggr[i].aggregator+&quot;_&quot;+i);
							} catch(e) {}
						}
						curr[label] =  tmpmember[label] = calculation( aggr[i].aggregator, curr[label], aggr[i].member, row);
					}
					member[vl] = tmpmember;
				}
				return curr;
			}
			// Making the row totals without to add in yDimension
			if(o.rowTotals &amp;&amp; o.yDimension.length &gt; 0) {
				var dn = o.yDimension[0].dataName;
				o.yDimension.splice(0,0,{dataName:dn});
				o.yDimension[0].converter =  function(){ return &#x27;_r_Totals&#x27;; };
			}
			// build initial columns (colModel) from xDimension
			xlen = $.isArray(o.xDimension) ? o.xDimension.length : 0;
			ylen = o.yDimension.length;
			aggrlen  = $.isArray(o.aggregates) ? o.aggregates.length : 0;
			if(xlen === 0 || aggrlen === 0) {
				throw(&quot;xDimension or aggregates optiona are not set!&quot;);
			}
			var colc;
			for(i = 0; i&lt; xlen; i++) {
				colc = {name:o.xDimension[i].dataName, frozen: o.frozenStaticCols};
				colc = $.extend(true, colc, o.xDimension[i]);
				columns.push( colc );
			}
			var groupfields = xlen - 1, tree={};
			//tree = { text: &#x27;root&#x27;, leaf: false, children: [] };
			//loop over alll the source data
			while( r &lt; rowlen ) {
				row = data[r];
				var xValue = [];
				var yValue = [];
				tmp = {};
				i = 0;
				// build the data from xDimension
				do {
					xValue[i]  = $.trim(row[o.xDimension[i].dataName]);
					tmp[o.xDimension[i].dataName] = xValue[i];
					i++;
				} while( i &lt; xlen );

				var k = 0;
				rowindex = -1;
				// check to see if the row is in our new pivotrow set
				newObj = find(pivotrows, findGroup, xValue);
				if(!newObj) {
					// if the row is not in our set
					k = 0;
					// if yDimension is set
					if(ylen&gt;=1) {
						// build the cols set in yDimension
						for(k=0;k&lt;ylen;k++) {
							yValue[k] = $.trim(row[o.yDimension[k].dataName]);
							// Check to see if we have user defined conditions
							if(o.yDimension[k].converter &amp;&amp; $.isFunction(o.yDimension[k].converter)) {
								yValue[k] = o.yDimension[k].converter.call(this, yValue[k], xValue, yValue);
							}
						}
						// make the colums based on aggregates definition
						// and return the members for late calculation
						tmp = agregateFunc( row, o.aggregates, yValue, tmp );
					} else  if( ylen === 0 ) {
						// if not set use direct the aggregates
						tmp = agregateFunc( row, o.aggregates, null, tmp );
					}
					// add the result in pivot rows
					pivotrows.push( tmp );
				} else {
					// the pivot exists
					if( rowindex &gt;= 0) {
						k = 0;
						// make the recalculations
						if(ylen&gt;=1) {
							for(k=0;k&lt;ylen;k++) {
								yValue[k] = $.trim(row[o.yDimension[k].dataName]);
								if(o.yDimension[k].converter &amp;&amp; $.isFunction(o.yDimension[k].converter)) {
									yValue[k] = o.yDimension[k].converter.call(this, yValue[k], xValue, yValue);
								}
							}
							newObj = agregateFunc( row, o.aggregates, yValue, newObj );
						} else  if( ylen === 0 ) {
							newObj = agregateFunc( row, o.aggregates, null, newObj );
						}
						// update the row
						pivotrows[rowindex] = newObj;
					}
				}
				var kj=0, current = null,existing = null, kk;
				// Build a JSON tree from the member (see aggregateFunc)
				// to make later the columns
				//
				for (kk in member) {
					if(kj === 0) {
						if (!tree.children||tree.children === undefined){
							tree = { text: kk, level : 0, children: [] };
						}
						current = tree.children;
					} else {
						existing = null;
						for (i=0; i &lt; current.length; i++) {
							if (current[i].text === kk) {
								//current[i].fields=member[kk];
								existing = current[i];
								break;
							}
						}
						if (existing) {
							current = existing.children;
						} else {
							current.push({ children: [], text: kk, level: kj,  fields: member[kk] });
							current = current[current.length - 1].children;
						}
					}
					kj++;
				}
				r++;
			}
			var  lastval=[], initColLen = columns.length, swaplen = initColLen;
			if(ylen&gt;0) {
				headers[ylen-1] = {	useColSpanStyle: false,	groupHeaders: []};
			}
			/*
			 * Recursive function which uses the tree to build the
			 * columns from the pivot values and set the group Headers
			 */
			function list(items) {
				var l, j, key, k, col;
				for (key in items) { // iterate
					if (items.hasOwnProperty(key)) {
					// write amount of spaces according to level
					// and write name and newline
						if(typeof items[key] !== &quot;object&quot;) {
							// If not a object build the header of the appropriate level
							if( key === &#x27;level&#x27;) {
								if(lastval[items.level] === undefined) {
									lastval[items.level] =&#x27;&#x27;;
									if(items.level&gt;0 &amp;&amp; items.text !== &#x27;_r_Totals&#x27;) {
										headers[items.level-1] = {
											useColSpanStyle: false,
											groupHeaders: []
										};
									}
								}
								if(lastval[items.level] !== items.text &amp;&amp; items.children.length &amp;&amp; items.text !== &#x27;_r_Totals&#x27;) {
									if(items.level&gt;0) {
										headers[items.level-1].groupHeaders.push({
											titleText: items.text
										});
										var collen = headers[items.level-1].groupHeaders.length,
										colpos = collen === 1 ? swaplen : initColLen+(collen-1)*aggrlen;
										headers[items.level-1].groupHeaders[collen-1].startColumnName = columns[colpos].name;
										headers[items.level-1].groupHeaders[collen-1].numberOfColumns = columns.length - colpos;
										initColLen = columns.length;
									}
								}
								lastval[items.level] = items.text;
							}
							// This is in case when the member contain more than one summary item
							if(items.level === ylen  &amp;&amp; key===&#x27;level&#x27; &amp;&amp; ylen &gt;0) {
								if( aggrlen &gt; 1){
									var ll=1;
									for( l in items.fields) {
										if(ll===1) {
											headers[ylen-1].groupHeaders.push({startColumnName: l, numberOfColumns: 1, titleText: items.text});
										}
										ll++;
									}
									headers[ylen-1].groupHeaders[headers[ylen-1].groupHeaders.length-1].numberOfColumns = ll-1;
								} else {
									headers.splice(ylen-1,1);
								}
							}
						}
						// if object, call recursively
						if (items[key] != null &amp;&amp; typeof items[key] === &quot;object&quot;) {
							list(items[key]);
						}
						// Finally build the coulumns
						if( key === &#x27;level&#x27;) {
							if(items.level &gt;0){
								j=0;
								for(l in items.fields) {
									col = {};
									for(k in o.aggregates[j]) {
										if(o.aggregates[j].hasOwnProperty(k)) {
											switch( k ) {
												case &#x27;member&#x27;:
												case &#x27;label&#x27;:
												case &#x27;aggregator&#x27;:
													break;
												default:
													col[k] = o.aggregates[j][k];
											}
										}
									}
									if(aggrlen&gt;1) {
										col.name = l;
										col.label = o.aggregates[j].label || l;
									} else {
										col.name = items.text;
										col.label = items.text===&#x27;_r_Totals&#x27; ? o.rowTotalsText : items.text;
									}
									columns.push (col);
									j++;
								}
							}
						}
					}
				}
			}

			list(tree, 0);
			var nm;
			// loop again trougth the pivot rows in order to build grand total
			if(o.colTotals) {
				var plen = pivotrows.length;
				while(plen--) {
					for(i=xlen;i&lt;columns.length;i++) {
						nm = columns[i].name;
						if(!summaries[nm]) {
							summaries[nm] = parseFloat(pivotrows[plen][nm] || 0);
						} else {
							summaries[nm] += parseFloat(pivotrows[plen][nm] || 0);
						}
					}
				}
			}
			// based on xDimension  levels build grouping
			if( groupfields &gt; 0) {
				for(i=0;i&lt;groupfields;i++) {
					groupOptions.groupingView.groupField[i] = columns[i].name;
					groupOptions.groupingView.groupSummary[i] = o.groupSummary;
					groupOptions.groupingView.groupSummaryPos[i] = o.groupSummaryPos;
				}
			} else {
				// no grouping is needed
				groupOptions.grouping = false;
			}
			groupOptions.sortname = columns[groupfields].name;
			groupOptions.groupingView.hideFirstGroupCol = true;
		});
		// return the final result.
		return { &quot;colModel&quot; : columns, &quot;rows&quot;: pivotrows, &quot;groupOptions&quot; : groupOptions, &quot;groupHeaders&quot; :  headers, summary : summaries };
	},
	jqPivot : function( data, pivotOpt, gridOpt, ajaxOpt) {
		return this.each(function(){
			var $t = this;

			function pivot( data) {
				var pivotGrid = jQuery($t).jqGrid(&#x27;pivotSetup&#x27;,data, pivotOpt),
				footerrow = $.assocArraySize(pivotGrid.summary) &gt; 0 ? true : false,
				query= $.jgrid.from(pivotGrid.rows), i;
				for(i=0; i&lt; pivotGrid.groupOptions.groupingView.groupField.length; i++) {
					query.orderBy(pivotGrid.groupOptions.groupingView.groupField[i], &quot;a&quot;, &#x27;text&#x27;, &#x27;&#x27;);
				}
				jQuery($t).jqGrid($.extend({
					datastr: $.extend(query.select(),footerrow ? {userdata:pivotGrid.summary} : {}),
					datatype: &quot;jsonstring&quot;,
					footerrow : footerrow,
					userDataOnFooter: footerrow,
					colModel: pivotGrid.colModel,
					viewrecords: true,
					sortname: pivotOpt.xDimension[0].dataName // ?????
				}, gridOpt || {}, pivotGrid.groupOptions));
				var gHead = pivotGrid.groupHeaders;
				if(gHead.length) {
					for( i = 0;i &lt; gHead.length ; i++) {
						if(gHead[i] &amp;&amp; gHead[i].groupHeaders.length) {
							jQuery($t).jqGrid(&#x27;setGroupHeaders&#x27;,gHead[i]);
						}
					}
				}
				if(pivotOpt.frozenStaticCols) {
					jQuery($t).jqGrid(&quot;setFrozenColumns&quot;);
				}
			}

			if(typeof data === &quot;string&quot;) {
				$.ajax($.extend({
					url : data,
					dataType: &#x27;json&#x27;,
					success : function(response) {
						pivot($.jgrid.getAccessor(response, ajaxOpt &amp;&amp; ajaxOpt.reader ? ajaxOpt.reader: &#x27;rows&#x27;) );
					}
				}, ajaxOpt || {}) );
			} else {
				pivot( data );
			}
		});
	}
});
})(jQuery);

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
